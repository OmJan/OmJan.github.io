<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="ru">
<head>
<meta charset="utf-8">
<meta name="description" content="IT blog">
<meta name="viewport" content="width=device-width">
<title>VelikiiNehochuha Blog</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="ru" href="rss.xml">
<link rel="canonical" href="http://velikiinehochuha.github.io/">
<link rel="next" href="index-1.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link rel="prefetch" href="posts/sicp-25-sistemy-s-obshchimi-operatsiiami/" type="text/html">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Перейти к главному содержимому</a>
    <div id="container">
             <header id="header"><h1 id="brand"><a href="http://velikiinehochuha.github.io/" title="VelikiiNehochuha Blog" rel="home">

        <span id="blog-title">VelikiiNehochuha Blog</span>
    </a></h1>

        
            <nav id="menu"><ul>
<li><a href="archive.html">Архив</a></li>
                <li><a href="categories/">Тэги</a></li>
                <li><a href="rss.xml">RSS лента</a></li>

    
    
    
    </ul></nav></header><main id="content"><div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-25-sistemy-s-obshchimi-operatsiiami/" class="u-url">SICP 2.5 Системы с общими операциями.</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-25-sistemy-s-obshchimi-operatsiiami/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-25T20:11:07+03:00" itemprop="datePublished" title="2020-01-25 20:11">2020-01-25 20:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
Системы с общими операциями не только для разных представлений, но и для разного числа аргументов.
</p>

<div id="outline-container-org3d2b23d" class="outline-2">
<h2 id="org3d2b23d">Упражнение 2.77</h2>
<div class="outline-text-2" id="text-org3d2b23d">
<p>
Луис Разумный пытается выполнить процедуру (magnitude z) где z объект комплексного числа как на изображении.
</p>

<p>
<img src="images/ch2-Z-G-65.gif" alt="nil"></p>

<p>
К его удивлению вместо числа, он получает ошибку ;No method for these types – APPLY-GENERIC (magnitude (complex)). Он показывает результат Алисе. Она говорит что пакет custom, не имеет селекторов magnitude, .. и предлагает добавить их в пакет.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">put</span> <span class="ss">'real-part</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span><span class="p">)</span> <span class="nv">real-part</span><span class="p">)</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'imag-part</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span><span class="p">)</span> <span class="nv">imag-part</span><span class="p">)</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'magnitude</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span><span class="p">)</span> <span class="nv">magnitude</span><span class="p">)</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'angle</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span><span class="p">)</span> <span class="nv">angle</span><span class="p">)</span>

<span class="p">(</span><span class="nb">magnitude </span><span class="p">(</span><span class="nf">make-complex-from-mag-ang</span> <span class="mi">10</span> <span class="mf">0.5</span><span class="p">))</span>
</pre></div>

<p>
Объясните почему это будет работать? Сколько раз вызывается apply-generic? Какая процедура выполняется в каждом случае?
</p>

<p>
apply-generic вызывается два раза, на первом этапе происходит отображение на процедуру magnitude только с другим тегом, а во втором случае происходит отображение процедуру на внутреннюю процедуру поката polar.
</p>

<p>
[Entering #[compound-procedure 88 magnitude]
    Args: (complex polar 10 . .5)]
[Entering #[compound-procedure 88 magnitude]
    Args: (polar 10 . .5)]
[10
      &lt;== #[compound-procedure 88 magnitude]
    Args: (polar 10 . .5)]
[10
      &lt;== #[compound-procedure 88 magnitude]
    Args: (complex polar 10 . .5)]
</p>
</div>
</div>

<div id="outline-container-org48cfd39" class="outline-2">
<h2 id="org48cfd39">Упражнение 2.78</h2>
<div class="outline-text-2" id="text-org48cfd39">
<p>
Внутренние процедуры scheme-number по существу просто вызывают процедуры +/-/.. Не возможно использовать примитивы языка напрямую, потому что наша система тип-тег требует что бы каждый объект имел тег, в тоже время все реализации Lisp имеют внутренню систему типов. Примитивы symbol? number? определяют являются ли объекты примитивными типами. Измените определение type-tag, contents и attach-tag, что бы наша система получила преимущество использования внутренних типов Scheme. То есть функции должны работать по прежнему, но для операции над простыми числами не требуется дополнительный конструктор, который возвращает пару тип значение.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-scheme-number-package</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'add</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'sub</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">- </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'mul</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'div</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)))</span>
  <span class="ss">'done</span><span class="p">)</span>
<span class="p">(</span><span class="nf">install-scheme-number-package</span><span class="p">)</span> <span class="c1">;; установка пакета</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">attach-tag</span> <span class="nv">type-tag</span> <span class="nv">contents</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">number? </span><span class="nv">contents</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">cons </span><span class="ss">'scheme-number</span> <span class="nv">contents</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">cons </span><span class="nv">type-tag</span> <span class="nv">contents</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">type-tag</span> <span class="nv">datum</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">number? </span><span class="nv">datum</span><span class="p">)</span> <span class="ss">'scheme-number</span><span class="p">)</span>
	<span class="p">((</span><span class="nb">pair? </span><span class="nv">datum</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">datum</span><span class="p">))</span>
	<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">error</span> <span class="s">"Bad tagged datum -- TYPE-TAG"</span> <span class="nv">datum</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">contents</span> <span class="nv">datum</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">number? </span><span class="nv">datum</span><span class="p">)</span> <span class="nv">datum</span><span class="p">)</span>
	<span class="p">((</span><span class="nb">pair? </span><span class="nv">datum</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">datum</span><span class="p">))</span>
	<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">error</span> <span class="s">"Bad tagged datum -- CONTENTS"</span> <span class="nv">datum</span><span class="p">))))</span>

<span class="p">(</span><span class="nf">add</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">;; 3</span>
</pre></div>
</div>
</div>


<div id="outline-container-org7b91fc1" class="outline-2">
<h2 id="org7b91fc1">Упражнение 2.79, 2.80</h2>
<div class="outline-text-2" id="text-org7b91fc1">
<p>
Определите общую процедуру equ? которая проверяет эквивалентность двух чисел. Процедура должна работать с обычными, рациональными и комплексными числами.
</p>

<p>
Определите общую процедуру =zero?
</p>

<div class="highlight"><pre><span></span><span class="c1">;; в интерфейсах пакетов</span>
<span class="c1">;; для обычных</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'equ?</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'=zero?</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">x</span> <span class="mi">0</span><span class="p">)))</span>
<span class="c1">;; для комплексных</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'equ?</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span> <span class="nv">complex</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">real-part </span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">y</span><span class="p">))</span> <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">imag-part </span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">imag-part </span><span class="nv">y</span><span class="p">)))))</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'=zero?</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">magnitude </span><span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)))</span>
<span class="c1">;; для рациональных</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'equ?</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span> <span class="nv">rational</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">y</span><span class="p">))</span> <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">y</span><span class="p">)))))</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'=zero?</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)))</span>
<span class="c1">;; общее определение</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">equ?</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'equ?</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">=zero?</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'=zero?</span> <span class="nv">x</span><span class="p">))</span>
<span class="p">(</span><span class="nf">=zero?</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">=zero?</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">(</span><span class="nf">equ?</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="nf">equ?</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">=zero?</span> <span class="p">(</span><span class="nf">make-complex-from-mag-ang</span> <span class="mi">10</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="nf">equ?</span> <span class="p">(</span><span class="nf">make-complex-from-mag-ang</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-complex-from-real-imag</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">))</span>
<span class="p">(</span><span class="nf">equ?</span> <span class="p">(</span><span class="nf">make-complex-from-real-imag</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-complex-from-real-imag</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="nf">equ?</span> <span class="p">(</span><span class="nf">make-rational</span> <span class="mi">2</span> <span class="mi">6</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-rational</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">))</span>
<span class="p">(</span><span class="nf">=zero?</span> <span class="p">(</span><span class="nf">make-rational</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>


<div id="outline-container-orge1b2234" class="outline-2">
<h2 id="orge1b2234">Упражнение 2.81</h2>
<div class="outline-text-2" id="text-orge1b2234">
<p>
Луис Разумный заметил что apply-generic может приводить аргументы, даже если они одного типа. Поэтому, он рассудил, что мы должны поместить процедуры приведения одинаковых типов в таблицу приведения.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">scheme-number-&gt;scheme-number</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">n</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">complex-&gt;complex</span> <span class="nv">z</span><span class="p">)</span> <span class="nv">z</span><span class="p">)</span>
<span class="p">(</span><span class="nf">put-coercion</span> <span class="ss">'scheme-number</span> <span class="ss">'scheme-number</span>
	      <span class="nv">scheme-number-&gt;scheme-number</span><span class="p">)</span>
<span class="p">(</span><span class="nf">put-coercion</span> <span class="ss">'complex</span> <span class="ss">'complex</span> <span class="nv">complex-&gt;complex</span><span class="p">)</span>
</pre></div>

<p>
a. С установленными процедурами Луиса, что произойдет если вызвать apply-generic с двумя аргументами типа scheme-number или двумя аргументами типа complex для операции которой нет в таблице этих типов? к примеру зададим общую процедуру экспоненты:
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">exp </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'exp</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>

<span class="c1">;; following added to Scheme-number package</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'exp</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span>
     <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nb">expt </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span> <span class="c1">; using primitive expt</span>
</pre></div>

<p>
и вызовем её для комплексных чисел.
</p>

<p>
произойдет рекурсивный вызов apply-generic.
</p>

<p>
b. Прав ли Луис что дописал эти преобразования типов?
Код Луиса лишний, apply-generic и так работает.
</p>

<p>
с. Измените apply-generic чтобы он не пытался искать в таблице приведения типов, если типы аргументов одинаковые.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">apply-generic</span> <span class="nv">op</span> <span class="o">.</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">type-tags</span> <span class="p">(</span><span class="nb">map </span><span class="nv">type-tag</span> <span class="nv">args</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">proc</span> <span class="p">(</span><span class="nf">get</span> <span class="nv">op</span> <span class="nv">type-tags</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">if </span><span class="nv">proc</span>
	  <span class="p">(</span><span class="nb">apply </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">map </span><span class="nv">contents</span> <span class="nv">args</span><span class="p">))</span>
	  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">length </span><span class="nv">args</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
	      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">type1</span> <span class="p">(</span><span class="nb">car </span><span class="nv">type-tags</span><span class="p">))</span>
		    <span class="p">(</span><span class="nf">type2</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">type-tags</span><span class="p">))</span>
		    <span class="p">(</span><span class="nf">a1</span> <span class="p">(</span><span class="nb">car </span><span class="nv">args</span><span class="p">))</span>
		    <span class="p">(</span><span class="nf">a2</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">args</span><span class="p">)))</span>
		<span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">equal? </span><span class="nv">type1</span> <span class="nv">type2</span><span class="p">)</span>
		    <span class="p">(</span><span class="nf">error</span> <span class="s">"No method for these types"</span>
			   <span class="p">(</span><span class="nb">list </span><span class="nv">op</span> <span class="nv">type-tags</span><span class="p">))</span>
		    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">t1-&gt;t2</span> <span class="p">(</span><span class="nf">get-coercion</span> <span class="nv">type1</span> <span class="nv">type2</span><span class="p">))</span>
			  <span class="p">(</span><span class="nf">t2-&gt;t1</span> <span class="p">(</span><span class="nf">get-coercion</span> <span class="nv">type2</span> <span class="nv">type1</span><span class="p">)))</span>
		      <span class="p">(</span><span class="k">cond </span><span class="p">(</span><span class="nf">t1-&gt;t2</span>
			     <span class="p">(</span><span class="nf">apply-generic</span> <span class="nv">op</span> <span class="p">(</span><span class="nf">t1-&gt;t2</span> <span class="nv">a1</span><span class="p">)</span> <span class="nv">a2</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">t2-&gt;t1</span>
			     <span class="p">(</span><span class="nf">apply-generic</span> <span class="nv">op</span> <span class="nv">a1</span> <span class="p">(</span><span class="nf">t2-&gt;t1</span> <span class="nv">a2</span><span class="p">)))</span>
			    <span class="p">(</span><span class="nf">else</span>
			     <span class="p">(</span><span class="nf">error</span> <span class="s">"No method for these types"</span>
				    <span class="p">(</span><span class="nb">list </span><span class="nv">op</span> <span class="nv">type-tags</span><span class="p">)))))))</span>
		<span class="p">(</span><span class="nf">error</span> <span class="s">"No method for these types"</span>
		       <span class="p">(</span><span class="nb">list </span><span class="nv">op</span> <span class="nv">type-tags</span><span class="p">)))))))</span>
</pre></div>
</div>
</div>


<div id="outline-container-org36fb671" class="outline-2">
<h2 id="org36fb671">Упражнение 2.82</h2>
<div class="outline-text-2" id="text-org36fb671">
<p>
Покажите как обобщить apply-generic для обработки приведения типов множественных аргументов. Одна из стратегий, попытка привести все аргументы к типу первого аргумента, затем к типу второго и так далее.
Дайте пример когда такая стратегия не работает (более того она может не сработать и для двух аргументов).
</p>

<p>
Если у нас есть три типа T1, T2, T3 и задана операция для T1, T2, T2 в таблице операций, то мы не найдем эту операцию, потому что при полном приведении типов сможем получить только T1 T2 T3, T1 T1 T1, T2 T2 T2, T3 T3 T3.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">map-args</span> <span class="nv">args</span> <span class="nv">type-tags</span> <span class="nv">cdr-type-tags</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">try-coercion</span> <span class="nv">args</span> <span class="nv">type-list</span> <span class="nv">target-type</span> <span class="nv">res</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">type-list</span><span class="p">)</span>
	<span class="nv">res</span>
	<span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">equal? </span><span class="p">(</span><span class="nb">car </span><span class="nv">type-list</span><span class="p">)</span> <span class="nv">target-type</span><span class="p">)</span>
	    <span class="p">(</span><span class="nf">try-coercion</span>
	     <span class="p">(</span><span class="nb">cdr </span><span class="nv">args</span><span class="p">)</span>
	     <span class="p">(</span><span class="nb">cdr </span><span class="nv">type-list</span><span class="p">)</span>
	     <span class="nv">target-type</span>
	     <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">args</span><span class="p">)</span> <span class="nv">res</span><span class="p">))</span>
	    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">t2-&gt;t1</span> <span class="p">(</span><span class="nf">get-coercion</span> <span class="p">(</span><span class="nb">car </span><span class="nv">type-list</span><span class="p">)</span> <span class="nv">target-type</span><span class="p">)))</span>
	      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="nv">t2-&gt;t1</span><span class="p">)</span>
		  <span class="nv">false</span>
		  <span class="p">(</span><span class="nf">try-coercion</span>
		   <span class="p">(</span><span class="nb">cdr </span><span class="nv">args</span><span class="p">)</span>
		   <span class="p">(</span><span class="nb">cdr </span><span class="nv">type-list</span><span class="p">)</span>
		   <span class="nv">target-type</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">t2-&gt;t1</span> <span class="p">(</span><span class="nb">car </span><span class="nv">args</span><span class="p">))</span> <span class="nv">res</span><span class="p">)))))))</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">cdr-type-tags</span><span class="p">)</span> <span class="p">(</span><span class="nf">error</span> <span class="s">"No method for these types"</span><span class="p">))</span>
	<span class="p">(</span><span class="nf">else</span>
	 <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">mapped-args</span> <span class="p">(</span><span class="nf">try-coercion</span> <span class="nv">args</span> <span class="nv">type-tags</span> <span class="p">(</span><span class="nb">car </span><span class="nv">cdr-type-tags</span><span class="p">)</span> <span class="o">'</span><span class="p">())))</span>
	   <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="nv">mapped-args</span><span class="p">)</span>
	       <span class="p">(</span><span class="nf">map-args</span> <span class="nv">args</span> <span class="nv">type-tags</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">cdr-type-tags</span><span class="p">))</span>
	       <span class="nv">mapped-args</span><span class="p">)))))</span>


<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">apply-generic</span> <span class="nv">op</span> <span class="o">.</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">type-tags</span> <span class="p">(</span><span class="nb">map </span><span class="nv">type-tag</span> <span class="nv">args</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">proc</span> <span class="p">(</span><span class="nf">get</span> <span class="nv">op</span> <span class="nv">type-tags</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="nv">proc</span><span class="p">)</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">mapped-args</span> <span class="p">(</span><span class="nf">map-args</span> <span class="nv">args</span> <span class="nv">type-tags</span> <span class="nv">type-tags</span><span class="p">)))</span>
	    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="nv">mapped-args</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">error</span> <span class="s">"No method for these types"</span> <span class="p">(</span><span class="nb">list </span><span class="nv">op</span> <span class="nv">type-tags</span><span class="p">))</span>
		<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">mapped-type-tags</span> <span class="p">(</span><span class="nb">map </span><span class="nv">type-tag</span> <span class="nv">mapped-args</span><span class="p">)))</span>
		  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">proc</span> <span class="p">(</span><span class="nf">get</span> <span class="nv">op</span> <span class="nv">mapped-type-tags</span><span class="p">)))</span>
		    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="nv">proc</span><span class="p">)</span>
			<span class="p">(</span><span class="nf">error</span> <span class="s">"No method for these types"</span> <span class="p">(</span><span class="nb">list </span><span class="nv">op</span> <span class="nv">type-tags</span><span class="p">))</span>
			<span class="p">(</span><span class="nb">apply </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">map </span><span class="nv">contents</span> <span class="nv">mapped-args</span><span class="p">)))))))</span>
	  <span class="p">(</span><span class="nb">apply </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">map </span><span class="nv">contents</span> <span class="nv">args</span><span class="p">))</span>
	  <span class="p">))))</span>

<span class="p">(</span><span class="nf">get</span> <span class="ss">'add</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span> <span class="nv">complex</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'add</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="nf">add</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">make-complex-from-real-imag</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgcf942c2" class="outline-2">
<h2 id="orgcf942c2">Упражнение 2.83</h2>
<div class="outline-text-2" id="text-orgcf942c2">
<p>
Предположим вы разрабатываете систему для работы с башней типов как на картинке
</p>

<p>
<img src="images/ch2-Z-G-66.gif" alt="nil"></p>

<p>
Для каждого типа (за исключением комплексного), напишите процедуру которая поднимает тип на один уровень. Покажите как установить общую операцию raise,которая будет работать для всех типов, кроме комплексного.
</p>

<p>
если мы добавим метод raise в пакеты для scheme-number, rational, complex, тогда мы потеряем возможность разрабатывать пакеты отдельно, поэтому лучше реализовать метод через отдельную функцию.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-raise-package</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-rational</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make</span> <span class="ss">'rational</span><span class="p">)</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-complex-from-real-imag</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make-from-real-imag</span> <span class="ss">'complex</span><span class="p">)</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-real</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make</span> <span class="ss">'scheme-real</span><span class="p">)</span> <span class="nv">x</span><span class="p">))</span>
  <span class="c1">;; interface</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'raise</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-rational</span> <span class="nv">x</span> <span class="mi">1</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'raise</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-real</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'raise</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-real</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-complex-from-real-imag</span> <span class="nv">x</span> <span class="mi">0</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'raise</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">error</span> <span class="s">"complex can't raise"</span><span class="p">)))</span>
  <span class="ss">'done</span><span class="p">)</span>
<span class="p">(</span><span class="nf">install-raise-package</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">raise</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'raise</span> <span class="nv">x</span><span class="p">))</span>
<span class="p">(</span><span class="nf">raise</span> <span class="p">(</span><span class="nf">raise</span> <span class="p">(</span><span class="nf">raise</span> <span class="p">(</span><span class="nf">make-number</span> <span class="mi">1</span><span class="p">))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org625b917" class="outline-2">
<h2 id="org625b917">Упражнение 2.84</h2>
<div class="outline-text-2" id="text-org625b917">
<p>
Используя процедуру raise из задачи 2.83 переделайте процедуру apply-generic, чтобы она приводила аргументы методом повышения типов.
Вам нужно придумать способ определить какой из двух типов выше в иерархии.
</p>
<div class="highlight"><pre><span></span><span class="c1">;; табличка с сравнением типов</span>
<span class="p">(</span><span class="k">define </span><span class="nv">*op-compare-types-table*</span> <span class="p">(</span><span class="nf">make-hash-table</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">put-type-value</span> <span class="nv">type</span> <span class="nv">value</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">hash-table/put!</span> <span class="nv">*op-compare-types-table*</span> <span class="p">(</span><span class="nb">list </span><span class="nv">type</span><span class="p">)</span> <span class="nv">value</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">get-type-value</span> <span class="nv">type</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">hash-table/get</span> <span class="nv">*op-compare-types-table*</span> <span class="p">(</span><span class="nb">list </span><span class="nv">type</span><span class="p">)</span> <span class="no">#f</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-compare-types-package</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">put-type-value</span> <span class="ss">'scheme-number</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">put-type-value</span> <span class="ss">'rational</span> <span class="mi">5</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">put-type-value</span> <span class="ss">'scheme-real</span> <span class="mi">10</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">put-type-value</span> <span class="ss">'complex</span> <span class="mi">15</span><span class="p">)</span>
  <span class="ss">'done</span><span class="p">)</span>
<span class="p">(</span><span class="nf">install-compare-types-package</span><span class="p">)</span>

<span class="c1">;; процедура сравнения типов</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">type1&gt;type2</span> <span class="nv">type1</span> <span class="nv">type2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">value1</span> <span class="p">(</span><span class="nf">get-type-value</span> <span class="nv">type1</span><span class="p">))</span>
	<span class="p">(</span><span class="nf">value2</span> <span class="p">(</span><span class="nf">get-type-value</span> <span class="nv">type2</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">&gt; </span><span class="nv">value1</span> <span class="nv">value2</span><span class="p">)))</span>


<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">map-args</span> <span class="nv">args</span> <span class="nv">type-tags</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">find-max-value-type</span> <span class="nv">types</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter-types</span> <span class="nv">types</span> <span class="nv">value</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">types</span><span class="p">)</span>
	  <span class="nv">value</span>
	  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">type1&gt;type2</span> <span class="p">(</span><span class="nb">car </span><span class="nv">types</span><span class="p">)</span> <span class="nv">value</span><span class="p">)</span>
	      <span class="p">(</span><span class="nf">iter-types</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">types</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">types</span><span class="p">))</span>
	      <span class="p">(</span><span class="nf">iter-types</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">types</span><span class="p">)</span> <span class="nv">value</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">iter-types</span> <span class="nv">types</span> <span class="p">(</span><span class="nb">car </span><span class="nv">types</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">raise-until-type</span> <span class="nv">arg</span> <span class="nv">target-type</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">equal? </span><span class="p">(</span><span class="nf">type-tag</span> <span class="nv">arg</span><span class="p">)</span> <span class="nv">target-type</span><span class="p">)</span>
	<span class="nv">arg</span>
	<span class="p">(</span><span class="nf">raise-until-type</span> <span class="p">(</span><span class="nf">raise</span> <span class="nv">arg</span><span class="p">)</span> <span class="nv">target-type</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">try-coercion</span> <span class="nv">args</span> <span class="nv">type-list</span> <span class="nv">target-type</span> <span class="nv">res</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">args</span><span class="p">)</span>
	<span class="nv">res</span>
	<span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">equal? </span><span class="p">(</span><span class="nb">car </span><span class="nv">type-list</span><span class="p">)</span> <span class="nv">target-type</span><span class="p">)</span>
	    <span class="p">(</span><span class="nf">try-coercion</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">args</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">type-list</span><span class="p">)</span> <span class="nv">target-type</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">args</span><span class="p">)</span> <span class="nv">res</span><span class="p">))</span>
	    <span class="p">(</span><span class="nf">try-coercion</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">args</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">type-list</span><span class="p">)</span> <span class="nv">target-type</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">raise-until-type</span> <span class="p">(</span><span class="nb">car </span><span class="nv">args</span><span class="p">)</span> <span class="nv">target-type</span><span class="p">)</span> <span class="nv">res</span><span class="p">)))))</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">target-type</span> <span class="p">(</span><span class="nf">find-max-value-type</span> <span class="nv">type-tags</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">mapped-args</span> <span class="p">(</span><span class="nf">try-coercion</span> <span class="nv">args</span> <span class="nv">type-tags</span> <span class="nv">target-type</span> <span class="o">'</span><span class="p">())))</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="nv">mapped-args</span><span class="p">)</span>
	  <span class="p">(</span><span class="nf">error</span> <span class="s">"No coercion for these types"</span><span class="p">)</span>
	  <span class="nv">mapped-args</span><span class="p">))))</span>


<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">apply-generic</span> <span class="nv">op</span> <span class="o">.</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">type-tags</span> <span class="p">(</span><span class="nb">map </span><span class="nv">type-tag</span> <span class="nv">args</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">proc</span> <span class="p">(</span><span class="nf">get</span> <span class="nv">op</span> <span class="nv">type-tags</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="nv">proc</span><span class="p">)</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">mapped-args</span> <span class="p">(</span><span class="nf">map-args</span> <span class="nv">args</span> <span class="nv">type-tags</span><span class="p">)))</span>
	    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="nv">mapped-args</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">error</span> <span class="s">"No method for these types"</span> <span class="p">(</span><span class="nb">list </span><span class="nv">op</span> <span class="nv">type-tags</span><span class="p">))</span>
		<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">mapped-type-tags</span> <span class="p">(</span><span class="nb">map </span><span class="nv">type-tag</span> <span class="nv">mapped-args</span><span class="p">)))</span>
		  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">proc</span> <span class="p">(</span><span class="nf">get</span> <span class="nv">op</span> <span class="nv">mapped-type-tags</span><span class="p">)))</span>
		    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="nv">proc</span><span class="p">)</span>
			<span class="p">(</span><span class="nf">error</span> <span class="s">"No method for these types"</span> <span class="p">(</span><span class="nb">list </span><span class="nv">op</span> <span class="nv">type-tags</span><span class="p">))</span>
			<span class="p">(</span><span class="nb">apply </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">map </span><span class="nv">contents</span> <span class="nv">mapped-args</span><span class="p">)))))))</span>
	  <span class="p">(</span><span class="nb">apply </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">map </span><span class="nv">contents</span> <span class="nv">args</span><span class="p">))</span>
	  <span class="p">))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgef58eb3" class="outline-2">
<h2 id="orgef58eb3">Упражнение 2.85</h2>
<div class="outline-text-2" id="text-orgef58eb3">
<p>
В разделе упоминалась процедура "упрощение" объекта, понижение типа насколько возможно. Составьте процедуру drop для башни типов. К примеру комплексное 1.5 + 0i может быть сведено к типу real 1.5. И используя drop перепишите apply-generic процедуру что бы "упростить" результат.
</p>

<p>
процедура drop:
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-coercion-package</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-rational</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make</span> <span class="ss">'rational</span><span class="p">)</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-complex-from-real-imag</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make-from-real-imag</span> <span class="ss">'complex</span><span class="p">)</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-real</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make</span> <span class="ss">'scheme-real</span><span class="p">)</span> <span class="nv">x</span><span class="p">))</span>
  <span class="c1">;; interface</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'raise</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-rational</span> <span class="nv">x</span> <span class="mi">1</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'raise</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-real</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'raise</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-real</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-complex-from-real-imag</span> <span class="nv">x</span> <span class="mi">0</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'raise</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">error</span> <span class="s">"complex can't raise"</span><span class="p">)))</span>
  <span class="c1">;; project</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'project</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-number</span> <span class="p">(</span><span class="nb">round </span><span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">))))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'project</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-real</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-number</span> <span class="p">(</span><span class="nb">round </span><span class="nv">x</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'project</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-real</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">x</span><span class="p">))))</span>
  <span class="ss">'done</span><span class="p">)</span>

<span class="p">(</span><span class="nf">install-coercion-package</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">apply-generic</span> <span class="nv">op</span> <span class="o">.</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">type-tags</span> <span class="p">(</span><span class="nb">map </span><span class="nv">type-tag</span> <span class="nv">args</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">proc</span> <span class="p">(</span><span class="nf">get</span> <span class="nv">op</span> <span class="nv">type-tags</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">if </span><span class="nv">proc</span>
	  <span class="p">(</span><span class="nb">apply </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">map </span><span class="nv">contents</span> <span class="nv">args</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">error</span>
	    <span class="s">"No method for these types -- APPLY-GENERIC"</span>
	    <span class="p">(</span><span class="nb">list </span><span class="nv">op</span> <span class="nv">type-tags</span><span class="p">))))))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">real-part </span><span class="nv">z</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'real-part</span> <span class="nv">z</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">imag-part </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'imag-part</span> <span class="nv">z</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">magnitude </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'magnitude</span> <span class="nv">z</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">angle </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'angle</span> <span class="nv">z</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">raise</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'raise</span> <span class="nv">x</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">project</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'project</span> <span class="nv">x</span><span class="p">))</span>


<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">drop</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">raise-until-type</span> <span class="nv">arg</span> <span class="nv">target-type</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">equal? </span><span class="p">(</span><span class="nf">type-tag</span> <span class="nv">arg</span><span class="p">)</span> <span class="nv">target-type</span><span class="p">)</span>
	<span class="nv">arg</span>
	<span class="p">(</span><span class="nf">raise-until-type</span> <span class="p">(</span><span class="nf">raise</span> <span class="nv">arg</span><span class="p">)</span> <span class="nv">target-type</span><span class="p">)))</span>

  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">pproc</span> <span class="p">(</span><span class="nf">get</span> <span class="ss">'project</span> <span class="p">(</span><span class="nb">map </span><span class="nv">type-tag</span> <span class="p">(</span><span class="nb">list </span><span class="nv">x</span><span class="p">)))))</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="nv">pproc</span><span class="p">)</span>
	<span class="nv">x</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">p</span> <span class="p">(</span><span class="nf">project</span> <span class="nv">x</span><span class="p">)))</span>
	  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">equ?</span> <span class="p">(</span><span class="nf">raise-until-type</span> <span class="nv">p</span> <span class="p">(</span><span class="nf">type-tag</span> <span class="nv">x</span><span class="p">))</span> <span class="nv">x</span><span class="p">)</span>
	      <span class="nv">p</span>
	      <span class="nv">x</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">drop-max</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">type-before</span> <span class="p">(</span><span class="nf">type-tag</span> <span class="nv">x</span><span class="p">))</span>
	<span class="p">(</span><span class="nf">new-value</span> <span class="p">(</span><span class="nf">drop</span> <span class="nv">x</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">equal? </span><span class="nv">type-before</span> <span class="p">(</span><span class="nf">type-tag</span> <span class="nv">new-value</span><span class="p">))</span>
	<span class="nv">x</span>
	<span class="p">(</span><span class="nf">drop-max</span> <span class="nv">new-value</span><span class="p">))))</span>
</pre></div>

<p>
нам не всегда нужно делать упрощение типов, поэтому оставим старую процедуру apply-generic для всех старых операций, а для операций add, mul, div, sub введем новую процедуру apply-generic-simplified, которая будет упрощать полученный результат.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">apply-generic-simplified</span> <span class="nv">op</span> <span class="o">.</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">simplified-result</span> <span class="nv">res</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">boolean? </span><span class="nv">res</span><span class="p">)</span> <span class="nv">res</span><span class="p">)</span>
	  <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">drop-max</span> <span class="nv">res</span><span class="p">))))</span>

  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">type-tags</span> <span class="p">(</span><span class="nb">map </span><span class="nv">type-tag</span> <span class="nv">args</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">proc</span> <span class="p">(</span><span class="nf">get</span> <span class="nv">op</span> <span class="nv">type-tags</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="nv">proc</span><span class="p">)</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">mapped-args</span> <span class="p">(</span><span class="nf">map-args</span> <span class="nv">args</span> <span class="nv">type-tags</span><span class="p">)))</span>
	    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="nv">mapped-args</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">error</span> <span class="s">"No method for these types"</span> <span class="p">(</span><span class="nb">list </span><span class="nv">op</span> <span class="nv">type-tags</span><span class="p">))</span>
		<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">mapped-type-tags</span> <span class="p">(</span><span class="nb">map </span><span class="nv">type-tag</span> <span class="nv">mapped-args</span><span class="p">)))</span>
		  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">proc</span> <span class="p">(</span><span class="nf">get</span> <span class="nv">op</span> <span class="nv">mapped-type-tags</span><span class="p">)))</span>
		    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="nv">proc</span><span class="p">)</span>
			<span class="p">(</span><span class="nf">error</span> <span class="s">"No method for these types"</span> <span class="p">(</span><span class="nb">list </span><span class="nv">op</span> <span class="nv">type-tags</span><span class="p">))</span>
			<span class="p">(</span><span class="nf">simplified-result</span> <span class="p">(</span><span class="nb">apply </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">map </span><span class="nv">contents</span> <span class="nv">mapped-args</span><span class="p">))))))))</span>
	  <span class="p">(</span><span class="nf">simplified-result</span> <span class="p">(</span><span class="nb">apply </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">map </span><span class="nv">contents</span> <span class="nv">args</span><span class="p">)))</span>
	  <span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic-simplified</span> <span class="ss">'add</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic-simplified</span> <span class="ss">'sub</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic-simplified</span> <span class="ss">'mul</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">div</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic-simplified</span> <span class="ss">'div</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>

<span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nf">make-complex-from-real-imag</span> <span class="mi">1</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-complex-from-real-imag</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">))</span>
<span class="c1">;; ;Value: (scheme-number . 2)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgb60dc01" class="outline-2">
<h2 id="orgb60dc01">Упражнение 2.86</h2>
<div class="outline-text-2" id="text-orgb60dc01">
<p>
Предположим мы хотим работать с комплексными числами, где реальная и мнимая часть могут быть представлены как обычными так и рациональными числами. Опишите и реализуйте изменения которые необходимы для этого. Вам потребуется реализовать операции sin, cos как общие операции над обычными и рациональными числами.
</p>

<p>
для этого операции +/-/*///sin/cos в пакете с комплексными нужно заменить на общие операции.
</p>

<p>
операции sin, cos, sqrt, atan чаще всего это реальный числа, поэтому напишем для них общую операцию которая будет приводить их аргумент к реальному типу данных, а затем выполнять операцию, таким образом нам не нужно будет вносить изменения во все пакеты, а только заменить эти операции в пакете для полярной и декартовой системы хранения комплексных чисел.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">operation-with-raise-to-real</span> <span class="nv">op</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'scheme-real</span> <span class="nv">z</span><span class="p">))</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">equal? </span><span class="p">(</span><span class="nf">type-tag</span> <span class="nv">x</span><span class="p">)</span> <span class="ss">'rational</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">operation-with-raise-to-real</span> <span class="nv">op</span> <span class="p">(</span><span class="nf">raise</span> <span class="nv">x</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">op</span> <span class="p">(</span><span class="nf">contents</span> <span class="nv">x</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">gsqrt</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">operation-with-raise-to-real</span> <span class="nv">sqrt</span> <span class="nv">x</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cosine</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">operation-with-raise-to-real</span> <span class="nv">cos</span> <span class="nv">x</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sine</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">operation-with-raise-to-real</span> <span class="nv">sin</span> <span class="nv">x</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">atangens</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">operation-with-raise-to-real</span> <span class="nv">atan</span> <span class="nv">x</span><span class="p">))</span>

<span class="c1">;; в пакетах complex, polar, rectangular заменяем +-sin и так далее на общие операции</span>
<span class="c1">;; (define (install-rectangular-package)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">magnitude </span><span class="nv">z</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">gsqrt</span> <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">z</span><span class="p">))</span>
		      <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nb">imag-part </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">imag-part </span><span class="nv">z</span><span class="p">)))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">angle </span><span class="nv">z</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">atangens</span> <span class="p">(</span><span class="nf">div</span> <span class="p">(</span><span class="nb">imag-part </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">z</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-from-mag-ang</span> <span class="nv">r</span> <span class="nv">a</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">mul</span> <span class="nv">r</span> <span class="p">(</span><span class="nf">sine</span> <span class="nv">a</span><span class="p">))</span> <span class="p">(</span><span class="nf">mul</span> <span class="nv">r</span> <span class="p">(</span><span class="nf">sine</span> <span class="nv">a</span><span class="p">))))</span>

<span class="c1">;;  (define (install-polar-package)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">real-part </span><span class="nv">z</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nb">magnitude </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">cosine</span> <span class="p">(</span><span class="nb">angle </span><span class="nv">z</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">imag-part </span><span class="nv">z</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nb">magnitude </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">sine</span> <span class="p">(</span><span class="nb">angle </span><span class="nv">z</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-from-real-imag</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">gsqrt</span> <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nf">mul</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">mul</span> <span class="nv">y</span> <span class="nv">y</span><span class="p">)))</span>
	  <span class="p">(</span><span class="nb">atan </span><span class="p">(</span><span class="nf">div</span> <span class="nv">y</span> <span class="nv">x</span><span class="p">))))</span>
<span class="c1">;; (install-polar-package)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">complex1</span> <span class="p">(</span><span class="nf">make-complex-from-real-imag</span> <span class="p">(</span><span class="nf">make-rational</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-rational</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">complex2</span> <span class="p">(</span><span class="nf">make-complex-from-real-imag</span> <span class="p">(</span><span class="nf">make-rational</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-rational</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">add</span> <span class="nv">complex1</span> <span class="nv">complex2</span><span class="p">)</span>
<span class="p">(</span><span class="nf">mul</span> <span class="nv">complex1</span> <span class="nv">complex2</span><span class="p">)</span>
</pre></div>
</div>
</div>


<div id="outline-container-orgf43679a" class="outline-2">
<h2 id="orgf43679a">Упражнение 2.87</h2>
<div class="outline-text-2" id="text-orgf43679a">
<p>
Добавьте =zero? для полиномов. 
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">all-zero?</span> <span class="nv">L1</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">empty-termlist?</span> <span class="nv">L1</span><span class="p">)</span> <span class="nv">true</span><span class="p">)</span>
	  <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nf">=zero?</span> <span class="p">(</span><span class="nf">coeff</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">)))</span> <span class="p">(</span><span class="nf">all-zero?</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L1</span><span class="p">)))</span> <span class="nv">true</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'=zero?</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">all-zero?</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">x</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">pol1</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="o">'</span><span class="p">((</span><span class="mi">2</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">pol2</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="o">'</span><span class="p">((</span><span class="mi">2</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">add</span> <span class="nv">pol1</span> <span class="nv">pol2</span><span class="p">)</span>
<span class="p">(</span><span class="nf">mul</span> <span class="nv">pol1</span> <span class="nv">pol2</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org7a7de18" class="outline-2">
<h2 id="org7a7de18">Упражнение 2.88</h2>
<div class="outline-text-2" id="text-org7a7de18">
<p>
Добавить в систему вычитание полиномов.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">negation-term-list</span> <span class="nv">L1</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">display </span><span class="nv">L1</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">L1</span><span class="p">)</span>
	<span class="nv">L1</span>
	<span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">make-term</span> <span class="p">(</span><span class="nf">order</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">))</span> <span class="p">(</span><span class="nf">negation</span> <span class="p">(</span><span class="nf">coeff</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">))))</span> <span class="p">(</span><span class="nf">negation-term-list</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L1</span><span class="p">)))))</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'sub</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span> <span class="nv">polynomial</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p1</span> <span class="nv">p2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">add-poly</span> <span class="nv">p1</span> <span class="p">(</span><span class="nf">contents</span> <span class="p">(</span><span class="nf">negation</span> <span class="p">(</span><span class="nf">tag</span> <span class="nv">p2</span><span class="p">)))))))</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'negation</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">make-poly</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nf">negation-term-list</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p</span><span class="p">))))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">negation</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'negation</span> <span class="nv">x</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'sub</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">pol1</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="o">'</span><span class="p">((</span><span class="mi">2</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">pol2</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="o">'</span><span class="p">((</span><span class="mi">2</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">add</span> <span class="nv">pol1</span> <span class="nv">pol2</span><span class="p">)</span>
<span class="p">(</span><span class="nf">add</span> <span class="nv">pol1</span> <span class="p">(</span><span class="nf">negation</span> <span class="nv">pol2</span><span class="p">))</span>
<span class="p">(</span><span class="nf">sub</span> <span class="nv">pol1</span> <span class="nv">pol2</span><span class="p">)</span>
<span class="c1">;; Value (polinomial x)</span>
</pre></div>
</div>
</div>


<div id="outline-container-org364830b" class="outline-2">
<h2 id="org364830b">Упражнение 2.89</h2>
<div class="outline-text-2" id="text-org364830b">
<p>
Определите процедуру которая определяет представление term-list для компактных полиномов.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-polynomial-dense-package</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'dense</span> <span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">the-empty-termlist</span><span class="p">)</span> <span class="o">'</span><span class="p">())</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-term</span> <span class="nv">term-list</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">term-list</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">term-list</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">term-list</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">term-list</span><span class="p">)</span> <span class="p">(</span><span class="nb">null? </span><span class="nv">term-list</span><span class="p">))</span>
  <span class="c1">;; (define (make-term order coeff) (list order coeff))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-coeff</span> <span class="nv">term-list</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">term-list</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-order</span> <span class="nv">term-list</span><span class="p">)</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">length </span><span class="nv">term-list</span><span class="p">)</span> <span class="mi">1</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">negation-term-list</span> <span class="nv">L1</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">L1</span><span class="p">)</span>
	<span class="nv">L1</span>
	<span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">negation</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">))</span> <span class="p">(</span><span class="nf">negation-term-list</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L1</span><span class="p">)))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-terms</span> <span class="nv">L1</span> <span class="nv">L2</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">display </span><span class="nv">L1</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sum-terms</span> <span class="nv">L1</span> <span class="nv">L2</span><span class="p">)</span>
      <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">empty-termlist?</span> <span class="nv">L1</span><span class="p">)</span> <span class="nv">L2</span><span class="p">)</span>
	    <span class="p">((</span><span class="nf">empty-termlist?</span> <span class="nv">L2</span><span class="p">)</span> <span class="nv">L1</span><span class="p">)</span>
	    <span class="p">(</span><span class="nf">else</span>
	     <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">)</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L2</span><span class="p">))</span> <span class="p">(</span><span class="nf">sum-terms</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L1</span><span class="p">)</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L2</span><span class="p">))))))</span>
    <span class="p">(</span><span class="nb">reverse </span><span class="p">(</span><span class="nf">sum-terms</span> <span class="p">(</span><span class="nb">reverse </span><span class="nv">L1</span><span class="p">)</span> <span class="p">(</span><span class="nb">reverse </span><span class="nv">L2</span><span class="p">))))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul-terms</span> <span class="nv">L1</span> <span class="nv">L2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">L1</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">the-empty-termlist</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">add-terms</span> <span class="p">(</span><span class="nf">mul-term-by-all-terms</span> <span class="nv">L1</span> <span class="nv">L2</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">mul-terms</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L1</span><span class="p">)</span> <span class="nv">L2</span><span class="p">))))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul-term-by-all-terms</span> <span class="nv">L1</span> <span class="nv">L2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul-coeff</span> <span class="nv">L</span> <span class="nv">constant</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">L</span><span class="p">)</span>
	  <span class="p">(</span><span class="nf">the-empty-termlist</span><span class="p">)</span>
	  <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">first-term</span> <span class="nv">L</span><span class="p">)</span> <span class="nv">constant</span><span class="p">)</span> <span class="p">(</span><span class="nf">mul-coeff</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L</span><span class="p">)</span> <span class="nv">constant</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">create-n-zeroes</span> <span class="nv">n</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
	  <span class="p">(</span><span class="nb">cons </span><span class="mi">0</span> <span class="p">(</span><span class="nf">create-n-zeroes</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)))</span>
	  <span class="o">'</span><span class="p">()))</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">L2</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">the-empty-termlist</span><span class="p">)</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">coeff</span> <span class="p">(</span><span class="nf">first-coeff</span> <span class="nv">L1</span><span class="p">))</span>
	      <span class="p">(</span><span class="nf">order</span> <span class="p">(</span><span class="nf">first-order</span> <span class="nv">L1</span><span class="p">)))</span>
	  <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nf">mul-coeff</span> <span class="nv">L2</span> <span class="nv">coeff</span><span class="p">)</span> <span class="p">(</span><span class="nf">create-n-zeroes</span> <span class="nv">order</span><span class="p">)))))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">all-zero?</span> <span class="nv">L1</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">empty-termlist?</span> <span class="nv">L1</span><span class="p">)</span> <span class="nv">true</span><span class="p">)</span>
	  <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nf">=zero?</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">))</span> <span class="p">(</span><span class="nf">all-zero?</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L1</span><span class="p">)))</span> <span class="nv">true</span><span class="p">)</span>
	  <span class="p">(</span><span class="k">else </span><span class="nv">false</span><span class="p">)))</span>

  <span class="p">(</span><span class="nf">put</span> <span class="ss">'negation</span> <span class="o">'</span><span class="p">(</span><span class="nv">dense</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">negation-term-list</span> <span class="nv">p</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'make</span> <span class="ss">'dense</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">terms</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="nv">terms</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'=zero?</span> <span class="o">'</span><span class="p">(</span><span class="nv">dense</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">terms</span><span class="p">)</span> <span class="p">(</span><span class="nf">all-zero?</span> <span class="nv">terms</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'add</span> <span class="o">'</span><span class="p">(</span><span class="nv">dense</span> <span class="nv">dense</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">terms1</span> <span class="nv">terms2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">add-terms</span> <span class="nv">terms1</span> <span class="nv">terms2</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'mul</span> <span class="o">'</span><span class="p">(</span><span class="nv">dense</span> <span class="nv">dense</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">terms1</span> <span class="nv">terms2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">mul-terms</span> <span class="nv">terms1</span> <span class="nv">terms2</span><span class="p">))))</span>
  <span class="ss">'done</span><span class="p">)</span>
<span class="p">(</span><span class="nf">install-polynomial-dense-package</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-dense-terms</span> <span class="nv">terms</span><span class="p">)</span>
  <span class="p">((</span><span class="nf">get</span> <span class="ss">'make</span> <span class="ss">'dense</span><span class="p">)</span> <span class="nv">terms</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">dense-terms</span> <span class="p">(</span><span class="nf">make-dense-terms</span> <span class="o">'</span><span class="p">(</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)))</span>
<span class="nv">dense-terms</span>
<span class="p">((</span><span class="nf">get</span> <span class="ss">'add</span> <span class="o">'</span><span class="p">(</span><span class="nv">dense</span> <span class="nv">dense</span><span class="p">))</span> <span class="o">'</span><span class="p">(</span><span class="mi">3</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">1</span><span class="p">)</span> <span class="o">'</span><span class="p">(</span><span class="mi">3</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="nf">add</span> <span class="nv">dense-terms</span> <span class="nv">dense-terms</span><span class="p">)</span>
<span class="p">(</span><span class="nf">mul</span> <span class="nv">dense-terms</span> <span class="nv">dense-terms</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgfdc03bf" class="outline-2">
<h2 id="orgfdc03bf">Упражнение 2.90</h2>
<div class="outline-text-2" id="text-orgfdc03bf">
<p>
Предположим бы хотим иметь два представления для компактных и разбросанных полиномов. Нам нужно разрешить два представления для полиномов. Перепишите модуль для полиномов что бы он работал с двумя представлениями.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-polynomial-sparse-package</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'sparse</span> <span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">the-empty-termlist</span><span class="p">)</span> <span class="o">'</span><span class="p">())</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-term</span> <span class="nv">term-list</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">term-list</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">term-list</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">term-list</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">term-list</span><span class="p">)</span> <span class="p">(</span><span class="nb">null? </span><span class="nv">term-list</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-term</span> <span class="nv">order</span> <span class="nv">coeff</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">order</span> <span class="nv">coeff</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">order</span> <span class="nv">term</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">term</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">coeff</span> <span class="nv">term</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">term</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">negation-term-list</span> <span class="nv">L1</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">L1</span><span class="p">)</span>
	<span class="nv">L1</span>
	<span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">make-term</span> <span class="p">(</span><span class="nf">order</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">))</span> <span class="p">(</span><span class="nf">negation</span> <span class="p">(</span><span class="nf">coeff</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">))))</span> <span class="p">(</span><span class="nf">negation-term-list</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L1</span><span class="p">)))))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">adjoin-term</span> <span class="nv">term</span> <span class="nv">term-list</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">=zero?</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">term</span><span class="p">))</span>
	<span class="nv">term-list</span>
	<span class="p">(</span><span class="nb">cons </span><span class="nv">term</span> <span class="nv">term-list</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-terms</span> <span class="nv">L1</span> <span class="nv">L2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">empty-termlist?</span> <span class="nv">L1</span><span class="p">)</span> <span class="nv">L2</span><span class="p">)</span>
	  <span class="p">((</span><span class="nf">empty-termlist?</span> <span class="nv">L2</span><span class="p">)</span> <span class="nv">L1</span><span class="p">)</span>
	  <span class="p">(</span><span class="nf">else</span>
	   <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">t1</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">))</span> <span class="p">(</span><span class="nf">t2</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L2</span><span class="p">)))</span>
	     <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">&gt; </span><span class="p">(</span><span class="nf">order</span> <span class="nv">t1</span><span class="p">)</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">t2</span><span class="p">))</span>
		    <span class="p">(</span><span class="nf">adjoin-term</span>
		     <span class="nv">t1</span> <span class="p">(</span><span class="nf">add-terms</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L1</span><span class="p">)</span> <span class="nv">L2</span><span class="p">)))</span>
		   <span class="p">((</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">order</span> <span class="nv">t1</span><span class="p">)</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">t2</span><span class="p">))</span>
		    <span class="p">(</span><span class="nf">adjoin-term</span>
		     <span class="nv">t2</span> <span class="p">(</span><span class="nf">add-terms</span> <span class="nv">L1</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L2</span><span class="p">))))</span>
		   <span class="p">(</span><span class="nf">else</span>
		    <span class="p">(</span><span class="nf">adjoin-term</span>
		     <span class="p">(</span><span class="nf">make-term</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">t1</span><span class="p">)</span>
				<span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">t1</span><span class="p">)</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">t2</span><span class="p">)))</span>
		     <span class="p">(</span><span class="nf">add-terms</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L1</span><span class="p">)</span>
				<span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L2</span><span class="p">)))))))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul-terms</span> <span class="nv">L1</span> <span class="nv">L2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">L1</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">the-empty-termlist</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">add-terms</span> <span class="p">(</span><span class="nf">mul-term-by-all-terms</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">)</span> <span class="nv">L2</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">mul-terms</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L1</span><span class="p">)</span> <span class="nv">L2</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul-term-by-all-terms</span> <span class="nv">t1</span> <span class="nv">L</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">L</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">the-empty-termlist</span><span class="p">)</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">t2</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L</span><span class="p">)))</span>
	  <span class="p">(</span><span class="nf">adjoin-term</span>
	   <span class="p">(</span><span class="nf">make-term</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">order</span> <span class="nv">t1</span><span class="p">)</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">t2</span><span class="p">))</span>
		      <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">t1</span><span class="p">)</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">t2</span><span class="p">)))</span>
	   <span class="p">(</span><span class="nf">mul-term-by-all-terms</span> <span class="nv">t1</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L</span><span class="p">))))))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">all-zero?</span> <span class="nv">L1</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">empty-termlist?</span> <span class="nv">L1</span><span class="p">)</span> <span class="nv">true</span><span class="p">)</span>
	  <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nf">=zero?</span> <span class="p">(</span><span class="nf">coeff</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">)))</span> <span class="p">(</span><span class="nf">all-zero?</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L1</span><span class="p">)))</span> <span class="nv">true</span><span class="p">)</span>
	  <span class="p">(</span><span class="k">else </span><span class="nv">false</span><span class="p">)))</span>

  <span class="p">(</span><span class="nf">put</span> <span class="ss">'negation</span> <span class="o">'</span><span class="p">(</span><span class="nv">sparse</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">negation-term-list</span> <span class="nv">p</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'make</span> <span class="ss">'sparse</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">terms</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="nv">terms</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'=zero?</span> <span class="o">'</span><span class="p">(</span><span class="nv">sparse</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">terms</span><span class="p">)</span> <span class="p">(</span><span class="nf">all-zero?</span> <span class="nv">terms</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'add</span> <span class="o">'</span><span class="p">(</span><span class="nv">sparse</span> <span class="nv">sparse</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">terms1</span> <span class="nv">terms2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">add-terms</span> <span class="nv">terms1</span> <span class="nv">terms2</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'mul</span> <span class="o">'</span><span class="p">(</span><span class="nv">sparse</span> <span class="nv">sparse</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">terms1</span> <span class="nv">terms2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">mul-terms</span> <span class="nv">terms1</span> <span class="nv">terms2</span><span class="p">))))</span>
  <span class="ss">'done</span><span class="p">)</span>

<span class="p">(</span><span class="nf">install-polynomial-sparse-package</span><span class="p">)</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'add-terms</span> <span class="o">'</span><span class="p">(</span><span class="nv">sparce</span> <span class="nv">sparce</span><span class="p">)</span> <span class="nv">false</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'add</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'mul</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-sparce-terms</span> <span class="nv">terms</span><span class="p">)</span>
  <span class="p">((</span><span class="nf">get</span> <span class="ss">'make</span> <span class="ss">'sparse</span><span class="p">)</span> <span class="nv">terms</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">sparce-terms</span> <span class="p">(</span><span class="nf">make-sparce-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">2</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">))))</span>
<span class="nv">sparce-terms</span>
<span class="p">((</span><span class="nf">get</span> <span class="ss">'add</span> <span class="o">'</span><span class="p">(</span><span class="nv">sparse</span> <span class="nv">sparse</span><span class="p">))</span> <span class="o">'</span><span class="p">((</span><span class="mi">2</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">))</span> <span class="o">'</span><span class="p">((</span><span class="mi">2</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">add</span> <span class="nv">sparce-terms</span> <span class="nv">sparce-terms</span><span class="p">)</span>
<span class="p">(</span><span class="nf">mul</span> <span class="nv">sparce-terms</span> <span class="nv">sparce-terms</span><span class="p">)</span>


<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-polynomial-package</span><span class="p">)</span>
  <span class="c1">;; internal procedures</span>
  <span class="c1">;; representation of poly</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-poly</span> <span class="nv">variable</span> <span class="nv">term-list</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cons </span><span class="nv">variable</span> <span class="nv">term-list</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">variable</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">p</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">term-list</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">p</span><span class="p">))</span>
  <span class="c1">;; &lt;procedures same-variable? and variable? from section 2.3.2&gt;</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">variable?</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">symbol? </span><span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nf">variable?</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">variable?</span> <span class="nv">v2</span><span class="p">)</span> <span class="p">(</span><span class="nb">eq? </span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">)))</span>
  <span class="c1">;; representation of terms and term lists</span>
  <span class="c1">;; ((100 1) (2 2) (0 1)) = x^100 + 2x^2 + 1</span>

  <span class="c1">;; procedurs on poly</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">term-list</span> <span class="nv">p1</span><span class="p">))</span>

    <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">term-list</span> <span class="nv">p2</span><span class="p">))</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p2</span><span class="p">))</span>
	<span class="p">(</span><span class="nf">make-poly</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p1</span><span class="p">)</span>
			<span class="p">(</span><span class="nf">term-list</span> <span class="nv">p2</span><span class="p">)))</span>
	<span class="p">(</span><span class="nf">error</span> <span class="s">"Polys not in same var -- ADD-POLY"</span>
	       <span class="p">(</span><span class="nb">list </span><span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p2</span><span class="p">))</span>
	<span class="p">(</span><span class="nf">make-poly</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p1</span><span class="p">)</span>
			<span class="p">(</span><span class="nf">term-list</span> <span class="nv">p2</span><span class="p">)))</span>
	<span class="p">(</span><span class="nf">error</span> <span class="s">"Polys not in same var -- MUL-POLY"</span>
	       <span class="p">(</span><span class="nb">list </span><span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>

  <span class="c1">;; interface to rest of the system</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'polynomial</span> <span class="nv">p</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'add</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span> <span class="nv">polynomial</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p1</span> <span class="nv">p2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">add-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'sub</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span> <span class="nv">polynomial</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p1</span> <span class="nv">p2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">add-poly</span> <span class="nv">p1</span> <span class="p">(</span><span class="nf">contents</span> <span class="p">(</span><span class="nf">negation</span> <span class="p">(</span><span class="nf">tag</span> <span class="nv">p2</span><span class="p">)))))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'mul</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span> <span class="nv">polynomial</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p1</span> <span class="nv">p2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">mul-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'make</span> <span class="ss">'polynomial</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">var</span> <span class="nv">terms</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">make-poly</span> <span class="nv">var</span> <span class="nv">terms</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'=zero?</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">=zero?</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">x</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'negation</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">make-poly</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nf">negation</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p</span><span class="p">))))))</span>
  <span class="ss">'done</span><span class="p">)</span>

<span class="p">(</span><span class="nf">install-polynomial-package</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">pol1</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">2</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">pol2</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">2</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">)))))</span>

<span class="p">(</span><span class="nf">negation</span> <span class="nv">pol2</span><span class="p">)</span>
<span class="p">(</span><span class="nf">add</span> <span class="nv">pol1</span> <span class="nv">pol2</span><span class="p">)</span>
<span class="p">(</span><span class="nf">add</span> <span class="nv">pol1</span> <span class="p">(</span><span class="nf">negation</span> <span class="nv">pol2</span><span class="p">))</span>
<span class="p">(</span><span class="nf">sub</span> <span class="nv">pol1</span> <span class="nv">pol2</span><span class="p">)</span>
<span class="p">(</span><span class="nf">mul</span> <span class="nv">pol1</span> <span class="nv">pol2</span><span class="p">)</span>
</pre></div>
</div>
</div>


<div id="outline-container-orge3eaf8d" class="outline-2">
<h2 id="orge3eaf8d">Упражнение 2.91</h2>
<div class="outline-text-2" id="text-orge3eaf8d">
<p>
Допишите функцию деления полиномов.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub-terms</span> <span class="nv">L1</span> <span class="nv">L2</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">add-terms</span> <span class="nv">L1</span> <span class="p">(</span><span class="nf">negation-term-list</span> <span class="nv">L2</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">div-terms</span> <span class="nv">L1</span> <span class="nv">L2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">L1</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">the-empty-termlist</span><span class="p">)</span> <span class="p">(</span><span class="nf">the-empty-termlist</span><span class="p">))</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">t1</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">))</span>
	      <span class="p">(</span><span class="nf">t2</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L2</span><span class="p">)))</span>
	  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="p">(</span><span class="nf">order</span> <span class="nv">t2</span><span class="p">)</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">t1</span><span class="p">))</span>
	      <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">the-empty-termlist</span><span class="p">)</span> <span class="nv">L1</span><span class="p">)</span>
	      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">new-c</span> <span class="p">(</span><span class="nf">div</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">t1</span><span class="p">)</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">t2</span><span class="p">)))</span>
		    <span class="p">(</span><span class="nf">new-o</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">order</span> <span class="nv">t1</span><span class="p">)</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">t2</span><span class="p">))))</span>
		<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">rest-of-result</span>
		       <span class="p">(</span><span class="nf">sub-terms</span> <span class="nv">L1</span> <span class="p">(</span><span class="nf">mul-terms</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">make-term</span> <span class="nv">new-o</span> <span class="nv">new-c</span><span class="p">))</span> <span class="nv">L2</span><span class="p">))))</span>

		  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">result</span> <span class="p">(</span><span class="nf">div-terms</span> <span class="nv">rest-of-result</span> <span class="nv">L2</span><span class="p">)))</span>
		    <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">add-terms</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">make-term</span> <span class="nv">new-o</span> <span class="nv">new-c</span><span class="p">))</span> <span class="p">(</span><span class="nb">car </span><span class="nv">result</span><span class="p">))</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">result</span><span class="p">)))))))))</span>
</pre></div>
</div>
</div>


<div id="outline-container-orga325370" class="outline-2">
<h2 id="orga325370">Упражнение 2.92</h2>
<div class="outline-text-2" id="text-orga325370">
<p>
Задав приоритет переменным, дополните пакет работы с полиномами так чтобы сумма и умножение для полиномов работало для полиномов разных переменных.
</p>

<p>
Нужно научиться приводить полином по x к полиному по y. Тогда мы сможем сложить полином по x c полиномом по y, приведя их к одной переменной.
</p>

<p>
например вот такой полином, будет очевидно равен сумме полиномов, то есть достаточно научиться приводить первую часть, а потом взять сумму от этого.
x<sup>2</sup> (3y<sup>2</sup> + 2) + x (y<sup>3</sup> + 2y<sup>2</sup> + 3)
смотрим
x<sup>2</sup> (3y<sup>2</sup> + 2) + …
x<sup>2</sup> 3y<sup>2</sup> + x<sup>2</sup> 2
y<sup>2</sup> (x<sup>2</sup>)3 + y<sup>0</sup>(x<sup>2</sup>)2
</p>

<p>
'y (2 (p (2 3)) (0 (p (2 2))
такой полином можем привести к полиному по y, все порядки y остаются прежними, а коэффициенты, это полином, по x<sup>2</sup> умноженный на прежний коэффициенты y.
</p>


<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-coercion-polynomial-package</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'polynomial</span> <span class="nv">p</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">term-list</span> <span class="nv">pol</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">pol</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">order</span> <span class="nv">term</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">term</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">coeff</span> <span class="nv">term</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">term</span><span class="p">))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">switch-variable</span> <span class="nv">pol</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">switch-single-term</span> <span class="nv">single</span><span class="p">)</span>
      <span class="c1">;; term here y and polinom x</span>
      <span class="p">(</span>
       <span class="nv">make-polynomial</span>
       <span class="ss">'x</span>
       <span class="p">(</span><span class="nf">make-sparse-terms</span>
	<span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">term</span><span class="p">)</span>
	       <span class="p">(</span><span class="nf">list</span>
		<span class="p">(</span><span class="nf">order</span> <span class="nv">term</span><span class="p">)</span>
		<span class="p">(</span><span class="nf">make-polynomial</span>
		 <span class="ss">'y</span>
		 <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">car </span><span class="nv">single</span><span class="p">)</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">term</span><span class="p">))))</span>
		 <span class="p">)))</span>
	     <span class="p">(</span><span class="nb">cadr </span><span class="nv">single</span><span class="p">)))))</span>

    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sum-list</span> <span class="nv">l</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">length </span><span class="nv">l</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
	  <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nb">car </span><span class="nv">l</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">l</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nb">car </span><span class="nv">l</span><span class="p">)</span> <span class="p">(</span><span class="nf">sum-list</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">l</span><span class="p">)))))</span>

    <span class="c1">;; пусть пока везде полиномы, в общем виде надо добавить условие</span>
    <span class="c1">;; приведения числа к полиному.</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">mapterms</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">term</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">term</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">term-list</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">term</span><span class="p">)))))</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">pol</span><span class="p">))))</span>
      <span class="p">(</span><span class="nf">sum-list</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">item</span><span class="p">)</span> <span class="p">(</span><span class="nf">switch-single-term</span> <span class="nv">item</span><span class="p">))</span> <span class="nv">mapterms</span><span class="p">))</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="c1">;; interface</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'raise</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">pol</span><span class="p">)</span> <span class="p">(</span><span class="nf">switch-variable</span> <span class="p">(</span><span class="nf">tag</span> <span class="nv">pol</span><span class="p">))))</span>
  <span class="ss">'done</span><span class="p">)</span>
<span class="p">(</span><span class="nf">install-coercion-polynomial-package</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">pol2variable</span> <span class="p">(</span><span class="nf">make-polynomial</span>
		      <span class="ss">'y</span>
		      <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="mi">2</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">2</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">)))))</span>
					       <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">3</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">2</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">3</span><span class="p">)))))</span>
					       <span class="p">(</span><span class="nb">list </span><span class="mi">0</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">0</span> <span class="mi">5</span><span class="p">)))))))))</span>

<span class="nv">pol2variable</span>
<span class="p">(</span><span class="nf">raise</span> <span class="nv">pol2variable</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">pol1</span> <span class="p">(</span>
	      <span class="nv">make-polynomial</span>
	      <span class="ss">'x</span>
	      <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="mi">2</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'y</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">2</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">)))))</span>
				       <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'y</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">0</span> <span class="mi">1</span><span class="p">)))))</span>
				       <span class="p">(</span><span class="nb">list </span><span class="mi">0</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'y</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">0</span> <span class="mi">1</span><span class="p">)))))))))</span>
<span class="nv">pol1</span>
<span class="p">(</span><span class="nf">add</span> <span class="nv">pol1</span> <span class="p">(</span><span class="nf">raise</span> <span class="nv">pol2variable</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org4e64d32" class="outline-2">
<h2 id="org4e64d32">Упражнение 2.93, 2.94</h2>
<div class="outline-text-2" id="text-org4e64d32">
<p>
Измените пакет для рациональных чисел чтобы он мог работать с полиномами. Протестируйте ваш пакет, вызвав make-rational над полиномами.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-rational-polynomial-package</span><span class="p">)</span>
  <span class="c1">;; internal procedures</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-rat</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cons </span><span class="nv">n</span> <span class="nv">d</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">make-rat</span> <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">y</span><span class="p">))</span>
		 <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)))</span>
	      <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">y</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">make-rat</span> <span class="p">(</span><span class="nf">sub</span> <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">y</span><span class="p">))</span>
		 <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)))</span>
	      <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">y</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">make-rat</span> <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">y</span><span class="p">))</span>
	      <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">y</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">div-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">make-rat</span> <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">y</span><span class="p">))</span>
	      <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">y</span><span class="p">))))</span>
  <span class="c1">;; interface to rest of the system</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'rational</span> <span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">real-tag</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'scheme-real</span> <span class="nv">x</span><span class="p">))</span>


  <span class="p">(</span><span class="nf">put</span> <span class="ss">'add</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span> <span class="nv">rational</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">add-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'sub</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span> <span class="nv">rational</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">sub-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'mul</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span> <span class="nv">rational</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">mul-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'div</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span> <span class="nv">rational</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">div-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>

  <span class="p">(</span><span class="nf">put</span> <span class="ss">'make</span> <span class="ss">'rational</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">n</span> <span class="nv">d</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">make-rat</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'=zero?</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">=zero?</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">))))</span>
  <span class="ss">'done</span><span class="p">)</span>
<span class="p">(</span><span class="nf">install-rational-polynomial-package</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-rational</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)</span>
  <span class="p">((</span><span class="nf">get</span> <span class="ss">'make</span> <span class="ss">'rational</span><span class="p">)</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">))</span>
</pre></div>

<p>
Теперь сложите rf с самим собой. Вы увидите что процедура добавления не сокращает деление до наименьших чисел. Напишите поиск наибольшего общего делителя для полиномов используя remainder-terms из упражнения 2.91.
</p>

<p>
Напишите процедуру нахождения НОД для полиномов и протестируйте результат.
</p>

<div class="highlight"><pre><span></span><span class="c1">;; в пакете записи полиномов</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">remainder-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">div-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cadr </span><span class="p">(</span><span class="nf">div-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">gcd-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">b</span><span class="p">)</span>
	<span class="nv">a</span>
	<span class="p">(</span><span class="nf">gcd-terms</span> <span class="nv">b</span> <span class="p">(</span><span class="nf">remainder-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'gcd-terms</span> <span class="o">'</span><span class="p">(</span><span class="nv">sparse</span> <span class="nv">sparse</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">terms1</span> <span class="nv">terms2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">gcd-terms</span> <span class="nv">terms1</span> <span class="nv">terms2</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">gcd-terms</span> <span class="nv">term1</span> <span class="nv">term2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'gcd-terms</span> <span class="nv">term1</span> <span class="nv">term2</span><span class="p">))</span>

<span class="p">(</span><span class="nf">gcd-terms</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">4</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">3</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">(</span><span class="mi">2</span> <span class="mi">-2</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">2</span><span class="p">)))</span>
	   <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">3</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">-1</span><span class="p">)))</span>
	   <span class="p">)</span>
<span class="c1">;;Value: (sparse (2 -1) (1 1))</span>

<span class="c1">;; в пакете для полиномов</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">gcd-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p2</span><span class="p">))</span>
	<span class="p">(</span><span class="nf">make-poly</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">gcd-terms</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p1</span><span class="p">)</span>
			      <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p2</span><span class="p">)))</span>
	<span class="p">(</span><span class="nf">error</span> <span class="s">"Polys not in same var -- GCD-POLY"</span>
	       <span class="p">(</span><span class="nb">list </span><span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'greatest-common-divisor</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span> <span class="nv">polynomial</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p1</span> <span class="nv">p2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">gcd-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">greatest-common-divisor</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'greatest-common-divisor</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">terms1</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">4</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">3</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">(</span><span class="mi">2</span> <span class="mi">-2</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">2</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">terms2</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">3</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">-1</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">p1</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="nv">terms1</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">p2</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="nv">terms2</span><span class="p">))</span>
<span class="p">(</span><span class="nf">greatest-common-divisor</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">)</span>
<span class="c1">;Value: (polynomial x sparse (2 -1) (1 1))</span>
</pre></div>
</div>
</div>


<div id="outline-container-org00cb686" class="outline-2">
<h2 id="org00cb686">Упражнение 2.95, 2.96, 2.97</h2>
<div class="outline-text-2" id="text-org00cb686">
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="nv">terms1</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">2</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">-2</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">p1</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="nv">terms1</span><span class="p">))</span>
<span class="nv">p1</span>
<span class="p">(</span><span class="k">define </span><span class="nv">terms2</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">2</span> <span class="mi">11</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">7</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">p2</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="nv">terms2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">terms3</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">1</span> <span class="mi">13</span><span class="p">)</span> <span class="p">(</span><span class="mi">0</span> <span class="mi">5</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">p3</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="nv">terms3</span><span class="p">))</span>
<span class="nv">p2</span>
<span class="nv">p3</span>
<span class="p">(</span><span class="k">define </span><span class="nv">q1</span> <span class="p">(</span><span class="nf">mul</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">))</span>
<span class="nv">q1</span>
<span class="c1">;Value: (polynomial x sparse (4 11) (3 -22) (2 18) (1 -14) (0 7))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">q2</span> <span class="p">(</span><span class="nf">mul</span> <span class="nv">p1</span> <span class="nv">p3</span><span class="p">))</span>
<span class="nv">q2</span>
<span class="c1">;Value: (polynomial x sparse (3 13) (2 -21) (1 3) (0 5))</span>
<span class="p">(</span><span class="nf">greatest-common-divisor</span> <span class="nv">q1</span> <span class="nv">q2</span><span class="p">)</span>
<span class="c1">;Value: (polynomial x sparse (2 1458/169) (1 -2916/169) (0 1458/169))</span>
</pre></div>

<p>
a. определите процедуру псевдоделения
b. измените результирующий НОД что бы исправить коэффициенты.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">multiple-coeffs</span> <span class="nv">q</span> <span class="nv">integer-factor</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">order</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">coeff</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">integer-factor</span><span class="p">)))</span> <span class="nv">q</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">integerizing-factor</span> <span class="nv">p</span> <span class="nv">q</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">c</span> <span class="p">(</span><span class="nf">coeff</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">q</span><span class="p">)))</span>
	<span class="p">(</span><span class="nf">o1</span> <span class="p">(</span><span class="nf">order</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">p</span><span class="p">)))</span>
	<span class="p">(</span><span class="nf">o2</span> <span class="p">(</span><span class="nf">order</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">q</span><span class="p">))))</span>
    <span class="p">(</span><span class="nb">expt </span><span class="nv">c</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="nv">o1</span> <span class="p">(</span><span class="nb">- </span><span class="nv">o2</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">remainder-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cadr </span><span class="p">(</span><span class="nf">div-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">pseudoremainder-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">ma</span> <span class="p">(</span><span class="nf">multiple-coeffs</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">integerizing-factor</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))))</span>
    <span class="p">(</span><span class="nb">cadr </span><span class="p">(</span><span class="nf">div-terms</span> <span class="nv">ma</span> <span class="nv">b</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">reduce-gcd-terms-coeff</span> <span class="nv">terms</span><span class="p">)</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">gcd-integer-list</span> <span class="nv">l</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">length </span><span class="nv">l</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">car </span><span class="nv">l</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">gcd-integer-list</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">gcd </span><span class="p">(</span><span class="nb">car </span><span class="nv">l</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">l</span><span class="p">))</span> <span class="p">(</span><span class="nb">cddr </span><span class="nv">l</span><span class="p">)))))</span>

  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">l</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">x</span><span class="p">))</span> <span class="nv">terms</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">multiple-coeffs</span> <span class="nv">terms</span> <span class="p">(</span><span class="nb">/ </span><span class="mi">1</span> <span class="p">(</span><span class="nf">gcd-integer-list</span> <span class="nv">l</span><span class="p">))))</span>
  <span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">gcd-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">b</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">reduce-gcd-terms-coeff</span> <span class="nv">a</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">gcd-terms</span> <span class="nv">b</span> <span class="p">(</span><span class="nf">pseudoremainder-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))))</span>
</pre></div>

<p>
c. определите процедуру reduce для полиномов
</p>

<div class="highlight"><pre><span></span><span class="c1">;; в пакете рациональных полиномов</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-rat</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">red</span> <span class="p">(</span><span class="nf">reduce</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">red</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">red</span><span class="p">))))</span>
<span class="c1">;; для списков коэффициентов</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">reduce-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">gcd-ab</span> <span class="p">(</span><span class="nf">gcd-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nf">div-terms</span> <span class="nv">a</span> <span class="nv">gcd-ab</span><span class="p">)))</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nf">div-terms</span> <span class="nv">b</span> <span class="nv">gcd-ab</span><span class="p">))))))</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'reduce</span> <span class="o">'</span><span class="p">(</span><span class="nv">sparse</span> <span class="nv">sparse</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">terms1</span> <span class="nv">terms2</span><span class="p">)</span> <span class="p">(</span><span class="nf">reduce-terms</span> <span class="nv">terms1</span> <span class="nv">terms2</span><span class="p">)))</span>
<span class="c1">;; для полиномов</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">reduce-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p2</span><span class="p">))</span>
	<span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">terms</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">make-poly</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span> <span class="nv">terms</span><span class="p">)))</span>
	     <span class="p">(</span><span class="nf">reduce</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p1</span><span class="p">)</span>
		     <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p2</span><span class="p">)))</span>
	<span class="p">(</span><span class="nf">error</span> <span class="s">"Polys not in same var -- REDUCE-POLY"</span>
	       <span class="p">(</span><span class="nb">list </span><span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">put</span> <span class="ss">'reduce</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span> <span class="nv">polynomial</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p1</span> <span class="nv">p2</span><span class="p">)</span> <span class="p">(</span><span class="nf">reduce-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">reduce</span> <span class="nv">term1</span> <span class="nv">term2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'reduce</span> <span class="nv">term1</span> <span class="nv">term2</span><span class="p">))</span>


<span class="p">(</span><span class="k">define </span><span class="nv">p1</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">1</span> <span class="mi">1</span><span class="p">)(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">p2</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">3</span> <span class="mi">1</span><span class="p">)(</span><span class="mi">0</span> <span class="mi">-1</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">p3</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">1</span> <span class="mi">1</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">p4</span> <span class="p">(</span><span class="nf">make-polynomial</span> <span class="ss">'x</span> <span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="o">'</span><span class="p">((</span><span class="mi">2</span> <span class="mi">1</span><span class="p">)(</span><span class="mi">0</span> <span class="mi">-1</span><span class="p">)))))</span>
<span class="nv">p1</span>
<span class="nv">p2</span>
<span class="p">(</span><span class="k">define </span><span class="nv">rf1</span> <span class="p">(</span><span class="nf">make-rational</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">rf2</span> <span class="p">(</span><span class="nf">make-rational</span> <span class="nv">p3</span> <span class="nv">p4</span><span class="p">))</span>
<span class="nv">rf2</span>

<span class="nv">rf1</span>

<span class="p">(</span><span class="nf">add</span> <span class="nv">rf1</span> <span class="nv">rf2</span><span class="p">)</span>
<span class="c1">;Value: (rational (polynomial x sparse (3 144) (2 56) (1 90) (0 34)) polynomial x sparse (4 11) (2 -4) (0 -7))</span>
</pre></div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-24-mnozhestvennye-predstavleniia-dlia-abstraktnykh-dannykh/" class="u-url">SICP 2.4 Множественные представления для абстрактных данных.</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-24-mnozhestvennye-predstavleniia-dlia-abstraktnykh-dannykh/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-25T19:33:39+03:00" itemprop="datePublished" title="2020-01-25 19:33">2020-01-25 19:33</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
<img src="images/ch2-Z-G-54.gif" alt="nil"></p>


<p>
<img src="images/ch2-Z-G-62.gif" alt="nil"></p>


<div id="outline-container-org3dfb9b4" class="outline-2">
<h2 id="org3dfb9b4">Упражнение 2.73</h2>
<div class="outline-text-2" id="text-org3dfb9b4">
<p>
В секции 2.3.2 описана программа символического дифференцирования.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">deriv</span> <span class="nv">exp</span> <span class="nv">var</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">number? </span><span class="nv">exp</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">((</span><span class="nf">variable?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="nv">exp</span> <span class="nv">var</span><span class="p">)</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">))</span>
	<span class="p">((</span><span class="nf">sum?</span> <span class="nv">exp</span><span class="p">)</span>
	 <span class="p">(</span><span class="nf">make-sum</span> <span class="p">(</span><span class="nf">deriv</span> <span class="p">(</span><span class="nf">addend</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">var</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">deriv</span> <span class="p">(</span><span class="nf">augend</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">var</span><span class="p">)))</span>
	<span class="p">((</span><span class="nf">product?</span> <span class="nv">exp</span><span class="p">)</span>
	 <span class="p">(</span><span class="nf">make-sum</span>
	   <span class="p">(</span><span class="nf">make-product</span> <span class="p">(</span><span class="nf">multiplier</span> <span class="nv">exp</span><span class="p">)</span>
			 <span class="p">(</span><span class="nf">deriv</span> <span class="p">(</span><span class="nf">multiplicand</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">var</span><span class="p">))</span>
	   <span class="p">(</span><span class="nf">make-product</span> <span class="p">(</span><span class="nf">deriv</span> <span class="p">(</span><span class="nf">multiplier</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">var</span><span class="p">)</span>
			 <span class="p">(</span><span class="nf">multiplicand</span> <span class="nv">exp</span><span class="p">))))</span>
	<span class="nv">&lt;more</span> <span class="nv">rules</span> <span class="nv">can</span> <span class="nv">be</span> <span class="nv">added</span> <span class="nv">here&gt;</span>
	<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">error</span> <span class="s">"unknown expression type -- DERIV"</span> <span class="nv">exp</span><span class="p">))))</span>
</pre></div>

<p>
Мы можем переписать программу что бы она выполняла дифференцирование по типу выражения. В данном случае "type tag" - символ алгебраической операции (к примеру +).
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">deriv</span> <span class="nv">exp</span> <span class="nv">var</span><span class="p">)</span>
   <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">number? </span><span class="nv">exp</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
	 <span class="p">((</span><span class="nf">variable?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="nv">exp</span> <span class="nv">var</span><span class="p">)</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">))</span>
	 <span class="p">(</span><span class="k">else </span><span class="p">((</span><span class="nf">get</span> <span class="ss">'deriv</span> <span class="p">(</span><span class="nf">operator</span> <span class="nv">exp</span><span class="p">))</span> <span class="p">(</span><span class="nf">operands</span> <span class="nv">exp</span><span class="p">)</span>
					    <span class="nv">var</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">operator</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">exp</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">operands</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">exp</span><span class="p">))</span>
</pre></div>

<p>
a. Объясните что сделано выше? Почему мы не можем применить number? и same-variable? в дата ориенторованный обработчик?
</p>

<p>
number? и same-variable? не содержат знака операции поэтому они не могут быть обработаны по типу операции.
</p>

<p>
b. напишите процедуру для взятия производной от суммы и произведения и вспомогательный код который помещает их в таблицу.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="nv">get</span> <span class="mi">2</span><span class="nv">d-get</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="nv">put</span> <span class="mi">2</span><span class="nv">d-put!</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">deriv</span> <span class="nv">exp</span> <span class="nv">var</span><span class="p">)</span>
   <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">number? </span><span class="nv">exp</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
	 <span class="p">((</span><span class="nf">variable?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="nv">exp</span> <span class="nv">var</span><span class="p">)</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">))</span>
	 <span class="p">(</span><span class="k">else </span><span class="p">((</span><span class="nf">get</span> <span class="ss">'deriv</span> <span class="p">(</span><span class="nf">operator</span> <span class="nv">exp</span><span class="p">))</span> <span class="p">(</span><span class="nf">operands</span> <span class="nv">exp</span><span class="p">)</span>
		<span class="nv">var</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">operator</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">exp</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">operands</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">exp</span><span class="p">))</span>

<span class="c1">;; для произведения</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-deriv-mul-package</span><span class="p">)</span>
  <span class="c1">;; internal procedures</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">multiplier</span> <span class="nv">opds</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">opds</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">multiplicand</span> <span class="nv">opds</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">opds</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-sum</span> <span class="nv">a1</span> <span class="nv">a2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'+</span> <span class="nv">a1</span> <span class="nv">a2</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-product</span> <span class="nv">m1</span> <span class="nv">m2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'*</span> <span class="nv">m1</span> <span class="nv">m2</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">deriv-mul</span> <span class="nv">operands</span> <span class="nv">var</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">make-sum</span>
     <span class="p">(</span><span class="nf">make-product</span> <span class="p">(</span><span class="nf">multiplier</span> <span class="nv">operands</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">deriv</span> <span class="p">(</span><span class="nf">multiplicand</span> <span class="nv">operands</span><span class="p">)</span> <span class="nv">var</span><span class="p">))</span>
     <span class="p">(</span><span class="nf">make-product</span> <span class="p">(</span><span class="nf">deriv</span> <span class="p">(</span><span class="nf">multiplier</span> <span class="nv">operands</span><span class="p">)</span> <span class="nv">var</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">multiplicand</span> <span class="nv">operands</span><span class="p">))))</span>
  <span class="c1">;; interface to the rest of the system</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'deriv</span> <span class="ss">'*</span> <span class="nv">deriv-mul</span><span class="p">)</span>
  <span class="ss">'done</span><span class="p">)</span>
<span class="p">(</span><span class="nf">install-deriv-mul-package</span><span class="p">)</span>
<span class="c1">;; для суммы</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-deriv-sum-package</span><span class="p">)</span>
  <span class="c1">;; internal procedures</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">addend</span> <span class="nv">opds</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">opds</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">augend</span> <span class="nv">opds</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">opds</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-sum</span> <span class="nv">a1</span> <span class="nv">a2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'+</span> <span class="nv">a1</span> <span class="nv">a2</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">deriv-sum</span> <span class="nv">opds</span> <span class="nv">var</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">make-sum</span> <span class="p">(</span><span class="nf">deriv</span> <span class="p">(</span><span class="nf">addend</span> <span class="nv">opds</span><span class="p">)</span> <span class="nv">var</span><span class="p">)</span> <span class="p">(</span><span class="nf">deriv</span> <span class="p">(</span><span class="nf">augend</span> <span class="nv">opds</span><span class="p">)</span> <span class="nv">var</span><span class="p">)))</span>
  <span class="c1">;; interface to the rest of the system</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'deriv</span> <span class="ss">'+</span> <span class="nv">deriv-sum</span><span class="p">)</span>
  <span class="ss">'done</span><span class="p">)</span>
<span class="p">(</span><span class="nf">install-deriv-sum-package</span><span class="p">)</span>
</pre></div>

<p>
c. добавить правило диффиренцирования для экспоненты
</p>

<div class="highlight"><pre><span></span><span class="c1">;; для экспоненты</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-deriv-exp-package</span><span class="p">)</span>
  <span class="c1">;; internal procedures</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">base</span> <span class="nv">opds</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">opds</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">exponent</span> <span class="nv">opds</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">opds</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-sum</span> <span class="nv">a1</span> <span class="nv">a2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'+</span> <span class="nv">a1</span> <span class="nv">a2</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-product</span> <span class="nv">m1</span> <span class="nv">m2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'*</span> <span class="nv">m1</span> <span class="nv">m2</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-exponentiation</span> <span class="nv">b1</span> <span class="nv">e2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">=number?</span> <span class="nv">e2</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
	  <span class="p">((</span><span class="nf">=number?</span> <span class="nv">e2</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">b1</span><span class="p">)</span>
	  <span class="p">((</span><span class="nf">=number?</span> <span class="nv">b1</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
	  <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">number? </span><span class="nv">b1</span><span class="p">)</span> <span class="p">(</span><span class="nb">number? </span><span class="nv">e2</span><span class="p">))</span> <span class="p">(</span><span class="nb">expt </span><span class="nv">b1</span> <span class="nv">e2</span><span class="p">))</span>
	  <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">list </span><span class="ss">'**</span> <span class="nv">b1</span> <span class="nv">e2</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">deriv-exp</span> <span class="nv">opds</span> <span class="nv">var</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">make-product</span> <span class="p">(</span><span class="nf">make-product</span> <span class="p">(</span><span class="nf">exponent</span> <span class="nv">opds</span><span class="p">)</span>
				<span class="p">(</span><span class="nf">make-exponentiation</span> <span class="p">(</span><span class="nf">base</span> <span class="nv">opds</span><span class="p">)</span>
						     <span class="p">(</span><span class="nf">make-sum</span> <span class="p">(</span><span class="nf">exponent</span> <span class="nv">opds</span><span class="p">)</span> <span class="mi">-1</span><span class="p">)))</span>
		  <span class="p">(</span><span class="nf">deriv</span> <span class="p">(</span><span class="nf">base</span> <span class="nv">opds</span><span class="p">)</span> <span class="nv">var</span><span class="p">)))</span>
  <span class="c1">;; interface to the rest of the system</span>
  <span class="p">(</span><span class="nf">put</span> <span class="ss">'deriv</span> <span class="ss">'**</span> <span class="nv">deriv-exp</span><span class="p">)</span>
  <span class="ss">'done</span><span class="p">)</span>

<span class="p">(</span><span class="nf">install-deriv-exp-package</span><span class="p">)</span>
<span class="p">(</span><span class="nf">deriv</span> <span class="o">'</span><span class="p">(</span><span class="nv">**</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="mi">3</span><span class="p">)</span> <span class="mi">5</span><span class="p">)</span> <span class="ss">'x</span><span class="p">)</span>
</pre></div>

<p>
d. предположим мы индексируем процедуры другим способом, то есть в процедуре производной вызывается вот такой код
</p>
<div class="highlight"><pre><span></span><span class="p">((</span><span class="nf">get</span> <span class="p">(</span><span class="nf">operator</span> <span class="nv">exp</span><span class="p">)</span> <span class="ss">'deriv</span><span class="p">)</span> <span class="p">(</span><span class="nf">operands</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">var</span><span class="p">)</span>
</pre></div>

<p>
Какие изменения необходимо сделать в остальной системе что бы код продолжал работать?
</p>

<p>
нам нужно изменить интерфейсную часть пакетов, то есть при выполнении put нужно поменять местами операнд и имя функции
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">put</span> <span class="ss">'**</span> <span class="ss">'deriv</span> <span class="nv">deriv-exp</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org3f59c89" class="outline-2">
<h2 id="org3f59c89">Упражнение 2.74</h2>
<div class="outline-text-2" id="text-org3f59c89">
<p>
"Жадное Предприятие Inc." широко децентрализованная компания, которая имеет много подразделений. В каждом подразделении своя реализация хранения списка персонала. Нужно иметь возможность получать и искать сотрудников по всем подразделениям, определите общие методы.
</p>

<p>
a. Дайте определение общей процедуры get-record, которая получает информацию по конкретному сотруднику из файла списка сотрудников подразделения.
</p>

<p>
b. Дайте определение общей процедуры get-salary, которая получает зарплату сотрудника.
</p>

<p>
c. Сделайте общую процедуру find-employee-record которая ищет по имени по всем подразделениям.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-department-1-package</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="nv">TYPE</span> <span class="ss">'department1</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="nv">allemployees</span> <span class="p">(</span><span class="nb">list </span><span class="o">'</span><span class="p">(</span><span class="nv">Каблуков</span> <span class="mf">100.0</span> <span class="s">"Достоевского 5, кв. 20"</span> <span class="mi">1</span><span class="p">)</span>
			     <span class="o">'</span><span class="p">(</span><span class="nv">Коровин</span> <span class="mf">70.0</span> <span class="s">"Луговая 2"</span> <span class="mi">2</span><span class="p">)</span>
			     <span class="o">'</span><span class="p">(</span><span class="nv">Тихонов</span> <span class="mf">75.0</span> <span class="s">"Лунина 13, кв. 156"</span> <span class="mi">3</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">last-name</span> <span class="nv">record</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">car </span><span class="nv">record</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">salary</span> <span class="nv">record</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cadr </span><span class="nv">record</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">address</span> <span class="nv">record</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">caddr </span><span class="nv">record</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">id</span> <span class="nv">record</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cadddr </span><span class="nv">record</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">get-record</span> <span class="nv">employee-id</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter-search</span> <span class="nv">pk</span> <span class="nv">records</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">records</span><span class="p">)</span>
	  <span class="nv">false</span>
	  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">pk</span> <span class="p">(</span><span class="nf">id</span> <span class="p">(</span><span class="nb">car </span><span class="nv">records</span><span class="p">)))</span>
	      <span class="p">(</span><span class="nb">car </span><span class="nv">records</span><span class="p">)</span>
	      <span class="p">(</span><span class="nf">iter-search</span> <span class="nv">pk</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">records</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nf">iter-search</span> <span class="nv">employee-id</span> <span class="nv">allemployees</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">search-by-name</span> <span class="nv">employee-name</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter-search</span> <span class="nv">name</span> <span class="nv">records</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">records</span><span class="p">)</span>
	  <span class="nv">false</span>
	  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">equal? </span><span class="nv">name</span> <span class="p">(</span><span class="nf">last-name</span> <span class="p">(</span><span class="nb">car </span><span class="nv">records</span><span class="p">)))</span>
	      <span class="p">(</span><span class="nb">car </span><span class="nv">records</span><span class="p">)</span>
	      <span class="p">(</span><span class="nf">iter-search</span> <span class="nv">name</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">records</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nf">iter-search</span> <span class="nv">employee-name</span> <span class="nv">allemployees</span><span class="p">))</span>
  <span class="c1">;; interface</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">attach-tag</span> <span class="nv">TYPE</span> <span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="nv">TYPE</span> <span class="ss">'get-record</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">get-record</span> <span class="nv">x</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="nv">TYPE</span> <span class="ss">'get-salary</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">rec</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">salary</span> <span class="nv">rec</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="nv">TYPE</span> <span class="ss">'find-employee-record</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">search-by-name</span> <span class="nv">x</span><span class="p">))))</span>
  <span class="nv">TYPE</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">dp1</span> <span class="p">(</span><span class="nf">install-department-1-package</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-department-2-package</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="nv">TYPE</span> <span class="ss">'department2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="nv">allemployees</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="mi">4</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'Щавелев</span> <span class="mf">105.0</span> <span class="s">"Пушкина 5, кв. 20"</span><span class="p">))</span>
			     <span class="p">(</span><span class="nb">list </span><span class="mi">5</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'Коровин</span> <span class="mf">71.0</span> <span class="s">"Пушкина 2"</span><span class="p">))</span>
			     <span class="p">(</span><span class="nb">list </span><span class="mi">6</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'Куравлев</span> <span class="mf">74.0</span> <span class="s">"Лунина 13, кв. 156"</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">last-name</span> <span class="nv">record</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cadr </span><span class="nv">record</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">salary</span> <span class="nv">record</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cadr </span><span class="p">(</span><span class="nb">cadr </span><span class="nv">record</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">address</span> <span class="nv">record</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">caddr </span><span class="p">(</span><span class="nb">cadr </span><span class="nv">record</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">id</span> <span class="nv">record</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">car </span><span class="nv">record</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">get-record</span> <span class="nv">employee-id</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter-search</span> <span class="nv">pk</span> <span class="nv">records</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">records</span><span class="p">)</span>
	  <span class="nv">false</span>
	  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">pk</span> <span class="p">(</span><span class="nf">id</span> <span class="p">(</span><span class="nb">car </span><span class="nv">records</span><span class="p">)))</span>
	      <span class="p">(</span><span class="nb">car </span><span class="nv">records</span><span class="p">)</span>
	      <span class="p">(</span><span class="nf">iter-search</span> <span class="nv">pk</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">records</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nf">iter-search</span> <span class="nv">employee-id</span> <span class="nv">allemployees</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">search-by-name</span> <span class="nv">employee-name</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter-search</span> <span class="nv">name</span> <span class="nv">employees</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">employees</span><span class="p">)</span>
	  <span class="nv">false</span>
	  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">equal? </span><span class="nv">name</span> <span class="p">(</span><span class="nf">last-name</span> <span class="p">(</span><span class="nb">car </span><span class="nv">employees</span><span class="p">)))</span>
	      <span class="p">(</span><span class="nb">car </span><span class="nv">employees</span><span class="p">)</span>
	      <span class="p">(</span><span class="nf">iter-search</span> <span class="nv">name</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">employees</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nf">iter-search</span> <span class="nv">employee-name</span> <span class="nv">allemployees</span><span class="p">))</span>
  <span class="c1">;; interface</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">attach-tag</span> <span class="nv">TYPE</span> <span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="nv">TYPE</span> <span class="ss">'get-record</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">get-record</span> <span class="nv">x</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="nv">TYPE</span> <span class="ss">'get-salary</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">rec</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">salary</span> <span class="nv">rec</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">put</span> <span class="nv">TYPE</span> <span class="ss">'find-employee-record</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">search-by-name</span> <span class="nv">x</span><span class="p">))))</span>
  <span class="nv">TYPE</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="nv">dp2</span> <span class="p">(</span><span class="nf">install-department-2-package</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">get-record</span> <span class="nv">employee-id</span> <span class="nv">department-id</span><span class="p">)</span>
  <span class="p">((</span><span class="nf">get</span> <span class="nv">department-id</span> <span class="ss">'get-record</span><span class="p">)</span> <span class="nv">employee-id</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">apply-generic</span> <span class="nv">op</span> <span class="o">.</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">type-tags</span> <span class="p">(</span><span class="nb">map </span><span class="nv">type-tag</span> <span class="nv">args</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">proc</span> <span class="p">(</span><span class="nf">get</span> <span class="p">(</span><span class="nb">car </span><span class="nv">type-tags</span><span class="p">)</span> <span class="nv">op</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">if </span><span class="nv">proc</span>
	  <span class="p">(</span><span class="nb">apply </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">map </span><span class="nv">contents</span> <span class="nv">args</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">error</span>
	    <span class="s">"No method for these types -- APPLY-GENERIC"</span>
	    <span class="p">(</span><span class="nb">list </span><span class="nv">type-tags</span> <span class="nv">op</span><span class="p">))))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">get-salary</span> <span class="nv">record</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'get-salary</span> <span class="nv">record</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">find-employee-record</span> <span class="nv">employee-name</span> <span class="nv">deps</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter-department-search</span> <span class="nv">name</span> <span class="nv">deps</span> <span class="nv">res</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">when</span> <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">null? </span><span class="nv">deps</span><span class="p">))</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">record</span> <span class="p">((</span><span class="nf">get</span> <span class="p">(</span><span class="nb">car </span><span class="nv">deps</span><span class="p">)</span> <span class="ss">'find-employee-record</span><span class="p">)</span> <span class="nv">name</span><span class="p">)))</span>
	  <span class="p">(</span><span class="nb">display </span><span class="nv">record</span><span class="p">)</span>
	  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">eq? </span><span class="nv">record</span> <span class="nv">false</span><span class="p">)</span>
	      <span class="p">(</span><span class="nf">iter-department-search</span> <span class="nv">name</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">deps</span><span class="p">)</span> <span class="nv">res</span><span class="p">)</span>
	      <span class="p">(</span><span class="nf">iter-department-search</span> <span class="nv">name</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">deps</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">record</span> <span class="nv">res</span><span class="p">)))))</span>
    <span class="nv">res</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">iter-department-search</span> <span class="nv">employee-name</span> <span class="nv">deps</span> <span class="o">'</span><span class="p">()))</span>
<span class="nv">dp1</span>
<span class="nv">dp2</span>
<span class="p">(</span><span class="nb">equal? </span><span class="ss">'Li</span> <span class="ss">'Li</span><span class="p">)</span>
<span class="p">(</span><span class="nf">get</span> <span class="nv">dp2</span> <span class="ss">'find-employee-record</span><span class="p">)</span>
<span class="p">((</span><span class="nf">get</span> <span class="nv">dp2</span> <span class="ss">'find-employee-record</span><span class="p">)</span> <span class="ss">'Li</span><span class="p">)</span>
<span class="p">(</span><span class="nf">find-employee-record</span> <span class="ss">'Коровин</span> <span class="p">(</span><span class="nb">list </span><span class="nv">dp1</span> <span class="nv">dp2</span><span class="p">))</span>
</pre></div>

<p>
d. Какие изменения нужно внести если в Жадное Предприятие Inc. добавится еще одна дочерняя.
</p>

<p>
При добавлении подразделения нужно будет задать уникальный TYPE и реализовать интерфейс.
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">put</span> <span class="nv">TYPE</span> <span class="ss">'get-record</span>
     <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="o">...</span> <span class="nv">x</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">put</span> <span class="nv">TYPE</span> <span class="ss">'get-salary</span>
     <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">rec</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="o">...</span> <span class="nv">rec</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">put</span> <span class="nv">TYPE</span> <span class="ss">'find-employee-record</span>
     <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="o">...</span> <span class="nv">x</span><span class="p">))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org7e3d48a" class="outline-2">
<h2 id="org7e3d48a">Упражнение 2.75</h2>
<div class="outline-text-2" id="text-org7e3d48a">
<p>
Определите конструктор make-from-mag-ang в стиле получения сообщения (message-passing).
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-from-real-imag</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">dispatch</span> <span class="nv">op</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">eq? </span><span class="nv">op</span> <span class="ss">'real-part</span><span class="p">)</span> <span class="nv">x</span><span class="p">)</span>
	  <span class="p">((</span><span class="nb">eq? </span><span class="nv">op</span> <span class="ss">'imag-part</span><span class="p">)</span> <span class="nv">y</span><span class="p">)</span>
	  <span class="p">((</span><span class="nb">eq? </span><span class="nv">op</span> <span class="ss">'magnitude</span><span class="p">)</span>
	   <span class="p">(</span><span class="nb">sqrt </span><span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">square</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">square</span> <span class="nv">y</span><span class="p">))))</span>
	  <span class="p">((</span><span class="nb">eq? </span><span class="nv">op</span> <span class="ss">'angle</span><span class="p">)</span> <span class="p">(</span><span class="nb">atan </span><span class="nv">y</span> <span class="nv">x</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">else</span>
	   <span class="p">(</span><span class="nf">error</span> <span class="s">"Unknown op -- MAKE-FROM-REAL-IMAG"</span> <span class="nv">op</span><span class="p">))))</span>
  <span class="nv">dispatch</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">apply-generic</span> <span class="nv">op</span> <span class="nv">arg</span><span class="p">)</span> <span class="p">(</span><span class="nf">arg</span> <span class="nv">op</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-from-mag-ang</span> <span class="nv">m</span> <span class="nv">a</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">dispatch</span> <span class="nv">op</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">eq? </span><span class="nv">op</span> <span class="ss">'real-part</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">m</span> <span class="p">(</span><span class="nb">cos </span><span class="nv">a</span><span class="p">)))</span>
	  <span class="p">((</span><span class="nb">eq? </span><span class="nv">op</span> <span class="ss">'imag-part</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">m</span> <span class="p">(</span><span class="nb">sin </span><span class="nv">a</span><span class="p">)))</span>
	  <span class="p">((</span><span class="nb">eq? </span><span class="nv">op</span> <span class="ss">'magnitude</span><span class="p">)</span> <span class="nv">m</span><span class="p">)</span>
	  <span class="p">((</span><span class="nb">eq? </span><span class="nv">op</span> <span class="ss">'angle</span><span class="p">)</span> <span class="nv">a</span><span class="p">)</span>
	  <span class="p">(</span><span class="nf">else</span>
	   <span class="p">(</span><span class="nf">error</span> <span class="s">"Unknown op -- MAKE-FROM-MAG-ANG"</span> <span class="nv">op</span><span class="p">))))</span>
  <span class="nv">dispatch</span><span class="p">)</span>


<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">real-part </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'real-part</span> <span class="nv">z</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">imag-part </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'imag-part</span> <span class="nv">z</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">magnitude </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'magnitude</span> <span class="nv">z</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">angle </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'angle</span> <span class="nv">z</span><span class="p">))</span>

<span class="p">(</span><span class="nb">real-part </span><span class="p">(</span><span class="nf">make-from-real-imag</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>


<div id="outline-container-orga87bdec" class="outline-2">
<h2 id="orga87bdec">Упражнение 2.76</h2>
<div class="outline-text-2" id="text-orga87bdec">
<p>
При эволюционировании системы с общими процедурами, могут потребоваться новые типы данных или новые операции. Для каждой из трех стратегий
</p>

<p>
общие операции с явным выбором по типу
дата ориентированный подход (через хеш таблицы)
и подход получения сообщения (через dispatch в конструкторе)
</p>

<p>
опишите изменения которые должны быть внесены для нового типа или новой операции <code>[3/3]</code>
</p>

<ul class="org-ul">
<li class="on">
<code>[X]</code> при явном выборе метода по типу, нужно изменить <b>все общие методы</b> добавив туда дополнительные условия обработки нового типа. если добавляется метод, то нужно реализовать <b>общий метод</b> с выбором частного метода <b>для каждого типа</b>.</li>

<li class="on">
<code>[X]</code> при использовании дата ориентированного подхода если добавляется новый метод, реализовать интерфейс для этого метода для каждого типа, если добавляется новый тип, нужно реализовать интерфейсные методы для данного типа. <b>Важно что при этом не меняется старый код.</b>
</li>

<li class="on">
<code>[X]</code> при использовании message-passing при добавлении метода, нужно изменить конструкторы всех типов, добавив туда обработку нового метода, если добавляется новый тип, достаточно описать новый конструктор. То есть <b>при добавлении типа, старый код не меняется</b>, но <b>при добавлении метода, придется менять конструкторы в старом коде</b>.</li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-23-simvolicheskie-dannye/" class="u-url">SICP 2.3 Символические данные.</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-23-simvolicheskie-dannye/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-23T01:03:21+03:00" itemprop="datePublished" title="2020-01-23 01:03">2020-01-23 01:03</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org3297eb5" class="outline-2">
<h2 id="org3297eb5">Упражнение 2.54</h2>
<div class="outline-text-2" id="text-org3297eb5">
<p>
Два списка называются равными если они содержат одинаковые элементы в одной последовательности. Определите equal? как рекурсивную функцию сравнения при помощи eq?.
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">equal? </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">pair? </span><span class="nv">b</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">eq? </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
      <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">equal? </span><span class="p">(</span><span class="nb">car </span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">b</span><span class="p">))</span> <span class="p">(</span><span class="nb">equal? </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">b</span><span class="p">)))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org1901cd8" class="outline-2">
<h2 id="org1901cd8">Упражнение 2.55</h2>
<div class="outline-text-2" id="text-org1901cd8">
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">car </span><span class="o">'</span><span class="ss">'abracadabra</span><span class="p">)</span>
<span class="c1">;; '''asdfsfsf = (quote (quote asdfsfsf))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org51fd1bc" class="outline-2">
<h2 id="org51fd1bc">Упражнение 2.56</h2>
<div class="outline-text-2" id="text-org51fd1bc">
<p>
Покажите как расширить базовое дифференцирование чтобы оно могло обрабатывать больше видов выражений. Например реализовав правило  \(\frac{d(u^n)}{dx}=nu^{n-1}\frac{du}{dx}\) 
добавив условие на проверку экспоненты и реализовав определения exponentiation?, base, exponent и make-exponentiation.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">exponentiation?</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">eq? </span><span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">)</span> <span class="ss">'**</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">base</span> <span class="nv">exponentiation</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">exponentiation</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">exponent</span> <span class="nv">exponentiation</span><span class="p">)</span> <span class="p">(</span><span class="nb">caddr </span><span class="nv">exponentiation</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-exponentiation</span> <span class="nv">b1</span> <span class="nv">e2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">=number?</span> <span class="nv">e2</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">((</span><span class="nf">=number?</span> <span class="nv">e2</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">b1</span><span class="p">)</span>
	<span class="p">((</span><span class="nf">=number?</span> <span class="nv">b1</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">number? </span><span class="nv">b1</span><span class="p">)</span> <span class="p">(</span><span class="nb">number? </span><span class="nv">e2</span><span class="p">))</span> <span class="p">(</span><span class="nb">expt </span><span class="nv">b1</span> <span class="nv">e2</span><span class="p">))</span>
	<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">list </span><span class="ss">'**</span> <span class="nv">b1</span> <span class="nv">e2</span><span class="p">))))</span>


<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">deriv</span> <span class="nv">exp</span> <span class="nv">var</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">number? </span><span class="nv">exp</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">((</span><span class="nf">variable?</span> <span class="nv">exp</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="nv">exp</span> <span class="nv">var</span><span class="p">)</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">))</span>
	<span class="p">((</span><span class="nf">sum?</span> <span class="nv">exp</span><span class="p">)</span>
	 <span class="p">(</span><span class="nf">make-sum</span> <span class="p">(</span><span class="nf">deriv</span> <span class="p">(</span><span class="nf">addend</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">var</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">deriv</span> <span class="p">(</span><span class="nf">augend</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">var</span><span class="p">)))</span>
	<span class="p">((</span><span class="nf">product?</span> <span class="nv">exp</span><span class="p">)</span>
	 <span class="p">(</span><span class="nf">make-sum</span>
	   <span class="p">(</span><span class="nf">make-product</span> <span class="p">(</span><span class="nf">multiplier</span> <span class="nv">exp</span><span class="p">)</span>
			 <span class="p">(</span><span class="nf">deriv</span> <span class="p">(</span><span class="nf">multiplicand</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">var</span><span class="p">))</span>
	   <span class="p">(</span><span class="nf">make-product</span> <span class="p">(</span><span class="nf">deriv</span> <span class="p">(</span><span class="nf">multiplier</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">var</span><span class="p">)</span>
			 <span class="p">(</span><span class="nf">multiplicand</span> <span class="nv">exp</span><span class="p">))))</span>
	<span class="p">((</span><span class="nf">exponentiation?</span> <span class="nv">exp</span><span class="p">)</span>
	 <span class="p">(</span><span class="nf">make-product</span> <span class="p">(</span><span class="nf">make-product</span> <span class="p">(</span><span class="nf">exponent</span> <span class="nv">exp</span><span class="p">)</span>
				     <span class="p">(</span><span class="nf">make-exponentiation</span> <span class="p">(</span><span class="nf">base</span> <span class="nv">exp</span><span class="p">)</span>
							  <span class="p">(</span><span class="nf">make-sum</span> <span class="p">(</span><span class="nf">exponent</span> <span class="nv">exp</span><span class="p">)</span>
								    <span class="mi">-1</span><span class="p">)))</span>
		       <span class="p">(</span><span class="nf">deriv</span> <span class="p">(</span><span class="nf">base</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">var</span><span class="p">)))</span>
	<span class="p">(</span><span class="nf">else</span>
	 <span class="p">(</span><span class="nf">error</span> <span class="s">"unknown expression type -- DERIV"</span> <span class="nv">exp</span><span class="p">))))</span>

<span class="p">(</span><span class="nf">deriv</span> <span class="o">'</span><span class="p">(</span><span class="nv">**</span> <span class="nv">x</span> <span class="mi">4</span><span class="p">)</span> <span class="ss">'x</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgc07f50d" class="outline-2">
<h2 id="orgc07f50d">Упражнение 2.57</h2>
<div class="outline-text-2" id="text-orgc07f50d">
<p>
Расширьте программу для дифференцирования что бы сумма и умножение могло вычисляться двух или более под выражений. То есть что бы можно было писать так.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">deriv</span> <span class="o">'</span><span class="p">(</span><span class="nv">*</span> <span class="nv">x</span> <span class="nv">y</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="mi">3</span><span class="p">))</span> <span class="ss">'x</span><span class="p">)</span>
</pre></div>

<p>
Попробуйте добиться этого изменяя только представление суммы и умножения, не изменяя саму функцию deriv.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-sum</span> <span class="nv">a1</span> <span class="nv">a2</span> <span class="o">.</span> <span class="nv">an</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">number? </span><span class="nv">a1</span><span class="p">)</span> <span class="p">(</span><span class="nb">number? </span><span class="nv">a2</span><span class="p">))</span> <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nb">list </span><span class="ss">'+</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">a1</span> <span class="nv">a2</span><span class="p">))</span> <span class="nv">an</span><span class="p">))</span>
	<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nb">list </span><span class="ss">'+</span> <span class="nv">a1</span> <span class="nv">a2</span><span class="p">)</span> <span class="nv">an</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-product</span> <span class="nv">m1</span> <span class="nv">m2</span> <span class="o">.</span> <span class="nv">mn</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nf">=number?</span> <span class="nv">m1</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">=number?</span> <span class="nv">m2</span> <span class="mi">0</span><span class="p">))</span> <span class="mi">0</span><span class="p">)</span>
	<span class="c1">;; ((=number? m1 1) m2)</span>
	<span class="c1">;; ((=number? m2 1) m1)</span>
	<span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">number? </span><span class="nv">m1</span><span class="p">)</span> <span class="p">(</span><span class="nb">number? </span><span class="nv">m2</span><span class="p">))</span> <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nb">list </span><span class="ss">'+</span> <span class="p">(</span><span class="nb">* </span><span class="nv">m1</span> <span class="nv">m2</span><span class="p">))</span> <span class="nv">mn</span><span class="p">))</span>
	<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nb">list </span><span class="ss">'*</span> <span class="nv">m1</span> <span class="nv">m2</span><span class="p">)</span> <span class="nv">mn</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">addend</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">s</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">augend</span> <span class="nv">s</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">length </span><span class="nv">s</span><span class="p">)</span> <span class="mi">3</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">caddr </span><span class="nv">s</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nb">list </span><span class="ss">'+</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">s</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">multiplier</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">p</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">multiplicand</span> <span class="nv">p</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">length </span><span class="nv">p</span><span class="p">)</span> <span class="mi">3</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">caddr </span><span class="nv">p</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nb">list </span><span class="ss">'*</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">p</span><span class="p">)))))</span>
</pre></div>
</div>
</div>


<div id="outline-container-orgb1537f1" class="outline-2">
<h2 id="orgb1537f1">Упражнение 2.58</h2>
<div class="outline-text-2" id="text-orgb1537f1">
<p>
Предположим мы хотим записывать программу для дифференцирования в обычной математической нотации. <code>[2/2]</code>
</p>

<ul class="org-ul">
<li class="on">
<code>[X]</code> предложите решение когда сумма и умножение всегда принимают два аргумента и приоритет выражений полностью задан скобками (x + (3 * (x + (y + 2))))</li>
</ul>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">variable?</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">symbol? </span><span class="nv">x</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nf">variable?</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">variable?</span> <span class="nv">v2</span><span class="p">)</span> <span class="p">(</span><span class="nb">eq? </span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-sum</span> <span class="nv">a1</span> <span class="nv">a2</span><span class="p">)</span> <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nb">list </span><span class="nv">a1</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'+</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">a2</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sum?</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">eq? </span><span class="p">(</span><span class="nb">cadr </span><span class="nv">x</span><span class="p">)</span> <span class="ss">'+</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">addend</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">s</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">augend</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">caddr </span><span class="nv">s</span><span class="p">))</span>
<span class="p">(</span><span class="nf">addend</span> <span class="p">(</span><span class="nf">make-sum</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="nf">augend</span> <span class="p">(</span><span class="nf">make-sum</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-product</span> <span class="nv">m1</span> <span class="nv">m2</span><span class="p">)</span> <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nb">list </span><span class="nv">m1</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'*</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">m2</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">product?</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">eq? </span><span class="p">(</span><span class="nb">cadr </span><span class="nv">x</span><span class="p">)</span> <span class="ss">'*</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">multiplier</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">p</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">multiplicand</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">caddr </span><span class="nv">p</span><span class="p">))</span>
<span class="p">(</span><span class="nf">make-product</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="nf">product?</span> <span class="p">(</span><span class="nf">make-product</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="nf">multiplier</span> <span class="p">(</span><span class="nf">make-product</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="nf">multiplicand</span> <span class="p">(</span><span class="nf">make-product</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>

<ul class="org-ul">
<li class="on">
<code>[X]</code> проблема становится сложнее если опустить необязательные скобки и подразумевать что умножение имеет приоритет над суммой, предложите свое решение для этого случая (x + 3 * (x + y + 2)) когда аргументов может быть более 2.</li>
</ul>
<p>
еще может быть вот такой случай (x + 3 * (x + y + 2) + (x * x)) тут после второй итерации нужно делать не умножение а ещё одну сумму.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">search-first-operand-position</span> <span class="nv">op</span> <span class="nv">exp</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">exp</span><span class="p">))</span> <span class="p">(</span><span class="nb">null? </span><span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">length </span><span class="nv">exp</span><span class="p">)</span> <span class="mi">3</span><span class="p">))</span>
      <span class="mi">0</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">eq? </span><span class="p">(</span><span class="nb">cadr </span><span class="nv">exp</span><span class="p">)</span> <span class="nv">op</span><span class="p">)</span>
	  <span class="p">(</span><span class="nb">+ </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span>
	  <span class="p">(</span><span class="nf">search-first-operand-position</span> <span class="nv">op</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">exp</span><span class="p">))</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-sum</span> <span class="nv">a1</span> <span class="nv">a2</span><span class="p">)</span> <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nb">list </span><span class="nv">a1</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'+</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">a2</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sum?</span> <span class="nv">s</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">fop</span> <span class="p">(</span><span class="nf">search-first-operand-position</span> <span class="ss">'+</span> <span class="nv">s</span> <span class="mi">0</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">&gt; </span><span class="nv">fop</span> <span class="mi">0</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">addend</span> <span class="nv">s</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">rev</span> <span class="p">(</span><span class="nb">reverse </span><span class="nv">s</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">fop</span> <span class="p">(</span><span class="nf">search-first-operand-position</span> <span class="ss">'+</span> <span class="nv">rev</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">addends</span> <span class="p">()))</span>
      <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter-shift</span> <span class="nv">ss</span> <span class="nv">n</span><span class="p">)</span>
	<span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
	    <span class="nv">ss</span>
	    <span class="p">(</span><span class="nf">iter-shift</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">ss</span><span class="p">))</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))))</span>
      <span class="p">(</span><span class="k">define </span><span class="nv">addends</span> <span class="p">(</span><span class="nf">iter-shift</span> <span class="nv">rev</span> <span class="nv">fop</span><span class="p">))</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">length </span><span class="nv">addends</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
	  <span class="p">(</span><span class="nb">car </span><span class="nv">addends</span><span class="p">)</span>
	  <span class="p">(</span><span class="nb">reverse </span><span class="nv">addends</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">augend</span> <span class="nv">s</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">fop</span> <span class="p">(</span><span class="nf">search-first-operand-position</span> <span class="ss">'+</span> <span class="nv">s</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">aug</span> <span class="p">()))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter-shift</span> <span class="nv">ss</span> <span class="nv">n</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
	  <span class="nv">ss</span>
	  <span class="p">(</span><span class="nf">iter-shift</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">ss</span><span class="p">))</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">define </span><span class="nv">aug</span> <span class="p">(</span><span class="nf">iter-shift</span> <span class="nv">s</span> <span class="nv">fop</span><span class="p">))</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">length </span><span class="nv">aug</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">car </span><span class="nv">aug</span><span class="p">)</span>
	<span class="nv">aug</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">deriv</span> <span class="o">'</span><span class="p">(</span><span class="nv">x</span> <span class="nv">+</span> <span class="mi">3</span> <span class="nv">*</span> <span class="p">(</span><span class="nf">x</span> <span class="nv">+</span> <span class="nv">y</span> <span class="nv">+</span> <span class="mi">2</span><span class="p">))</span> <span class="ss">'x</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org89b4f10" class="outline-2">
<h2 id="org89b4f10">Упражнение 2.59</h2>
<div class="outline-text-2" id="text-org89b4f10">
<p>
Определите процедуру union-set если set не отсортированный список.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">union-set</span> <span class="nv">set1</span> <span class="nv">set2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">set2</span><span class="p">)</span> <span class="nv">set1</span><span class="p">)</span>
	<span class="p">((</span><span class="nf">element-of-set?</span> <span class="p">(</span><span class="nb">car </span><span class="nv">set2</span><span class="p">)</span> <span class="nv">set1</span><span class="p">)</span> <span class="p">(</span><span class="nf">union-set</span> <span class="nv">set1</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set2</span><span class="p">)))</span>
	<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">set2</span><span class="p">)</span> <span class="p">(</span><span class="nf">union-set</span> <span class="nv">set1</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set2</span><span class="p">))))))</span>
</pre></div>

<p>
так как все процедуры используют element-of-set? эта функция сильно влияет на порядок роста. Порядок роста для element-of-set? и adjoin-set равен n. Для intersection-set и union-set n<sup>2</sup>.
</p>
</div>
</div>

<div id="outline-container-orgc43a71b" class="outline-2">
<h2 id="orgc43a71b">Упражнение 2.60</h2>
<div class="outline-text-2" id="text-orgc43a71b">
<p>
Предположим сеты могут иметь дубликаты. Реализуйте методы для сетов для такой структуры. Как от этого изменится порядок роста?
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">element-of-set?</span> <span class="nv">x</span> <span class="nv">set</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">set</span><span class="p">)</span> <span class="nv">false</span><span class="p">)</span>
	<span class="p">((</span><span class="nb">equal? </span><span class="nv">x</span> <span class="p">(</span><span class="nb">car </span><span class="nv">set</span><span class="p">))</span> <span class="nv">true</span><span class="p">)</span>
	<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">element-of-set?</span> <span class="nv">x</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">adjoin-set</span> <span class="nv">x</span> <span class="nv">set</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">set</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">intersection-set</span> <span class="nv">set1</span> <span class="nv">set2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">null? </span><span class="nv">set1</span><span class="p">)</span> <span class="p">(</span><span class="nb">null? </span><span class="nv">set2</span><span class="p">))</span> <span class="o">'</span><span class="p">())</span>
	<span class="p">((</span><span class="nf">element-of-set?</span> <span class="p">(</span><span class="nb">car </span><span class="nv">set1</span><span class="p">)</span> <span class="nv">set2</span><span class="p">)</span>
	 <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">set1</span><span class="p">)</span>
	       <span class="p">(</span><span class="nf">intersection-set</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set1</span><span class="p">)</span> <span class="nv">set2</span><span class="p">)))</span>
	<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">intersection-set</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set1</span><span class="p">)</span> <span class="nv">set2</span><span class="p">))))</span>


<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">union-set</span> <span class="nv">set1</span> <span class="nv">set2</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">append </span><span class="nv">set1</span> <span class="nv">set2</span><span class="p">))</span>
</pre></div>

<p>
Для element-of-set порядок роста n, для adjoin-set 1, для intersection-set n<sup>2</sup>, для union-set n (так как append займет n).
</p>
</div>
</div>

<div id="outline-container-orga4b7165" class="outline-2">
<h2 id="orga4b7165">Упражнение 2.61</h2>
<div class="outline-text-2" id="text-orga4b7165">
<p>
Дайте определение adjoin-set для сортированных списков.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">adjoin-set</span> <span class="nv">x</span> <span class="nv">set</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">set</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">x</span><span class="p">))</span>
	<span class="p">((</span><span class="nb">= </span><span class="nv">x</span> <span class="p">(</span><span class="nb">car </span><span class="nv">set</span><span class="p">))</span> <span class="nv">set</span><span class="p">)</span>
	<span class="p">((</span><span class="nb">&lt; </span><span class="nv">x</span> <span class="p">(</span><span class="nb">car </span><span class="nv">set</span><span class="p">))</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">set</span><span class="p">))</span>
	<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">set</span><span class="p">)</span> <span class="p">(</span><span class="nf">adjoin-set</span> <span class="nv">x</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set</span><span class="p">))))))</span>
</pre></div>
<p>
порядок роста по прежнему n, но иногда работает быстрее.
</p>
</div>
</div>

<div id="outline-container-org2d060af" class="outline-2">
<h2 id="org2d060af">Упражнение 2.62</h2>
<div class="outline-text-2" id="text-org2d060af">
<p>
Приведите определение union-set с порядком роста n.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">union-set</span> <span class="nv">set1</span> <span class="nv">set2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">set1</span><span class="p">)</span> <span class="nv">set2</span><span class="p">)</span>
	<span class="p">((</span><span class="nb">null? </span><span class="nv">set2</span><span class="p">)</span> <span class="nv">set1</span><span class="p">)</span>
	<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">x1</span> <span class="p">(</span><span class="nb">car </span><span class="nv">set1</span><span class="p">))</span> <span class="p">(</span><span class="nf">x2</span> <span class="p">(</span><span class="nb">car </span><span class="nv">set2</span><span class="p">)))</span>
		<span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">x1</span> <span class="nv">x2</span><span class="p">)</span>
		       <span class="p">(</span><span class="nb">cons </span><span class="nv">x1</span>
			     <span class="p">(</span><span class="nf">union-set</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set1</span><span class="p">)</span>
					<span class="p">(</span><span class="nb">cdr </span><span class="nv">set2</span><span class="p">))))</span>
		      <span class="p">((</span><span class="nb">&lt; </span><span class="nv">x1</span> <span class="nv">x2</span><span class="p">)</span>
		       <span class="p">(</span><span class="nb">cons </span><span class="nv">x1</span> <span class="p">(</span><span class="nf">union-set</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set1</span><span class="p">)</span> <span class="nv">set2</span><span class="p">)))</span>
		      <span class="p">((</span><span class="nb">&lt; </span><span class="nv">x2</span> <span class="nv">x1</span><span class="p">)</span>
		       <span class="p">(</span><span class="nb">cons </span><span class="nv">x2</span> <span class="p">(</span><span class="nf">union-set</span> <span class="nv">set1</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set2</span><span class="p">)))))))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orged02fc2" class="outline-2">
<h2 id="orged02fc2">Упражнение 2.63</h2>
<div class="outline-text-2" id="text-orged02fc2">
<p>
Обе процедуры приведенные ниже трансформируют дерево в список.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tree-&gt;list-1</span> <span class="nv">tree</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">tree</span><span class="p">)</span>
      <span class="o">'</span><span class="p">()</span>
      <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nf">tree-&gt;list-1</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">tree</span><span class="p">))</span>
	      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">entry</span> <span class="nv">tree</span><span class="p">)</span>
		    <span class="p">(</span><span class="nf">tree-&gt;list-1</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">tree</span><span class="p">))))))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tree-&gt;list-2</span> <span class="nv">tree</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">copy-to-list</span> <span class="nv">tree</span> <span class="nv">result-list</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">tree</span><span class="p">)</span>
	<span class="nv">result-list</span>
	<span class="p">(</span><span class="nf">copy-to-list</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">tree</span><span class="p">)</span>
		      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">entry</span> <span class="nv">tree</span><span class="p">)</span>
			    <span class="p">(</span><span class="nf">copy-to-list</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">tree</span><span class="p">)</span>
					  <span class="nv">result-list</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nf">copy-to-list</span> <span class="nv">tree</span> <span class="o">'</span><span class="p">()))</span>
</pre></div>

<p>
a. Будут ли отличаться результаты двух процедур? Какие списки будут для дерева с рисунка 2.16
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="nv">tree1</span> <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">7</span>
			 <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">3</span>
				    <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">1</span> <span class="p">()</span> <span class="p">())</span>
				    <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">5</span> <span class="p">()</span> <span class="p">()))</span>
			 <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">9</span>
				    <span class="p">()</span>
				    <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">11</span> <span class="p">()</span> <span class="p">()))))</span>

<span class="nv">tree1</span>
<span class="p">(</span><span class="nf">tree-&gt;list-1</span> <span class="nv">tree1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">tree-&gt;list-2</span> <span class="nv">tree1</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">tree2</span> <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">3</span>
			 <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">7</span>
				    <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">5</span> <span class="p">()</span> <span class="p">())</span>
				    <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">9</span>
					       <span class="p">()</span>
					       <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">11</span> <span class="p">()</span> <span class="p">())))</span>
			 <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">1</span>
				    <span class="p">()</span>
				    <span class="p">())))</span>

<span class="nv">tree2</span>
<span class="p">(</span><span class="nf">tree-&gt;list-1</span> <span class="nv">tree2</span><span class="p">)</span>
<span class="p">(</span><span class="nf">tree-&gt;list-2</span> <span class="nv">tree2</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">tree3</span> <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">5</span>
			 <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">3</span>
				    <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">1</span> <span class="p">()</span> <span class="p">())</span>
				    <span class="p">())</span>
			 <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">9</span>
				    <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">7</span> <span class="p">()</span> <span class="p">())</span>
				    <span class="p">(</span><span class="nf">make-tree</span> <span class="mi">11</span> <span class="p">()</span> <span class="p">()))))</span>
<span class="nv">tree3</span>
<span class="p">(</span><span class="nf">tree-&gt;list-1</span> <span class="nv">tree3</span><span class="p">)</span>
<span class="p">(</span><span class="nf">tree-&gt;list-2</span> <span class="nv">tree3</span><span class="p">)</span>
</pre></div>

<p>
списки одинаковые
</p>

<p>
b. как отличается порядок роста?
в первом случае за счет линейного времени append, порядок роста n*log(n)
во втором случае порядок роста будет n.
</p>
</div>
</div>

<div id="outline-container-org8be82d5" class="outline-2">
<h2 id="org8be82d5">Упражнение 2.64</h2>
<div class="outline-text-2" id="text-org8be82d5">
<p>
Следующая процедура list-&gt;tree преобразует отсортированный список в сбалансированное бинарное дерево. Вспомогательная процедура partial-tree принимает в качестве аргументов целое n и список и строит сбалансированное  бинарное дерево содержащее первые n элементов списка. Результат это функции - пара, первое значение это созданное дерево, а cdr элементы не вошедшие в дерево.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">list-&gt;tree</span> <span class="nv">elements</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nf">partial-tree</span> <span class="nv">elements</span> <span class="p">(</span><span class="nb">length </span><span class="nv">elements</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">partial-tree</span> <span class="nv">elts</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">cons </span><span class="o">'</span><span class="p">()</span> <span class="nv">elts</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">left-size</span> <span class="p">(</span><span class="nb">quotient </span><span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">2</span><span class="p">)))</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">left-result</span> <span class="p">(</span><span class="nf">partial-tree</span> <span class="nv">elts</span> <span class="nv">left-size</span><span class="p">)))</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">left-tree</span> <span class="p">(</span><span class="nb">car </span><span class="nv">left-result</span><span class="p">))</span>
		<span class="p">(</span><span class="nf">non-left-elts</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">left-result</span><span class="p">))</span>
		<span class="p">(</span><span class="nf">right-size</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">left-size</span> <span class="mi">1</span><span class="p">))))</span>
	    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">this-entry</span> <span class="p">(</span><span class="nb">car </span><span class="nv">non-left-elts</span><span class="p">))</span>
		  <span class="p">(</span><span class="nf">right-result</span> <span class="p">(</span><span class="nf">partial-tree</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">non-left-elts</span><span class="p">)</span>
					      <span class="nv">right-size</span><span class="p">)))</span>
	      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">right-tree</span> <span class="p">(</span><span class="nb">car </span><span class="nv">right-result</span><span class="p">))</span>
		    <span class="p">(</span><span class="nf">remaining-elts</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">right-result</span><span class="p">)))</span>
		<span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">make-tree</span> <span class="nv">this-entry</span> <span class="nv">left-tree</span> <span class="nv">right-tree</span><span class="p">)</span>
		      <span class="nv">remaining-elts</span><span class="p">))))))))</span>
</pre></div>

<p>
a. Кратко опишите как работает partial-tree. Нарисуйте дерево для списка (1 3 5 7 9 11).
</p>

<p>
Берем половину списка, строим от него дерево из первых int((n-1)/2 элементов. берем следующий элемент это будет вершина дерева, берем остальные элементы это будет правая часть дерева. для левой и правой стороны дерева процесс построения рекурсивно повторяется.
</p>

<div class="highlight"><pre><span></span><span class="c1">;Value: ((5 (1 () (3 () ())) (9 (7 () ()) (11 () ()))))</span>

	   <span class="mi">5</span>
	<span class="nv">/</span>      <span class="err">\</span>
       <span class="mi">1</span>         <span class="mi">9</span>
	<span class="err">\</span>       <span class="nv">/</span>  <span class="err">\</span>
     <span class="p">()</span>  <span class="mi">3</span>     <span class="mi">7</span>    <span class="mi">11</span>
	<span class="nv">/</span> <span class="err">\</span>   <span class="nv">/</span><span class="err">\</span>    <span class="nv">/</span> <span class="err">\</span>
       <span class="p">()</span> <span class="p">()</span> <span class="p">()()</span>  <span class="p">()</span>  <span class="p">()</span>
</pre></div>

<p>
b. Каков порядок роста list-&gt;tree?
</p>

<p>
Порядок роста n.
</p>
</div>
</div>

<div id="outline-container-org517d17c" class="outline-2">
<h2 id="org517d17c">Упражнение 2.65</h2>
<div class="outline-text-2" id="text-org517d17c">
<p>
Используя результаты упражнений 2.63 и 2.64 приведите определение union-set и intersection-set для множеств определенных как сбалансированные бинарные деревья.
</p>

<div class="highlight"><pre><span></span>	<span class="mi">4</span>                     <span class="mi">7</span>
      <span class="nv">/</span>  <span class="err">\</span>                <span class="nv">/</span>      <span class="err">\</span>
     <span class="mi">3</span>    <span class="mi">5</span>              <span class="mi">1</span>         <span class="mi">9</span>
    <span class="nv">/</span> <span class="err">\</span>   <span class="nv">/</span> <span class="err">\</span>              <span class="err">\</span>       <span class="nv">/</span>  <span class="err">\</span>
  <span class="p">()</span>   <span class="mi">1</span> <span class="mi">6</span>   <span class="mi">11</span>         <span class="p">()</span>  <span class="mi">3</span>     <span class="mi">8</span>    <span class="mi">11</span>
			   <span class="nv">/</span> <span class="err">\</span>   <span class="nv">/</span><span class="err">\</span>    <span class="nv">/</span> <span class="err">\</span>
			  <span class="p">()</span> <span class="p">()</span> <span class="p">()()</span>  <span class="p">()</span>  <span class="p">()</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">union-tree-set</span> <span class="nv">set1</span> <span class="nv">set2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">orderedlist1</span> <span class="p">(</span><span class="nf">tree-&gt;list-2</span> <span class="nv">set1</span><span class="p">))</span> <span class="p">(</span><span class="nf">orderedlist2</span> <span class="p">(</span><span class="nf">tree-&gt;list-2</span> <span class="nv">set2</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">union-set</span> <span class="nv">set1</span> <span class="nv">set2</span><span class="p">)</span>
      <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">set1</span><span class="p">)</span> <span class="nv">set2</span><span class="p">)</span>
	    <span class="p">((</span><span class="nb">null? </span><span class="nv">set2</span><span class="p">)</span> <span class="nv">set1</span><span class="p">)</span>
	    <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">x1</span> <span class="p">(</span><span class="nb">car </span><span class="nv">set1</span><span class="p">))</span> <span class="p">(</span><span class="nf">x2</span> <span class="p">(</span><span class="nb">car </span><span class="nv">set2</span><span class="p">)))</span>
		    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">x1</span> <span class="nv">x2</span><span class="p">)</span>
			   <span class="p">(</span><span class="nb">cons </span><span class="nv">x1</span>
				 <span class="p">(</span><span class="nf">union-set</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set1</span><span class="p">)</span>
					    <span class="p">(</span><span class="nb">cdr </span><span class="nv">set2</span><span class="p">))))</span>
			  <span class="p">((</span><span class="nb">&lt; </span><span class="nv">x1</span> <span class="nv">x2</span><span class="p">)</span>
			   <span class="p">(</span><span class="nb">cons </span><span class="nv">x1</span> <span class="p">(</span><span class="nf">union-set</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set1</span><span class="p">)</span> <span class="nv">set2</span><span class="p">)))</span>
			  <span class="p">((</span><span class="nb">&lt; </span><span class="nv">x2</span> <span class="nv">x1</span><span class="p">)</span>
			   <span class="p">(</span><span class="nb">cons </span><span class="nv">x2</span> <span class="p">(</span><span class="nf">union-set</span> <span class="nv">set1</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set2</span><span class="p">)))))))))</span>

    <span class="p">(</span><span class="nf">list-&gt;tree</span> <span class="p">(</span><span class="nf">union-set</span> <span class="nv">orderedlist1</span> <span class="nv">orderedlist2</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">intersection-tree-set</span> <span class="nv">set1</span> <span class="nv">set2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">orderedlist1</span> <span class="p">(</span><span class="nf">tree-&gt;list-2</span> <span class="nv">set1</span><span class="p">))</span> <span class="p">(</span><span class="nf">orderedlist2</span> <span class="p">(</span><span class="nf">tree-&gt;list-2</span> <span class="nv">set2</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">intersection-set</span> <span class="nv">set1</span> <span class="nv">set2</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nb">null? </span><span class="nv">set1</span><span class="p">)</span> <span class="p">(</span><span class="nb">null? </span><span class="nv">set2</span><span class="p">))</span>
	  <span class="o">'</span><span class="p">()</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">x1</span> <span class="p">(</span><span class="nb">car </span><span class="nv">set1</span><span class="p">))</span> <span class="p">(</span><span class="nf">x2</span> <span class="p">(</span><span class="nb">car </span><span class="nv">set2</span><span class="p">)))</span>
	    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">x1</span> <span class="nv">x2</span><span class="p">)</span>
		   <span class="p">(</span><span class="nb">cons </span><span class="nv">x1</span>
			 <span class="p">(</span><span class="nf">intersection-set</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set1</span><span class="p">)</span>
					   <span class="p">(</span><span class="nb">cdr </span><span class="nv">set2</span><span class="p">))))</span>
		  <span class="p">((</span><span class="nb">&lt; </span><span class="nv">x1</span> <span class="nv">x2</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">intersection-set</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set1</span><span class="p">)</span> <span class="nv">set2</span><span class="p">))</span>
		  <span class="p">((</span><span class="nb">&lt; </span><span class="nv">x2</span> <span class="nv">x1</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">intersection-set</span> <span class="nv">set1</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set2</span><span class="p">)))))))</span>
    <span class="p">(</span><span class="nf">list-&gt;tree</span> <span class="p">(</span><span class="nf">intersection-set</span> <span class="nv">orderedlist1</span> <span class="nv">orderedlist2</span><span class="p">))))</span>
</pre></div>

<p>
так как tree-&gt;list-2, list-&gt;tree и intersection-set, union-set (на сортированных списках) имеют порядок роста n, то и последовательное применение этих алгоритмов также имеет такой же порядок роста.
</p>
</div>
</div>

<div id="outline-container-org93769a0" class="outline-2">
<h2 id="org93769a0">Упражнение 2.66</h2>
<div class="outline-text-2" id="text-org93769a0">
<p>
Определите lookup для бинарного дерева.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">lookup</span> <span class="nv">given-key</span> <span class="nv">tree</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">tree</span><span class="p">)</span> <span class="nv">false</span><span class="p">)</span>
	<span class="p">((</span><span class="nb">equal? </span><span class="nv">given-key</span> <span class="p">(</span><span class="nf">entry</span> <span class="nv">tree</span><span class="p">))</span> <span class="p">(</span><span class="nf">entry</span> <span class="nv">tree</span><span class="p">))</span>
	<span class="p">((</span><span class="nb">&gt; </span><span class="nv">given-key</span> <span class="p">(</span><span class="nf">entry</span> <span class="nv">tree</span><span class="p">))</span> <span class="p">(</span><span class="nf">lookup</span> <span class="nv">given-key</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">tree</span><span class="p">)))</span>
	<span class="p">((</span><span class="nb">&lt; </span><span class="nv">given-key</span> <span class="p">(</span><span class="nf">entry</span> <span class="nv">tree</span><span class="p">))</span> <span class="p">(</span><span class="nf">lookup</span> <span class="nv">given-key</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">tree</span><span class="p">)))))</span>
</pre></div>

<p>
log n
</p>
</div>
</div>

<div id="outline-container-orgb3dd010" class="outline-2">
<h2 id="orgb3dd010">Упражнение 2.67</h2>
<div class="outline-text-2" id="text-orgb3dd010">
<p>
Дано кодирующее дерево и сообщение, используя decode расшифруйте сообщение.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="nv">sample-tree</span>
  <span class="p">(</span><span class="nf">make-code-tree</span> <span class="p">(</span><span class="nf">make-leaf</span> <span class="ss">'A</span> <span class="mi">4</span><span class="p">)</span>
		  <span class="p">(</span><span class="nf">make-code-tree</span>
		   <span class="p">(</span><span class="nf">make-leaf</span> <span class="ss">'B</span> <span class="mi">2</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">make-code-tree</span> <span class="p">(</span><span class="nf">make-leaf</span> <span class="ss">'D</span> <span class="mi">1</span><span class="p">)</span>
				   <span class="p">(</span><span class="nf">make-leaf</span> <span class="ss">'C</span> <span class="mi">1</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">sample-message</span> <span class="o">'</span><span class="p">(</span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">))</span>
<span class="p">(</span><span class="nf">decode</span> <span class="nv">sample-message</span> <span class="nv">sample-tree</span><span class="p">)</span>
<span class="c1">;Value: (a d a b b c a)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org2ad5157" class="outline-2">
<h2 id="org2ad5157">Упражнение 2.68</h2>
<div class="outline-text-2" id="text-org2ad5157">
<p>
Процедура encode принимает на вход сообщение и дерево и генерирует последовательность бит.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">in-list?</span> <span class="nv">symbol</span> <span class="nv">symbols</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">symbols</span><span class="p">)</span>
      <span class="nv">false</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">equal? </span><span class="nv">symbol</span> <span class="p">(</span><span class="nb">car </span><span class="nv">symbols</span><span class="p">))</span>
	  <span class="nv">true</span>
	  <span class="p">(</span><span class="nf">in-list?</span> <span class="nv">symbol</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">symbols</span><span class="p">)))))</span>
<span class="p">(</span><span class="nf">in-list?</span> <span class="ss">'A</span> <span class="o">'</span><span class="p">(</span><span class="nv">b</span> <span class="nv">c</span> <span class="nv">a</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">encode-symbol</span> <span class="nv">symbol</span> <span class="nv">tree</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">l-branch</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">tree</span><span class="p">))</span>
	<span class="p">(</span><span class="nf">r-branch</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">tree</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">in-list?</span> <span class="nv">symbol</span> <span class="p">(</span><span class="nf">symbols</span> <span class="nv">l-branch</span><span class="p">))</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">leaf?</span> <span class="nv">l-branch</span><span class="p">)</span>
						    <span class="p">(</span><span class="nb">cons </span><span class="ss">'0</span> <span class="p">())</span>
						    <span class="p">(</span><span class="nb">cons </span><span class="ss">'0</span> <span class="p">(</span><span class="nf">encode-symbol</span> <span class="nv">symbol</span> <span class="nv">l-branch</span><span class="p">))))</span>
	  <span class="p">((</span><span class="nf">in-list?</span> <span class="nv">symbol</span> <span class="p">(</span><span class="nf">symbols</span> <span class="nv">r-branch</span><span class="p">))</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">leaf?</span> <span class="nv">r-branch</span><span class="p">)</span>
						    <span class="p">(</span><span class="nb">cons </span><span class="ss">'1</span> <span class="p">())</span>
						    <span class="p">(</span><span class="nb">cons </span><span class="ss">'1</span> <span class="p">(</span><span class="nf">encode-symbol</span> <span class="nv">symbol</span> <span class="nv">r-branch</span><span class="p">))))</span>
	  <span class="p">(</span><span class="nf">else</span>
	   <span class="p">(</span><span class="nf">error</span> <span class="s">"not exist symbol -- ENCODE-SYMBOL"</span> <span class="nv">symbol</span><span class="p">)))))</span>
<span class="p">(</span><span class="nf">encode</span> <span class="o">'</span><span class="p">(</span><span class="nv">a</span> <span class="nv">d</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">sample-tree</span><span class="p">)</span> <span class="c1">;Value: (0 1 1 0 0 1 0 1 0 1 1 1 0)</span>
</pre></div>

<p>
Encode-symbol - процедура кодирующая один символ. Дайте определение этой процедуры. Протестируйте на результате упражнения 2.67.
</p>
</div>
</div>

<div id="outline-container-org6da5208" class="outline-2">
<h2 id="org6da5208">Упражнение 2.69</h2>
<div class="outline-text-2" id="text-org6da5208">
<p>
Следующая процедура генерирует дерево по Хафману из пар символ-частота.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">generate-huffman-tree</span> <span class="nv">pairs</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">successive-merge</span> <span class="p">(</span><span class="nf">make-leaf-set</span> <span class="nv">pairs</span><span class="p">)))</span>
</pre></div>

<p>
Make-leaf-set, процедура приведенная выше, сортирует пары. Нужно дать определение процедуры successive-merge, которая делает слияние элементов с наименьшим весом, пока не останется один элемент.
</p>

<div class="highlight"><pre><span></span><span class="c1">;; вставка отсортированная по весу</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">adjoin-set</span> <span class="nv">x</span> <span class="nv">set</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">set</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">x</span><span class="p">))</span>
	<span class="p">((</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">weight</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">weight</span> <span class="p">(</span><span class="nb">car </span><span class="nv">set</span><span class="p">)))</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">set</span><span class="p">))</span>
	<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">set</span><span class="p">)</span>
		    <span class="p">(</span><span class="nf">adjoin-set</span> <span class="nv">x</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">set</span><span class="p">))))))</span>

<span class="c1">;; получаем сортированный список листов.</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-leaf-set</span> <span class="nv">pairs</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">pairs</span><span class="p">)</span>
      <span class="o">'</span><span class="p">()</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">pair</span> <span class="p">(</span><span class="nb">car </span><span class="nv">pairs</span><span class="p">)))</span>
	<span class="p">(</span><span class="nf">adjoin-set</span> <span class="p">(</span><span class="nf">make-leaf</span> <span class="p">(</span><span class="nb">car </span><span class="nv">pair</span><span class="p">)</span>    <span class="c1">; symbol</span>
			       <span class="p">(</span><span class="nb">cadr </span><span class="nv">pair</span><span class="p">))</span>  <span class="c1">; frequency</span>
		    <span class="p">(</span><span class="nf">make-leaf-set</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">pairs</span><span class="p">))))))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">successive-merge</span> <span class="nv">opairs</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">length </span><span class="nv">opairs</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">car </span><span class="nv">opairs</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">merged</span> <span class="p">(</span><span class="nf">make-code-tree</span> <span class="p">(</span><span class="nb">car </span><span class="nv">opairs</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">opairs</span><span class="p">))))</span>
	<span class="p">(</span><span class="nb">display </span><span class="nv">merged</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">successive-merge</span> <span class="p">(</span><span class="nf">adjoin-set</span> <span class="nv">merged</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">opairs</span><span class="p">)))))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">generate-huffman-tree</span> <span class="nv">pairs</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">successive-merge</span> <span class="p">(</span><span class="nf">make-leaf-set</span> <span class="nv">pairs</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">gentree</span> <span class="p">(</span><span class="nf">generate-huffman-tree</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="ss">'A</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'B</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'C</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'D</span> <span class="mi">1</span><span class="p">))))</span>
<span class="nv">gentree</span>
<span class="p">(</span><span class="nf">symbols</span> <span class="nv">gentree</span><span class="p">)</span>

<span class="p">(</span><span class="nf">encode</span> <span class="o">'</span><span class="p">(</span><span class="nv">a</span> <span class="nv">d</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">gentree</span><span class="p">)</span>
</pre></div>
</div>
</div>


<div id="outline-container-org1498b35" class="outline-2">
<h2 id="org1498b35">Упражнение 2.70</h2>
<div class="outline-text-2" id="text-org1498b35">
<p>
Следующий 8ми символьный алфавит с заданными частотами повторения был разработан чтобы эффективно кодировать рок лирику пятидесятых.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left">A</td>
<td class="org-right">2</td>
<td class="org-left">NA</td>
<td class="org-right">16</td>
</tr>
<tr>
<td class="org-left">BOOM</td>
<td class="org-right">1</td>
<td class="org-left">SHA</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">GET</td>
<td class="org-right">2</td>
<td class="org-left">YIP</td>
<td class="org-right">9</td>
</tr>
<tr>
<td class="org-left">JOB</td>
<td class="org-right">2</td>
<td class="org-left">WAH</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<p>
Get a job
</p>

<p>
Sha na na na na na na na na
</p>

<p>
Get a job
</p>

<p>
Sha na na na na na na na na
</p>

<p>
Wah yip yip yip yip yip yip yip yip yip
</p>

<p>
Sha boom
</p>

<p>
Сколько бит потребуется для кодирования?
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="nv">pairs</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="ss">'A</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'BOOM</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'GET</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'JOB</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'NA</span> <span class="mi">16</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'SHA</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'YIP</span> <span class="mi">9</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'WAH</span> <span class="mi">1</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">lyric-tree</span> <span class="p">(</span><span class="nf">generate-huffman-tree</span> <span class="nv">pairs</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">song</span> <span class="o">'</span><span class="p">(</span><span class="nv">Get</span> <span class="nv">a</span> <span class="nv">job</span> <span class="nv">Sha</span> <span class="nv">na</span> <span class="nv">na</span> <span class="nv">na</span> <span class="nv">na</span> <span class="nv">na</span> <span class="nv">na</span> <span class="nv">na</span> <span class="nv">na</span> <span class="nv">Get</span> <span class="nv">a</span> <span class="nv">job</span> <span class="nv">Sha</span> <span class="nv">na</span> <span class="nv">na</span> <span class="nv">na</span> <span class="nv">na</span> <span class="nv">na</span> <span class="nv">na</span> <span class="nv">na</span> <span class="nv">na</span> <span class="nv">Wah</span> <span class="nv">yip</span> <span class="nv">yip</span> <span class="nv">yip</span> <span class="nv">yip</span> <span class="nv">yip</span> <span class="nv">yip</span> <span class="nv">yip</span> <span class="nv">yip</span> <span class="nv">yip</span> <span class="nv">Sha</span> <span class="nv">boom</span><span class="p">))</span>
<span class="nv">song</span>

<span class="p">(</span><span class="nb">length </span><span class="p">(</span><span class="nf">encode</span> <span class="nv">song</span> <span class="nv">lyric-tree</span><span class="p">))</span>
<span class="c1">;; 84</span>

<span class="p">(</span><span class="nb">* </span><span class="mi">3</span> <span class="p">(</span><span class="nb">length </span><span class="nv">song</span><span class="p">))</span>

<span class="c1">;; 108</span>
<span class="c1">;; 22.333%</span>
</pre></div>
</div>
</div>

<div id="outline-container-org587e382" class="outline-2">
<h2 id="org587e382">Упражнение 2.71</h2>
<div class="outline-text-2" id="text-org587e382">
<p>
Предположим у нас есть дерево по Хафману для алфавита из n символов, частота которых 1,2,4,..,2<sup>(n-1)</sup>. Сделайте набросок дерева для n=5 и n=10. Сколько бит требуется в таком дереве что бы закодировать наиболее часто встречающийся символ? Наименее часто встречающийся?
</p>

<div class="highlight"><pre><span></span><span class="c1">;; n = 5</span>
<span class="c1">;; 1,2,4,8,16</span>
<span class="c1">;; (1,2, 3)</span>
<span class="c1">;; (1,2,4 7)</span>
<span class="c1">;; (1,2,4,8 15)</span>
<span class="c1">;; (1,2,4,8,16 31)</span>
<span class="p">(</span><span class="k">define </span><span class="nv">pairs</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="ss">'A</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'B</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'C</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'D</span> <span class="mi">8</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'E</span> <span class="mi">16</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">bin-tree</span> <span class="p">(</span><span class="nf">generate-huffman-tree</span> <span class="nv">pairs</span><span class="p">))</span>
<span class="p">(</span><span class="nf">encode</span> <span class="o">'</span><span class="p">(</span><span class="nv">A</span><span class="p">)</span> <span class="nv">bin-tree</span><span class="p">)</span>
<span class="c1">;; (0 0 0 0)</span>


<span class="c1">;; (1,2,4,8,16,32 63)</span>

<span class="c1">;; n = 10</span>
<span class="c1">;; 1,2,4,8,16</span>
<span class="c1">;; (1,2, 3)</span>
<span class="c1">;; (1,2,4 7)</span>
<span class="c1">;; (1,2,4,8 15)</span>
<span class="c1">;; (1,2,4,8,16 31)</span>
<span class="c1">;; (1,2,4,8,16,32 63)</span>
<span class="c1">;; (1,2,4,8,16,32,64 127)</span>
<span class="c1">;; (1,2,4,8,16,32,64,128 255)</span>
<span class="c1">;; (1,2,4,8,16,32,64,128,256 511)</span>
<span class="c1">;; (1,2,4,8,16,32,64,128,256,512 1023)</span>

<span class="c1">;; чтобы закодировать самый частый символ 1 бит</span>
<span class="c1">;; чтобы закодировать самый редкий символ для n=5, </span>

<span class="c1">;; 1,2,4,8,16,32,64,128,256,512</span>
<span class="p">(</span><span class="k">define </span><span class="nv">pairs</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="ss">'A</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'B</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'C</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'D</span> <span class="mi">8</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'E</span> <span class="mi">16</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'F</span> <span class="mi">32</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'G</span> <span class="mi">64</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'H</span> <span class="mi">128</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'I</span> <span class="mi">256</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">'J</span> <span class="mi">512</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">bin-tree</span> <span class="p">(</span><span class="nf">generate-huffman-tree</span> <span class="nv">pairs</span><span class="p">))</span>
<span class="nv">bin-tree</span>
<span class="p">(</span><span class="nf">encode</span> <span class="o">'</span><span class="p">(</span><span class="nv">A</span><span class="p">)</span> <span class="nv">bin-tree</span><span class="p">)</span>
<span class="c1">;; (0 0 0 0 0 0 0 0 0)</span>


		     <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span> <span class="nv">e</span><span class="p">)</span> <span class="mi">31</span>
		     <span class="nv">/</span>           <span class="err">\</span>
		<span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="p">)</span> <span class="mi">15</span>      <span class="nv">e</span> <span class="mi">16</span>
		 <span class="nv">/</span>     <span class="err">\</span>
	   <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="mi">7</span>    <span class="nv">d</span> <span class="mi">8</span>
	     <span class="nv">/</span>    <span class="err">\</span>
	<span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span> <span class="mi">3</span>    <span class="nv">c</span> <span class="mi">4</span>
	 <span class="nv">/</span>   <span class="err">\</span>
      <span class="nv">a</span> <span class="mi">1</span>    <span class="nv">b</span> <span class="mi">2</span>
<span class="c1">;; получается n-1 бит</span>
</pre></div>
</div>
</div>


<div id="outline-container-org364e2d4" class="outline-2">
<h2 id="org364e2d4">Упражнение 2.72</h2>
<div class="outline-text-2" id="text-org364e2d4">
<p>
Каков порядок роста для процедуры кодирования символа? Убедитесь что учли поиск вхождения символа. Ответить на этот вопрос в общем сложно. Поэтому рассмотрите частный случай когда частота символов при кодировании будет как в упражнении 2.71. И приведите порядок роста для кодирования наиболее часто встречающегося символа и наименее часто встречающегося символа.
</p>

<p>
для самого частого символа, нам нужно всего один раз проверить что символ встретился в алфавите, то есть порядок роста будет равен порядку роста поиска элемента в отсортированном списке, у нас это n (так как бинарное дерево не используется).
</p>

<p>
для самого редко встречающегося символа нам потребуется n -1 раз делать поиск по (n-1)/2 элементам то есть итоговый порядок роста будет n<sup>2</sup></p>

<p>
То есть общий ответ будет между n и n<sup>2</sup>.
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-224-primer-iazyk-izobrazhenii/" class="u-url">SICP 2.2.4 Пример: Язык изображений.</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-224-primer-iazyk-izobrazhenii/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-21T21:12:26+03:00" itemprop="datePublished" title="2020-01-21 21:12">2020-01-21 21:12</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org7c6fd9b" class="outline-2">
<h2 id="org7c6fd9b">Упражнение 2.44.</h2>
<div class="outline-text-2" id="text-org7c6fd9b">
<p>
Определите процедуру up-split используемую в corner-split.
</p>

<p>
<img src="images/up-split-einstein.png" alt="nil"></p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">up-split</span> <span class="nv">painter</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">painter</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">smaller</span> <span class="p">(</span><span class="nf">up-split</span> <span class="nv">painter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))))</span>
	<span class="p">(</span><span class="nf">below</span> <span class="nv">painter</span> <span class="p">(</span><span class="nf">beside</span> <span class="nv">smaller</span> <span class="nv">smaller</span><span class="p">)))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgc1f752f" class="outline-2">
<h2 id="orgc1f752f">Упражнение 2.45.</h2>
<div class="outline-text-2" id="text-orgc1f752f">
<p>
Определите процедуру обобщение up-split right-split.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">split</span> <span class="nv">fs</span> <span class="nv">ss</span><span class="p">)</span>
  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">painter,</span> <span class="nv">n</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nv">painter</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">smaller</span> <span class="p">((</span><span class="nf">split</span> <span class="nv">fs</span> <span class="nv">ss</span><span class="p">)</span> <span class="nv">painter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))))</span>
	  <span class="p">(</span><span class="nf">fs</span> <span class="nv">painter</span> <span class="p">(</span><span class="nf">ss</span> <span class="nv">smaller</span> <span class="nv">smaller</span><span class="p">))))))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">right-split</span> <span class="p">(</span><span class="nf">split</span> <span class="nv">beside</span> <span class="nv">below</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">up-split</span> <span class="p">(</span><span class="nf">split</span> <span class="nv">below</span> <span class="nv">beside</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org7d94fea" class="outline-2">
<h2 id="org7d94fea">Упражнение 2.46</h2>
<div class="outline-text-2" id="text-org7d94fea">
<p>
Двумерный вектор v проведенный из точки отсчета в некоторую точку может быть представлен как пара координат x и y. Реализуйте абстракцию для векторов задав конструктор make-vect и соответствующие селекторы xcor-vect, ycor-vect. Реализуйте процедуры add-vect, sub-vect и scale-vect, которые выполняют операции над вектором.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-vect</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="nv">v</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cdr </span><span class="nv">v</span><span class="p">))</span>
<span class="p">(</span><span class="nf">ycor-vect</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-vect</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-vect</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v2</span><span class="p">))</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v2</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub-vect</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-vect</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v2</span><span class="p">))</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v2</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">scale-vect</span> <span class="nv">v</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-vect</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v</span><span class="p">)</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v</span><span class="p">)</span> <span class="nv">n</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org91bb85a" class="outline-2">
<h2 id="org91bb85a">Упражнение 2.47</h2>
<div class="outline-text-2" id="text-org91bb85a">
<p>
Здесь две возможных конструктора для фреймов:
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-frame</span> <span class="nv">origin</span> <span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list </span><span class="nv">origin</span> <span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-frame</span> <span class="nv">origin</span> <span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="nv">origin</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">)))</span>
</pre></div>

<p>
Для каждого конструктора укажите соответствующие селекторы что бы реализовать процедуры для фреймов.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">origin-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="nv">frame</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge1-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cadr </span><span class="nv">frame</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge1-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cadr </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">frame</span><span class="p">)))</span>

<span class="c1">;; 2</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">origin-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="nv">frame</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge1-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">frame</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge1-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">frame</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org6773718" class="outline-2">
<h2 id="org6773718">Упражнение 2.48</h2>
<div class="outline-text-2" id="text-org6773718">
<p>
Сегмент направленной линии на плоскости может быть представлен в виде пары векторов: вектор идущий от начала координат до начальной точки сегмента и вектор идущий от начала координат до конечной точки сегмента. Используя векторное представление из 2.46 что бы определить представление для сегментов с конструктором make-segment и селекторами start-segment, end-segment.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-segment</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">start-segment</span> <span class="nv">seg</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="nv">seg</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">end-segment</span> <span class="nv">seg</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cdr </span><span class="nv">seg</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgd1f80c5" class="outline-2">
<h2 id="orgd1f80c5">Упражнение 2.49</h2>
<div class="outline-text-2" id="text-orgd1f80c5">
<p>
Используя segments-&gt;painter определите следующие процедуры
a. Нарисовать контур обозначенной рамки.
b. Нарисовать Х соединяющий противоположные углы рамки.
c. Нарисовать ромбовидную форму соединяющую центры рамки.
d. Нарисовать волну.
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">for-each </span><span class="nv">proc</span> <span class="nv">items</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">proc</span> <span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">for-each </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)))</span>
  <span class="nv">true</span><span class="p">)</span>
<span class="c1">;; frame</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-frame</span> <span class="nv">origin</span> <span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list </span><span class="nv">origin</span> <span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">origin-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="nv">frame</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge1-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">card</span> <span class="nv">frame</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge2-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">card</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">frame</span><span class="p">)))</span>

<span class="c1">;; segment</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-segment</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">start-segment</span> <span class="nv">seg</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="nv">seg</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">end-segment</span> <span class="nv">seg</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cdr </span><span class="nv">seg</span><span class="p">))</span>

<span class="c1">;; vector</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-vect</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="nv">v</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cdr </span><span class="nv">v</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-vect</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-vect</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v2</span><span class="p">))</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v2</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub-vect</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-vect</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v2</span><span class="p">))</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v2</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">scale-vect</span> <span class="nv">v</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-vect</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v</span><span class="p">)</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v</span><span class="p">)</span> <span class="nv">n</span><span class="p">)))</span>

<span class="c1">;; a</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">segments-&gt;painter</span> <span class="nv">segment-list</span><span class="p">)</span>
  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">frame</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">for-each</span>
     <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">segment</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">draw-line</span>
	<span class="p">((</span><span class="nf">frame-coord-map</span> <span class="nv">frame</span><span class="p">)</span> <span class="p">(</span><span class="nf">start-segment</span> <span class="nv">segment</span><span class="p">))</span>
	<span class="p">((</span><span class="nf">frame-coord-map</span> <span class="nv">frame</span><span class="p">)</span> <span class="p">(</span><span class="nf">end-segment</span> <span class="nv">segment</span><span class="p">))))</span>
     <span class="nv">segment-list</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">frame1</span> <span class="p">(</span><span class="nf">make-frame</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">segment-list-a</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">))</span>
			    <span class="p">))</span>

<span class="p">((</span><span class="nf">segments-&gt;painter</span> <span class="nv">segment-list-a</span><span class="p">)</span> <span class="nv">frame1</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">segment-list-b</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">))</span>
			    <span class="p">))</span>

<span class="p">((</span><span class="nf">segments-&gt;painter</span> <span class="nv">segment-list-b</span><span class="p">)</span> <span class="nv">frame1</span><span class="p">)</span>


<span class="p">(</span><span class="k">define </span><span class="nv">segment-list-c</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.5</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mf">0.5</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mf">0.5</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.5</span> <span class="mi">1</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.5</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mf">0.5</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mf">0.5</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.5</span> <span class="mi">0</span><span class="p">))</span>
			    <span class="p">))</span>

<span class="p">((</span><span class="nf">segments-&gt;painter</span> <span class="nv">segment-list-c</span><span class="p">)</span> <span class="nv">frame1</span><span class="p">)</span>


<span class="p">(</span><span class="k">define </span><span class="nv">segment-list-d</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">25</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">35</span> <span class="o">.</span><span class="mi">5</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">35</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">3</span> <span class="o">.</span><span class="mi">6</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">3</span> <span class="o">.</span><span class="mi">6</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">15</span> <span class="o">.</span><span class="mi">4</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">15</span> <span class="o">.</span><span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="o">.</span><span class="mi">65</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="o">.</span><span class="mi">65</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="o">.</span><span class="mi">85</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="o">.</span><span class="mi">85</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">15</span> <span class="o">.</span><span class="mi">6</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">15</span> <span class="o">.</span><span class="mi">6</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">3</span> <span class="o">.</span><span class="mi">65</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">3</span> <span class="o">.</span><span class="mi">65</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">4</span> <span class="o">.</span><span class="mi">65</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">4</span> <span class="o">.</span><span class="mi">65</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">35</span> <span class="o">.</span><span class="mi">85</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">35</span> <span class="o">.</span><span class="mi">85</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">4</span> <span class="mi">1</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">4</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="mi">1</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">65</span> <span class="o">.</span><span class="mi">85</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">65</span> <span class="o">.</span><span class="mi">85</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="o">.</span><span class="mi">65</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="o">.</span><span class="mi">65</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">75</span> <span class="o">.</span><span class="mi">65</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">75</span> <span class="o">.</span><span class="mi">65</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="o">.</span><span class="mi">35</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="o">.</span><span class="mi">35</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="o">.</span><span class="mi">15</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="o">.</span><span class="mi">15</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="o">.</span><span class="mi">45</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="o">.</span><span class="mi">45</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">75</span> <span class="mi">0</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">75</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="mi">0</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">5</span> <span class="o">.</span><span class="mi">3</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">5</span> <span class="o">.</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">4</span> <span class="mi">0</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">4</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">25</span> <span class="mi">0</span><span class="p">))</span>
			     <span class="p">))</span>

<span class="p">((</span><span class="nf">segments-&gt;painter</span> <span class="nv">segment-list-d</span><span class="p">)</span> <span class="nv">frame1</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge422d16" class="outline-2">
<h2 id="orge422d16">Упражнение 2.50</h2>
<div class="outline-text-2" id="text-orge422d16">
<p>
Определите процедуру flip-horiz и трансформации которые вращают изображения против часовой стрелки на 180 и 270 градусов.
</p>


<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">flip-horiz</span> <span class="nv">painter</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">transform-painter</span> <span class="nv">painter</span>
		     <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="o">.</span><span class="mi">0</span><span class="p">)</span>
		     <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">0</span> <span class="o">.</span><span class="mi">0</span><span class="p">)</span>
		     <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">1.0</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">repeated</span> <span class="nv">f</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span><span class="p">))</span>
      <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="p">((</span><span class="nf">repeated</span> <span class="nv">f</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))</span> <span class="nv">x</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rotate90</span> <span class="nv">painter</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">transform-painter</span> <span class="nv">painter</span>
		     <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">0.0</span><span class="p">)</span>
		     <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">1.0</span><span class="p">)</span>
		     <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">0.0</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rotate270</span> <span class="nv">painter</span><span class="p">)</span>
  <span class="p">((</span><span class="nf">repeated</span> <span class="nv">rotate90</span> <span class="mi">3</span><span class="p">)</span> <span class="nv">painter</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rotate180</span> <span class="nv">painter</span><span class="p">)</span>
  <span class="p">((</span><span class="nf">repeated</span> <span class="nv">rotate90</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">painter</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org6a92d68" class="outline-2">
<h2 id="org6a92d68">Упражнение 2.51</h2>
<div class="outline-text-2" id="text-org6a92d68">
<p>
Определите процедуру below. Как аналог beside и второй раз через beside и подходящие трасформации.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">below</span> <span class="nv">painter1</span> <span class="nv">painter2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">split-point</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">0.5</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">paint-bottom</span>
	   <span class="p">(</span><span class="nf">transform-painter</span> <span class="nv">painter1</span>
			      <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">0.0</span><span class="p">)</span>
			      <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">0.0</span><span class="p">)</span>
			      <span class="nv">split-point</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">paint-top</span>
	   <span class="p">(</span><span class="nf">transform-painter</span> <span class="nv">painter2</span>
			      <span class="nv">split-point</span>
			      <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">0.5</span><span class="p">)</span>
			      <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">1.0</span><span class="p">))))</span>
      <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">frame</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">paint-bottom</span> <span class="nv">frame</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">paint-top</span> <span class="nv">frame</span><span class="p">)))))</span>


<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">below-2</span> <span class="nv">painter1</span> <span class="nv">painter2</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">rotate270</span> <span class="p">(</span><span class="nf">beside</span> <span class="nv">painter1</span> <span class="nv">painter2</span><span class="p">)))</span>
</pre></div>
</div>
</div>


<div id="outline-container-org67a1205" class="outline-2">
<h2 id="org67a1205">Упражнение 2.52</h2>
<div class="outline-text-2" id="text-org67a1205">
<p>
Внесите изменение в square-limit на разных уровнях абстракции
а. Добавьте какие-нибудь сегменты к примитиву wave.
</p>

<div class="highlight"><pre><span></span><span class="c1">;; тут просто добавляем в список элементов пару сегментов</span>
<span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">5</span> <span class="o">.</span><span class="mi">75</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">5</span> <span class="o">.</span><span class="mi">77</span><span class="p">))</span>
<span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">45</span> <span class="o">.</span><span class="mi">75</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">55</span> <span class="o">.</span><span class="mi">75</span><span class="p">))</span>
</pre></div>

<p>
б. измените corner-split (к примеру используя только одну копию up-split и right-split вместо двух).
</p>

<div class="highlight"><pre><span></span><span class="c1">;; тут просто редактируем функцию corner-split</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">corner-split</span> <span class="nv">painter</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">painter</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">up</span> <span class="p">(</span><span class="nf">up-split</span> <span class="nv">painter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)))</span>
	    <span class="p">(</span><span class="nf">right</span> <span class="p">(</span><span class="nf">right-split</span> <span class="nv">painter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))))</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">top-left</span> <span class="p">(</span><span class="nf">beside</span> <span class="nv">up</span> <span class="nv">up</span><span class="p">))</span>
	      <span class="p">(</span><span class="nf">bottom-right</span> <span class="p">(</span><span class="nf">below</span> <span class="nv">right</span> <span class="nv">right</span><span class="p">))</span>
	      <span class="p">(</span><span class="nf">corner</span> <span class="p">(</span><span class="nf">corner-split</span> <span class="nv">painter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))))</span>
	  <span class="p">(</span><span class="nf">beside</span> <span class="p">(</span><span class="nf">below</span> <span class="nv">painter</span> <span class="nv">top-left</span><span class="p">)</span>
		  <span class="p">(</span><span class="nf">below</span> <span class="nv">painter</span> <span class="nv">corner</span><span class="p">))))))</span>
</pre></div>
<p>
в. измените square-limit, что бы собрать углы по другому шаблону
</p>

<div class="highlight"><pre><span></span><span class="c1">;; тут просто редактируем функцию square-limit</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-limit</span> <span class="nv">painter</span> <span class="nv">n</span><span class="p">)</span>
   <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">combine4</span> <span class="p">(</span><span class="nf">square-of-four</span> <span class="nv">flip-vert</span> <span class="nv">rotate180</span>
				   <span class="nv">identity</span> <span class="nv">flip-horiz</span><span class="p">)))</span>
     <span class="p">(</span><span class="nf">combine4</span> <span class="p">(</span><span class="nf">corner-split</span> <span class="nv">painter</span> <span class="nv">n</span><span class="p">))))</span>
</pre></div>

<p>
пример программы показывает что мы делаем редактирование только на одном из уровней абстракций.
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-223-posledovatelnosti-kak-obobshchaiushchie-interfeisy/" class="u-url">SICP 2.2.3 Последовательности как обобщающие интерфейсы.</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-223-posledovatelnosti-kak-obobshchaiushchie-interfeisy/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-20T14:08:28+03:00" itemprop="datePublished" title="2020-01-20 14:08">2020-01-20 14:08</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
<img src="images/ch2-Z-G-17.gif" alt="nil"></p>


<div id="outline-container-orgf90b00d" class="outline-2">
<h2 id="orgf90b00d">Упражнение 2.33</h2>
<div class="outline-text-2" id="text-orgf90b00d">
<p>
Заполните недостающие выражения, чтобы завершить определения некоторых основных операций над списками через накопление.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">map </span><span class="nv">p</span> <span class="nv">sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">&lt;??&gt;</span><span class="p">)</span> <span class="nv">nil</span> <span class="nv">sequence</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">append </span><span class="nv">seq1</span> <span class="nv">seq2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">cons</span> <span class="nv">&lt;??&gt;</span> <span class="nv">&lt;??&gt;</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">length </span><span class="nv">sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">&lt;??&gt;</span> <span class="mi">0</span> <span class="nv">sequence</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">map </span><span class="nv">p</span> <span class="nv">sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">p</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">y</span><span class="p">))</span> <span class="nv">nil</span> <span class="nv">sequence</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">append </span><span class="nv">seq1</span> <span class="nv">seq2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">cons</span> <span class="nv">seq2</span> <span class="nv">seq1</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">length </span><span class="nv">sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="nv">y</span><span class="p">))</span> <span class="mi">0</span> <span class="nv">sequence</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org697f221" class="outline-2">
<h2 id="org697f221">Упражнение 2.34</h2>
<div class="outline-text-2" id="text-org697f221">
<p>
Оценка полинома от одной переменной x в заданной точке, может быть сформулирована в терминах накопления. Мы оцениваем полином
\(a_nx^n+a_{n-1}x^{n-1}+...+a_1x+a_0x\) используя широко известный алгоритм - правило Хорнера, который структурирует вычисление как \((...(a_nx+a_{n-1})x+...+a_1)x + a_0\).
</p>

<p>
Другими словами начиная с a<sub>n</sub> умноженного на x, добавляем a<sub>n-1</sub>, умножаем на x и так далее, пока не достигаем a<sub>0</sub>. Заполните шаблон что бы закончить процедуру вычисления полинома, предполагая что коэффициенты полинома заданы списком.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">horner-eval</span> <span class="nv">x</span> <span class="nv">coefficient-sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">this-coeff</span> <span class="nv">higher-terms</span><span class="p">)</span> <span class="nv">&lt;??&gt;</span><span class="p">)</span>
	      <span class="mi">0</span>
	      <span class="nv">coefficient-sequence</span><span class="p">))</span>
<span class="p">(</span><span class="nf">horner-eval</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">5</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">horner-eval</span> <span class="nv">x</span> <span class="nv">coefficient-sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">this-coeff</span> <span class="nv">higher-terms</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">this-coeff</span> <span class="p">(</span><span class="nb">* </span><span class="nv">x</span> <span class="nv">higher-terms</span><span class="p">)))</span>
	      <span class="mi">0</span>
	      <span class="nv">coefficient-sequence</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org19f5aff" class="outline-2">
<h2 id="org19f5aff">Упражнение 2.35</h2>
<div class="outline-text-2" id="text-org19f5aff">
<p>
Переопределите count-leaves из секции 2.2.2 через накопление.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">count-leaves</span> <span class="nv">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">&lt;??&gt;</span> <span class="nv">&lt;??&gt;</span> <span class="p">(</span><span class="nb">map </span><span class="nv">&lt;??&gt;</span> <span class="nv">&lt;??&gt;</span><span class="p">)))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">count-leaves</span> <span class="nv">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">+</span> <span class="mi">0</span>
	      <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">sub-tree</span><span class="p">)</span>
		     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">sub-tree</span><span class="p">)</span>
			 <span class="p">(</span><span class="nf">count-leaves</span> <span class="nv">sub-tree</span><span class="p">)</span>
			 <span class="mi">1</span><span class="p">))</span> <span class="nv">t</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgdf87e87" class="outline-2">
<h2 id="orgdf87e87">Упражнение 2.36</h2>
<div class="outline-text-2" id="text-orgdf87e87">
<p>
Процедура accumulate-n похожа на accumulate, но принимает третий аргумент последовательность последовательностей. Предполагается что все они имеют одинаковое количество аргументов. Она применяет назначенную процедуру накопления для всех первых элементов последовательности, всех вторых и так далее. И возвращает последовательность результатов. К примеру результат (accumulate-n + 0 s), где s это ((1 2 3) (4 5 6) (7 8 9) (10 11 12)), будет равен (22 26 30). Заполните пропуски в определении процедуры.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">accumulate-n</span> <span class="nv">op</span> <span class="nv">init</span> <span class="nv">seqs</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="p">(</span><span class="nb">car </span><span class="nv">seqs</span><span class="p">))</span>
      <span class="nv">nil</span>
      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">accumulate</span> <span class="nv">op</span> <span class="nv">init</span> <span class="nv">&lt;??&gt;</span><span class="p">)</span>
	    <span class="p">(</span><span class="nf">accumulate-n</span> <span class="nv">op</span> <span class="nv">init</span> <span class="nv">&lt;??&gt;</span><span class="p">))))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">accumulate-n</span> <span class="nv">op</span> <span class="nv">init</span> <span class="nv">seqs</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="p">(</span><span class="nb">car </span><span class="nv">seqs</span><span class="p">))</span>
      <span class="nv">nil</span>
      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">accumulate</span> <span class="nv">op</span> <span class="nv">init</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">seq</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">seq</span><span class="p">))</span> <span class="nv">seqs</span><span class="p">))</span>
	    <span class="p">(</span><span class="nf">accumulate-n</span> <span class="nv">op</span> <span class="nv">init</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">seq</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">seq</span><span class="p">))</span> <span class="nv">seqs</span><span class="p">)))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org49f6012" class="outline-2">
<h2 id="org49f6012">Упражнение 2.37</h2>
<div class="outline-text-2" id="text-org49f6012">
<p>
Предположим мы представляем векторы v = (v<sub>i</sub>) как последовательность чисел и матрицы m =(m<sub>ij</sub>) как последовательность векторов (строки матрицы). К примеру матрица:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="org-left"></colgroup>
<tbody>
<tr>
<td class="org-left">1 2 3 4</td>
</tr>
<tr>
<td class="org-left">4 5 6 7</td>
</tr>
<tr>
<td class="org-left">6 7 8 9</td>
</tr>
</tbody>
</table>
<p>
представлена как последовательность ((1 2 3 4) (4 5 6 6) (6 7 8 9)).
C этим представлением мы можем использовать последовательности операций чтобы выразить основные операции на матрицей и вектором. Эти операции (которые описаны в любой книжке по алгебре) следующие:
</p>

<p>
(dot-product v w)
(matrix-<b>-vector m v)
(matrix-</b>-matrix m n)
(transpose m) ;; вернет матрицу n, где n<sub>ij</sub> = m<sub>ji</sub></p>


<p>
Мы можем определить dot-product как (map - стандартный из scheme):
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">dot-product</span> <span class="nv">v</span> <span class="nv">w</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">+</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">map </span><span class="nv">*</span> <span class="nv">v</span> <span class="nv">w</span><span class="p">)))</span>
</pre></div>

<p>
Заполните недостающие места в следующих процедурах для остальных операций над матрицами. (Процедура accumulate-n определена в упражнении 2.36)
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">matrix-*-vector</span> <span class="nv">m</span> <span class="nv">v</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">w</span><span class="p">)</span> <span class="p">(</span><span class="nf">dot-product</span> <span class="nv">w</span> <span class="nv">v</span><span class="p">))</span> <span class="nv">m</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">transpose</span> <span class="nv">mat</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate-n</span> <span class="nv">cons</span> <span class="p">()</span> <span class="nv">mat</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">matrix-*-matrix</span> <span class="nv">m</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">cols</span> <span class="p">(</span><span class="nf">transpose</span> <span class="nv">n</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">row</span><span class="p">)</span> <span class="p">(</span><span class="nf">matrix-*-vector</span> <span class="nv">cols</span> <span class="nv">row</span><span class="p">))</span> <span class="nv">m</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org3c65486" class="outline-2">
<h2 id="org3c65486">Упражнение 2.38</h2>
<div class="outline-text-2" id="text-org3c65486">
<p>
Процедура accumulate так же известна как fold-right, потому что она объединяет первый элемент последовательности с результатами объединения всех элементов справа. Также есть fold-left, которая объединяет элементы в обратном направлении.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fold-left</span> <span class="nv">op</span> <span class="nv">initial</span> <span class="nv">sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">result</span> <span class="nv">rest</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">rest</span><span class="p">)</span>
	<span class="nv">result</span>
	<span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">result</span> <span class="p">(</span><span class="nb">car </span><span class="nv">rest</span><span class="p">))</span>
	      <span class="p">(</span><span class="nb">cdr </span><span class="nv">rest</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">iter</span> <span class="nv">initial</span> <span class="nv">sequence</span><span class="p">))</span>

<span class="c1">;; Каковы значения выражений?</span>
<span class="p">(</span><span class="nf">fold-right</span> <span class="nv">/</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span> <span class="c1">;; 3/2</span>
<span class="p">(</span><span class="nf">fold-left</span> <span class="nv">/</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span> <span class="c1">;;  1/6</span>
<span class="p">(</span><span class="nf">fold-right</span> <span class="nv">list</span> <span class="nv">nil</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span><span class="c1">;; (list 1 (list 2 ( list 3 ())))</span>
<span class="p">(</span><span class="nf">fold-left</span> <span class="nv">list</span> <span class="nv">nil</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span> <span class="c1">;; (list (list (list () 1) 2) 3)</span>
</pre></div>

<p>
Каким свойством должен обладать op что бы fold-right, fold-left были одинаковыми? Коммутативность и ассоциативность.
</p>
</div>
</div>

<div id="outline-container-orga36c62e" class="outline-2">
<h2 id="orga36c62e">Упражнение 2.39</h2>
<div class="outline-text-2" id="text-orga36c62e">
<p>
Дайте определение reverse через fold-right и fold-left.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">reverse </span><span class="nv">sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">fold-right</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">first</span> <span class="nv">part-reversed</span><span class="p">)</span> <span class="p">(</span><span class="nb">append </span><span class="nv">part-reversed</span> <span class="p">(</span><span class="nb">list </span><span class="nv">first</span><span class="p">)))</span> <span class="nv">nil</span> <span class="nv">sequence</span><span class="p">))</span>
<span class="p">(</span><span class="nb">reverse </span><span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">reverse </span><span class="nv">sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">fold-left</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">result</span> <span class="nv">last</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">last</span> <span class="nv">result</span><span class="p">))</span> <span class="nv">nil</span> <span class="nv">sequence</span><span class="p">))</span>
</pre></div>
</div>
</div>


<div id="outline-container-org3060f9c" class="outline-2">
<h2 id="org3060f9c">Упражнение 2.40</h2>
<div class="outline-text-2" id="text-org3060f9c">
<p>
Определите процедуру unique-pairs, которая принимая целое n, генерирует последовательность пар (i,j) 1&lt;=j&lt;i&lt;=n. Используя процедуру unique-pairs упростите определение prime-sum-pairs, приведенное в книге.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">unique-pairs</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">flatmap</span>
   <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">j</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">i</span> <span class="nv">j</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">- </span><span class="nv">i</span> <span class="mi">1</span><span class="p">))))</span>
   <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="nv">n</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">prime-sum-pairs</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">map </span><span class="nv">make-pair-sum</span>
       <span class="p">(</span><span class="nf">filter</span> <span class="nv">prime-sum?</span>
	       <span class="p">(</span><span class="nf">unique-pairs</span> <span class="nv">n</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">prime-sum-pairs</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgf767b71" class="outline-2">
<h2 id="orgf767b71">Упражнение 2.41</h2>
<div class="outline-text-2" id="text-orgf767b71">
<p>
Напишите процедуру, чтобы найти все упорядоченные тройки различных положительных целых чисел i, j, k, меньших или равных заданному числу n, сумма которых равна заданному числу S.
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">not-end-with-1?</span> <span class="nv">pair</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">cadr </span><span class="nv">pair</span><span class="p">)</span> <span class="mi">1</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">uniq-3</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">flatmap</span>
   <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">pair</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">k</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">car </span><span class="nv">pair</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">pair</span><span class="p">)</span> <span class="nv">k</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">cadr </span><span class="nv">pair</span><span class="p">)</span> <span class="mi">1</span><span class="p">))))</span>
   <span class="p">(</span><span class="nf">filter</span> <span class="nv">not-end-with-1?</span> <span class="p">(</span><span class="nf">unique-pairs</span> <span class="nv">n</span><span class="p">))))</span>


<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">uniq-tuples-m</span> <span class="nv">n</span> <span class="nv">m</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">&lt; </span><span class="nv">n</span> <span class="nv">m</span><span class="p">)</span> <span class="nv">nil</span><span class="p">)</span>
	<span class="p">((</span><span class="nb">= </span><span class="nv">m</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">map </span><span class="nv">list</span> <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="nv">n</span><span class="p">)))</span>
	<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">flatmap</span>
	       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">tuple</span><span class="p">)</span>
		 <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">k</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">k</span> <span class="nv">tuple</span><span class="p">))</span>
		      <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">car </span><span class="nv">tuple</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">n</span><span class="p">)))</span>
	       <span class="p">(</span><span class="nf">uniq-tuples-m</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">- </span><span class="nv">m</span> <span class="mi">1</span><span class="p">))))))</span>

<span class="p">(</span><span class="nf">uniq-tuples-m</span> <span class="mi">5</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org392b36a" class="outline-2">
<h2 id="org392b36a">Упражнение 2.42</h2>
<div class="outline-text-2" id="text-org392b36a">
<p>
Задача о восьми ферзях. Как разместить 8 ферзей на шахматной доске, что бы не один ферзь не бил другого. Одно из возможных решений представлено на картинке.
</p>

<p>
<img src="images/ch2-Z-G-23.gif" alt="nil"></p>

<p>
Один способ решения ставим первого ферзя на любую клетку доски. Остальные k-1 ферзей мы должны расставить так что бы они не атаковали друг друга. Можно сформулировать этот подход рекурсивно. Предположим мы уже генерировали всех возможные способы расстановки k-1 ферзей в первых k-1 столбцах доски. Для каждого из этих способов генерируем дополнительный набор позиций размещая ферзя в каждой строчке k-ой колонки. Теперь отфильтруем их оставляя только позиции в которых ферзь не атакован другими. Это даст все возможные расположения k ферзей в первых k колонках. Продолжая этот процесс мы получим решения головоломки.
</p>

<p>
Мы записали эту процедуру под именем queens. Она возвращает список всех решений для досок n x n. Она содержит внутреннюю процедуру queen-cols, которая возвращает список всех способов разместить ферзей на первых k колонках доски.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">queens</span> <span class="nv">board-size</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">queen-cols</span> <span class="nv">k</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">k</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list </span><span class="nv">empty-board</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">filter</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">positions</span><span class="p">)</span> <span class="p">(</span><span class="nf">safe?</span> <span class="nv">k</span> <span class="nv">positions</span><span class="p">))</span>
	 <span class="p">(</span><span class="nf">flatmap</span>
	  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">rest-of-queens</span><span class="p">)</span>
	    <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">new-row</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">adjoin-position</span> <span class="nv">new-row</span> <span class="nv">k</span> <span class="nv">rest-of-queens</span><span class="p">))</span>
		 <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="nv">board-size</span><span class="p">)))</span>
	  <span class="p">(</span><span class="nf">queen-cols</span> <span class="p">(</span><span class="nb">- </span><span class="nv">k</span> <span class="mi">1</span><span class="p">))))))</span>
  <span class="p">(</span><span class="nf">queen-cols</span> <span class="nv">board-size</span><span class="p">))</span>
</pre></div>

<p>
rest-of-queens - способ разместить k -1 ферзей в первых k - 1 колонках и new-row - строчка в которой надо поместить ферзя в k-ой колонке.
Завершите программу реализовав представление позиций, включая adjoin-position, которая добавляет новую позицию к существующим позициям, и empty-set - пустой список позиций. Также нужно написать процедуру safe?.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="nv">empty-board</span> <span class="p">())</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">adjoin-position</span> <span class="nv">new-row</span> <span class="nv">k</span> <span class="nv">rest-of-queens</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="nv">new-row</span> <span class="nv">rest-of-queens</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">include-row?</span> <span class="nv">item</span> <span class="nv">positions</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">positions</span><span class="p">)</span>
      <span class="nv">false</span>
      <span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nb">= </span><span class="nv">item</span> <span class="p">(</span><span class="nb">car </span><span class="nv">positions</span><span class="p">))</span> <span class="p">(</span><span class="nf">include?</span> <span class="nv">item</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">positions</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">include-diagonale?</span> <span class="nv">item</span> <span class="nv">positions</span> <span class="nv">k</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">positive</span> <span class="nv">item</span> <span class="nv">positions</span> <span class="nv">k</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">positions</span><span class="p">)</span>
	<span class="nv">false</span>
	<span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">+ </span><span class="nv">item</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">positions</span><span class="p">))</span> <span class="p">(</span><span class="nf">positive</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">item</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">positions</span><span class="p">)</span> <span class="nv">k</span><span class="p">))</span>
	<span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">negative</span> <span class="nv">item</span> <span class="nv">positions</span> <span class="nv">k</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nb">null? </span><span class="nv">positions</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">- </span><span class="nv">item</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">1</span><span class="p">))</span>
	<span class="nv">false</span>
	<span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">- </span><span class="nv">item</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">positions</span><span class="p">))</span> <span class="p">(</span><span class="nf">negative</span> <span class="p">(</span><span class="nb">- </span><span class="nv">item</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">positions</span><span class="p">)</span> <span class="nv">k</span><span class="p">))</span>
	<span class="p">))</span>
  <span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">negative</span> <span class="nv">item</span> <span class="nv">positions</span> <span class="nv">k</span><span class="p">)</span> <span class="p">(</span><span class="nf">positive</span> <span class="nv">item</span> <span class="nv">positions</span> <span class="nv">k</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">safe?</span> <span class="nv">k</span> <span class="nv">positions</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">and</span>
   <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nf">include-row?</span> <span class="p">(</span><span class="nb">car </span><span class="nv">positions</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">positions</span><span class="p">)))</span> <span class="c1">;; нет совпадений по строкам</span>
   <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nf">include-diagonale?</span> <span class="p">(</span><span class="nb">car </span><span class="nv">positions</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">positions</span><span class="p">)</span> <span class="nv">k</span><span class="p">))))</span> <span class="c1">;; не совпадает по диагоналям</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">queens</span> <span class="nv">board-size</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">queen-cols</span> <span class="nv">k</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">k</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list </span><span class="nv">empty-board</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">filter</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">positions</span><span class="p">)</span> <span class="p">(</span><span class="nf">safe?</span> <span class="nv">k</span> <span class="nv">positions</span><span class="p">))</span>
	 <span class="p">(</span><span class="nf">flatmap</span>
	  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">rest-of-queens</span><span class="p">)</span>
	    <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">new-row</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">adjoin-position</span> <span class="nv">new-row</span> <span class="nv">k</span> <span class="nv">rest-of-queens</span><span class="p">))</span>
		 <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="nv">board-size</span><span class="p">)))</span>
	  <span class="p">(</span><span class="nf">queen-cols</span> <span class="p">(</span><span class="nb">- </span><span class="nv">k</span> <span class="mi">1</span><span class="p">))))))</span>
  <span class="p">(</span><span class="nf">queen-cols</span> <span class="nv">board-size</span><span class="p">))</span>

<span class="p">(</span><span class="nf">queens</span> <span class="mi">8</span><span class="p">)</span> <span class="c1">;; Value: ((4 2 7 3 6 8 5 1) (5 2 4 7 3 8 6 1) (3 5 2 8 6 4 7 1) (3 6 4 2 8 5 7 1) (5 7 1 3 8 6 4 2) (4 6 8 3 1 7 5 2) (3 6 8 1 4 7 5 2) (5 3 8 4 7 1 6 2) (5 7 4 1 3 8 6 2) (4 1 5 8 6 3 7 2) (3 6 4 1 8 5 7 2) (4 7 5 3 1 6 8 2) (6 4 2 8 5 7 1 3) (6 4 7 1 8 2 5 3) (1 7 4 6 8 2 5 3) (6 8 2 4 1 7 5 3) (6 2 7 1 4 8 5 3) (4 7 1 8 5 2 6 3) (5 8 4 1 7 2 6 3) (4 8 1 5 7 2 6 3) (2 7 5 8 1 4 6 3) (1 7 5 8 2 4 6 3) (2 5 7 4 1 8 6 3) (4 2 7 5 1 8 6 3) (5 7 1 4 2 8 6 3) (6 4 1 5 8 2 7 3) (5 1 4 6 8 2 7 3) (5 2 6 1 7 4 8 3) (6 3 7 2 8 5 1 4) (2 7 3 6 8 5 1 4) (7 3 1 6 8 5 2 4) (5 1 8 6 3 7 2 4) (1 5 8 6 3 7 2 4) (3 6 8 1 5 7 2 4) (6 3 1 7 5 8 2 4) (7 5 3 1 6 8 2 4) (7 3 8 2 5 1 6 4) (5 3 1 7 2 8 6 4) (2 5 7 1 3 8 6 4) (3 6 2 5 8 1 7 4) (6 1 5 2 8 3 7 4) (8 3 1 6 2 5 7 4) (2 8 6 1 3 5 7 4) (5 7 2 6 3 1 8 4) (3 6 2 7 5 1 8 4) (6 2 7 1 3 5 8 4) (3 7 2 8 6 4 1 5) (6 3 7 2 4 8 1 5) (4 2 7 3 6 8 1 5) (7 1 3 8 6 4 2 5) (1 6 8 3 7 4 2 5) (3 8 4 7 1 6 2 5) (6 3 7 4 1 8 2 5) (7 4 2 8 6 1 3 5) (4 6 8 2 7 1 3 5) (2 6 1 7 4 8 3 5) (2 4 6 8 3 1 7 5) (3 6 8 2 4 1 7 5) (6 3 1 8 4 2 7 5) (8 4 1 3 6 2 7 5) (4 8 1 3 6 2 7 5) (2 6 8 3 1 4 7 5) (7 2 6 3 1 4 8 5) (3 6 2 7 1 4 8 5) (4 7 3 8 2 5 1 6) (4 8 5 3 1 7 2 6) (3 5 8 4 1 7 2 6) (4 2 8 5 7 1 3 6) (5 7 2 4 8 1 3 6) (7 4 2 5 8 1 3 6) (8 2 4 1 7 5 3 6) (7 2 4 1 8 5 3 6) (5 1 8 4 2 7 3 6) (4 1 5 8 2 7 3 6) (5 2 8 1 4 7 3 6) (3 7 2 8 5 1 4 6) (3 1 7 5 8 2 4 6) (8 2 5 3 1 7 4 6) (3 5 2 8 1 7 4 6) (3 5 7 1 4 2 8 6) (5 2 4 6 8 3 1 7) (6 3 5 8 1 4 2 7) (5 8 4 1 3 6 2 7) (4 2 5 8 6 1 3 7) (4 6 1 5 2 8 3 7) (6 3 1 8 5 2 4 7) (5 3 1 6 8 2 4 7) (4 2 8 6 1 3 5 7) (6 3 5 7 1 4 2 8) (6 4 7 1 3 5 2 8) (4 7 5 2 6 1 3 8) (5 7 2 6 3 1 4 8))</span>
<span class="p">(</span><span class="nb">length </span><span class="p">(</span><span class="nf">queens</span> <span class="mi">8</span><span class="p">))</span> <span class="c1">;Value: 92</span>
</pre></div>
</div>
</div>


<div id="outline-container-org3ed4730" class="outline-2">
<h2 id="org3ed4730">Упражнение 2.43</h2>
<div class="outline-text-2" id="text-org3ed4730">
<p>
Процедура Луиса для queens работала медленно. Выяснилось что он поменял местами отображения в flatmap.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">flatmap</span>
 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">new-row</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">rest-of-queens</span><span class="p">)</span>
	  <span class="p">(</span><span class="nf">adjoin-position</span> <span class="nv">new-row</span> <span class="nv">k</span> <span class="nv">rest-of-queens</span><span class="p">))</span>
	<span class="p">(</span><span class="nf">queen-cols</span> <span class="p">(</span><span class="nb">- </span><span class="nv">k</span> <span class="mi">1</span><span class="p">))))</span>
 <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="nv">board-size</span><span class="p">))</span>
</pre></div>

<p>
Объясните почему смена отображения замедляет программу. Оцени время для восьми ферзей если для 6 было время T.
</p>

<p>
(queen-cols (- k 1)) вызывается 8 раз.
</p>

<p>
Замедление происходит потому что считаем 8 раз предыдущие позиции на каждом вызове рекурсии. То есть если оценивать во времени обхода этих позиций то рост будет 8<sup>N</sup> где N количество позиций. Количество позиций сложная функция из-за фильтра, но после 5 она начинает резко расти. За счет этого наблюдается замедление.
</p>

<p>
Допустим для 6 позиций заняло время T. что бы для 7 позиций посчитать она выполнит 8 раз для 6 позиций. Потом количество позиций увеличится в 8 раз. потом применим функцию фильтра, которая сократит варианты. И еще раз выполнится 8 раз для 7. То есть итоговое T, будет порядка (8<sup>2</sup>) T.
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-22-ierarkhicheskie-dannye-i-svoistvo-zamykaniia-the-closure-property/" class="u-url">SICP 2.2 Иерархические данные и свойство замыкания (the closure property).</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-22-ierarkhicheskie-dannye-i-svoistvo-zamykaniia-the-closure-property/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-18T15:18:01+03:00" itemprop="datePublished" title="2020-01-18 15:18">2020-01-18 15:18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.17
  </h2>
  <div>
   <div>
    <p>
     Определите процедуру last-pair, которая возвращает список который содержит только последний элемент данного (непустого списка).
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">last-pair</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">))</span>
<span class="lineno">3 </span>      <span class="nv">list1</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="nf">last-pair</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">))))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.18
  </h2>
  <div>
   <div>
    <p>
     Определите процедуру reverse, которая возвращает список элементы которого записаны в обратном порядке.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">reverse </span><span class="nv">list1</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">l</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">l</span><span class="p">)</span>
<span class="lineno">4 </span>        <span class="nv">result</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">l</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">l</span><span class="p">)</span> <span class="nv">result</span><span class="p">))))</span>
<span class="lineno">6 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">list1</span> <span class="nv">nil</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.19
  </h2>
  <div>
   <div>
    <p>
     Рассмотрим программу подсчета количества изменений из раздела 1.2.2. Было бы хорошо легко изменить валюту. Когда программа написана валюта учитывается в методах first-denomination и count-change.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; исходная программа</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">count-change</span> <span class="nv">amount</span><span class="p">)</span>
<span class="lineno"> 3 </span>  <span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="mi">5</span><span class="p">))</span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="nv">kinds-of-coins</span><span class="p">)</span>
<span class="lineno"> 5 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno"> 6 </span>        <span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">0</span><span class="p">))</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno"> 7 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span>
<span class="lineno"> 8 </span>                     <span class="p">(</span><span class="nb">- </span><span class="nv">kinds-of-coins</span> <span class="mi">1</span><span class="p">))</span>
<span class="lineno"> 9 </span>                 <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nb">- </span><span class="nv">amount</span>
<span class="lineno">10 </span>                        <span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">kinds-of-coins</span><span class="p">))</span>
<span class="lineno">11 </span>                     <span class="nv">kinds-of-coins</span><span class="p">)))))</span>
<span class="lineno">12 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">kinds-of-coins</span><span class="p">)</span>
<span class="lineno">13 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">14 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">5</span><span class="p">)</span>
<span class="lineno">15 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">3</span><span class="p">)</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno">16 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">4</span><span class="p">)</span> <span class="mi">25</span><span class="p">)</span>
<span class="lineno">17 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">5</span><span class="p">)</span> <span class="mi">50</span><span class="p">)))</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span><span class="p">(</span><span class="nf">cc</span> <span class="mi">100</span> <span class="mi">5</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     Было бы лучше иметь список монет которые могут быть использованы для размена.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="nv">us-coins</span> <span class="p">(</span><span class="nb">list </span><span class="mi">50</span> <span class="mi">25</span> <span class="mi">10</span> <span class="mi">5</span> <span class="mi">1</span><span class="p">))</span>
<span class="lineno">2 </span><span class="p">(</span><span class="k">define </span><span class="nv">uk-coins</span> <span class="p">(</span><span class="nb">list </span><span class="mi">100</span> <span class="mi">50</span> <span class="mi">20</span> <span class="mi">10</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mf">0.5</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     Мы хотим переписать программу cc что бы её второй аргумент представлял собой список значений монет, вместо целого числа. Тогда у нас будут списки для каждого вида валют.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="nf">cc</span> <span class="mi">100</span> <span class="nv">us-coins</span><span class="p">)</span>
<span class="lineno">2 </span><span class="mi">292</span>
</pre>
</div>   <div>
    <p>
     Для этого потребуется несколько изменить программу cc. Доступ ко второму элементу будет осуществляться по другому.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="nv">coin-values</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">3 </span>        <span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">no-more?</span> <span class="nv">coin-values</span><span class="p">))</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">4 </span>        <span class="p">(</span><span class="nf">else</span>
<span class="lineno">5 </span>         <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span>
<span class="lineno">6 </span>                <span class="p">(</span><span class="nf">except-first-denomination</span> <span class="nv">coin-values</span><span class="p">))</span>
<span class="lineno">7 </span>            <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nb">- </span><span class="nv">amount</span>
<span class="lineno">8 </span>                   <span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">coin-values</span><span class="p">))</span>
<span class="lineno">9 </span>                <span class="nv">coin-values</span><span class="p">)))))</span>
</pre>
</div>   <div>
    <p>
     Определите процедуры first-denomination, except-first-denomination, no-more. Влияет ли порядок в списке на итоговое число?
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="nv">us-coins</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">25</span> <span class="mi">10</span> <span class="mi">5</span> <span class="mi">50</span><span class="p">))</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="nv">uk-coins</span> <span class="p">(</span><span class="nb">list </span><span class="mi">100</span> <span class="mi">50</span> <span class="mi">20</span> <span class="mi">10</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">except-first-denomination</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 4 </span>  <span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">))</span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 6 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">list1</span><span class="p">))</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">no-more?</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 9 </span>      <span class="nv">list1</span>
<span class="lineno">10 </span>      <span class="nv">false</span><span class="p">))</span>
<span class="lineno">11 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="nv">coin-values</span><span class="p">)</span>
<span class="lineno">12 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">13 </span>        <span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">no-more?</span> <span class="nv">coin-values</span><span class="p">))</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">14 </span>        <span class="p">(</span><span class="nf">else</span>
<span class="lineno">15 </span>         <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span>
<span class="lineno">16 </span>                <span class="p">(</span><span class="nf">except-first-denomination</span> <span class="nv">coin-values</span><span class="p">))</span>
<span class="lineno">17 </span>            <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nb">- </span><span class="nv">amount</span>
<span class="lineno">18 </span>                   <span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">coin-values</span><span class="p">))</span>
<span class="lineno">19 </span>                <span class="nv">coin-values</span><span class="p">)))))</span>
<span class="lineno">20 </span><span class="p">(</span><span class="nf">cc</span> <span class="mi">100</span> <span class="nv">us-coins</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     Порядок не влияет, так как рекурсивно обходятся все варианты изменения.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.20
  </h2>
  <div>
   <div>
    <p>
     Используя нотацию dotted-tail, напишите процедуру same-parity которая принимает одно или более целых чисел и возвращает список всех аргументов которые имеют такое-же четное-нечетное соотношение как первый аргумент.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">same-parity</span> <span class="nv">x</span> <span class="o">.</span> <span class="nv">l</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">filter</span> <span class="nv">list1</span> <span class="nv">same?</span><span class="p">)</span>
<span class="lineno"> 3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 4 </span>        <span class="nv">list1</span>
<span class="lineno"> 5 </span>        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same?</span> <span class="p">(</span><span class="nb">car </span><span class="nv">list1</span><span class="p">))</span>
<span class="lineno"> 6 </span>            <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">list1</span><span class="p">)</span> <span class="p">(</span><span class="nf">filter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">)</span> <span class="nv">same?</span><span class="p">))</span>
<span class="lineno"> 7 </span>            <span class="p">(</span><span class="nf">filter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">)</span> <span class="nv">same?</span><span class="p">)</span>
<span class="lineno"> 8 </span>            <span class="p">)))</span>
<span class="lineno"> 9 </span>  <span class="p">(</span><span class="k">define </span><span class="nv">same-even-odd</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">even? </span><span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">even? </span><span class="nv">i</span><span class="p">)))</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">even? </span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">even? </span><span class="nv">i</span><span class="p">)))</span> <span class="mi">1</span> <span class="nv">false</span><span class="p">)))</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="p">(</span><span class="nf">filter</span> <span class="nv">l</span> <span class="nv">same-even-odd</span><span class="p">)))</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span><span class="p">(</span><span class="nf">same-parity</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.21
  </h2>
  <div>
   <div>
    <p>
     Процедура square-list принимает список аргументов и возвращает список квадратов.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="nf">square-list</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
<span class="lineno">2 </span><span class="p">(</span><span class="mi">1</span> <span class="mi">4</span> <span class="mi">9</span> <span class="mi">16</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     Приведены два реализации square-list. Дополните их.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-list</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">)</span>
<span class="lineno">3 </span>      <span class="nv">nil</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">))</span> <span class="p">(</span><span class="nf">square-list</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)))))</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span>
<span class="lineno">7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-list</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">8 </span>  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">square</span> <span class="nv">x</span><span class="p">))</span> <span class="nv">items</span><span class="p">))</span>
<span class="lineno">9 </span><span class="p">(</span><span class="nf">square-list</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.22
  </h2>
  <div>
   <div>
    <p>
     Луис пытается переписать первую реализацию square-list (2.21) что бы она генерировала итеративный процесс.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-list</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">things</span> <span class="nv">answer</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">things</span><span class="p">)</span>
<span class="lineno">4 </span>        <span class="nv">answer</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">things</span><span class="p">)</span> 
<span class="lineno">6 </span>              <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">car </span><span class="nv">things</span><span class="p">))</span>
<span class="lineno">7 </span>                    <span class="nv">answer</span><span class="p">))))</span>
<span class="lineno">8 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">items</span> <span class="nv">nil</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     К сожалению список получается в обратном порядке, почему?
    </p>
    <p>
     (list 1 2 3) nil iter (list 2 3) (cons 1 nil) iter (list 3) (cons 4 (cons 1 nil)) iter () (cons 9 (cons 4 (cons 1 nil))) return (cons 9 (cons 4 (cons 1 nil)))
    </p>
    <p>
     Луис пытается починить баг переставляя аргументы в cons
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-list</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">things</span> <span class="nv">answer</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">things</span><span class="p">)</span>
<span class="lineno">4 </span>        <span class="nv">answer</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">things</span><span class="p">)</span>
<span class="lineno">6 </span>              <span class="p">(</span><span class="nb">cons </span><span class="nv">answer</span>
<span class="lineno">7 </span>                    <span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">car </span><span class="nv">things</span><span class="p">))))))</span>
<span class="lineno">8 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">items</span> <span class="nv">nil</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     Это не работает получается (cons (cons (cons nil 1) 4) 9)
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.23
  </h2>
  <div>
   <div>
    <p>
     Процедура for-each похожа на map, только вместо того чтобы возвращать измененный список она просто применяет переданную функцию к каждому элементу. Используется что бы выполнить действия над списком, например печать.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="nb">for-each </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">newline</span><span class="p">)</span> <span class="p">(</span><span class="nb">display </span><span class="nv">x</span><span class="p">))</span>
<span class="lineno">2 </span>          <span class="p">(</span><span class="nb">list </span><span class="mi">57</span> <span class="mi">321</span> <span class="mi">88</span><span class="p">))</span>
<span class="lineno">3 </span><span class="mi">57</span>
<span class="lineno">4 </span><span class="mi">321</span>
<span class="lineno">5 </span><span class="mi">88</span>
</pre>
</div>   <div>
    <p>
     Возвращаемое значение может быть любым например true. Дайте определение процедуры for-each.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">for-each </span><span class="nv">proc</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">))</span>
<span class="lineno">3 </span>      <span class="p">(</span><span class="nf">proc</span> <span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">)))</span>
<span class="lineno">4 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">))</span>
<span class="lineno">5 </span>      <span class="p">(</span><span class="nb">for-each </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)))</span>
<span class="lineno">6 </span>  <span class="nv">true</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.24
  </h2>
  <div>
   <div>
    <p>
     Предположим мы оцениваем выражение (list 1 (list 2 (list 3 4))). Что даст вывод интерпретатора. Изобразите box-and-pointer и древовидную структуры.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="mi">1</span> <span class="p">(</span><span class="mi">2</span> <span class="p">(</span><span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="p">(</span><span class="nb">list </span><span class="mi">2</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
<span class="lineno"> 4 </span>     <span class="nv">/</span>      <span class="err">\</span>
<span class="lineno"> 5 </span>    <span class="nv">/</span>        <span class="err">\</span>
<span class="lineno"> 6 </span>   <span class="mi">1</span>   <span class="p">(</span><span class="nb">list </span><span class="mi">2</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
<span class="lineno"> 7 </span>            <span class="nv">/</span>        <span class="err">\</span>
<span class="lineno"> 8 </span>           <span class="nv">/</span>          <span class="err">\</span>
<span class="lineno"> 9 </span>          <span class="mi">2</span>         <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="lineno">10 </span>                     <span class="nv">/</span>      <span class="err">\</span>
<span class="lineno">11 </span>                    <span class="nv">/</span>        <span class="err">\</span>
<span class="lineno">12 </span>                   <span class="mi">3</span>          <span class="mi">4</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span><span class="p">(</span><span class="nb">cons </span><span class="mi">1</span>  <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">list </span><span class="mi">2</span> <span class="p">(</span><span class="o">...</span><span class="p">))</span> <span class="nv">nil</span><span class="p">)</span>
<span class="lineno">15 </span>     <span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="o">.</span><span class="p">]</span><span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">&gt;</span><span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="nv">/</span><span class="p">]</span>
<span class="lineno">16 </span>      <span class="nv">|</span>                    <span class="nv">|</span>
<span class="lineno">17 </span>      <span class="nv">|</span>                    <span class="nv">|</span>
<span class="lineno">18 </span>      <span class="nv">v</span>                    <span class="nv">v</span>
<span class="lineno">19 </span>      <span class="mi">1</span>                   <span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="o">.</span><span class="p">]</span><span class="nv">-</span> <span class="nv">-&gt;</span><span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="nv">/</span><span class="p">]</span>
<span class="lineno">20 </span>                           <span class="nv">|</span>         <span class="nv">|</span>
<span class="lineno">21 </span>                           <span class="nv">|</span>         <span class="nv">|</span>
<span class="lineno">22 </span>                           <span class="nv">v</span>         <span class="nv">v</span>
<span class="lineno">23 </span>                           <span class="mi">2</span>     <span class="p">(</span><span class="nb">cons </span><span class="mi">3</span> <span class="p">(</span><span class="nb">cons </span><span class="mi">4</span> <span class="nv">nil</span><span class="p">)</span>
<span class="lineno">24 </span>                                    <span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="o">.</span><span class="p">]</span><span class="nv">-</span> <span class="nv">-&gt;</span><span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="nv">/</span><span class="p">]</span>
<span class="lineno">25 </span>                                     <span class="nv">|</span>         <span class="nv">|</span>
<span class="lineno">26 </span>                                     <span class="nv">|</span>         <span class="nv">|</span>
<span class="lineno">27 </span>                                     <span class="nv">v</span>         <span class="nv">v</span>
<span class="lineno">28 </span>                                     <span class="mi">3</span>         <span class="mi">4</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.25
  </h2>
  <div>
   <div>
    <p>
     Приведите комюинации cars и cdrs которые выбирую 7 из каждого списка.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="c1">;; (1 3 (5 7) 9)</span>
<span class="lineno">2 </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">3</span> <span class="p">(</span><span class="nb">list </span><span class="mi">5</span> <span class="mi">7</span><span class="p">)</span> <span class="mi">9</span><span class="p">))))))</span>
<span class="lineno">3 </span><span class="c1">;; ((7))</span>
<span class="lineno">4 </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="mi">7</span><span class="p">))))</span>
<span class="lineno">5 </span><span class="c1">;; (1 (2 (3 (4 (5 (6 7))))))</span>
<span class="lineno">6 </span><span class="p">(</span><span class="k">define </span><span class="nv">list3</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="p">(</span><span class="nb">list </span><span class="mi">2</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="p">(</span><span class="nb">list </span><span class="mi">4</span> <span class="p">(</span><span class="nb">list </span><span class="mi">5</span> <span class="p">(</span><span class="nb">list </span><span class="mi">6</span> <span class="mi">7</span><span class="p">)))))))</span>
<span class="lineno">7 </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">list3</span><span class="p">))))))))))))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.26
  </h2>
  <div>
   <div>
    <p>
     Допустим определили два списка. Какой будет результат выражений.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="nv">y</span> <span class="p">(</span><span class="nb">list </span><span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="nb">append </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno"> 5 </span><span class="c1">;; (1 2 3 4 5 6)</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno"> 7 </span><span class="c1">;; ((1 2 3) 4 5 6)</span>
<span class="lineno"> 8 </span><span class="p">(</span><span class="nb">list </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno"> 9 </span><span class="c1">;; (cons x (cons y nil)</span>
<span class="lineno">10 </span><span class="c1">;; ((1 2 4) (4 5 6))</span>
</pre>
</div>   <div>
    <p>
     то есть list создаст список списков, в то время как cons запишет в car первый список, а в cdr указатель на y, что приведет к разному результату с list x y. cons просто добавляет элемент в начало списка y.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.27
  </h2>
  <div>
   <div>
    <p>
     Измените процедуру reverse что бы она умела разворачивать вложенные списки.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">deep-reverse</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 4 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">l</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno"> 5 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">l</span><span class="p">)</span>
<span class="lineno"> 6 </span>        <span class="nv">result</span>
<span class="lineno"> 7 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">l</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">deep-reverse</span> <span class="p">(</span><span class="nb">car </span><span class="nv">l</span><span class="p">))</span> <span class="nv">result</span><span class="p">))))</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 9 </span>      <span class="p">(</span><span class="nf">iter</span> <span class="nv">list1</span> <span class="nv">nil</span><span class="p">)</span>
<span class="lineno">10 </span>      <span class="nv">list1</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     тут просто рекурсивно вызываем deep-reverse и если list1 это не список просто возвращаем значение.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.28
  </h2>
  <div>
   <div>
    <p>
     Напишите процедуру fringe, которая принимает дерево в виде списка и возвращает список всех листьев в порядке слева на право.
    </p>
    <p>
     Например:
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="p">(</span><span class="nf">fringe</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">4 </span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span><span class="p">(</span><span class="nf">fringe</span> <span class="p">(</span><span class="nb">list </span><span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>
<span class="lineno">7 </span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
</pre>
</div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="k">define </span><span class="p">(</span><span class="nf">fringe</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">x</span><span class="p">)</span>
<span class="lineno">3 </span>      <span class="nv">x</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">))</span>
<span class="lineno">5 </span>          <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nf">fringe</span> <span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="nf">fringe</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">x</span><span class="p">)))</span>
<span class="lineno">6 </span>          <span class="nv">x</span><span class="p">)))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.29
  </h2>
  <div>
   <div>
    <p>
     Бинарный ползунок состоит из двух веток, левой и правой. Мы можем представить бинарный ползунок используя объединение из двух веток (к примеру используя list).
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nb">list </span><span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     Каждая ветка это стержень определенной длинны + вес либо еще один бинарный ползунок.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-branch</span> <span class="nv">length</span> <span class="nv">structure</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nb">list </span><span class="nv">length</span> <span class="nv">structure</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     a. Напишите селекторы left-branch и right-branch, которые возвращабт ветки + branch-length и branch-structure, которые возвращают компоненты ветки. b. Используя селекторы напишите процедуру total-weight, которая возвращает суммарный вес. с. Ползунок сбалансирован, когда крутящий момент верхней левой ветки равен верхней правой ветке (то есть длинна стержня умножить на вес свисающий с этого стержня). Напишите процедуру которая тестирует сбалансировал ли ползунок. d. Предположим мы поменяли представление так что конструктор стал таким
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>
<span class="lineno">3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-branch</span> <span class="nv">length</span> <span class="nv">structure</span><span class="p">)</span>
<span class="lineno">4 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">length</span> <span class="nv">structure</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     Как много изменений нужно внести в программу после этого?
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nb">list </span><span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-branch</span> <span class="nv">length</span> <span class="nv">structure</span><span class="p">)</span>
<span class="lineno"> 5 </span>  <span class="p">(</span><span class="nb">list </span><span class="nv">length</span> <span class="nv">structure</span><span class="p">))</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno"> 7 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">m</span><span class="p">))</span>
<span class="lineno"> 8 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno"> 9 </span>  <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">m</span><span class="p">)))</span>
<span class="lineno">10 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-length</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">11 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">b</span><span class="p">))</span>
<span class="lineno">12 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-structure</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">13 </span>  <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">b</span><span class="p">)))</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>
<span class="lineno">16 </span><span class="p">(</span><span class="k">define </span><span class="nv">l0</span> <span class="p">(</span><span class="nf">make-branch</span> <span class="mi">3</span> <span class="mi">10</span><span class="p">))</span>
<span class="lineno">17 </span><span class="p">(</span><span class="k">define </span><span class="nv">r0</span> <span class="p">(</span><span class="nf">make-branch</span> <span class="mi">3</span> <span class="mi">10</span><span class="p">))</span>
<span class="lineno">18 </span><span class="p">(</span><span class="k">define </span><span class="nv">m0</span> <span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">l0</span> <span class="nv">r0</span><span class="p">))</span>
<span class="lineno">19 </span>
<span class="lineno">20 </span><span class="p">(</span><span class="k">define </span><span class="nv">l1</span> <span class="p">(</span><span class="nf">make-branch</span> <span class="mi">10</span> <span class="mi">10</span><span class="p">))</span>
<span class="lineno">21 </span><span class="p">(</span><span class="k">define </span><span class="nv">r1</span> <span class="p">(</span><span class="nf">make-branch</span> <span class="mi">5</span> <span class="nv">m0</span><span class="p">))</span>
<span class="lineno">22 </span><span class="p">(</span><span class="k">define </span><span class="nv">m1</span> <span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">l1</span> <span class="nv">r1</span><span class="p">))</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span><span class="c1">;; общий вес</span>
<span class="lineno">25 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">structure-weight</span> <span class="nv">s</span><span class="p">)</span>
<span class="lineno">26 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">s</span><span class="p">)</span>
<span class="lineno">27 </span>      <span class="p">(</span><span class="nf">total-weight</span> <span class="nv">s</span><span class="p">)</span>
<span class="lineno">28 </span>      <span class="nv">s</span><span class="p">))</span>
<span class="lineno">29 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-weight</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">30 </span>  <span class="p">(</span><span class="nf">structure-weight</span> <span class="p">(</span><span class="nf">branch-structure</span> <span class="nv">b</span><span class="p">)))</span>
<span class="lineno">31 </span>
<span class="lineno">32 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">total-weight</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno">33 </span>  <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">branch-weight</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">))</span> <span class="p">(</span><span class="nf">branch-weight</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">))))</span>
<span class="lineno">34 </span>
<span class="lineno">35 </span><span class="p">(</span><span class="nf">total-weight</span> <span class="nv">m1</span><span class="p">)</span>
<span class="lineno">36 </span>
<span class="lineno">37 </span><span class="c1">;; балансировка</span>
<span class="lineno">38 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">balanced?</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno">39 </span>  <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">branch-weight</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">))</span> <span class="p">(</span><span class="nf">branch-length</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">)))</span>
<span class="lineno">40 </span>     <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">branch-weight</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">))</span> <span class="p">(</span><span class="nf">branch-length</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">)))))</span>
<span class="lineno">41 </span>
<span class="lineno">42 </span><span class="p">(</span><span class="nf">balanced?</span> <span class="nv">m1</span><span class="p">)</span>
<span class="lineno">43 </span><span class="p">(</span><span class="nf">balanced?</span> <span class="nv">m0</span><span class="p">)</span>
<span class="lineno">44 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
<span class="lineno">45 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>
<span class="lineno">46 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-branch</span> <span class="nv">length</span> <span class="nv">structure</span><span class="p">)</span>
<span class="lineno">47 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">length</span> <span class="nv">structure</span><span class="p">))</span>
<span class="lineno">48 </span>
<span class="lineno">49 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno">50 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">m</span><span class="p">))</span>
<span class="lineno">51 </span><span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m0</span><span class="p">)</span>
<span class="lineno">52 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">)</span> <span class="c1">;; поменял метод</span>
<span class="lineno">53 </span>  <span class="p">(</span><span class="nb">cdr </span><span class="nv">m</span><span class="p">))</span>
<span class="lineno">54 </span><span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m0</span><span class="p">)</span>
<span class="lineno">55 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-length</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">56 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">b</span><span class="p">))</span>
<span class="lineno">57 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-structure</span> <span class="nv">b</span><span class="p">)</span> <span class="c1">;; поменял метод</span>
<span class="lineno">58 </span>  <span class="p">(</span><span class="nb">cdr </span><span class="nv">b</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     поменяли два селектора.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.30
  </h2>
  <div>
   <div>
    <p>
     Напишите процедуру square-tree без и с использованием map.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-tree</span> <span class="nv">tree</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">tree</span><span class="p">)</span> <span class="nv">nil</span><span class="p">)</span>
<span class="lineno"> 3 </span>        <span class="p">((</span><span class="nb">not </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">tree</span><span class="p">))</span> <span class="p">(</span><span class="nf">square</span> <span class="nv">tree</span><span class="p">))</span>
<span class="lineno"> 4 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">square-tree</span> <span class="p">(</span><span class="nb">car </span><span class="nv">tree</span><span class="p">))</span>
<span class="lineno"> 5 </span>                    <span class="p">(</span><span class="nf">square-tree</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">tree</span><span class="p">))))))</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-tree</span> <span class="nv">tree</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">sub-tree</span><span class="p">)</span>
<span class="lineno"> 9 </span>         <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">sub-tree</span><span class="p">)</span>
<span class="lineno">10 </span>             <span class="p">(</span><span class="nf">square-tree</span> <span class="nv">sub-tree</span><span class="p">)</span>
<span class="lineno">11 </span>             <span class="p">(</span><span class="nf">square</span> <span class="nv">sub-tree</span><span class="p">)))</span>
<span class="lineno">12 </span>       <span class="nv">tree</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.31
  </h2>
  <div>
   <div>
    <p>
     Абстрагируйте ваш ответ к 2.30 что бы можно было записывать процедуру square-tree через tree-map.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-tree</span> <span class="nv">tree</span><span class="p">)</span> <span class="p">(</span><span class="nf">tree-map</span> <span class="nv">square</span> <span class="nv">tree</span><span class="p">))</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span>
<span class="lineno">4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tree-map</span> <span class="nv">proc</span> <span class="nv">tree</span><span class="p">)</span>
<span class="lineno">5 </span>  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">sub-tree</span><span class="p">)</span>
<span class="lineno">6 </span>         <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">sub-tree</span><span class="p">)</span>
<span class="lineno">7 </span>             <span class="p">(</span><span class="nf">tree-map</span> <span class="nv">proc</span> <span class="nv">sub-tree</span><span class="p">)</span>
<span class="lineno">8 </span>             <span class="p">(</span><span class="nf">proc</span> <span class="nv">sub-tree</span><span class="p">)))</span>
<span class="lineno">9 </span>       <span class="nv">tree</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.32
  </h2>
  <div>
   <div>
    <p>
     Мы можем представить set как список уникальных элементов, а так же set всех подмножеств как список списков. К примеру set (1 2 3), тогда сет всех подмножеств будет (() (3) (2) (2 3) (1) (1 3) (1 2) (1 2 3)). Допишите функцию генерирующую список всех подмножеств сета и дайте пояснение как она работает.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">subsets</span> <span class="nv">s</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">s</span><span class="p">)</span>
<span class="lineno">3 </span>      <span class="p">(</span><span class="nb">list </span><span class="nv">nil</span><span class="p">)</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">rest</span> <span class="p">(</span><span class="nf">subsets</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">s</span><span class="p">))))</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nb">append </span><span class="nv">rest</span> <span class="p">(</span><span class="nb">map </span><span class="nv">&lt;??&gt;</span> <span class="nv">rest</span><span class="p">)))))</span>
</pre>
</div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">subsets</span> <span class="nv">s</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">s</span><span class="p">)</span>
<span class="lineno">3 </span>      <span class="p">(</span><span class="nb">list </span><span class="nv">nil</span><span class="p">)</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">rest</span> <span class="p">(</span><span class="nf">subsets</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">s</span><span class="p">))))</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nb">append </span><span class="nv">rest</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">set</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">s</span><span class="p">)</span> <span class="nv">set</span><span class="p">))</span> <span class="nv">rest</span><span class="p">)))))</span>
<span class="lineno">6 </span>
<span class="lineno">7 </span><span class="p">(</span><span class="nf">subsets</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
<span class="lineno">8 </span><span class="c1">;Value: (() (3) (2) (2 3) (1) (1 3) (1 2) (1 2 3))</span>
</pre>
</div>   <div>
    <p>
     выбираем список без первого элемента, генерируем для него все подмножества. добавляем к полученным подмножествам такое же подмножество но везде первым элементом идет первый элемент. на последней итерации у нас получается пустое список, он возвращает () - нулевое подмножество. в итоге мы перебрали все возможные варианты.
    </p>
   </div>
  </div>
 </div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-vvedenie-v-abstragirovanie-dannykh/" class="u-url">SICP Введение в абстрагирование данных</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-vvedenie-v-abstragirovanie-dannykh/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-16T11:35:27+03:00" itemprop="datePublished" title="2020-01-16 11:35">2020-01-16 11:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.1
  </h2>
  <div>
   <div>
    <p>
     Определите make-rat которая будет определять знак.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-rat</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">g</span> <span class="p">(</span><span class="nb">gcd </span><span class="nv">n</span> <span class="nv">d</span><span class="p">))</span>
<span class="lineno">3 </span>        <span class="p">(</span><span class="nf">sign</span> <span class="p">(</span><span class="k">cond </span><span class="p">(</span><span class="k">or </span><span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt; </span><span class="nv">d</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="nv">d</span> <span class="mi">0</span><span class="p">)))</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">4 </span>                        <span class="p">(</span><span class="k">else </span><span class="mi">0</span><span class="p">))))</span>
<span class="lineno">5 </span>    <span class="p">(</span><span class="nf">cons</span>
<span class="lineno">6 </span>     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">sign</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">abs </span><span class="p">(</span><span class="nb">/ </span><span class="nv">n</span> <span class="nv">g</span><span class="p">))</span> <span class="p">(</span><span class="nb">* </span><span class="mi">-1</span> <span class="p">(</span><span class="nb">abs </span><span class="p">(</span><span class="nb">/ </span><span class="nv">n</span> <span class="nv">g</span><span class="p">))))</span>
<span class="lineno">7 </span>     <span class="p">(</span><span class="nb">abs </span><span class="p">(</span><span class="nb">/ </span><span class="nv">d</span> <span class="nv">g</span><span class="p">)))))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.2
  </h2>
  <div>
   <div>
    <p>
     Рассмотрим проблему представления отрезков на плоскости. Каждый отрезок представлен в виде пары точек. Определите консруктор отрезка make-segment и методы получения (selectors) начала и конца отрезка: start-segment, end-segment, которые определяют представление сегмента в виде точек. Кроме того точка может быть представлена в виде пары чисел. Наконец определите процедуру для средней точки отрезка midpoint-segment.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">average</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">+ </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-point</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">x-point</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">p</span><span class="p">))</span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">y-point</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">p</span><span class="p">))</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">print-point</span> <span class="nv">p</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno"> 9 </span>  <span class="p">(</span><span class="nb">display </span><span class="s">"("</span><span class="p">)</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">x-point</span> <span class="nv">p</span><span class="p">))</span>
<span class="lineno">11 </span>  <span class="p">(</span><span class="nb">display </span><span class="s">","</span><span class="p">)</span>
<span class="lineno">12 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">y-point</span> <span class="nv">p</span><span class="p">))</span>
<span class="lineno">13 </span>  <span class="p">(</span><span class="nb">display </span><span class="s">")"</span><span class="p">))</span>
<span class="lineno">14 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">average-points</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">15 </span>   <span class="p">(</span><span class="nf">make-point</span> <span class="p">(</span><span class="nf">average</span> <span class="p">(</span><span class="nf">x-point</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">x-point</span> <span class="nv">b</span><span class="p">))</span>
<span class="lineno">16 </span>               <span class="p">(</span><span class="nf">average</span> <span class="p">(</span><span class="nf">y-point</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">y-point</span> <span class="nv">b</span><span class="p">))))</span>
<span class="lineno">17 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">distance-points</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">18 </span>  <span class="p">(</span><span class="nb">sqrt </span><span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">x-point</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">x-point</span> <span class="nv">b</span><span class="p">)))</span>
<span class="lineno">19 </span>           <span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">y-point</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">y-point</span> <span class="nv">b</span><span class="p">))))))</span>
<span class="lineno">20 </span><span class="p">(</span><span class="nf">print-point</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-segment</span> <span class="nv">start</span> <span class="nv">end</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">start</span> <span class="nv">end</span><span class="p">))</span>
<span class="lineno">23 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">start-segment</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">s</span><span class="p">))</span>
<span class="lineno">24 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">end-segment</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">s</span><span class="p">))</span>
<span class="lineno">25 </span>
<span class="lineno">26 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">midpoint-segment</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nf">average-points</span> <span class="p">(</span><span class="nf">start-segment</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nf">end-segment</span> <span class="nv">s</span><span class="p">)))</span>
<span class="lineno">27 </span><span class="p">(</span><span class="nf">print-point</span> <span class="p">(</span><span class="nf">midpoint-segment</span> <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">6</span> <span class="mi">0</span><span class="p">))))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.3
  </h2>
  <div>
   <div>
    <p>
     Определите представление прямоугольника на плоскости. В терминаха вашего конструктора и селекторов создайте процедуру которая вывчисляет периметр и площадь. Теперь реализуйте другое представление для прямоугольников. Можете ли вы спроектировать вашу сисетму с подходящими барьерами абстракций, что бы одни и теже процедуры для перемитра и площади работали с разными представлениями.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">segment-lenght</span> <span class="nv">s</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nf">distance-points</span> <span class="p">(</span><span class="nf">start-segment</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nf">end-segment</span> <span class="nv">s</span><span class="p">)))</span>
<span class="lineno"> 3 </span><span class="c1">;; (segment-lenght (make-segment (make-point 0 0) (make-point 6 0)))</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-rect</span> <span class="nv">seg1</span> <span class="nv">seg2</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">seg1</span> <span class="nv">seg2</span><span class="p">))</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rect-base</span> <span class="nv">r</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">r</span><span class="p">))</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rect-side</span> <span class="nv">r</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">r</span><span class="p">))</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rect-perimeter</span> <span class="nv">r</span><span class="p">)</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="nb">* </span><span class="mf">2.0</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">segment-lenght</span> <span class="p">(</span><span class="nf">rect-base</span> <span class="nv">r</span><span class="p">))</span> <span class="p">(</span><span class="nf">segment-lenght</span> <span class="p">(</span><span class="nf">rect-side</span> <span class="nv">r</span><span class="p">)))))</span>
<span class="lineno">11 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">react-area</span> <span class="nv">r</span><span class="p">)</span>
<span class="lineno">12 </span>  <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">segment-lenght</span> <span class="p">(</span><span class="nf">rect-base</span> <span class="nv">r</span><span class="p">))</span> <span class="p">(</span><span class="nf">segment-lenght</span> <span class="p">(</span><span class="nf">rect-side</span> <span class="nv">r</span><span class="p">))))</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span><span class="p">(</span><span class="nf">rect-perimeter</span> <span class="p">(</span><span class="nf">make-rect</span>
<span class="lineno">15 </span>                 <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">6</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno">16 </span>                 <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">))</span>
<span class="lineno">17 </span>                 <span class="p">))</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span><span class="p">(</span><span class="nf">react-area</span> <span class="p">(</span><span class="nf">make-rect</span>
<span class="lineno">20 </span>                 <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">6</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno">21 </span>                 <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">))</span>
<span class="lineno">22 </span>                 <span class="p">))</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span>
<span class="lineno">25 </span><span class="c1">;; другое представление прямоугольника например тремя точками</span>
<span class="lineno">26 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-rect</span> <span class="nv">point1</span> <span class="nv">point2</span> <span class="nv">point3</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">cons </span><span class="nv">point1</span> <span class="nv">point2</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">point2</span> <span class="nv">point3</span><span class="p">)))</span>
<span class="lineno">27 </span><span class="p">(</span><span class="nf">rect-perimeter</span> <span class="p">(</span><span class="nf">make-rect</span>
<span class="lineno">28 </span>                 <span class="p">(</span><span class="nf">make-point</span> <span class="mi">6</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">)</span>
<span class="lineno">29 </span>                 <span class="p">))</span>
<span class="lineno">30 </span>
<span class="lineno">31 </span><span class="p">(</span><span class="nf">react-area</span> <span class="p">(</span><span class="nf">make-rect</span>
<span class="lineno">32 </span>             <span class="p">(</span><span class="nf">make-point</span> <span class="mi">6</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">)</span>
<span class="lineno">33 </span>             <span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.4
  </h2>
  <div>
   <div>
    <p>
     Дано альтернативное процедурное представление пары. Проверить Что с его помощью можно получить первое значение из пары, допишите реализацию получения второго значения из пары?
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">m</span><span class="p">)</span> <span class="p">(</span><span class="nf">m</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)))</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="nb">cons </span><span class="mi">1</span> <span class="mi">2</span><span class="p">)</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">car </span><span class="nv">z</span><span class="p">)</span>
<span class="lineno"> 7 </span>  <span class="p">(</span><span class="nf">z</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p</span> <span class="nv">q</span><span class="p">)</span> <span class="nv">p</span><span class="p">)))</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span><span class="c1">;; (cons 1 3)</span>
<span class="lineno">10 </span><span class="c1">;; (car (cons 1 3))</span>
<span class="lineno">11 </span><span class="c1">;; (car (lambda (m) (m x y)))</span>
<span class="lineno">12 </span><span class="c1">;; ((lambda (m) (m x y)) (lambda (p q) p))</span>
<span class="lineno">13 </span><span class="c1">;; (m x y) это как раз вызвать процедуру которая в параметрах с параметрами x y</span>
<span class="lineno">14 </span><span class="c1">;; но следующая проуедура как раз возвращает первый параметр p, то есть все выражение</span>
<span class="lineno">15 </span><span class="c1">;; вернет x</span>
<span class="lineno">16 </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cons </span><span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">z</span><span class="p">)</span>
<span class="lineno">19 </span>  <span class="p">(</span><span class="nf">z</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p</span> <span class="nv">q</span><span class="p">)</span> <span class="nv">q</span><span class="p">)))</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cons </span><span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.5
  </h2>
  <div>
   <div>
    <p>
     Покажите что мы можем представить пары неотрицательных целых чисел, используя только числа и арифметические операции, если представим пару a и b как целое произведение <span class="inline-formula"><img class="img-inline-formula img-formula" width="45" height="15" src="formulae/.zOENo0lip4SHHhRpT3lhv8ITPk7RRL56PDS_A.png" alt="2^a\cdot 3^b" title="2^a\cdot 3^b"></span>. Приведите соответствующие процедуры cons, car, cdr.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="nv">logB</span>
<span class="lineno"> 2 </span>    <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">B</span><span class="p">)</span>
<span class="lineno"> 3 </span>      <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">log </span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">log </span><span class="nv">B</span><span class="p">))))</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">cons </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 6 </span>  <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">fast-expt</span> <span class="mi">2</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">fast-expt</span> <span class="mi">3</span> <span class="nv">b</span><span class="p">)))</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">r</span><span class="p">)</span>
<span class="lineno"> 9 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="p">(</span><span class="nb">remainder </span><span class="nv">r</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">10 </span>      <span class="p">(</span><span class="nf">logB</span> <span class="nv">r</span> <span class="mi">3</span><span class="p">)</span>
<span class="lineno">11 </span>      <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">/ </span><span class="nv">r</span> <span class="mi">2</span><span class="p">))))</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">car </span><span class="nv">r</span><span class="p">)</span>
<span class="lineno">14 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="p">(</span><span class="nb">remainder </span><span class="nv">r</span> <span class="mi">3</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">15 </span>      <span class="p">(</span><span class="nf">logB</span> <span class="nv">r</span> <span class="mi">2</span><span class="p">)</span>
<span class="lineno">16 </span>      <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">/ </span><span class="nv">r</span> <span class="mi">3</span><span class="p">))))</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span><span class="p">(</span><span class="nb">cons </span><span class="mi">1</span> <span class="mi">4</span><span class="p">)</span> <span class="c1">; 162</span>
<span class="lineno">19 </span><span class="p">(</span><span class="nb">car </span><span class="mi">162</span><span class="p">)</span> <span class="c1">; 1</span>
<span class="lineno">20 </span><span class="p">(</span><span class="nb">cdr </span><span class="mi">162</span><span class="p">)</span> <span class="c1">; 4</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.6
  </h2>
  <div>
   <div>
    <p>
     Если случай представления пар в виде процедур был не достаточно ошеломляющим, учтите что в языке который может манипулировать процедурами, мы можем обойтись без чисел , по крайне мерее если говорить о неотрицательных целых числах, реализовав 0 и операцию добавления 1 как:
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="nv">zero</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="nv">x</span><span class="p">)))</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-1</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">4 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="p">((</span><span class="nf">n</span> <span class="nv">f</span><span class="p">)</span> <span class="nv">x</span><span class="p">)))))</span>
</pre>
</div>   <div>
    <p>
     Это представление изветсно как цифры Черча в честь изобретателя Алонсо Черча, логика который изобрел исчисления. Дайте определении one и two (напрямую без использования zero add-1) (Используйте подстановку выполненния (add-1 zero)). Дайте прямое определение процедуры + (не в терминах повторения add-1)
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="nv">zero</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="nv">x</span><span class="p">)))</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-1</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">4 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="p">((</span><span class="nf">n</span> <span class="nv">f</span><span class="p">)</span> <span class="nv">x</span><span class="p">)))))</span>
</pre>
</div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; (add-1 zero)</span>
<span class="lineno"> 2 </span><span class="c1">;; (add-1 (lambda (f) (lambda (x) x)))</span>
<span class="lineno"> 3 </span><span class="c1">;; ((n f) x) будет просто x, так как n это zero</span>
<span class="lineno"> 4 </span><span class="c1">;;</span>
<span class="lineno"> 5 </span><span class="c1">;; (lambda (x) (f x))</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">one</span> <span class="nv">f</span><span class="p">)</span>
<span class="lineno"> 7 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span><span class="p">)))</span>
<span class="lineno"> 8 </span><span class="c1">;; (add-1 one)</span>
<span class="lineno"> 9 </span><span class="c1">;;</span>
<span class="lineno">10 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">two</span> <span class="nv">f</span><span class="p">)</span>
<span class="lineno">11 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span><span class="p">))))</span>
<span class="lineno">12 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add</span> <span class="nv">m</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">13 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">((</span><span class="nf">m</span> <span class="nv">f</span><span class="p">)</span> <span class="p">((</span><span class="nf">n</span> <span class="nv">f</span><span class="p">)</span> <span class="nv">x</span><span class="p">)))))</span>
<span class="lineno">14 </span><span class="c1">;; пусть m=one, n=one</span>
<span class="lineno">15 </span><span class="c1">;; ((n f) x) = (f x)</span>
<span class="lineno">16 </span><span class="c1">;; ((m f) (f x))</span>
<span class="lineno">17 </span><span class="c1">;; (f (f x))</span>
<span class="lineno">18 </span><span class="c1">;; (lambda (x) (f (f x))) а это не что иное как два</span>
<span class="lineno">19 </span><span class="p">(</span><span class="nf">add</span> <span class="nv">one</span> <span class="nv">one</span><span class="p">)</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">print-church</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">22 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">((</span><span class="nf">n</span> <span class="nv">inc</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">newline</span><span class="p">))</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span><span class="p">(</span><span class="nf">print-church</span> <span class="nv">zero</span><span class="p">)</span>
<span class="lineno">25 </span><span class="p">(</span><span class="nf">print-church</span> <span class="nv">one</span><span class="p">)</span>
<span class="lineno">26 </span><span class="p">(</span><span class="nf">print-church</span> <span class="nv">two</span><span class="p">)</span>
<span class="lineno">27 </span><span class="p">(</span><span class="nf">print-church</span> <span class="p">(</span><span class="nf">add</span> <span class="nv">two</span> <span class="nv">two</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.7
  </h2>
  <div>
   <div>
    <p>
     Определите селекторы upper-bound и lower-bound.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-interval</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">a</span> <span class="nv">b</span><span class="p">))</span>
<span class="lineno">2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">max </span><span class="p">(</span><span class="nb">car </span><span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">i</span><span class="p">)))</span>
<span class="lineno">3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">min </span><span class="p">(</span><span class="nb">car </span><span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">i</span><span class="p">)))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.8
  </h2>
  <div>
   <div>
    <p>
     Используя рассуждения Алисы напишите процедуру для вычисления разности интервалов.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub-interval</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nf">make-interval</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno">3 </span>                 <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.9
  </h2>
  <div>
   <div>
    <p>
     Ширина интервала - половина разницы между верхней и нижней оценкой. Ширина является мерой неопределенности значения указанного для интервала. Для некоторых операций над интервалами результирующая ширина является функцией от ширин интервалов, которые были аргументами, а для некотрых операций нет. Покажите что ширина суммы (или разницы) является такой функцией. А для умножения и деления правило не выполняется.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; определяем функцию ширины интервала</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">width-interval</span> <span class="nv">i</span><span class="p">)</span>
<span class="lineno"> 3 </span>  <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">i</span><span class="p">))</span> <span class="mf">2.0</span><span class="p">))</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="nf">width-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mf">4.0</span> <span class="mf">6.0</span><span class="p">))</span> <span class="c1">;; 1</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="nf">width-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">10</span> <span class="mi">14</span><span class="p">))</span> <span class="c1">;; 2</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="nf">width-interval</span> <span class="p">(</span><span class="nf">add-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">4</span> <span class="mi">6</span><span class="p">)</span>
<span class="lineno"> 8 </span>                              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">10</span> <span class="mi">14</span><span class="p">)))</span><span class="c1">;; 3</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="p">(</span><span class="nf">width-interval</span> <span class="p">(</span><span class="nf">sub-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">4</span> <span class="mi">6</span><span class="p">)</span>
<span class="lineno">11 </span>                              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">10</span> <span class="mi">14</span><span class="p">)))</span><span class="c1">;; 3</span>
<span class="lineno">12 </span><span class="p">(</span><span class="nf">width-interval</span> <span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">10</span> <span class="mi">14</span><span class="p">)</span>
<span class="lineno">13 </span>                              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">4</span> <span class="mi">6</span><span class="p">)))</span><span class="c1">;; 22</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span><span class="p">(</span><span class="nf">width-interval</span> <span class="p">(</span><span class="nf">div-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mf">10.0</span> <span class="mf">14.0</span><span class="p">)</span>
<span class="lineno">16 </span>                              <span class="p">(</span><span class="nf">make-interval</span> <span class="mf">4.0</span> <span class="mf">6.0</span><span class="p">)))</span><span class="c1">;; 0.916</span>
</pre>
</div>   <div>
    <p>
     Видим что для сложения и вычитания результирующая ширина равна сумме исходных. Для yмножения и деления это все не выполняется.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.10
  </h2>
  <div>
   <div>
    <p>
     Бен Битдиддл подсказал что неясно как делить если интервал с нулевой границей. Добавить в код обработку ошибки.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">div-interval</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">error</span> <span class="s">"Error upper-bound = 0"</span><span class="p">))</span>
<span class="lineno">3 </span>        <span class="p">((</span><span class="nb">= </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">error</span> <span class="s">"Error lower-bound = 0"</span><span class="p">))</span>
<span class="lineno">4 </span>        <span class="p">(</span><span class="nf">else</span>
<span class="lineno">5 </span>         <span class="p">(</span><span class="nf">mul-interval</span> <span class="nv">x</span>
<span class="lineno">6 </span>                       <span class="p">(</span><span class="nf">make-interval</span> <span class="p">(</span><span class="nb">/ </span><span class="mf">1.0</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno">7 </span>                                      <span class="p">(</span><span class="nb">/ </span><span class="mf">1.0</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)))))))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.11
  </h2>
  <div>
   <div>
    <p>
     Испытывая знаки конечных точек интервалов можно разбить multi-interval на девять случаев, только один из которых требует более двух перемножений. Перепишите процедуру используя этот совет.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="c1">;; Если все положительно</span>
<span class="lineno"> 3 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno"> 4 </span>                                                              <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno"> 5 </span>                                                              <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno"> 6 </span>        <span class="c1">;; Если все отрицательное</span>
<span class="lineno"> 7 </span>        <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&lt;= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno"> 8 </span>                                                              <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno"> 9 </span>                                                              <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">10 </span>        <span class="c1">;; x положительный, а y содержит 0</span>
<span class="lineno">11 </span>        <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno">12 </span>                                                                                    <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno">13 </span>                                                                                    <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">14 </span>        <span class="c1">;; x положительный, а y весь отрицательный</span>
<span class="lineno">15 </span>        <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno">16 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno">17 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">18 </span>        <span class="c1">;; y положительный, а x содержит 0</span>
<span class="lineno">19 </span>        <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno">20 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">))</span>
<span class="lineno">21 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">22 </span>        <span class="c1">;; y положительный, а x весь отрицательный</span>
<span class="lineno">23 </span>        <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno">24 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">))</span>
<span class="lineno">25 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">26 </span>        <span class="c1">;; x отрицательный y пересекает 0</span>
<span class="lineno">27 </span>        <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno">28 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno">29 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">30 </span>        <span class="c1">;; y отрицательный x пересекает 0</span>
<span class="lineno">31 </span>        <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno">32 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">))</span>
<span class="lineno">33 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">34 </span>        <span class="c1">;; иначе у нас и x и y пересекают 0, в этом случае и нужно перемножать значения</span>
<span class="lineno">35 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">p1</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)))</span>
<span class="lineno">36 </span>                    <span class="p">(</span><span class="nf">p2</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)))</span>
<span class="lineno">37 </span>                    <span class="p">(</span><span class="nf">p3</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)))</span>
<span class="lineno">38 </span>                    <span class="p">(</span><span class="nf">p4</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">39 </span>                <span class="p">(</span><span class="nf">make-interval</span> <span class="p">(</span><span class="nb">min </span><span class="nv">p1</span> <span class="nv">p2</span> <span class="nv">p3</span> <span class="nv">p4</span><span class="p">)</span>
<span class="lineno">40 </span>                               <span class="p">(</span><span class="nb">max </span><span class="nv">p1</span> <span class="nv">p2</span> <span class="nv">p3</span> <span class="nv">p4</span><span class="p">))))))</span>
<span class="lineno">41 </span>
<span class="lineno">42 </span><span class="c1">;; Тесты</span>
<span class="lineno">43 </span><span class="c1">;; 1) x, y &gt;</span>
<span class="lineno">44 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">10</span> <span class="mi">14</span><span class="p">)</span>
<span class="lineno">45 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">))</span>
<span class="lineno">46 </span><span class="c1">;; 2) x, y &lt;</span>
<span class="lineno">47 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-14</span> <span class="mi">-10</span><span class="p">)</span>
<span class="lineno">48 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-6</span> <span class="mi">-4</span><span class="p">))</span>
<span class="lineno">49 </span><span class="c1">;; 3) x&gt; y&lt;</span>
<span class="lineno">50 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">14</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno">51 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-6</span> <span class="mi">-4</span><span class="p">))</span>
<span class="lineno">52 </span><span class="c1">;; 4) x&gt; y 0</span>
<span class="lineno">53 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">14</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno">54 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-2</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno">55 </span><span class="c1">;; 5) y&gt; x 0</span>
<span class="lineno">56 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-2</span> <span class="mi">2</span><span class="p">)</span>
<span class="lineno">57 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">14</span> <span class="mi">10</span><span class="p">))</span>
<span class="lineno">58 </span><span class="c1">;; 6) y&gt; x&lt;</span>
<span class="lineno">59 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-4</span> <span class="mi">-2</span><span class="p">)</span>
<span class="lineno">60 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">14</span> <span class="mi">10</span><span class="p">))</span>
<span class="lineno">61 </span><span class="c1">;; 7) x&lt; y 0</span>
<span class="lineno">62 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-4</span> <span class="mi">-2</span><span class="p">)</span>
<span class="lineno">63 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-2</span> <span class="mi">6</span><span class="p">))</span>
<span class="lineno">64 </span><span class="c1">;; 8) y&lt; x 0</span>
<span class="lineno">65 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-2</span> <span class="mi">6</span><span class="p">)</span>
<span class="lineno">66 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-4</span> <span class="mi">-2</span><span class="p">))</span>
<span class="lineno">67 </span><span class="c1">;; 9) x, y 0</span>
<span class="lineno">68 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-6</span> <span class="mi">-3</span><span class="p">)</span>
<span class="lineno">69 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-4</span> <span class="mi">-2</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.12
  </h2>
  <div>
   <div>
    <p>
     Определите конструктор make-center-percent который получает центр и процент погрешности что бы создать интервал. Вам также нужно определить селектор percent, который вычисляет погрешность для интервала.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-center-percent</span> <span class="nv">c</span> <span class="nv">p</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nf">make-interval</span> <span class="p">(</span><span class="nb">- </span><span class="nv">c</span>  <span class="p">(</span><span class="nb">* </span><span class="nv">c</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">p</span> <span class="mf">100.0</span><span class="p">)))</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">c</span> <span class="p">(</span><span class="nb">* </span><span class="nv">c</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">p</span> <span class="mf">100.0</span><span class="p">)))))</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">percent</span> <span class="nv">i</span><span class="p">)</span>
<span class="lineno">5 </span>  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">c</span> <span class="p">(</span><span class="nf">center</span> <span class="nv">i</span><span class="p">)))</span>
<span class="lineno">6 </span>    <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">c</span><span class="p">)</span> <span class="mi">100</span><span class="p">)</span> <span class="nv">c</span><span class="p">)))</span>
<span class="lineno">7 </span><span class="p">(</span><span class="nf">make-center-percent</span> <span class="mi">5</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno">8 </span><span class="p">(</span><span class="nf">percent</span> <span class="p">(</span><span class="nf">make-center-percent</span> <span class="mi">5</span> <span class="mi">10</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.13
  </h2>
  <div>
   <p>
    Покажите что при малых процентных допусках, есть простая формула для вычисления приблизительного значения допуска для произведения двух интервалов в терминах допусков факторов. Вы можете упростить задачу предположив что все интервалы положительные.
   </p>
   <p>
    Пусть Сx Cy центры двух интервалов, их погрешности Tx, Ty соответственно, пусть Сx, Cy &gt; 0. Тогда перемножая их получим:
   </p>
   <p>
    <span class="inline-formula"><img class="img-inline-formula img-formula" width="494" height="17" src="formulae/yzLwIL7U8o0TGIgYxnq1jKv8cn5D8X8nw.DdkQ.png" alt="min = (Cx-Tx)(Cy-Ty) = CxCy - (TxCy + TyCx) + TxTy" title="min = (Cx-Tx)(Cy-Ty) = CxCy - (TxCy + TyCx) + TxTy"></span> <span class="inline-formula"><img class="img-inline-formula img-formula" width="497" height="17" src="formulae/cbJuiyvW49gp_pAPXhvfaE1cmIYp.NqcCuql3Q.png" alt="max = (Cx+Tx)(Cy+Ty) = CxCy + (TxCy + TyCx) + TxTy" title="max = (Cx+Tx)(Cy+Ty) = CxCy + (TxCy + TyCx) + TxTy"></span>
   </p>
   <p>
    <span class="inline-formula"><img class="img-inline-formula img-formula" width="263" height="24" src="formulae/sWwyVefJ_.k1_WRDQReg36g_d43CjaZgB5m5IQ.png" alt="Tmul = \frac{CyTx + CxTy}{CxCy + TxTy}=\frac{CyTx + CxTy}{CxCy}" title="Tmul = \frac{CyTx + CxTy}{CxCy + TxTy}=\frac{CyTx + CxTy}{CxCy}"></span>. значением TxTy в знаменателе можно пренебречь.
   </p>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.14, 2.15, 2.16
  </h2>
  <div>
   <div>
    <p>
     Продемонстрируйте что утверждения Лема из книги правильно. Исследуйте поведение системы на различных арифметических выражениях. Создайте интервалы A и B и используйте их для вычисления A/A и B/B. Вы получите наибольшее понимание, используя интервалы, чья ширина составляет небольшой процент от значения центра. Изучите результаты вычислений в форме центр-процент.
    </p>
    <p>
     получается что при повторном делении умножении мы увеличиваем
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">A</span> <span class="p">(</span><span class="nf">make-center-percent</span> <span class="mi">100</span> <span class="mi">3</span><span class="p">))</span> <span class="p">(</span><span class="nf">B</span> <span class="p">(</span><span class="nf">make-center-percent</span> <span class="mi">80</span> <span class="mi">4</span><span class="p">)))</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">par1</span> <span class="nv">r1</span> <span class="nv">r2</span><span class="p">)</span>
<span class="lineno"> 3 </span>    <span class="p">(</span><span class="nf">div-interval</span> <span class="p">(</span><span class="nf">mul-interval</span> <span class="nv">r1</span> <span class="nv">r2</span><span class="p">)</span>
<span class="lineno"> 4 </span>                  <span class="p">(</span><span class="nf">add-interval</span> <span class="nv">r1</span> <span class="nv">r2</span><span class="p">)))</span>
<span class="lineno"> 5 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">par2</span> <span class="nv">r1</span> <span class="nv">r2</span><span class="p">)</span>
<span class="lineno"> 6 </span>    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">one</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)))</span>
<span class="lineno"> 7 </span>      <span class="p">(</span><span class="nf">div-interval</span> <span class="nv">one</span>
<span class="lineno"> 8 </span>                    <span class="p">(</span><span class="nf">add-interval</span> <span class="p">(</span><span class="nf">div-interval</span> <span class="nv">one</span> <span class="nv">r1</span><span class="p">)</span>
<span class="lineno"> 9 </span>                                  <span class="p">(</span><span class="nf">div-interval</span> <span class="nv">one</span> <span class="nv">r2</span><span class="p">)))))</span>
<span class="lineno">10 </span>  <span class="c1">;; Подтверждение утверждения Лема</span>
<span class="lineno">11 </span>  <span class="c1">;; (display (width A))</span>
<span class="lineno">12 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">13 </span>  <span class="c1">;; (display (width B))</span>
<span class="lineno">14 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">15 </span>  <span class="c1">;; (display (par1 A B))</span>
<span class="lineno">16 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">17 </span>  <span class="c1">;; (display (center (par1 A B)))</span>
<span class="lineno">18 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">19 </span>  <span class="c1">;; (display (percent (par1 A B)))</span>
<span class="lineno">20 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">21 </span>  <span class="c1">;; (display (par2 A B))</span>
<span class="lineno">22 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">23 </span>  <span class="c1">;; (display (center (par2 A B)))</span>
<span class="lineno">24 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">25 </span>  <span class="c1">;; (display (percent (par2 A B)))</span>
<span class="lineno">26 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">27 </span>
<span class="lineno">28 </span>  <span class="p">(</span><span class="nb">display </span><span class="s">"****B****"</span><span class="p">)</span>
<span class="lineno">29 </span>  <span class="p">(</span><span class="nb">display </span><span class="nv">B</span><span class="p">)</span>
<span class="lineno">30 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">31 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">center</span> <span class="nv">B</span><span class="p">))</span>
<span class="lineno">32 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">33 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">percent</span> <span class="nv">B</span><span class="p">))</span>
<span class="lineno">34 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">35 </span>  <span class="p">(</span><span class="nb">display </span><span class="s">"****B*(B/B)****"</span><span class="p">)</span>
<span class="lineno">36 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="nv">B</span> <span class="p">(</span><span class="nf">div-interval</span> <span class="nv">B</span> <span class="nv">B</span><span class="p">)))</span>
<span class="lineno">37 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">38 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">center</span> <span class="p">(</span><span class="nf">mul-interval</span> <span class="nv">B</span> <span class="p">(</span><span class="nf">div-interval</span> <span class="nv">B</span> <span class="nv">B</span><span class="p">))))</span>
<span class="lineno">39 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">40 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">percent</span> <span class="p">(</span><span class="nf">mul-interval</span> <span class="nv">B</span> <span class="p">(</span><span class="nf">div-interval</span> <span class="nv">B</span> <span class="nv">B</span><span class="p">))))</span>
<span class="lineno">41 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">42 </span>  <span class="p">)</span>
</pre>
</div>   <div>
    <p>
     Другой пользователь так же заметил различные результаты подсчета интервалов при эквивалентных алгебраических выражениях. Она говорит, что формула для вычисления интервалов с использованием сисетмы Алисы даст более жесткие границы ошибок, если её можно записать в такой форме, что никакая переменная, представляющая неопределенное число, не повторяется. Поэтому par2 "лучше" par1. Права ли она? Почему?
    </p>
    <p>
     "лучше" потому что погрешность получается меньше. она получается меньше, потому что в случае par2 у интервала 1 нет погрешности, поэтому все действия с этим интервалом не приводят к росту погрешности в целом, напротив в первом случае мы вводим дополнительную погрешность при каждом действии с интервалом. А нам нужно вводить погрешность столько раз сколько элемент задействован в цепи. То есть по разу для R1 и R2, поэтому вторая формула лучше.
    </p>
    <p>
     Объясните, в общем, почему эквивалентные алгебраические выражения могут привести к разным ответам. Можете ли вы разработать интервально-арифметический пакет, который не имеет этого недостатка, или эта задача невозможна? (Предупреждение: эта проблема очень сложная.)
    </p>
    <p>
     Алгебраические выражения не учитывают физического смысла встречающихся элементов. Если разрабатывать такой пакет, то нам при каждом расчете нужно знать сколько раз встречается тот или иной элемент и в каким способом он задействован, что бы дать расчет неопределенности конкретно для этого случая. Наверно можно разработать пакет которые будет находить минимально возможную неопределенность. Если проанализировать все действия которые нам надо выполнять и выявить повторы, можно перестроить уравнение таким образом что бы уменьшить количество действий с неопределенными интервалами.
    </p>
   </div>
  </div>
 </div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-134-protsedury-kak-vozvrashchaemye-znacheniia-uprazhneniia-140-146/" class="u-url">SICP 1.34 Процедуры как возвращаемые значения, упражнения 1.40-1.46</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-134-protsedury-kak-vozvrashchaemye-znacheniia-uprazhneniia-140-146/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-15T19:17:40+03:00" itemprop="datePublished" title="2020-01-15 19:17">2020-01-15 19:17</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.40
  </h2>
  <div>
   <div>
    <p>
     Определите процедуру cubic, которая может быть использована вместе с newtons-method для нахождения корней <span class="inline-formula"><img class="img-inline-formula img-formula" width="158" height="16" src="formulae/sXwqMiZD7UL6oHbZ.i0kVUnRMNW4SotUtae6OQ.png" alt="x^3+a\cdot x^2+b\cdot x+c" title="x^3+a\cdot x^2+b\cdot x+c"></span>
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cubic</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">* </span><span class="nv">x</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">a</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">b</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">c</span><span class="p">)))</span>
<span class="lineno">4 </span>
<span class="lineno">5 </span><span class="p">(</span><span class="nf">newtons-method</span> <span class="p">(</span><span class="nf">cubic</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.41
  </h2>
  <div>
   <div>
    <p>
     Определите процедуру double которая принимает процедуру как аргумент и возвращает процедуру, которая применяет переданную процедуру дважды. К примеру (double inc) должена вернуть процедуру которая два раза делает inc. Какое значение вернет (((double (double double)) inc) 5)?
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">double</span> <span class="nv">f</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span><span class="p">))))</span>
<span class="lineno">4 </span><span class="p">(((</span><span class="nf">double</span> <span class="p">(</span><span class="nf">double</span> <span class="nv">double</span><span class="p">))</span> <span class="nv">inc</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">; 16</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.42
  </h2>
  <div>
   <div>
    <p>
     Пусть f и g две функции одного аргумента. Композицией f после g называется <span class="inline-formula"><img class="img-inline-formula img-formula" width="93" height="17" src="formulae/gZRHSPvfgublk.GfaBQZG_htxW7etTPzHVF0_g.png" alt="x\mapsto f(g(x))" title="x\mapsto f(g(x))"></span>. Определите процедуру compose, которая составляет композицию двух функций.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">compose</span> <span class="nv">f</span> <span class="nv">g</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="nf">g</span> <span class="nv">x</span><span class="p">))))</span>
<span class="lineno">3 </span><span class="p">((</span><span class="nf">compose</span> <span class="nv">square</span> <span class="nv">inc</span><span class="p">)</span> <span class="mi">6</span><span class="p">)</span> <span class="c1">; 49</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.43
  </h2>
  <div>
   <div>
    <p>
     Если f числовая функция и n положительное целое, тогда мы можем n раз применить функцию к результату выполнения исходной функции, то есть <span class="inline-formula"><img class="img-inline-formula img-formula" width="124" height="17" src="formulae/HU6llSc5.Zpyr.Hr5NnGjQGw2XI4.RQN15cVAQ.png" alt="f(f(...(f(x))...))" title="f(f(...(f(x))...))"></span>. К примеру, если f(x) = x + 1, тогда если мы применим функцию n раз, то получим функцию f(x)=x+n. Если f - возведение в квадрат,тогда результирующая функция будет x в степени 2n. Напишите процедуру, что бы её можно было использовать вот таким образом ((repeated square 2) 5), используйте compose из упражнения 1.42.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">repeated</span> <span class="nv">f</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">3 </span>      <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span><span class="p">))</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="nf">compose</span> <span class="nv">f</span> <span class="p">(</span><span class="nf">repeated</span> <span class="nv">f</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)))))</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span><span class="p">((</span><span class="nf">repeated</span> <span class="nv">square</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">;; 625</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.44
  </h2>
  <div>
   <div>
    <p>
     Идея сглаживающей функции важна при обработке сигналов. Если f - функция и dx - некоторое малое приращение, тогда сглаженная версия функции f, эта функция значение которой в точке x среднее между f(x-dx) и f(x+dx). Напишете процедуру smooth которая принимает на вход функцию и возвращает сглаженную функцию f. Иногда полезно применить сглаживание несколько раз (то есть сгладить сглаженную функцию) что-бы получить n-раз сглаженную функцию. Покажите как генерировать n раз сглаженную функцию при помощи процедуры repeat из 1.43.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="nv">dx</span> <span class="mf">0.00001</span><span class="p">)</span>
<span class="lineno">2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">smooth</span> <span class="nv">f</span><span class="p">)</span>
<span class="lineno">3 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">average</span> <span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="nb">- </span><span class="nv">x</span> <span class="nv">dx</span><span class="p">))</span> <span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">dx</span><span class="p">)))))</span>
<span class="lineno">4 </span>
<span class="lineno">5 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">smooth-n</span> <span class="nv">f</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">6 </span>  <span class="p">((</span><span class="nf">repeated</span> <span class="nv">smooth</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">f</span><span class="p">))</span>
<span class="lineno">7 </span><span class="p">((</span><span class="nf">smooth</span> <span class="nv">square</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
<span class="lineno">8 </span><span class="p">((</span><span class="nf">smooth-n</span> <span class="nv">square</span> <span class="mi">5</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.45
  </h2>
  <div>
   <div>
    <p>
     В разделе 1.3.3 мы видели, что вычилсить квадратные корни путем лобового нахождения фиксированной точки от <span class="inline-formula"><img class="img-inline-formula img-formula" width="64" height="17" src="formulae/zdJWgnFS7PUYZhExeEvrX_tFSENKt1VSCK.Y5Q.png" alt="y\mapsto x/y" title="y\mapsto x/y"></span> не получается, это удалось починить методом усреднения. Тот же метод работает для нахождения кубического корня. К сожалению процесс не срабатывает для корня четвертой степени. Одного усреднения не достаточно что бы выполнить поиск фиксированной точки для схождения <span class="inline-formula"><img class="img-inline-formula img-formula" width="71" height="18" src="formulae/lgB8nsh8BmlyJvAIU7tAqvbF8Rl8.f5Qr5TrSA.png" alt="y\mapsto x/y^3" title="y\mapsto x/y^3"></span>. C другой стороны если применить усреднение два раза , поиск фиксированной точки начинает сходиться. Поэксперементируйте с количеством усреднений для вычисления корня n-ой степени, то есть на отображении <span class="inline-formula"><img class="img-inline-formula img-formula" width="91" height="18" src="formulae/3G5wsHuLMEIvQKNcMebKrdcrXyGTIDeetUDp8Q.png" alt="y\mapsto x/y^{n-1}" title="y\mapsto x/y^{n-1}"></span>. Используя это запишите процедуру для вычисления корня n-ой степени, через fixed-point, average-damp и repeated.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; 1 ; 1 0</span>
<span class="lineno"> 2 </span><span class="c1">;; 2 ; 2 1</span>
<span class="lineno"> 3 </span>     <span class="c1">; 3 1</span>
<span class="lineno"> 4 </span><span class="c1">;; 4 ; 4 2</span>
<span class="lineno"> 5 </span>     <span class="c1">; 5 2</span>
<span class="lineno"> 6 </span>     <span class="c1">; 6 2</span>
<span class="lineno"> 7 </span>     <span class="c1">; 7 2</span>
<span class="lineno"> 8 </span><span class="c1">;; 8 ; 8 3</span>
<span class="lineno"> 9 </span>     <span class="c1">; 15 3</span>
<span class="lineno">10 </span>     <span class="c1">; 16 4</span>
<span class="lineno">11 </span>     <span class="c1">; 32 4</span>
<span class="lineno">12 </span>     <span class="c1">; 33 5</span>
<span class="lineno">13 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">nth-root</span> <span class="nv">x</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">14 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">get-ad-count</span> <span class="nv">n</span> <span class="nv">i</span><span class="p">)</span>
<span class="lineno">15 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">n</span> <span class="p">(</span><span class="nf">fast-expt</span> <span class="mi">2</span> <span class="nv">i</span><span class="p">))</span>
<span class="lineno">16 </span>        <span class="p">(</span><span class="nb">- </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">17 </span>        <span class="p">(</span><span class="nf">get-ad-count</span> <span class="nv">n</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">i</span> <span class="mi">1</span><span class="p">))))</span>
<span class="lineno">18 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">get-ad-count</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">))</span>
<span class="lineno">19 </span>  <span class="p">(</span><span class="nf">fixed-point</span> <span class="p">((</span><span class="nf">repeated</span> <span class="nv">average-damp</span> <span class="p">(</span><span class="nf">get-ad-count</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">))</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">x</span> <span class="p">(</span><span class="nf">fast-expt</span> <span class="nv">y</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)))))</span>
<span class="lineno">20 </span>               <span class="mf">1.0</span><span class="p">))</span>
<span class="lineno">21 </span><span class="p">(</span><span class="nf">nth-root</span> <span class="mi">27</span> <span class="mi">64</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.46
  </h2>
  <div>
   <div>
    <p>
     Некоторые из численных методов, описанных в этой главе являются примерами примерами чрезвычайно общей вычислитетельной стратегии известной как итеративное улучшение. Итеративное вычисление говорит о том, что для вычисления чего либо, мы начнем с первоначальной догадки для ответа, проверим, является ли догадка достаточно хорошей, иначе улчучшим догадку и продолжим процесс используя улучшенную догадку в качестве новой догадки. Напишите процедуру iterative-improve которая принимает две процедуры в качестве аргументов: метод определяющий достаточно ли хороша догадка и метод улучшения догадки. Iterative-improve должна возвращать процедуру которая принимает в качестве аргумента догадку и улучшает её пока она не проходит проверку на предел. Перепишете процедуру квадратного корня и процедуру fixed-point в терминах iterative-improve.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="nv">tolerance</span> <span class="mf">0.00001</span><span class="p">)</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">close-enough?</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
<span class="lineno"> 3 </span>  <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">abs </span><span class="p">(</span><span class="nb">- </span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">))</span> <span class="nv">tolerance</span><span class="p">))</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iterative-improve</span> <span class="nv">good-enough?</span> <span class="nv">improve</span><span class="p">)</span>
<span class="lineno"> 6 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">try</span> <span class="nv">guess</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno"> 7 </span>    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">next</span> <span class="p">(</span><span class="nf">improve</span> <span class="nv">guess</span><span class="p">)))</span>
<span class="lineno"> 8 </span>      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">close-enough?</span> <span class="nv">guess</span> <span class="nv">next</span><span class="p">)</span>
<span class="lineno"> 9 </span>          <span class="nv">next</span>
<span class="lineno">10 </span>          <span class="p">(</span><span class="nf">try</span> <span class="nv">next</span> <span class="nv">x</span><span class="p">))))</span>
<span class="lineno">11 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">guess</span><span class="p">)</span> <span class="p">(</span><span class="nf">try</span> <span class="nv">guess</span> <span class="nv">x</span><span class="p">)))</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">sqrt </span><span class="nv">x</span><span class="p">)</span>
<span class="lineno">14 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">improve</span> <span class="nv">guess</span><span class="p">)</span>
<span class="lineno">15 </span>    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">average</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno">16 </span>      <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno">17 </span>    <span class="p">(</span><span class="nf">average</span> <span class="nv">guess</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">x</span> <span class="nv">guess</span><span class="p">)))</span>
<span class="lineno">18 </span>  <span class="p">((</span><span class="nf">iterative-improve</span> <span class="nv">close-enough?</span> <span class="nv">improve</span><span class="p">)</span> <span class="nv">x</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="lineno">19 </span>
<span class="lineno">20 </span><span class="p">(</span><span class="nb">sqrt </span><span class="mi">2</span><span class="p">)</span> <span class="c1">;Value: 1.4142156862745097</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span>
<span class="lineno">23 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fixed-point</span> <span class="nv">f</span><span class="p">)</span>
<span class="lineno">24 </span>  <span class="p">((</span><span class="nf">iterative-improve</span> <span class="nv">close-enough?</span> <span class="nv">f</span><span class="p">)</span> <span class="mf">1.0</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="lineno">25 </span><span class="p">(</span><span class="nf">fixed-point</span> <span class="nv">cos</span><span class="p">)</span> <span class="c1">;Value: .7390822985224024</span>
</pre>
</div>  </div>
 </div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-133-protsedury-kak-obobshchaiushchie-metody-uprazhneniia-135-139/" class="u-url">SICP 1.33 Процедуры как обобщающие методы, упражнения 1.35-1.39</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-133-protsedury-kak-obobshchaiushchie-metody-uprazhneniia-135-139/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-15T01:36:40+03:00" itemprop="datePublished" title="2020-01-15 01:36">2020-01-15 01:36</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.35
  </h2>
  <div>
   <div>
    <p>
     Показать что золотое сечение <span class="inline-formula"><img class="img-inline-formula img-formula" width="10" height="15" src="formulae/nnhzdqchKKCzaVcrUWETL.T75aNctBowFpJaFA.png" alt="\phi" title="\phi"></span> это фиксированная точка трансформации <span class="inline-formula"><img class="img-inline-formula img-formula" width="94" height="17" src="formulae/1nMkSU9aUmKU94eNCFHsW76zCOstgHrGuaN.JA.png" alt="x\mapsto1+1/x" title="x\mapsto1+1/x"></span> и используя этот факт, вычислить <span class="inline-formula"><img class="img-inline-formula img-formula" width="10" height="15" src="formulae/nnhzdqchKKCzaVcrUWETL.T75aNctBowFpJaFA.png" alt="\phi" title="\phi"></span> через fixed-point.
    </p>
    <p>
     По определению фиксированной точки <span class="inline-formula"><img class="img-inline-formula img-formula" width="91" height="17" src="formulae/WYQmJitF3lTCsDqateA03gibfHVchhI21clQqA.png" alt="\phi=1+1/\phi" title="\phi=1+1/\phi"></span>, где <span class="inline-formula"><img class="img-inline-formula img-formula" width="117" height="20" src="formulae/UjJadbN6A6Af7gemc_E398qzlsLx0k7YuMSyaw.png" alt="\phi=(1+\sqrt{5})/2" title="\phi=(1+\sqrt{5})/2"></span> в общем очевидно что <span class="inline-formula"><img class="img-inline-formula img-formula" width="10" height="15" src="formulae/nnhzdqchKKCzaVcrUWETL.T75aNctBowFpJaFA.png" alt="\phi" title="\phi"></span> фиксированная точка на таком отображении.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">phi</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nf">fixed-point</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="p">(</span><span class="nb">/ </span><span class="mi">1</span> <span class="nv">y</span><span class="p">)))</span>
<span class="lineno">3 </span>  <span class="mf">1.0</span><span class="p">))</span>
<span class="lineno">4 </span>
<span class="lineno">5 </span><span class="p">(</span><span class="nf">phi</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">;Value: 1.6180327868852458</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.36
  </h2>
  <div>
   <div>
    <p>
     Измените процедуру fixed-point чтобы она печатала последовательность генерируемых приближений используя newline и display из упражнения 1.22. Затем найдите решение для <span class="inline-formula"><img class="img-inline-formula img-formula" width="76" height="11" src="formulae/HM9Qm.s3HgJ57VPQ4wJ9rQUqMNF5eAQN2wpsuQ.png" alt="x^x=1000" title="x^x=1000"></span> найдя фиксированную точку для <span class="inline-formula"><img class="img-inline-formula img-formula" width="164" height="17" src="formulae/XbkaMPB9jJlE1P3QZghbOy1J0EdWxwV8s53z7g.png" alt="x\mapsto\log(1000)/\log(x)" title="x\mapsto\log(1000)/\log(x)"></span>. Сравните количество шагов с использованием усреднения и без него.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fixed-point</span> <span class="nv">f</span> <span class="nv">first-guess</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">close-enough?</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
<span class="lineno"> 3 </span>    <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">abs </span><span class="p">(</span><span class="nb">- </span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">))</span> <span class="nv">tolerance</span><span class="p">))</span>
<span class="lineno"> 4 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">try</span> <span class="nv">guess</span><span class="p">)</span>
<span class="lineno"> 5 </span>    <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno"> 6 </span>    <span class="p">(</span><span class="nb">display </span><span class="nv">guess</span><span class="p">)</span>
<span class="lineno"> 7 </span>    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">next</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">guess</span><span class="p">)))</span>
<span class="lineno"> 8 </span>      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">close-enough?</span> <span class="nv">guess</span> <span class="nv">next</span><span class="p">)</span>
<span class="lineno"> 9 </span>          <span class="nv">next</span>
<span class="lineno">10 </span>          <span class="p">(</span><span class="nf">try</span> <span class="nv">next</span><span class="p">))))</span>
<span class="lineno">11 </span>  <span class="p">(</span><span class="nf">try</span> <span class="nv">first-guess</span><span class="p">))</span>
</pre>
</div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">xx1000</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nf">fixed-point</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">log </span><span class="mi">1000</span><span class="p">)</span> <span class="p">(</span><span class="nb">log </span><span class="nv">y</span><span class="p">)))</span>
<span class="lineno">3 </span>               <span class="mf">2.0</span><span class="p">))</span>
<span class="lineno">4 </span><span class="p">(</span><span class="nf">xx1000</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     2. 9.965784284662087 3.004472209841214 6.279195757507157 3.759850702401539 5.215843784925895 4.182207192401397 4.8277650983445906 4.387593384662677 4.671250085763899 4.481403616895052 4.6053657460929 4.5230849678718865 4.577114682047341 4.541382480151454 4.564903245230833 4.549372679303342 4.559606491913287 4.552853875788271 4.557305529748263 4.554369064436181 4.556305311532999 4.555028263573554 4.555870396702851 4.555315001192079 4.5556812635433275 4.555439715736846 4.555599009998291 4.555493957531389 4.555563237292884 4.555517548417651 4.555547679306398 4.555527808516254 4.555540912917957 ;Value: 4.555532270803653
    </p>
    <p>
     35 раз.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">xx1000</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nf">fixed-point</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">average</span> <span class="nv">y</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">log </span><span class="mi">1000</span><span class="p">)</span> <span class="p">(</span><span class="nb">log </span><span class="nv">y</span><span class="p">))))</span>
<span class="lineno">3 </span>               <span class="mf">2.0</span><span class="p">))</span>
<span class="lineno">4 </span><span class="p">(</span><span class="nf">xx1000</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     2. 5.9828921423310435 4.922168721308343 4.628224318195455 4.568346513136242 4.5577305909237005 4.555909809045131 4.555599411610624 4.5555465521473675 ;Value: 4.555537551999825
    </p>
    <p>
     10 раз.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.37
  </h2>
  <div>
   <div>
    <p>
     a. Бесконечная непрерывная дробь, выражение вида <span class="inline-formula"><img class="img-inline-formula img-formula" width="137" height="42" src="formulae/sjdXVLc6Vxzo8R25UmTxO.UuXfYfmoa9vN_8.Q.png" alt="f=\frac{N_1}{D_1+\frac{N_2}{D_2+\frac{N_3}{D_3+...}}}" title="f=\frac{N_1}{D_1+\frac{N_2}{D_2+\frac{N_3}{D_3+...}}}"></span>. В качестве примера можно показать что если для всех i <span class="inline-formula"><img class="img-inline-formula img-formula" width="51" height="14" src="formulae/a5St5HY2vJG2jaktUsvEtzVWFraPzgmbnMYF1g.png" alt="N_i=1" title="N_i=1"></span> <span class="inline-formula"><img class="img-inline-formula img-formula" width="52" height="14" src="formulae/bDp8GpJmdsEE0J6UTQXqXGylrL1NSnQeOKvqew.png" alt="D_i=1" title="D_i=1"></span>, то дробь будут равна <span class="inline-formula"><img class="img-inline-formula img-formula" width="28" height="17" src="formulae/jqoyPqGFD.741uy0dJ7pDnObupyLxw9ZqHDK_w.png" alt="1/\phi" title="1/\phi"></span>, где <span class="inline-formula"><img class="img-inline-formula img-formula" width="10" height="15" src="formulae/nnhzdqchKKCzaVcrUWETL.T75aNctBowFpJaFA.png" alt="\phi" title="\phi"></span> золотое сечение рассмотренное в упражнении 1.22. Один из способов приближенного вычисления такой дроби это отсечь дальнейшее деление при каком-то i=k. Такое усечение называется k-выраженная конечная непрерывная дробь. <span class="inline-formula"><img class="img-inline-formula img-formula" width="79" height="43" src="formulae/5YQQAqK.eBLHAcmk.ZOTVEMFDhO2rwHnTcpQRA.png" alt="\frac{N_1}{D_1+\frac{N_2}{...+\frac{N_k}{D_k}}}" title="\frac{N_1}{D_1+\frac{N_2}{...+\frac{N_k}{D_k}}}"></span>. Предположим что n и d процедуры одного аргумента (в терминах индекса i), которые возвращают <span class="inline-formula"><img class="img-inline-formula img-formula" width="20" height="14" src="formulae/sZiS..WGvCGhxZnDSGl5MdBWBV0bOes6DufUgQ.png" alt="N_i" title="N_i"></span> и <span class="inline-formula"><img class="img-inline-formula img-formula" width="20" height="14" src="formulae/E9O3WRQowdTN.EcibQkKJgNdUqBImg.3BViLZQ.png" alt="D_i" title="D_i"></span> в терминологии непрерывной дроби. Определите процедуру cont-frac так что выполнение (cont-frac n d k) вычисляет значение дроби усеченной по k. Проверьте вашу процедуру на приближенное вычисление <span class="inline-formula"><img class="img-inline-formula img-formula" width="28" height="17" src="formulae/jqoyPqGFD.741uy0dJ7pDnObupyLxw9ZqHDK_w.png" alt="1/\phi" title="1/\phi"></span> используя код
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="nf">cont-frac</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno">2 </span>           <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno">3 </span>           <span class="nv">k</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     b. Напишите рекурсивную и итеративную реализацию процедуры cont-frac.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cont-frac</span> <span class="nv">n</span> <span class="nv">d</span> <span class="nv">k</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">revert-index</span> <span class="nv">n</span> <span class="nv">d</span> <span class="nv">i</span><span class="p">)</span>
<span class="lineno"> 3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">i</span> <span class="nv">k</span><span class="p">)</span>
<span class="lineno"> 4 </span>        <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">n</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">d</span> <span class="nv">i</span><span class="p">)</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="lineno"> 5 </span>        <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">n</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">d</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nf">revert-index</span> <span class="nv">n</span> <span class="nv">d</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">i</span> <span class="mi">1</span><span class="p">))))))</span>
<span class="lineno"> 6 </span>  <span class="p">(</span><span class="nf">revert-index</span> <span class="nv">n</span> <span class="nv">d</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="p">(</span><span class="nf">cont-frac</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno"> 9 </span>           <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno">10 </span>           <span class="mi">100</span><span class="p">)</span> <span class="c1">;Value: .6180339887498948</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>
<span class="lineno">13 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cont-frac</span> <span class="nv">n</span> <span class="nv">d</span> <span class="nv">k</span><span class="p">)</span>
<span class="lineno">14 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">i</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno">15 </span>    <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">16 </span>    <span class="p">(</span><span class="nb">display </span><span class="nv">result</span><span class="p">)</span>
<span class="lineno">17 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">i</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">18 </span>        <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">n</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">d</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">result</span><span class="p">))</span>
<span class="lineno">19 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">n</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">d</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">result</span><span class="p">)))))</span>
<span class="lineno">20 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">k</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span><span class="p">(</span><span class="nf">cont-frac</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno">23 </span>           <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno">24 </span>           <span class="mi">100</span><span class="p">)</span> <span class="c1">;Value: .6180339887498948</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.38
  </h2>
  <div>
   <div>
    <p>
     В 1737 швейцарский математик Леонард Эйлер опубликовал мемуары De Fractionibus Continuis, которые содержали запись непрерывной дроби для e-2, где e - основание натурального логарифма. В этой дроби все Ni = 1, а Di соответственно 1, 2, 1, 1, 4, 1, 1, 6, 1, 1, 8, ... Напишите процедуру для приближенного вычисления e.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">e-approximation</span> <span class="nv">k</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nb">+ </span><span class="mi">2</span> <span class="p">(</span><span class="nf">cont-frac</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno"> 3 </span>                  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">i</span> <span class="mi">0</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno"> 4 </span>                               <span class="p">((</span><span class="nb">= </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span> <span class="mf">2.0</span><span class="p">)</span>
<span class="lineno"> 5 </span>                               <span class="p">((</span><span class="nb">&lt;= </span><span class="nv">i</span> <span class="mi">3</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno"> 6 </span>                               <span class="p">((</span><span class="nb">= </span><span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nb">- </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">3</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="mi">2</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">- </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">3</span><span class="p">)))</span>
<span class="lineno"> 7 </span>                               <span class="p">(</span><span class="k">else </span><span class="mf">1.0</span><span class="p">)))</span>
<span class="lineno"> 8 </span>                  <span class="nv">k</span><span class="p">)))</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="p">(</span><span class="nf">e-approximation</span> <span class="mi">100</span><span class="p">)</span> <span class="c1">;Value: 2.7208245385621153</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.39
  </h2>
  <div>
   <div>
    <p>
     Бесконечная дробь для тангенса была опубликована в 1970 немецким математиком Ламбертом. <span class="inline-formula"><img class="img-inline-formula img-formula" width="133" height="37" src="formulae/Kh3Tu0aZ5ik5TrqUeTNCTUfOTq2DBN23c_X9Qw.png" alt="\tan{x}=\frac{x}{1-\frac{x^2}{3-\frac{x^2}{5-...}}}" title="\tan{x}=\frac{x}{1-\frac{x^2}{3-\frac{x^2}{5-...}}}"></span>. Напишите процедуру для приближенного вычисления тангенса.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cont-frac-params</span> <span class="nv">n</span> <span class="nv">d</span> <span class="nv">k</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">i</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno"> 3 </span>    <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno"> 4 </span>    <span class="p">(</span><span class="nb">display </span><span class="nv">result</span><span class="p">)</span>
<span class="lineno"> 5 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">i</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno"> 6 </span>        <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">n</span> <span class="nv">i</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">d</span> <span class="nv">i</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">result</span><span class="p">))</span>
<span class="lineno"> 7 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">n</span> <span class="nv">i</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">d</span> <span class="nv">i</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">result</span><span class="p">)))))</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">k</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>
<span class="lineno">11 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tan-cf</span> <span class="nv">x</span> <span class="nv">k</span><span class="p">)</span>
<span class="lineno">12 </span>  <span class="p">(</span><span class="nf">cont-frac-params</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span> <span class="nv">j</span><span class="p">)</span> <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">i</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">j</span><span class="p">)</span>
<span class="lineno">13 </span>                          <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">square</span> <span class="nv">j</span><span class="p">))))</span>
<span class="lineno">14 </span>           <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="p">(</span><span class="nb">* </span><span class="mi">2</span> <span class="nv">i</span><span class="p">)))</span>
<span class="lineno">15 </span>           <span class="mi">100</span> <span class="nv">x</span><span class="p">))</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span><span class="p">(</span><span class="nf">tan-cf</span> <span class="mi">2</span> <span class="mi">100</span><span class="p">)</span><span class="c1">;Value: -2.185039863261519</span>
</pre>
</div>  </div>
 </div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-protsedury-vysshego-poriadka-uprazhneniia-129-133/" class="u-url">SICP Процедуры высшего порядка, упражнения 1.29-1.34</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-protsedury-vysshego-poriadka-uprazhneniia-129-133/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-14T12:43:07+03:00" itemprop="datePublished" title="2020-01-14 12:43">2020-01-14 12:43</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.29
  </h2>
  <div>
   <div>
    <p>
     Правило Симпсона более точный метод вычисления интеграла чем метод приведенный ранее в книге. По правилу Симпсона, интеграл функции f от а до b приблизительно равен <span class="inline-formula"><img class="img-inline-formula img-formula" width="344" height="21" src="formulae/ZEjhbtp2azXoWkeqy4AJ.bLxz0MqUj5y_JoL5g.png" alt="\frac{h}{3}[y_0+4y_1+2y_2+...+2y_{n-2}+4y_{n-1}+2y_n]" title="\frac{h}{3}[y_0+4y_1+2y_2+...+2y_{n-2}+4y_{n-1}+2y_n]"></span>, где h=(b-a)/n, <span class="inline-formula"><img class="img-inline-formula img-formula" width="114" height="17" src="formulae/fkSsmMh38xP3c4ajHM7Irs1jWJ1ViSftHhg2Ng.png" alt="y_k=f(a+kh)" title="y_k=f(a+kh)"></span>. Напишите процедуру вычисляющую интеграл по этому методу. Сравните результаты с предыдущим методом при n=100, n=1000.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sum-simpson</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span> <span class="nv">controln</span> <span class="nv">k</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 3 </span>      <span class="mi">0</span>
<span class="lineno"> 4 </span>      <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">controln</span> <span class="nv">k</span><span class="p">)(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">))</span>
<span class="lineno"> 5 </span>         <span class="p">(</span><span class="nf">sum-simpson</span> <span class="nv">term</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">next</span> <span class="nv">b</span> <span class="nv">controln</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">k</span> <span class="mi">1</span><span class="p">)))))</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">integral-simpson</span> <span class="nv">f</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">getdx</span> <span class="nv">start</span> <span class="nv">end</span> <span class="nv">steps</span><span class="p">)</span>
<span class="lineno"> 9 </span>    <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">- </span><span class="nv">end</span> <span class="nv">start</span><span class="p">)</span> <span class="nv">steps</span><span class="p">))</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">dx</span> <span class="p">(</span><span class="nf">getdx</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">n</span><span class="p">)))</span>
<span class="lineno">11 </span>    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">controln</span> <span class="nv">step-number</span><span class="p">)</span>
<span class="lineno">12 </span>      <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">step-number</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">13 </span>            <span class="p">((</span><span class="nb">even? </span><span class="nv">step-number</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
<span class="lineno">14 </span>            <span class="p">(</span><span class="k">else </span><span class="mi">4</span><span class="p">)))</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">next-a</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">17 </span>      <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">dx</span><span class="p">))</span>
<span class="lineno">18 </span>  <span class="c1">;; ;; (define (add-dx x) (+ x (getdx dx)))</span>
<span class="lineno">19 </span>    <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">sum-simpson</span> <span class="nv">f</span> <span class="nv">a</span> <span class="nv">next-a</span> <span class="nv">b</span> <span class="nv">controln</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">20 </span>       <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">getdx</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">n</span><span class="p">)</span> <span class="mi">3</span><span class="p">))</span>
<span class="lineno">21 </span>    <span class="p">))</span>
<span class="lineno">22 </span>
<span class="lineno">23 </span><span class="p">(</span><span class="nf">integral-simpson</span> <span class="nv">cube</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">100</span><span class="p">)</span><span class="c1">;;19/75 0.25333333333333335</span>
<span class="lineno">24 </span><span class="p">(</span><span class="nf">integral-simpson</span> <span class="nv">cube</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">1000</span><span class="p">)</span><span class="c1">;; 751/3000 0.25033333333333335</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.30
  </h2>
  <div>
   <div>
    <p>
     Процедура sum приведенная в книге генерирует линейную рекурсию. Процедуру можно переписать что бы сумма вычислялась итерациями. Покажите как это сделать.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sum</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="k">if </span><span class="nv">&lt;??&gt;</span>
<span class="lineno">4 </span>        <span class="nv">&lt;??&gt;</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="nv">&lt;??&gt;</span> <span class="nv">&lt;??&gt;</span><span class="p">)))</span>
<span class="lineno">6 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">&lt;??&gt;</span> <span class="nv">&lt;??&gt;</span><span class="p">))</span>
</pre>
</div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sum</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">4 </span>        <span class="nv">result</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">result</span> <span class="p">(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">)))))</span>
<span class="lineno">6 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno">7 </span><span class="p">(</span><span class="nf">sum</span> <span class="nv">identity</span> <span class="mi">1</span> <span class="nv">inc</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">; 15</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.31
  </h2>
  <div>
   <div>
    <p>
     a. Процедура sum является лишь простым примером из огромного числа подобных абстракций, которые могут быть сформулированы через процедуры высшего порядка. Напишите аналогичную процедуру product которая возвращает произведение значений функции в точках заданного интервала. Покажите как определить факториал через данную процедуру. Также используйте product для вычисления приближения <span class="inline-formula"><img class="img-inline-formula img-formula" width="10" height="7" src="formulae/pNnv.0JDiPStcnC_sVMLZXeu2Nqgm_VX3SQ9xw.png" alt="\pi" title="\pi"></span> используя формулу <span class="inline-formula"><img class="img-inline-formula img-formula" width="114" height="21" src="formulae/2U4YX2IBoqTMhJ80nyMI7JdFJpeeiyvd2Yp69g.png" alt="\frac{\pi}{4}=\frac{2\cdot4\cdot4\cdot6\cdot6\cdot8...}{3\cdot3\cdot5\cdot5\cdot7\cdot7...}" title="\frac{\pi}{4}=\frac{2\cdot4\cdot4\cdot6\cdot6\cdot8...}{3\cdot3\cdot5\cdot5\cdot7\cdot7...}"></span>.
    </p>
    <p>
     b. Если ваша процедура генерирует рекурсивный процесс, перепишите её на итерационный процесс.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">product</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 3 </span>      <span class="mi">1</span>
<span class="lineno"> 4 </span>      <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">)</span>
<span class="lineno"> 5 </span>         <span class="p">(</span><span class="nf">product</span> <span class="nv">term</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">))))</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">producti</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno"> 9 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">10 </span>        <span class="nv">result</span>
<span class="lineno">11 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">result</span> <span class="p">(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">)))))</span>
<span class="lineno">12 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="mi">1</span><span class="p">))</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">product-factorial</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">15 </span>  <span class="p">(</span><span class="nf">product</span> <span class="nv">identity</span> <span class="mi">1</span> <span class="nv">inc</span> <span class="mi">5</span><span class="p">))</span>
<span class="lineno">16 </span><span class="p">(</span><span class="nf">product-factorial</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">;; 120</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">multiplicate-pi</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">19 </span>  <span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">+ </span><span class="mi">4</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">5</span> <span class="nv">x</span><span class="p">))))</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">product-pi</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">22 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub-pi</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">23 </span>    <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nb">/ </span><span class="nv">x</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="mi">1</span><span class="p">))))</span>
<span class="lineno">24 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">next-x</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">25 </span>    <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno">26 </span>  <span class="p">(</span><span class="nb">* </span><span class="mi">4</span> <span class="p">(</span><span class="nf">product</span> <span class="nv">sub-pi</span> <span class="mi">2</span> <span class="nv">next-x</span> <span class="nv">n</span><span class="p">)))</span>
<span class="lineno">27 </span><span class="p">(</span><span class="nf">product-pi</span> <span class="mi">1000</span><span class="p">)</span> <span class="c1">; 3.1431607055322663</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.32
  </h2>
  <div>
   <div>
    <p>
     a. Покажите что процедуры sum и product оба являются частными случаями более общей нотации accumulate, которая объединяет набор терминов в более общую функцию.
    </p>
    <p>
     b. сделайте рекурсивный и итерационный вариант.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; рекурсивный</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">accumulate</span> <span class="nv">combiner</span> <span class="nv">null-value</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 3 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 4 </span>      <span class="nv">null-value</span>
<span class="lineno"> 5 </span>      <span class="p">(</span><span class="nf">combiner</span> <span class="p">(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">)</span>
<span class="lineno"> 6 </span>                <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">combiner</span> <span class="nv">null-value</span> <span class="nv">term</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">))))</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="c1">;; итерационный</span>
<span class="lineno"> 9 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">accumulate</span> <span class="nv">combiner</span> <span class="nv">null-value</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno">11 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">12 </span>      <span class="nv">result</span>
<span class="lineno">13 </span>      <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">combiner</span> <span class="nv">result</span> <span class="p">(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">)))))</span>
<span class="lineno">14 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="nv">null-value</span><span class="p">))</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">product</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">17 </span>  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">*</span> <span class="mi">1</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">))</span>
<span class="lineno">18 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sum</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">19 </span>  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">+</span> <span class="mi">0</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">))</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">accumulate-factorial</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">22 </span>  <span class="p">(</span><span class="nf">product</span> <span class="nv">identity</span> <span class="mi">1</span> <span class="nv">inc</span> <span class="mi">5</span><span class="p">))</span>
<span class="lineno">23 </span><span class="p">(</span><span class="nf">accumulate-factorial</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">; 120</span>
<span class="lineno">24 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">accumulate-sum</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">25 </span>  <span class="p">(</span><span class="nf">sum</span> <span class="nv">identity</span> <span class="nv">a</span> <span class="nv">inc</span> <span class="nv">b</span><span class="p">))</span>
<span class="lineno">26 </span><span class="p">(</span><span class="nf">accumulate-sum</span> <span class="mi">1</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">; 15</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.33
  </h2>
  <div>
   <div>
    <p>
     Вы можете получить еще более общую версию accumulate, введя понятие фильтра по слагаемым. То есть складывать (или перемножать) только те значения которые удовлетворяют заданному условию. Результирующая абстракция filtered-accumulate все те же параметры как и accumulate, плюс дополнительным предикатом одного аргумента, описывающим фильтр. Напишите процедуру filtered-accumulate. Покажите как выразить следующие понятия используя её.
    </p>
    <p>
     a. Сумма квадратов простых чисел в интервале от a до b. b. Перемножение всех положительных целых меньших чем n, которые взаимно простых с n (GCD (i,n) = 1)
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; рекурсивный</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">filtered-accumulate</span> <span class="nv">combiner</span> <span class="nv">null-value</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span> <span class="nv">filter</span><span class="p">)</span>
<span class="lineno"> 3 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 4 </span>      <span class="nv">null-value</span>
<span class="lineno"> 5 </span>      <span class="p">(</span><span class="nf">combiner</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">filter</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">null-value</span><span class="p">)</span>
<span class="lineno"> 6 </span>                <span class="p">(</span><span class="nf">filtered-accumulate</span> <span class="nv">combiner</span> <span class="nv">null-value</span> <span class="nv">term</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">next</span> <span class="nv">b</span> <span class="nv">filter</span><span class="p">))))</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="c1">;; итерационный</span>
<span class="lineno"> 9 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">filtered-accumulate</span> <span class="nv">combiner</span> <span class="nv">null-value</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span> <span class="nv">filter</span><span class="p">)</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno">11 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">12 </span>      <span class="nv">result</span>
<span class="lineno">13 </span>      <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">filter</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">14 </span>                         <span class="p">(</span><span class="nf">combiner</span> <span class="nv">result</span> <span class="p">(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">))</span>
<span class="lineno">15 </span>                         <span class="nv">result</span><span class="p">)</span>
<span class="lineno">16 </span>            <span class="p">)))</span>
<span class="lineno">17 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="nv">null-value</span><span class="p">))</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span>
<span class="lineno">20 </span><span class="c1">;; cумма квадратов целых в диапазоне</span>
<span class="lineno">21 </span><span class="c1">;; передаем в фильтр два параметра a b что бы работало абстракция со следующим примером</span>
<span class="lineno">22 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">filter-prime?</span> <span class="nv">x</span> <span class="nv">end</span><span class="p">)</span>
<span class="lineno">23 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">prime?</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">24 </span>      <span class="mi">1</span>
<span class="lineno">25 </span>      <span class="nv">false</span><span class="p">))</span>
<span class="lineno">26 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sum-square-primes</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">27 </span>  <span class="p">(</span><span class="nf">filtered-accumulate</span> <span class="nv">+</span> <span class="mi">0</span> <span class="nv">square</span> <span class="nv">a</span> <span class="nv">inc</span> <span class="nv">b</span> <span class="nv">filter-prime?</span><span class="p">))</span>
<span class="lineno">28 </span><span class="p">(</span><span class="nf">sum-square-primes</span> <span class="mi">1</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">; 14</span>
<span class="lineno">29 </span>
<span class="lineno">30 </span><span class="c1">;; перемножение всех взаимно простых с n в диапазоне [m n]</span>
<span class="lineno">31 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">filter-relative-prime?</span> <span class="nv">x</span> <span class="nv">end</span><span class="p">)</span>
<span class="lineno">32 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">gcd </span><span class="nv">x</span> <span class="nv">end</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">33 </span>      <span class="mi">1</span>
<span class="lineno">34 </span>      <span class="nv">false</span><span class="p">))</span>
<span class="lineno">35 </span>
<span class="lineno">36 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">product-relative-primes</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">37 </span>  <span class="p">(</span><span class="nf">filtered-accumulate</span> <span class="nv">*</span> <span class="mi">1</span> <span class="nv">identity</span> <span class="nv">a</span> <span class="nv">inc</span> <span class="nv">b</span> <span class="nv">filter-relative-prime?</span><span class="p">))</span>
<span class="lineno">38 </span><span class="p">(</span><span class="nf">product-relative-primes</span> <span class="mi">1</span> <span class="mi">6</span><span class="p">)</span><span class="c1">; 5</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.34
  </h2>
  <div>
   <div>
    <p>
     Предположим мы определили процедуру
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">f</span> <span class="nv">g</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nf">g</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno">3 </span><span class="p">(</span><span class="nf">f</span> <span class="nv">square</span><span class="p">)</span> <span class="c1">; 4</span>
<span class="lineno">4 </span><span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">z</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">z</span> <span class="mi">1</span><span class="p">))))</span> <span class="c1">; 6</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span><span class="p">(</span><span class="mi">2</span> <span class="mi">2</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     Что произойдет если вызвать (f f)?
    </p>
    <p>
     Происходит ошибка ;The object 2 is not applicable. Функция f ожидает в качестве параметра получить функцию которую можно вызвать, она его и получает и вызывает функцию f с параметром 2 (рекурсивно второй раз), и пытается выполнить функцию (2 2), на что и ругается интерпретатор, потому что 2 не процедура.
    </p>
   </div>
  </div>
 </div>
</div>
    </div>
    </article>
</div>
        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-1.html" rel="next">Старые записи</a>
            </li>
        </ul></nav></main><footer id="footer"><p>Contents © 2020         <a href="mailto:anton.s.pilipenko@gmail.com">Velikii Nehochuha</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
                <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
