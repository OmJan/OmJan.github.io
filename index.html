<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="ru">
<head>
<meta charset="utf-8">
<meta name="description" content="IT blog">
<meta name="viewport" content="width=device-width">
<title>VelikiiNehochuha Blog</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="ru" href="rss.xml">
<link rel="canonical" href="http://velikiinehochuha.github.io/">
<link rel="next" href="index-1.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link rel="prefetch" href="posts/sicp-224-primer-iazyk-izobrazhenii/" type="text/html">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Перейти к главному содержимому</a>
    <div id="container">
             <header id="header"><h1 id="brand"><a href="http://velikiinehochuha.github.io/" title="VelikiiNehochuha Blog" rel="home">

        <span id="blog-title">VelikiiNehochuha Blog</span>
    </a></h1>

        
            <nav id="menu"><ul>
<li><a href="archive.html">Архив</a></li>
                <li><a href="categories/">Тэги</a></li>
                <li><a href="rss.xml">RSS лента</a></li>

    
    
    
    </ul></nav></header><main id="content"><div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-224-primer-iazyk-izobrazhenii/" class="u-url">SICP 2.2.4 Пример: Язык изображений.</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-224-primer-iazyk-izobrazhenii/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-21T21:12:26+03:00" itemprop="datePublished" title="2020-01-21 21:12">2020-01-21 21:12</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org6859af3" class="outline-2">
<h2 id="org6859af3">Упражнение 2.44.</h2>
<div class="outline-text-2" id="text-org6859af3">
<p>
Определите процедуру up-split используемую в corner-split.
</p>

<p>
<img src="images/up-split-einstein.png" alt="nil"></p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">up-split</span> <span class="nv">painter</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">painter</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">smaller</span> <span class="p">(</span><span class="nf">up-split</span> <span class="nv">painter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))))</span>
	<span class="p">(</span><span class="nf">below</span> <span class="nv">painter</span> <span class="p">(</span><span class="nf">beside</span> <span class="nv">smaller</span> <span class="nv">smaller</span><span class="p">)))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org42bdc83" class="outline-2">
<h2 id="org42bdc83">Упражнение 2.45.</h2>
<div class="outline-text-2" id="text-org42bdc83">
<p>
Определите процедуру обобщение up-split right-split.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">split</span> <span class="nv">fs</span> <span class="nv">ss</span><span class="p">)</span>
  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">painter,</span> <span class="nv">n</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nv">painter</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">smaller</span> <span class="p">((</span><span class="nf">split</span> <span class="nv">fs</span> <span class="nv">ss</span><span class="p">)</span> <span class="nv">painter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))))</span>
	  <span class="p">(</span><span class="nf">fs</span> <span class="nv">painter</span> <span class="p">(</span><span class="nf">ss</span> <span class="nv">smaller</span> <span class="nv">smaller</span><span class="p">))))))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">right-split</span> <span class="p">(</span><span class="nf">split</span> <span class="nv">beside</span> <span class="nv">below</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">up-split</span> <span class="p">(</span><span class="nf">split</span> <span class="nv">below</span> <span class="nv">beside</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org7875ebc" class="outline-2">
<h2 id="org7875ebc">Упражнение 2.46</h2>
<div class="outline-text-2" id="text-org7875ebc">
<p>
Двумерный вектор v проведенный из точки отсчета в некоторую точку может быть представлен как пара координат x и y. Реализуйте абстракцию для векторов задав конструктор make-vect и соответствующие селекторы xcor-vect, ycor-vect. Реализуйте процедуры add-vect, sub-vect и scale-vect, которые выполняют операции над вектором.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-vect</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="nv">v</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cdr </span><span class="nv">v</span><span class="p">))</span>
<span class="p">(</span><span class="nf">ycor-vect</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-vect</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-vect</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v2</span><span class="p">))</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v2</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub-vect</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-vect</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v2</span><span class="p">))</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v2</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">scale-vect</span> <span class="nv">v</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-vect</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v</span><span class="p">)</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v</span><span class="p">)</span> <span class="nv">n</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org57b4585" class="outline-2">
<h2 id="org57b4585">Упражнение 2.47</h2>
<div class="outline-text-2" id="text-org57b4585">
<p>
Здесь две возможных конструктора для фреймов:
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-frame</span> <span class="nv">origin</span> <span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list </span><span class="nv">origin</span> <span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-frame</span> <span class="nv">origin</span> <span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="nv">origin</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">)))</span>
</pre></div>

<p>
Для каждого конструктора укажите соответствующие селекторы что бы реализовать процедуры для фреймов.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">origin-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="nv">frame</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge1-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">card</span> <span class="nv">frame</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge1-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">card</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">frame</span><span class="p">)))</span>

<span class="c1">;; 2</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">origin-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="nv">frame</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge1-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">frame</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge1-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">frame</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org4fd628a" class="outline-2">
<h2 id="org4fd628a">Упражнение 2.48</h2>
<div class="outline-text-2" id="text-org4fd628a">
<p>
Сегмент направленной линии на плоскости может быть представлен в виде пары векторов: вектор идущий от начала координат до начальной точки сегмента и вектор идущий от начала координат до конечной точки сегмента. Используя векторное представление из 2.46 что бы определить представление для сегментов с конструктором make-segment и селекторами start-segment, end-segment.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-segment</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">start-segment</span> <span class="nv">seg</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="nv">seg</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">end-segment</span> <span class="nv">seg</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cdr </span><span class="nv">seg</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgc99297d" class="outline-2">
<h2 id="orgc99297d">Упражнение 2.49</h2>
<div class="outline-text-2" id="text-orgc99297d">
<p>
Используя segments-&gt;painter определите следующие процедуры
a. Нарисовать контур обозначенной рамки.
b. Нарисовать Х соединяющий противоположные углы рамки.
c. Нарисовать ромбовидную форму соединяющую центры рамки.
d. Нарисовать волну.
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">for-each </span><span class="nv">proc</span> <span class="nv">items</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">proc</span> <span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">for-each </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)))</span>
  <span class="nv">true</span><span class="p">)</span>
<span class="c1">;; frame</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-frame</span> <span class="nv">origin</span> <span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list </span><span class="nv">origin</span> <span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">origin-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="nv">frame</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge1-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">card</span> <span class="nv">frame</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge2-frame</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">card</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">frame</span><span class="p">)))</span>

<span class="c1">;; segment</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-segment</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">start-segment</span> <span class="nv">seg</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="nv">seg</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">end-segment</span> <span class="nv">seg</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cdr </span><span class="nv">seg</span><span class="p">))</span>

<span class="c1">;; vector</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-vect</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">car </span><span class="nv">v</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cdr </span><span class="nv">v</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-vect</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-vect</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v2</span><span class="p">))</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v2</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub-vect</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-vect</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v2</span><span class="p">))</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v2</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">scale-vect</span> <span class="nv">v</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">make-vect</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v</span><span class="p">)</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v</span><span class="p">)</span> <span class="nv">n</span><span class="p">)))</span>

<span class="c1">;; a</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">segments-&gt;painter</span> <span class="nv">segment-list</span><span class="p">)</span>
  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">frame</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">for-each</span>
     <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">segment</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">draw-line</span>
	<span class="p">((</span><span class="nf">frame-coord-map</span> <span class="nv">frame</span><span class="p">)</span> <span class="p">(</span><span class="nf">start-segment</span> <span class="nv">segment</span><span class="p">))</span>
	<span class="p">((</span><span class="nf">frame-coord-map</span> <span class="nv">frame</span><span class="p">)</span> <span class="p">(</span><span class="nf">end-segment</span> <span class="nv">segment</span><span class="p">))))</span>
     <span class="nv">segment-list</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">frame1</span> <span class="p">(</span><span class="nf">make-frame</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">segment-list-a</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">))</span>
			    <span class="p">))</span>

<span class="p">((</span><span class="nf">segments-&gt;painter</span> <span class="nv">segment-list-a</span><span class="p">)</span> <span class="nv">frame1</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">segment-list-b</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">))</span>
			    <span class="p">))</span>

<span class="p">((</span><span class="nf">segments-&gt;painter</span> <span class="nv">segment-list-b</span><span class="p">)</span> <span class="nv">frame1</span><span class="p">)</span>


<span class="p">(</span><span class="k">define </span><span class="nv">segment-list-c</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.5</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mf">0.5</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="mf">0.5</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.5</span> <span class="mi">1</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.5</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mf">0.5</span><span class="p">))</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="mf">0.5</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.5</span> <span class="mi">0</span><span class="p">))</span>
			    <span class="p">))</span>

<span class="p">((</span><span class="nf">segments-&gt;painter</span> <span class="nv">segment-list-c</span><span class="p">)</span> <span class="nv">frame1</span><span class="p">)</span>


<span class="p">(</span><span class="k">define </span><span class="nv">segment-list-d</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">25</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">35</span> <span class="o">.</span><span class="mi">5</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">35</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">3</span> <span class="o">.</span><span class="mi">6</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">3</span> <span class="o">.</span><span class="mi">6</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">15</span> <span class="o">.</span><span class="mi">4</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">15</span> <span class="o">.</span><span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="o">.</span><span class="mi">65</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="o">.</span><span class="mi">65</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="o">.</span><span class="mi">85</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">0</span> <span class="o">.</span><span class="mi">85</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">15</span> <span class="o">.</span><span class="mi">6</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">15</span> <span class="o">.</span><span class="mi">6</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">3</span> <span class="o">.</span><span class="mi">65</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">3</span> <span class="o">.</span><span class="mi">65</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">4</span> <span class="o">.</span><span class="mi">65</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">4</span> <span class="o">.</span><span class="mi">65</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">35</span> <span class="o">.</span><span class="mi">85</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">35</span> <span class="o">.</span><span class="mi">85</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">4</span> <span class="mi">1</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">4</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="mi">1</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">65</span> <span class="o">.</span><span class="mi">85</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">65</span> <span class="o">.</span><span class="mi">85</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="o">.</span><span class="mi">65</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="o">.</span><span class="mi">65</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">75</span> <span class="o">.</span><span class="mi">65</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">75</span> <span class="o">.</span><span class="mi">65</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="o">.</span><span class="mi">35</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="o">.</span><span class="mi">35</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="o">.</span><span class="mi">15</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mi">1</span> <span class="o">.</span><span class="mi">15</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="o">.</span><span class="mi">45</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="o">.</span><span class="mi">45</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">75</span> <span class="mi">0</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">75</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="mi">0</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">6</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">5</span> <span class="o">.</span><span class="mi">3</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">5</span> <span class="o">.</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">4</span> <span class="mi">0</span><span class="p">))</span>
			     <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">4</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">25</span> <span class="mi">0</span><span class="p">))</span>
			     <span class="p">))</span>

<span class="p">((</span><span class="nf">segments-&gt;painter</span> <span class="nv">segment-list-d</span><span class="p">)</span> <span class="nv">frame1</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org2b39407" class="outline-2">
<h2 id="org2b39407">Упражнение 2.50</h2>
<div class="outline-text-2" id="text-org2b39407">
<p>
Определите процедуру flip-horiz и трансформации которые вращают изображения против часовой стрелки на 180 и 270 градусов.
</p>


<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">flip-horiz</span> <span class="nv">painter</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">transform-painter</span> <span class="nv">painter</span>
		     <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="o">.</span><span class="mi">0</span><span class="p">)</span>
		     <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">0</span> <span class="o">.</span><span class="mi">0</span><span class="p">)</span>
		     <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">1.0</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">repeated</span> <span class="nv">f</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span><span class="p">))</span>
      <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="p">((</span><span class="nf">repeated</span> <span class="nv">f</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))</span> <span class="nv">x</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rotate90</span> <span class="nv">painter</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">transform-painter</span> <span class="nv">painter</span>
		     <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">0.0</span><span class="p">)</span>
		     <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">1.0</span><span class="p">)</span>
		     <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">0.0</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rotate270</span> <span class="nv">painter</span><span class="p">)</span>
  <span class="p">((</span><span class="nf">repeated</span> <span class="nv">rotate90</span> <span class="mi">3</span><span class="p">)</span> <span class="nv">painter</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rotate180</span> <span class="nv">painter</span><span class="p">)</span>
  <span class="p">((</span><span class="nf">repeated</span> <span class="nv">rotate90</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">painter</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgcf03c30" class="outline-2">
<h2 id="orgcf03c30">Упражнение 2.51</h2>
<div class="outline-text-2" id="text-orgcf03c30">
<p>
Определите процедуру below. Как аналог beside и второй раз через beside и подходящие трасформации.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">below</span> <span class="nv">painter1</span> <span class="nv">painter2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">split-point</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">0.5</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">paint-bottom</span>
	   <span class="p">(</span><span class="nf">transform-painter</span> <span class="nv">painter1</span>
			      <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">0.0</span><span class="p">)</span>
			      <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">0.0</span><span class="p">)</span>
			      <span class="nv">split-point</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">paint-top</span>
	   <span class="p">(</span><span class="nf">transform-painter</span> <span class="nv">painter2</span>
			      <span class="nv">split-point</span>
			      <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">0.5</span><span class="p">)</span>
			      <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">1.0</span><span class="p">))))</span>
      <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">frame</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">paint-bottom</span> <span class="nv">frame</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">paint-top</span> <span class="nv">frame</span><span class="p">)))))</span>


<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">below-2</span> <span class="nv">painter1</span> <span class="nv">painter2</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">rotate270</span> <span class="p">(</span><span class="nf">beside</span> <span class="nv">painter1</span> <span class="nv">painter2</span><span class="p">)))</span>
</pre></div>
</div>
</div>


<div id="outline-container-orgd82b7bc" class="outline-2">
<h2 id="orgd82b7bc">Упражнение 2.52</h2>
<div class="outline-text-2" id="text-orgd82b7bc">
<p>
Внесите изменение в square-limit на разных уровнях абстракции
а. Добавьте какие-нибудь сегменты к примитиву wave.
</p>

<div class="highlight"><pre><span></span><span class="c1">;; тут просто добавляем в список элементов пару сегментов</span>
<span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">5</span> <span class="o">.</span><span class="mi">75</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">5</span> <span class="o">.</span><span class="mi">77</span><span class="p">))</span>
<span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">45</span> <span class="o">.</span><span class="mi">75</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="o">.</span><span class="mi">55</span> <span class="o">.</span><span class="mi">75</span><span class="p">))</span>
</pre></div>

<p>
б. измените corner-split (к примеру используя только одну копию up-split и right-split вместо двух).
</p>

<div class="highlight"><pre><span></span><span class="c1">;; тут просто редактируем функцию corner-split</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">corner-split</span> <span class="nv">painter</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nv">painter</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">up</span> <span class="p">(</span><span class="nf">up-split</span> <span class="nv">painter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)))</span>
	    <span class="p">(</span><span class="nf">right</span> <span class="p">(</span><span class="nf">right-split</span> <span class="nv">painter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))))</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">top-left</span> <span class="p">(</span><span class="nf">beside</span> <span class="nv">up</span> <span class="nv">up</span><span class="p">))</span>
	      <span class="p">(</span><span class="nf">bottom-right</span> <span class="p">(</span><span class="nf">below</span> <span class="nv">right</span> <span class="nv">right</span><span class="p">))</span>
	      <span class="p">(</span><span class="nf">corner</span> <span class="p">(</span><span class="nf">corner-split</span> <span class="nv">painter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))))</span>
	  <span class="p">(</span><span class="nf">beside</span> <span class="p">(</span><span class="nf">below</span> <span class="nv">painter</span> <span class="nv">top-left</span><span class="p">)</span>
		  <span class="p">(</span><span class="nf">below</span> <span class="nv">painter</span> <span class="nv">corner</span><span class="p">))))))</span>
</pre></div>
<p>
в. измените square-limit, что бы собрать углы по другому шаблону
</p>

<div class="highlight"><pre><span></span><span class="c1">;; тут просто редактируем функцию square-limit</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-limit</span> <span class="nv">painter</span> <span class="nv">n</span><span class="p">)</span>
   <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">combine4</span> <span class="p">(</span><span class="nf">square-of-four</span> <span class="nv">flip-vert</span> <span class="nv">rotate180</span>
				   <span class="nv">identity</span> <span class="nv">flip-horiz</span><span class="p">)))</span>
     <span class="p">(</span><span class="nf">combine4</span> <span class="p">(</span><span class="nf">corner-split</span> <span class="nv">painter</span> <span class="nv">n</span><span class="p">))))</span>
</pre></div>

<p>
пример программы показывает что мы делаем редактирование только на одном из уровней абстракций.
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-223-posledovatelnosti-kak-obobshchaiushchie-interfeisy/" class="u-url">SICP 2.2.3 Последовательности как обобщающие интерфейсы.</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-223-posledovatelnosti-kak-obobshchaiushchie-interfeisy/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-20T14:08:28+03:00" itemprop="datePublished" title="2020-01-20 14:08">2020-01-20 14:08</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
<img src="images/ch2-Z-G-17.gif" alt="nil"></p>


<div id="outline-container-org23e2d63" class="outline-2">
<h2 id="org23e2d63">Упражнение 2.33</h2>
<div class="outline-text-2" id="text-org23e2d63">
<p>
Заполните недостающие выражения, чтобы завершить определения некоторых основных операций над списками через накопление.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">map </span><span class="nv">p</span> <span class="nv">sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">&lt;??&gt;</span><span class="p">)</span> <span class="nv">nil</span> <span class="nv">sequence</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">append </span><span class="nv">seq1</span> <span class="nv">seq2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">cons</span> <span class="nv">&lt;??&gt;</span> <span class="nv">&lt;??&gt;</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">length </span><span class="nv">sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">&lt;??&gt;</span> <span class="mi">0</span> <span class="nv">sequence</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">map </span><span class="nv">p</span> <span class="nv">sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">p</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">y</span><span class="p">))</span> <span class="nv">nil</span> <span class="nv">sequence</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">append </span><span class="nv">seq1</span> <span class="nv">seq2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">cons</span> <span class="nv">seq2</span> <span class="nv">seq1</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">length </span><span class="nv">sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="nv">y</span><span class="p">))</span> <span class="mi">0</span> <span class="nv">sequence</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org37a2dff" class="outline-2">
<h2 id="org37a2dff">Упражнение 2.34</h2>
<div class="outline-text-2" id="text-org37a2dff">
<p>
Оценка полинома от одной переменной x в заданной точке, может быть сформулирована в терминах накопления. Мы оцениваем полином
\(a_nx^n+a_{n-1}x^{n-1}+...+a_1x+a_0x\) используя широко известный алгоритм - правило Хорнера, который структурирует вычисление как \((...(a_nx+a_{n-1})x+...+a_1)x + a_0\).
</p>

<p>
Другими словами начиная с a<sub>n</sub> умноженного на x, добавляем a<sub>n-1</sub>, умножаем на x и так далее, пока не достигаем a<sub>0</sub>. Заполните шаблон что бы закончить процедуру вычисления полинома, предполагая что коэффициенты полинома заданы списком.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">horner-eval</span> <span class="nv">x</span> <span class="nv">coefficient-sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">this-coeff</span> <span class="nv">higher-terms</span><span class="p">)</span> <span class="nv">&lt;??&gt;</span><span class="p">)</span>
	      <span class="mi">0</span>
	      <span class="nv">coefficient-sequence</span><span class="p">))</span>
<span class="p">(</span><span class="nf">horner-eval</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">5</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">horner-eval</span> <span class="nv">x</span> <span class="nv">coefficient-sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">this-coeff</span> <span class="nv">higher-terms</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">this-coeff</span> <span class="p">(</span><span class="nb">* </span><span class="nv">x</span> <span class="nv">higher-terms</span><span class="p">)))</span>
	      <span class="mi">0</span>
	      <span class="nv">coefficient-sequence</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org6f235f0" class="outline-2">
<h2 id="org6f235f0">Упражнение 2.35</h2>
<div class="outline-text-2" id="text-org6f235f0">
<p>
Переопределите count-leaves из секции 2.2.2 через накопление.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">count-leaves</span> <span class="nv">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">&lt;??&gt;</span> <span class="nv">&lt;??&gt;</span> <span class="p">(</span><span class="nb">map </span><span class="nv">&lt;??&gt;</span> <span class="nv">&lt;??&gt;</span><span class="p">)))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">count-leaves</span> <span class="nv">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">+</span> <span class="mi">0</span>
	      <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">sub-tree</span><span class="p">)</span>
		     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">sub-tree</span><span class="p">)</span>
			 <span class="p">(</span><span class="nf">count-leaves</span> <span class="nv">sub-tree</span><span class="p">)</span>
			 <span class="mi">1</span><span class="p">))</span> <span class="nv">t</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org14dc452" class="outline-2">
<h2 id="org14dc452">Упражнение 2.36</h2>
<div class="outline-text-2" id="text-org14dc452">
<p>
Процедура accumulate-n похожа на accumulate, но принимает третий аргумент последовательность последовательностей. Предполагается что все они имеют одинаковое количество аргументов. Она применяет назначенную процедуру накопления для всех первых элементов последовательности, всех вторых и так далее. И возвращает последовательность результатов. К примеру результат (accumulate-n + 0 s), где s это ((1 2 3) (4 5 6) (7 8 9) (10 11 12)), будет равен (22 26 30). Заполните пропуски в определении процедуры.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">accumulate-n</span> <span class="nv">op</span> <span class="nv">init</span> <span class="nv">seqs</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="p">(</span><span class="nb">car </span><span class="nv">seqs</span><span class="p">))</span>
      <span class="nv">nil</span>
      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">accumulate</span> <span class="nv">op</span> <span class="nv">init</span> <span class="nv">&lt;??&gt;</span><span class="p">)</span>
	    <span class="p">(</span><span class="nf">accumulate-n</span> <span class="nv">op</span> <span class="nv">init</span> <span class="nv">&lt;??&gt;</span><span class="p">))))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">accumulate-n</span> <span class="nv">op</span> <span class="nv">init</span> <span class="nv">seqs</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="p">(</span><span class="nb">car </span><span class="nv">seqs</span><span class="p">))</span>
      <span class="nv">nil</span>
      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">accumulate</span> <span class="nv">op</span> <span class="nv">init</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">seq</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">seq</span><span class="p">))</span> <span class="nv">seqs</span><span class="p">))</span>
	    <span class="p">(</span><span class="nf">accumulate-n</span> <span class="nv">op</span> <span class="nv">init</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">seq</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">seq</span><span class="p">))</span> <span class="nv">seqs</span><span class="p">)))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0dda79f" class="outline-2">
<h2 id="org0dda79f">Упражнение 2.37</h2>
<div class="outline-text-2" id="text-org0dda79f">
<p>
Предположим мы представляем векторы v = (v<sub>i</sub>) как последовательность чисел и матрицы m =(m<sub>ij</sub>) как последовательность векторов (строки матрицы). К примеру матрица:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="org-left"></colgroup>
<tbody>
<tr>
<td class="org-left">1 2 3 4</td>
</tr>
<tr>
<td class="org-left">4 5 6 7</td>
</tr>
<tr>
<td class="org-left">6 7 8 9</td>
</tr>
</tbody>
</table>
<p>
представлена как последовательность ((1 2 3 4) (4 5 6 6) (6 7 8 9)).
C этим представлением мы можем использовать последовательности операций чтобы выразить основные операции на матрицей и вектором. Эти операции (которые описаны в любой книжке по алгебре) следующие:
</p>

<p>
(dot-product v w)
(matrix-<b>-vector m v)
(matrix-</b>-matrix m n)
(transpose m) ;; вернет матрицу n, где n<sub>ij</sub> = m<sub>ji</sub></p>


<p>
Мы можем определить dot-product как (map - стандартный из scheme):
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">dot-product</span> <span class="nv">v</span> <span class="nv">w</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">+</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">map </span><span class="nv">*</span> <span class="nv">v</span> <span class="nv">w</span><span class="p">)))</span>
</pre></div>

<p>
Заполните недостающие места в следующих процедурах для остальных операций над матрицами. (Процедура accumulate-n определена в упражнении 2.36)
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">matrix-*-vector</span> <span class="nv">m</span> <span class="nv">v</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">w</span><span class="p">)</span> <span class="p">(</span><span class="nf">dot-product</span> <span class="nv">w</span> <span class="nv">v</span><span class="p">))</span> <span class="nv">m</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">transpose</span> <span class="nv">mat</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">accumulate-n</span> <span class="nv">cons</span> <span class="p">()</span> <span class="nv">mat</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">matrix-*-matrix</span> <span class="nv">m</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">cols</span> <span class="p">(</span><span class="nf">transpose</span> <span class="nv">n</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">row</span><span class="p">)</span> <span class="p">(</span><span class="nf">matrix-*-vector</span> <span class="nv">cols</span> <span class="nv">row</span><span class="p">))</span> <span class="nv">m</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgfa00fb8" class="outline-2">
<h2 id="orgfa00fb8">Упражнение 2.38</h2>
<div class="outline-text-2" id="text-orgfa00fb8">
<p>
Процедура accumulate так же известна как fold-right, потому что она объединяет первый элемент последовательности с результатами объединения всех элементов справа. Также есть fold-left, которая объединяет элементы в обратном направлении.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fold-left</span> <span class="nv">op</span> <span class="nv">initial</span> <span class="nv">sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">result</span> <span class="nv">rest</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">rest</span><span class="p">)</span>
	<span class="nv">result</span>
	<span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">result</span> <span class="p">(</span><span class="nb">car </span><span class="nv">rest</span><span class="p">))</span>
	      <span class="p">(</span><span class="nb">cdr </span><span class="nv">rest</span><span class="p">))))</span>
  <span class="p">(</span><span class="nf">iter</span> <span class="nv">initial</span> <span class="nv">sequence</span><span class="p">))</span>

<span class="c1">;; Каковы значения выражений?</span>
<span class="p">(</span><span class="nf">fold-right</span> <span class="nv">/</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span> <span class="c1">;; 3/2</span>
<span class="p">(</span><span class="nf">fold-left</span> <span class="nv">/</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span> <span class="c1">;;  1/6</span>
<span class="p">(</span><span class="nf">fold-right</span> <span class="nv">list</span> <span class="nv">nil</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span><span class="c1">;; (list 1 (list 2 ( list 3 ())))</span>
<span class="p">(</span><span class="nf">fold-left</span> <span class="nv">list</span> <span class="nv">nil</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span> <span class="c1">;; (list (list (list () 1) 2) 3)</span>
</pre></div>

<p>
Каким свойством должен обладать op что бы fold-right, fold-left были одинаковыми? Коммутативность и ассоциативность.
</p>
</div>
</div>

<div id="outline-container-orgad7e9a9" class="outline-2">
<h2 id="orgad7e9a9">Упражнение 2.39</h2>
<div class="outline-text-2" id="text-orgad7e9a9">
<p>
Дайте определение reverse через fold-right и fold-left.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">reverse </span><span class="nv">sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">fold-right</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">first</span> <span class="nv">part-reversed</span><span class="p">)</span> <span class="p">(</span><span class="nb">append </span><span class="nv">part-reversed</span> <span class="p">(</span><span class="nb">list </span><span class="nv">first</span><span class="p">)))</span> <span class="nv">nil</span> <span class="nv">sequence</span><span class="p">))</span>
<span class="p">(</span><span class="nb">reverse </span><span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">reverse </span><span class="nv">sequence</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">fold-left</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">result</span> <span class="nv">last</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">last</span> <span class="nv">result</span><span class="p">))</span> <span class="nv">nil</span> <span class="nv">sequence</span><span class="p">))</span>
</pre></div>
</div>
</div>


<div id="outline-container-orgda7a431" class="outline-2">
<h2 id="orgda7a431">Упражнение 2.40</h2>
<div class="outline-text-2" id="text-orgda7a431">
<p>
Определите процедуру unique-pairs, которая принимая целое n, генерирует последовательность пар (i,j) 1&lt;=j&lt;i&lt;=n. Используя процедуру unique-pairs упростите определение prime-sum-pairs, приведенное в книге.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">unique-pairs</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">flatmap</span>
   <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">j</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">i</span> <span class="nv">j</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">- </span><span class="nv">i</span> <span class="mi">1</span><span class="p">))))</span>
   <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="nv">n</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">prime-sum-pairs</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">map </span><span class="nv">make-pair-sum</span>
       <span class="p">(</span><span class="nf">filter</span> <span class="nv">prime-sum?</span>
	       <span class="p">(</span><span class="nf">unique-pairs</span> <span class="nv">n</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">prime-sum-pairs</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgfeb817f" class="outline-2">
<h2 id="orgfeb817f">Упражнение 2.41</h2>
<div class="outline-text-2" id="text-orgfeb817f">
<p>
Напишите процедуру, чтобы найти все упорядоченные тройки различных положительных целых чисел i, j, k, меньших или равных заданному числу n, сумма которых равна заданному числу S.
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">not-end-with-1?</span> <span class="nv">pair</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">cadr </span><span class="nv">pair</span><span class="p">)</span> <span class="mi">1</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">uniq-3</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">flatmap</span>
   <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">pair</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">k</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">car </span><span class="nv">pair</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">pair</span><span class="p">)</span> <span class="nv">k</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">cadr </span><span class="nv">pair</span><span class="p">)</span> <span class="mi">1</span><span class="p">))))</span>
   <span class="p">(</span><span class="nf">filter</span> <span class="nv">not-end-with-1?</span> <span class="p">(</span><span class="nf">unique-pairs</span> <span class="nv">n</span><span class="p">))))</span>


<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">uniq-tuples-m</span> <span class="nv">n</span> <span class="nv">m</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">&lt; </span><span class="nv">n</span> <span class="nv">m</span><span class="p">)</span> <span class="nv">nil</span><span class="p">)</span>
	<span class="p">((</span><span class="nb">= </span><span class="nv">m</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">map </span><span class="nv">list</span> <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="nv">n</span><span class="p">)))</span>
	<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">flatmap</span>
	       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">tuple</span><span class="p">)</span>
		 <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">k</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">k</span> <span class="nv">tuple</span><span class="p">))</span>
		      <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">car </span><span class="nv">tuple</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">n</span><span class="p">)))</span>
	       <span class="p">(</span><span class="nf">uniq-tuples-m</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">- </span><span class="nv">m</span> <span class="mi">1</span><span class="p">))))))</span>

<span class="p">(</span><span class="nf">uniq-tuples-m</span> <span class="mi">5</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgec672b8" class="outline-2">
<h2 id="orgec672b8">Упражнение 2.42</h2>
<div class="outline-text-2" id="text-orgec672b8">
<p>
Задача о восьми ферзях. Как разместить 8 ферзей на шахматной доске, что бы не один ферзь не бил другого. Одно из возможных решений представлено на картинке.
</p>

<p>
<img src="images/ch2-Z-G-23.gif" alt="nil"></p>

<p>
Один способ решения ставим первого ферзя на любую клетку доски. Остальные k-1 ферзей мы должны расставить так что бы они не шаховали друг друга. Можно сформулировать этот подход рекурсивно. Предположим мы уже сгенерировали всех возможных способов расстановки k-1 ферзей в первых k-1 столбцах доски. Для каждого из этих способов генерируем дополнительный набор позиций размещая ферзя в каждой строчке k-ой колонки. Теперь отфильтруем их оставляя только позиции в которых ферзь не атакован другими. Это даст все возможные расположения k ферзей в первых k колонках. Продолжая этот процесс мы получим решения головоломки.
</p>

<p>
Мы записали эту процедуру под именем queens. Она возвращает список всех решений для досок n x n. Она содержит внутреннюю процедуру queen-cols, которая возвращает список всех способов разместить ферзей на первых k колонках доски.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">queens</span> <span class="nv">board-size</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">queen-cols</span> <span class="nv">k</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">k</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list </span><span class="nv">empty-board</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">filter</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">positions</span><span class="p">)</span> <span class="p">(</span><span class="nf">safe?</span> <span class="nv">k</span> <span class="nv">positions</span><span class="p">))</span>
	 <span class="p">(</span><span class="nf">flatmap</span>
	  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">rest-of-queens</span><span class="p">)</span>
	    <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">new-row</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">adjoin-position</span> <span class="nv">new-row</span> <span class="nv">k</span> <span class="nv">rest-of-queens</span><span class="p">))</span>
		 <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="nv">board-size</span><span class="p">)))</span>
	  <span class="p">(</span><span class="nf">queen-cols</span> <span class="p">(</span><span class="nb">- </span><span class="nv">k</span> <span class="mi">1</span><span class="p">))))))</span>
  <span class="p">(</span><span class="nf">queen-cols</span> <span class="nv">board-size</span><span class="p">))</span>
</pre></div>

<p>
rest-of-queens - способ разместить k -1 ферзей в первых k - 1 колонках и new-row - строчка в которой надо поместить ферзя в k-ой колонке.
Завершите программу реализовав представление позиций, включая adjoin-position, которая добавляет новую позицию к существующим позициям, и empty-set - пустой список позиций. Также нужно написать процедуру safe?.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">define </span><span class="nv">empty-board</span> <span class="p">())</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">adjoin-position</span> <span class="nv">new-row</span> <span class="nv">k</span> <span class="nv">rest-of-queens</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="nv">new-row</span> <span class="nv">rest-of-queens</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">include-row?</span> <span class="nv">item</span> <span class="nv">positions</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">positions</span><span class="p">)</span>
      <span class="nv">false</span>
      <span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nb">= </span><span class="nv">item</span> <span class="p">(</span><span class="nb">car </span><span class="nv">positions</span><span class="p">))</span> <span class="p">(</span><span class="nf">include?</span> <span class="nv">item</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">positions</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">include-diagonale?</span> <span class="nv">item</span> <span class="nv">positions</span> <span class="nv">k</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">positive</span> <span class="nv">item</span> <span class="nv">positions</span> <span class="nv">k</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">positions</span><span class="p">)</span>
	<span class="nv">false</span>
	<span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">+ </span><span class="nv">item</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">positions</span><span class="p">))</span> <span class="p">(</span><span class="nf">positive</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">item</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">positions</span><span class="p">)</span> <span class="nv">k</span><span class="p">))</span>
	<span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">negative</span> <span class="nv">item</span> <span class="nv">positions</span> <span class="nv">k</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nb">null? </span><span class="nv">positions</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">- </span><span class="nv">item</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">1</span><span class="p">))</span>
	<span class="nv">false</span>
	<span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">- </span><span class="nv">item</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">positions</span><span class="p">))</span> <span class="p">(</span><span class="nf">negative</span> <span class="p">(</span><span class="nb">- </span><span class="nv">item</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">positions</span><span class="p">)</span> <span class="nv">k</span><span class="p">))</span>
	<span class="p">))</span>
  <span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">negative</span> <span class="nv">item</span> <span class="nv">positions</span> <span class="nv">k</span><span class="p">)</span> <span class="p">(</span><span class="nf">positive</span> <span class="nv">item</span> <span class="nv">positions</span> <span class="nv">k</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">safe?</span> <span class="nv">k</span> <span class="nv">positions</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">and</span>
   <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nf">include-row?</span> <span class="p">(</span><span class="nb">car </span><span class="nv">positions</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">positions</span><span class="p">)))</span> <span class="c1">;; нет совпадений по строкам</span>
   <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nf">include-diagonale?</span> <span class="p">(</span><span class="nb">car </span><span class="nv">positions</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">positions</span><span class="p">)</span> <span class="nv">k</span><span class="p">))))</span> <span class="c1">;; не совпадает по диагоналям</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">queens</span> <span class="nv">board-size</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">queen-cols</span> <span class="nv">k</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">k</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">(</span><span class="nb">list </span><span class="nv">empty-board</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">filter</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">positions</span><span class="p">)</span> <span class="p">(</span><span class="nf">safe?</span> <span class="nv">k</span> <span class="nv">positions</span><span class="p">))</span>
	 <span class="p">(</span><span class="nf">flatmap</span>
	  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">rest-of-queens</span><span class="p">)</span>
	    <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">new-row</span><span class="p">)</span>
		   <span class="p">(</span><span class="nf">adjoin-position</span> <span class="nv">new-row</span> <span class="nv">k</span> <span class="nv">rest-of-queens</span><span class="p">))</span>
		 <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="nv">board-size</span><span class="p">)))</span>
	  <span class="p">(</span><span class="nf">queen-cols</span> <span class="p">(</span><span class="nb">- </span><span class="nv">k</span> <span class="mi">1</span><span class="p">))))))</span>
  <span class="p">(</span><span class="nf">queen-cols</span> <span class="nv">board-size</span><span class="p">))</span>

<span class="p">(</span><span class="nf">queens</span> <span class="mi">8</span><span class="p">)</span> <span class="c1">;; Value: ((4 2 7 3 6 8 5 1) (5 2 4 7 3 8 6 1) (3 5 2 8 6 4 7 1) (3 6 4 2 8 5 7 1) (5 7 1 3 8 6 4 2) (4 6 8 3 1 7 5 2) (3 6 8 1 4 7 5 2) (5 3 8 4 7 1 6 2) (5 7 4 1 3 8 6 2) (4 1 5 8 6 3 7 2) (3 6 4 1 8 5 7 2) (4 7 5 3 1 6 8 2) (6 4 2 8 5 7 1 3) (6 4 7 1 8 2 5 3) (1 7 4 6 8 2 5 3) (6 8 2 4 1 7 5 3) (6 2 7 1 4 8 5 3) (4 7 1 8 5 2 6 3) (5 8 4 1 7 2 6 3) (4 8 1 5 7 2 6 3) (2 7 5 8 1 4 6 3) (1 7 5 8 2 4 6 3) (2 5 7 4 1 8 6 3) (4 2 7 5 1 8 6 3) (5 7 1 4 2 8 6 3) (6 4 1 5 8 2 7 3) (5 1 4 6 8 2 7 3) (5 2 6 1 7 4 8 3) (6 3 7 2 8 5 1 4) (2 7 3 6 8 5 1 4) (7 3 1 6 8 5 2 4) (5 1 8 6 3 7 2 4) (1 5 8 6 3 7 2 4) (3 6 8 1 5 7 2 4) (6 3 1 7 5 8 2 4) (7 5 3 1 6 8 2 4) (7 3 8 2 5 1 6 4) (5 3 1 7 2 8 6 4) (2 5 7 1 3 8 6 4) (3 6 2 5 8 1 7 4) (6 1 5 2 8 3 7 4) (8 3 1 6 2 5 7 4) (2 8 6 1 3 5 7 4) (5 7 2 6 3 1 8 4) (3 6 2 7 5 1 8 4) (6 2 7 1 3 5 8 4) (3 7 2 8 6 4 1 5) (6 3 7 2 4 8 1 5) (4 2 7 3 6 8 1 5) (7 1 3 8 6 4 2 5) (1 6 8 3 7 4 2 5) (3 8 4 7 1 6 2 5) (6 3 7 4 1 8 2 5) (7 4 2 8 6 1 3 5) (4 6 8 2 7 1 3 5) (2 6 1 7 4 8 3 5) (2 4 6 8 3 1 7 5) (3 6 8 2 4 1 7 5) (6 3 1 8 4 2 7 5) (8 4 1 3 6 2 7 5) (4 8 1 3 6 2 7 5) (2 6 8 3 1 4 7 5) (7 2 6 3 1 4 8 5) (3 6 2 7 1 4 8 5) (4 7 3 8 2 5 1 6) (4 8 5 3 1 7 2 6) (3 5 8 4 1 7 2 6) (4 2 8 5 7 1 3 6) (5 7 2 4 8 1 3 6) (7 4 2 5 8 1 3 6) (8 2 4 1 7 5 3 6) (7 2 4 1 8 5 3 6) (5 1 8 4 2 7 3 6) (4 1 5 8 2 7 3 6) (5 2 8 1 4 7 3 6) (3 7 2 8 5 1 4 6) (3 1 7 5 8 2 4 6) (8 2 5 3 1 7 4 6) (3 5 2 8 1 7 4 6) (3 5 7 1 4 2 8 6) (5 2 4 6 8 3 1 7) (6 3 5 8 1 4 2 7) (5 8 4 1 3 6 2 7) (4 2 5 8 6 1 3 7) (4 6 1 5 2 8 3 7) (6 3 1 8 5 2 4 7) (5 3 1 6 8 2 4 7) (4 2 8 6 1 3 5 7) (6 3 5 7 1 4 2 8) (6 4 7 1 3 5 2 8) (4 7 5 2 6 1 3 8) (5 7 2 6 3 1 4 8))</span>
<span class="p">(</span><span class="nb">length </span><span class="p">(</span><span class="nf">queens</span> <span class="mi">8</span><span class="p">))</span> <span class="c1">;Value: 92</span>
</pre></div>
</div>
</div>


<div id="outline-container-org9383008" class="outline-2">
<h2 id="org9383008">Упражнение 2.43</h2>
<div class="outline-text-2" id="text-org9383008">
<p>
Процедура Луиса для queens работала медленно. Выяснилось что он поменял местами отображения в flatmap.
</p>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">flatmap</span>
 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">new-row</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">rest-of-queens</span><span class="p">)</span>
	  <span class="p">(</span><span class="nf">adjoin-position</span> <span class="nv">new-row</span> <span class="nv">k</span> <span class="nv">rest-of-queens</span><span class="p">))</span>
	<span class="p">(</span><span class="nf">queen-cols</span> <span class="p">(</span><span class="nb">- </span><span class="nv">k</span> <span class="mi">1</span><span class="p">))))</span>
 <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="nv">board-size</span><span class="p">))</span>
</pre></div>

<p>
Объясните почему смена отображения замедляет программу. Оцени время для восьми ферзей если для 6 было время T.
</p>

<p>
(queen-cols (- k 1)) вызывается 8 раз.
</p>

<p>
Замедление происходит потому что считаем 8 раз предыдущие позиции на каждом вызове рекурсии. То есть если оценивать во времени обхода этих позиций то рост будет 8<sup>N</sup> где N количество позиций. Количество позиций сложная функция из-за фильтра, но после 5 она начинает резко расти. За счет этого наблюдается замедление.
</p>

<p>
Допустим для 6 позиций заняло время T. что бы для 7 позиций посчитать она выполнит 8 раз для 6 позиций. Потом количество позиций увеличится в 8 раз. потом применим функцию фильтра, которая сократит варианты. И еще раз выполнится 8 раз для 7. То есть итоговое T, будет порядка (8<sup>2</sup>) T.
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-22-ierarkhicheskie-dannye-i-svoistvo-zamykaniia-the-closure-property/" class="u-url">SICP 2.2 Иерархические данные и свойство замыкания (the closure property).</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-22-ierarkhicheskie-dannye-i-svoistvo-zamykaniia-the-closure-property/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-18T15:18:01+03:00" itemprop="datePublished" title="2020-01-18 15:18">2020-01-18 15:18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.17
  </h2>
  <div>
   <div>
    <p>
     Определите процедуру last-pair, которая возвращает список который содержит только последний элемент данного (непустого списка).
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">last-pair</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">))</span>
<span class="lineno">3 </span>      <span class="nv">list1</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="nf">last-pair</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">))))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.18
  </h2>
  <div>
   <div>
    <p>
     Определите процедуру reverse, которая возвращает список элементы которого записаны в обратном порядке.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">reverse </span><span class="nv">list1</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">l</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">l</span><span class="p">)</span>
<span class="lineno">4 </span>        <span class="nv">result</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">l</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">l</span><span class="p">)</span> <span class="nv">result</span><span class="p">))))</span>
<span class="lineno">6 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">list1</span> <span class="nv">nil</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.19
  </h2>
  <div>
   <div>
    <p>
     Рассмотрим программу подсчета количества изменений из раздела 1.2.2. Было бы хорошо легко изменить валюту. Когда программа написана валюта учитывается в методах first-denomination и count-change.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; исходная программа</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">count-change</span> <span class="nv">amount</span><span class="p">)</span>
<span class="lineno"> 3 </span>  <span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="mi">5</span><span class="p">))</span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="nv">kinds-of-coins</span><span class="p">)</span>
<span class="lineno"> 5 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno"> 6 </span>        <span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">0</span><span class="p">))</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno"> 7 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span>
<span class="lineno"> 8 </span>                     <span class="p">(</span><span class="nb">- </span><span class="nv">kinds-of-coins</span> <span class="mi">1</span><span class="p">))</span>
<span class="lineno"> 9 </span>                 <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nb">- </span><span class="nv">amount</span>
<span class="lineno">10 </span>                        <span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">kinds-of-coins</span><span class="p">))</span>
<span class="lineno">11 </span>                     <span class="nv">kinds-of-coins</span><span class="p">)))))</span>
<span class="lineno">12 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">kinds-of-coins</span><span class="p">)</span>
<span class="lineno">13 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">14 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">5</span><span class="p">)</span>
<span class="lineno">15 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">3</span><span class="p">)</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno">16 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">4</span><span class="p">)</span> <span class="mi">25</span><span class="p">)</span>
<span class="lineno">17 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">5</span><span class="p">)</span> <span class="mi">50</span><span class="p">)))</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span><span class="p">(</span><span class="nf">cc</span> <span class="mi">100</span> <span class="mi">5</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     Было бы лучше иметь список монет которые могут быть использованы для размена.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="nv">us-coins</span> <span class="p">(</span><span class="nb">list </span><span class="mi">50</span> <span class="mi">25</span> <span class="mi">10</span> <span class="mi">5</span> <span class="mi">1</span><span class="p">))</span>
<span class="lineno">2 </span><span class="p">(</span><span class="k">define </span><span class="nv">uk-coins</span> <span class="p">(</span><span class="nb">list </span><span class="mi">100</span> <span class="mi">50</span> <span class="mi">20</span> <span class="mi">10</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mf">0.5</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     Мы хотим переписать программу cc что бы её второй аргумент представлял собой список значений монет, вместо целого числа. Тогда у нас будут списки для каждого вида валют.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="nf">cc</span> <span class="mi">100</span> <span class="nv">us-coins</span><span class="p">)</span>
<span class="lineno">2 </span><span class="mi">292</span>
</pre>
</div>   <div>
    <p>
     Для этого потребуется несколько изменить программу cc. Доступ ко второму элементу будет осуществляться по другому.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="nv">coin-values</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">3 </span>        <span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">no-more?</span> <span class="nv">coin-values</span><span class="p">))</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">4 </span>        <span class="p">(</span><span class="nf">else</span>
<span class="lineno">5 </span>         <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span>
<span class="lineno">6 </span>                <span class="p">(</span><span class="nf">except-first-denomination</span> <span class="nv">coin-values</span><span class="p">))</span>
<span class="lineno">7 </span>            <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nb">- </span><span class="nv">amount</span>
<span class="lineno">8 </span>                   <span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">coin-values</span><span class="p">))</span>
<span class="lineno">9 </span>                <span class="nv">coin-values</span><span class="p">)))))</span>
</pre>
</div>   <div>
    <p>
     Определите процедуры first-denomination, except-first-denomination, no-more. Влияет ли порядок в списке на итоговое число?
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="nv">us-coins</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">25</span> <span class="mi">10</span> <span class="mi">5</span> <span class="mi">50</span><span class="p">))</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="nv">uk-coins</span> <span class="p">(</span><span class="nb">list </span><span class="mi">100</span> <span class="mi">50</span> <span class="mi">20</span> <span class="mi">10</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">except-first-denomination</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 4 </span>  <span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">))</span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 6 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">list1</span><span class="p">))</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">no-more?</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 9 </span>      <span class="nv">list1</span>
<span class="lineno">10 </span>      <span class="nv">false</span><span class="p">))</span>
<span class="lineno">11 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="nv">coin-values</span><span class="p">)</span>
<span class="lineno">12 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">13 </span>        <span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">no-more?</span> <span class="nv">coin-values</span><span class="p">))</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">14 </span>        <span class="p">(</span><span class="nf">else</span>
<span class="lineno">15 </span>         <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span>
<span class="lineno">16 </span>                <span class="p">(</span><span class="nf">except-first-denomination</span> <span class="nv">coin-values</span><span class="p">))</span>
<span class="lineno">17 </span>            <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nb">- </span><span class="nv">amount</span>
<span class="lineno">18 </span>                   <span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">coin-values</span><span class="p">))</span>
<span class="lineno">19 </span>                <span class="nv">coin-values</span><span class="p">)))))</span>
<span class="lineno">20 </span><span class="p">(</span><span class="nf">cc</span> <span class="mi">100</span> <span class="nv">us-coins</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     Порядок не влияет, так как рекурсивно обходятся все варианты изменения.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.20
  </h2>
  <div>
   <div>
    <p>
     Используя нотацию dotted-tail, напишите процедуру same-parity которая принимает одно или более целых чисел и возвращает список всех аргументов которые имеют такое-же четное-нечетное соотношение как первый аргумент.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">same-parity</span> <span class="nv">x</span> <span class="o">.</span> <span class="nv">l</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">filter</span> <span class="nv">list1</span> <span class="nv">same?</span><span class="p">)</span>
<span class="lineno"> 3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 4 </span>        <span class="nv">list1</span>
<span class="lineno"> 5 </span>        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same?</span> <span class="p">(</span><span class="nb">car </span><span class="nv">list1</span><span class="p">))</span>
<span class="lineno"> 6 </span>            <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">list1</span><span class="p">)</span> <span class="p">(</span><span class="nf">filter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">)</span> <span class="nv">same?</span><span class="p">))</span>
<span class="lineno"> 7 </span>            <span class="p">(</span><span class="nf">filter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">)</span> <span class="nv">same?</span><span class="p">)</span>
<span class="lineno"> 8 </span>            <span class="p">)))</span>
<span class="lineno"> 9 </span>  <span class="p">(</span><span class="k">define </span><span class="nv">same-even-odd</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">even? </span><span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">even? </span><span class="nv">i</span><span class="p">)))</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">even? </span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">even? </span><span class="nv">i</span><span class="p">)))</span> <span class="mi">1</span> <span class="nv">false</span><span class="p">)))</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="p">(</span><span class="nf">filter</span> <span class="nv">l</span> <span class="nv">same-even-odd</span><span class="p">)))</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span><span class="p">(</span><span class="nf">same-parity</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.21
  </h2>
  <div>
   <div>
    <p>
     Процедура square-list принимает список аргументов и возвращает список квадратов.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="nf">square-list</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
<span class="lineno">2 </span><span class="p">(</span><span class="mi">1</span> <span class="mi">4</span> <span class="mi">9</span> <span class="mi">16</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     Приведены два реализации square-list. Дополните их.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-list</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">)</span>
<span class="lineno">3 </span>      <span class="nv">nil</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">))</span> <span class="p">(</span><span class="nf">square-list</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)))))</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span>
<span class="lineno">7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-list</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">8 </span>  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">square</span> <span class="nv">x</span><span class="p">))</span> <span class="nv">items</span><span class="p">))</span>
<span class="lineno">9 </span><span class="p">(</span><span class="nf">square-list</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.22
  </h2>
  <div>
   <div>
    <p>
     Луис пытается переписать первую реализацию square-list (2.21) что бы она генерировала итеративный процесс.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-list</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">things</span> <span class="nv">answer</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">things</span><span class="p">)</span>
<span class="lineno">4 </span>        <span class="nv">answer</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">things</span><span class="p">)</span> 
<span class="lineno">6 </span>              <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">car </span><span class="nv">things</span><span class="p">))</span>
<span class="lineno">7 </span>                    <span class="nv">answer</span><span class="p">))))</span>
<span class="lineno">8 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">items</span> <span class="nv">nil</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     К сожалению список получается в обратном порядке, почему?
    </p>
    <p>
     (list 1 2 3) nil iter (list 2 3) (cons 1 nil) iter (list 3) (cons 4 (cons 1 nil)) iter () (cons 9 (cons 4 (cons 1 nil))) return (cons 9 (cons 4 (cons 1 nil)))
    </p>
    <p>
     Луис пытается починить баг переставляя аргументы в cons
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-list</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">things</span> <span class="nv">answer</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">things</span><span class="p">)</span>
<span class="lineno">4 </span>        <span class="nv">answer</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">things</span><span class="p">)</span>
<span class="lineno">6 </span>              <span class="p">(</span><span class="nb">cons </span><span class="nv">answer</span>
<span class="lineno">7 </span>                    <span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">car </span><span class="nv">things</span><span class="p">))))))</span>
<span class="lineno">8 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">items</span> <span class="nv">nil</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     Это не работает получается (cons (cons (cons nil 1) 4) 9)
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.23
  </h2>
  <div>
   <div>
    <p>
     Процедура for-each похожа на map, только вместо того чтобы возвращать измененный список она просто применяет переданную функцию к каждому элементу. Используется что бы выполнить действия над списком, например печать.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="nb">for-each </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">newline</span><span class="p">)</span> <span class="p">(</span><span class="nb">display </span><span class="nv">x</span><span class="p">))</span>
<span class="lineno">2 </span>          <span class="p">(</span><span class="nb">list </span><span class="mi">57</span> <span class="mi">321</span> <span class="mi">88</span><span class="p">))</span>
<span class="lineno">3 </span><span class="mi">57</span>
<span class="lineno">4 </span><span class="mi">321</span>
<span class="lineno">5 </span><span class="mi">88</span>
</pre>
</div>   <div>
    <p>
     Возвращаемое значение может быть любым например true. Дайте определение процедуры for-each.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">for-each </span><span class="nv">proc</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">))</span>
<span class="lineno">3 </span>      <span class="p">(</span><span class="nf">proc</span> <span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">)))</span>
<span class="lineno">4 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">))</span>
<span class="lineno">5 </span>      <span class="p">(</span><span class="nb">for-each </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)))</span>
<span class="lineno">6 </span>  <span class="nv">true</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.24
  </h2>
  <div>
   <div>
    <p>
     Предположим мы оцениваем выражение (list 1 (list 2 (list 3 4))). Что даст вывод интерпретатора. Изобразите box-and-pointer и древовидную структуры.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="mi">1</span> <span class="p">(</span><span class="mi">2</span> <span class="p">(</span><span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="p">(</span><span class="nb">list </span><span class="mi">2</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
<span class="lineno"> 4 </span>     <span class="nv">/</span>      <span class="err">\</span>
<span class="lineno"> 5 </span>    <span class="nv">/</span>        <span class="err">\</span>
<span class="lineno"> 6 </span>   <span class="mi">1</span>   <span class="p">(</span><span class="nb">list </span><span class="mi">2</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
<span class="lineno"> 7 </span>            <span class="nv">/</span>        <span class="err">\</span>
<span class="lineno"> 8 </span>           <span class="nv">/</span>          <span class="err">\</span>
<span class="lineno"> 9 </span>          <span class="mi">2</span>         <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="lineno">10 </span>                     <span class="nv">/</span>      <span class="err">\</span>
<span class="lineno">11 </span>                    <span class="nv">/</span>        <span class="err">\</span>
<span class="lineno">12 </span>                   <span class="mi">3</span>          <span class="mi">4</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span><span class="p">(</span><span class="nb">cons </span><span class="mi">1</span>  <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">list </span><span class="mi">2</span> <span class="p">(</span><span class="o">...</span><span class="p">))</span> <span class="nv">nil</span><span class="p">)</span>
<span class="lineno">15 </span>     <span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="o">.</span><span class="p">]</span><span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">&gt;</span><span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="nv">/</span><span class="p">]</span>
<span class="lineno">16 </span>      <span class="nv">|</span>                    <span class="nv">|</span>
<span class="lineno">17 </span>      <span class="nv">|</span>                    <span class="nv">|</span>
<span class="lineno">18 </span>      <span class="nv">v</span>                    <span class="nv">v</span>
<span class="lineno">19 </span>      <span class="mi">1</span>                   <span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="o">.</span><span class="p">]</span><span class="nv">-</span> <span class="nv">-&gt;</span><span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="nv">/</span><span class="p">]</span>
<span class="lineno">20 </span>                           <span class="nv">|</span>         <span class="nv">|</span>
<span class="lineno">21 </span>                           <span class="nv">|</span>         <span class="nv">|</span>
<span class="lineno">22 </span>                           <span class="nv">v</span>         <span class="nv">v</span>
<span class="lineno">23 </span>                           <span class="mi">2</span>     <span class="p">(</span><span class="nb">cons </span><span class="mi">3</span> <span class="p">(</span><span class="nb">cons </span><span class="mi">4</span> <span class="nv">nil</span><span class="p">)</span>
<span class="lineno">24 </span>                                    <span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="o">.</span><span class="p">]</span><span class="nv">-</span> <span class="nv">-&gt;</span><span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="nv">/</span><span class="p">]</span>
<span class="lineno">25 </span>                                     <span class="nv">|</span>         <span class="nv">|</span>
<span class="lineno">26 </span>                                     <span class="nv">|</span>         <span class="nv">|</span>
<span class="lineno">27 </span>                                     <span class="nv">v</span>         <span class="nv">v</span>
<span class="lineno">28 </span>                                     <span class="mi">3</span>         <span class="mi">4</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.25
  </h2>
  <div>
   <div>
    <p>
     Приведите комюинации cars и cdrs которые выбирую 7 из каждого списка.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="c1">;; (1 3 (5 7) 9)</span>
<span class="lineno">2 </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">3</span> <span class="p">(</span><span class="nb">list </span><span class="mi">5</span> <span class="mi">7</span><span class="p">)</span> <span class="mi">9</span><span class="p">))))))</span>
<span class="lineno">3 </span><span class="c1">;; ((7))</span>
<span class="lineno">4 </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="mi">7</span><span class="p">))))</span>
<span class="lineno">5 </span><span class="c1">;; (1 (2 (3 (4 (5 (6 7))))))</span>
<span class="lineno">6 </span><span class="p">(</span><span class="k">define </span><span class="nv">list3</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="p">(</span><span class="nb">list </span><span class="mi">2</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="p">(</span><span class="nb">list </span><span class="mi">4</span> <span class="p">(</span><span class="nb">list </span><span class="mi">5</span> <span class="p">(</span><span class="nb">list </span><span class="mi">6</span> <span class="mi">7</span><span class="p">)))))))</span>
<span class="lineno">7 </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">list3</span><span class="p">))))))))))))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.26
  </h2>
  <div>
   <div>
    <p>
     Допустим определили два списка. Какой будет результат выражений.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="nv">y</span> <span class="p">(</span><span class="nb">list </span><span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="nb">append </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno"> 5 </span><span class="c1">;; (1 2 3 4 5 6)</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno"> 7 </span><span class="c1">;; ((1 2 3) 4 5 6)</span>
<span class="lineno"> 8 </span><span class="p">(</span><span class="nb">list </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno"> 9 </span><span class="c1">;; (cons x (cons y nil)</span>
<span class="lineno">10 </span><span class="c1">;; ((1 2 4) (4 5 6))</span>
</pre>
</div>   <div>
    <p>
     то есть list создаст список списков, в то время как cons запишет в car первый список, а в cdr указатель на y, что приведет к разному результату с list x y. cons просто добавляет элемент в начало списка y.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.27
  </h2>
  <div>
   <div>
    <p>
     Измените процедуру reverse что бы она умела разворачивать вложенные списки.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">deep-reverse</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 4 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">l</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno"> 5 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">l</span><span class="p">)</span>
<span class="lineno"> 6 </span>        <span class="nv">result</span>
<span class="lineno"> 7 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">l</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">deep-reverse</span> <span class="p">(</span><span class="nb">car </span><span class="nv">l</span><span class="p">))</span> <span class="nv">result</span><span class="p">))))</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 9 </span>      <span class="p">(</span><span class="nf">iter</span> <span class="nv">list1</span> <span class="nv">nil</span><span class="p">)</span>
<span class="lineno">10 </span>      <span class="nv">list1</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     тут просто рекурсивно вызываем deep-reverse и если list1 это не список просто возвращаем значение.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.28
  </h2>
  <div>
   <div>
    <p>
     Напишите процедуру fringe, которая принимает дерево в виде списка и возвращает список всех листьев в порядке слева на право.
    </p>
    <p>
     Например:
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="p">(</span><span class="nf">fringe</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">4 </span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span><span class="p">(</span><span class="nf">fringe</span> <span class="p">(</span><span class="nb">list </span><span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>
<span class="lineno">7 </span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
</pre>
</div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="k">define </span><span class="p">(</span><span class="nf">fringe</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">x</span><span class="p">)</span>
<span class="lineno">3 </span>      <span class="nv">x</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">))</span>
<span class="lineno">5 </span>          <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nf">fringe</span> <span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="nf">fringe</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">x</span><span class="p">)))</span>
<span class="lineno">6 </span>          <span class="nv">x</span><span class="p">)))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.29
  </h2>
  <div>
   <div>
    <p>
     Бинарный ползунок состоит из двух веток, левой и правой. Мы можем представить бинарный ползунок используя объединение из двух веток (к примеру используя list).
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nb">list </span><span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     Каждая ветка это стержень определенной длинны + вес либо еще один бинарный ползунок.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-branch</span> <span class="nv">length</span> <span class="nv">structure</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nb">list </span><span class="nv">length</span> <span class="nv">structure</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     a. Напишите селекторы left-branch и right-branch, которые возвращабт ветки + branch-length и branch-structure, которые возвращают компоненты ветки. b. Используя селекторы напишите процедуру total-weight, которая возвращает суммарный вес. с. Ползунок сбалансирован, когда крутящий момент верхней левой ветки равен верхней правой ветке (то есть длинна стержня умножить на вес свисающий с этого стержня). Напишите процедуру которая тестирует сбалансировал ли ползунок. d. Предположим мы поменяли представление так что конструктор стал таким
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>
<span class="lineno">3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-branch</span> <span class="nv">length</span> <span class="nv">structure</span><span class="p">)</span>
<span class="lineno">4 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">length</span> <span class="nv">structure</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     Как много изменений нужно внести в программу после этого?
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nb">list </span><span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-branch</span> <span class="nv">length</span> <span class="nv">structure</span><span class="p">)</span>
<span class="lineno"> 5 </span>  <span class="p">(</span><span class="nb">list </span><span class="nv">length</span> <span class="nv">structure</span><span class="p">))</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno"> 7 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">m</span><span class="p">))</span>
<span class="lineno"> 8 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno"> 9 </span>  <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">m</span><span class="p">)))</span>
<span class="lineno">10 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-length</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">11 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">b</span><span class="p">))</span>
<span class="lineno">12 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-structure</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">13 </span>  <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">b</span><span class="p">)))</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>
<span class="lineno">16 </span><span class="p">(</span><span class="k">define </span><span class="nv">l0</span> <span class="p">(</span><span class="nf">make-branch</span> <span class="mi">3</span> <span class="mi">10</span><span class="p">))</span>
<span class="lineno">17 </span><span class="p">(</span><span class="k">define </span><span class="nv">r0</span> <span class="p">(</span><span class="nf">make-branch</span> <span class="mi">3</span> <span class="mi">10</span><span class="p">))</span>
<span class="lineno">18 </span><span class="p">(</span><span class="k">define </span><span class="nv">m0</span> <span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">l0</span> <span class="nv">r0</span><span class="p">))</span>
<span class="lineno">19 </span>
<span class="lineno">20 </span><span class="p">(</span><span class="k">define </span><span class="nv">l1</span> <span class="p">(</span><span class="nf">make-branch</span> <span class="mi">10</span> <span class="mi">10</span><span class="p">))</span>
<span class="lineno">21 </span><span class="p">(</span><span class="k">define </span><span class="nv">r1</span> <span class="p">(</span><span class="nf">make-branch</span> <span class="mi">5</span> <span class="nv">m0</span><span class="p">))</span>
<span class="lineno">22 </span><span class="p">(</span><span class="k">define </span><span class="nv">m1</span> <span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">l1</span> <span class="nv">r1</span><span class="p">))</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span><span class="c1">;; общий вес</span>
<span class="lineno">25 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">structure-weight</span> <span class="nv">s</span><span class="p">)</span>
<span class="lineno">26 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">s</span><span class="p">)</span>
<span class="lineno">27 </span>      <span class="p">(</span><span class="nf">total-weight</span> <span class="nv">s</span><span class="p">)</span>
<span class="lineno">28 </span>      <span class="nv">s</span><span class="p">))</span>
<span class="lineno">29 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-weight</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">30 </span>  <span class="p">(</span><span class="nf">structure-weight</span> <span class="p">(</span><span class="nf">branch-structure</span> <span class="nv">b</span><span class="p">)))</span>
<span class="lineno">31 </span>
<span class="lineno">32 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">total-weight</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno">33 </span>  <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">branch-weight</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">))</span> <span class="p">(</span><span class="nf">branch-weight</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">))))</span>
<span class="lineno">34 </span>
<span class="lineno">35 </span><span class="p">(</span><span class="nf">total-weight</span> <span class="nv">m1</span><span class="p">)</span>
<span class="lineno">36 </span>
<span class="lineno">37 </span><span class="c1">;; балансировка</span>
<span class="lineno">38 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">balanced?</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno">39 </span>  <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">branch-weight</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">))</span> <span class="p">(</span><span class="nf">branch-length</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">)))</span>
<span class="lineno">40 </span>     <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">branch-weight</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">))</span> <span class="p">(</span><span class="nf">branch-length</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">)))))</span>
<span class="lineno">41 </span>
<span class="lineno">42 </span><span class="p">(</span><span class="nf">balanced?</span> <span class="nv">m1</span><span class="p">)</span>
<span class="lineno">43 </span><span class="p">(</span><span class="nf">balanced?</span> <span class="nv">m0</span><span class="p">)</span>
<span class="lineno">44 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
<span class="lineno">45 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>
<span class="lineno">46 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-branch</span> <span class="nv">length</span> <span class="nv">structure</span><span class="p">)</span>
<span class="lineno">47 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">length</span> <span class="nv">structure</span><span class="p">))</span>
<span class="lineno">48 </span>
<span class="lineno">49 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno">50 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">m</span><span class="p">))</span>
<span class="lineno">51 </span><span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m0</span><span class="p">)</span>
<span class="lineno">52 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">)</span> <span class="c1">;; поменял метод</span>
<span class="lineno">53 </span>  <span class="p">(</span><span class="nb">cdr </span><span class="nv">m</span><span class="p">))</span>
<span class="lineno">54 </span><span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m0</span><span class="p">)</span>
<span class="lineno">55 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-length</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">56 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">b</span><span class="p">))</span>
<span class="lineno">57 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-structure</span> <span class="nv">b</span><span class="p">)</span> <span class="c1">;; поменял метод</span>
<span class="lineno">58 </span>  <span class="p">(</span><span class="nb">cdr </span><span class="nv">b</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     поменяли два селектора.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.30
  </h2>
  <div>
   <div>
    <p>
     Напишите процедуру square-tree без и с использованием map.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-tree</span> <span class="nv">tree</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">tree</span><span class="p">)</span> <span class="nv">nil</span><span class="p">)</span>
<span class="lineno"> 3 </span>        <span class="p">((</span><span class="nb">not </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">tree</span><span class="p">))</span> <span class="p">(</span><span class="nf">square</span> <span class="nv">tree</span><span class="p">))</span>
<span class="lineno"> 4 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">square-tree</span> <span class="p">(</span><span class="nb">car </span><span class="nv">tree</span><span class="p">))</span>
<span class="lineno"> 5 </span>                    <span class="p">(</span><span class="nf">square-tree</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">tree</span><span class="p">))))))</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-tree</span> <span class="nv">tree</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">sub-tree</span><span class="p">)</span>
<span class="lineno"> 9 </span>         <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">sub-tree</span><span class="p">)</span>
<span class="lineno">10 </span>             <span class="p">(</span><span class="nf">square-tree</span> <span class="nv">sub-tree</span><span class="p">)</span>
<span class="lineno">11 </span>             <span class="p">(</span><span class="nf">square</span> <span class="nv">sub-tree</span><span class="p">)))</span>
<span class="lineno">12 </span>       <span class="nv">tree</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.31
  </h2>
  <div>
   <div>
    <p>
     Абстрагируйте ваш ответ к 2.30 что бы можно было записывать процедуру square-tree через tree-map.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-tree</span> <span class="nv">tree</span><span class="p">)</span> <span class="p">(</span><span class="nf">tree-map</span> <span class="nv">square</span> <span class="nv">tree</span><span class="p">))</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span>
<span class="lineno">4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tree-map</span> <span class="nv">proc</span> <span class="nv">tree</span><span class="p">)</span>
<span class="lineno">5 </span>  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">sub-tree</span><span class="p">)</span>
<span class="lineno">6 </span>         <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">sub-tree</span><span class="p">)</span>
<span class="lineno">7 </span>             <span class="p">(</span><span class="nf">tree-map</span> <span class="nv">proc</span> <span class="nv">sub-tree</span><span class="p">)</span>
<span class="lineno">8 </span>             <span class="p">(</span><span class="nf">proc</span> <span class="nv">sub-tree</span><span class="p">)))</span>
<span class="lineno">9 </span>       <span class="nv">tree</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.32
  </h2>
  <div>
   <div>
    <p>
     Мы можем представить set как список уникальных элементов, а так же set всех подмножеств как список списков. К примеру set (1 2 3), тогда сет всех подмножеств будет (() (3) (2) (2 3) (1) (1 3) (1 2) (1 2 3)). Допишите функцию генерирующую список всех подмножеств сета и дайте пояснение как она работает.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">subsets</span> <span class="nv">s</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">s</span><span class="p">)</span>
<span class="lineno">3 </span>      <span class="p">(</span><span class="nb">list </span><span class="nv">nil</span><span class="p">)</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">rest</span> <span class="p">(</span><span class="nf">subsets</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">s</span><span class="p">))))</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nb">append </span><span class="nv">rest</span> <span class="p">(</span><span class="nb">map </span><span class="nv">&lt;??&gt;</span> <span class="nv">rest</span><span class="p">)))))</span>
</pre>
</div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">subsets</span> <span class="nv">s</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">s</span><span class="p">)</span>
<span class="lineno">3 </span>      <span class="p">(</span><span class="nb">list </span><span class="nv">nil</span><span class="p">)</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">rest</span> <span class="p">(</span><span class="nf">subsets</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">s</span><span class="p">))))</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nb">append </span><span class="nv">rest</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">set</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">s</span><span class="p">)</span> <span class="nv">set</span><span class="p">))</span> <span class="nv">rest</span><span class="p">)))))</span>
<span class="lineno">6 </span>
<span class="lineno">7 </span><span class="p">(</span><span class="nf">subsets</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
<span class="lineno">8 </span><span class="c1">;Value: (() (3) (2) (2 3) (1) (1 3) (1 2) (1 2 3))</span>
</pre>
</div>   <div>
    <p>
     выбираем список без первого элемента, генерируем для него все подмножества. добавляем к полученным подмножествам такое же подмножество но везде первым элементом идет первый элемент. на последней итерации у нас получается пустое список, он возвращает () - нулевое подмножество. в итоге мы перебрали все возможные варианты.
    </p>
   </div>
  </div>
 </div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-vvedenie-v-abstragirovanie-dannykh/" class="u-url">SICP Введение в абстрагирование данных</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-vvedenie-v-abstragirovanie-dannykh/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-16T11:35:27+03:00" itemprop="datePublished" title="2020-01-16 11:35">2020-01-16 11:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.1
  </h2>
  <div>
   <div>
    <p>
     Определите make-rat которая будет определять знак.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-rat</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">g</span> <span class="p">(</span><span class="nb">gcd </span><span class="nv">n</span> <span class="nv">d</span><span class="p">))</span>
<span class="lineno">3 </span>        <span class="p">(</span><span class="nf">sign</span> <span class="p">(</span><span class="k">cond </span><span class="p">(</span><span class="k">or </span><span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt; </span><span class="nv">d</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="nv">d</span> <span class="mi">0</span><span class="p">)))</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">4 </span>                        <span class="p">(</span><span class="k">else </span><span class="mi">0</span><span class="p">))))</span>
<span class="lineno">5 </span>    <span class="p">(</span><span class="nf">cons</span>
<span class="lineno">6 </span>     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">sign</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">abs </span><span class="p">(</span><span class="nb">/ </span><span class="nv">n</span> <span class="nv">g</span><span class="p">))</span> <span class="p">(</span><span class="nb">* </span><span class="mi">-1</span> <span class="p">(</span><span class="nb">abs </span><span class="p">(</span><span class="nb">/ </span><span class="nv">n</span> <span class="nv">g</span><span class="p">))))</span>
<span class="lineno">7 </span>     <span class="p">(</span><span class="nb">abs </span><span class="p">(</span><span class="nb">/ </span><span class="nv">d</span> <span class="nv">g</span><span class="p">)))))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.2
  </h2>
  <div>
   <div>
    <p>
     Рассмотрим проблему представления отрезков на плоскости. Каждый отрезок представлен в виде пары точек. Определите консруктор отрезка make-segment и методы получения (selectors) начала и конца отрезка: start-segment, end-segment, которые определяют представление сегмента в виде точек. Кроме того точка может быть представлена в виде пары чисел. Наконец определите процедуру для средней точки отрезка midpoint-segment.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">average</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">+ </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-point</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">x-point</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">p</span><span class="p">))</span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">y-point</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">p</span><span class="p">))</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">print-point</span> <span class="nv">p</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno"> 9 </span>  <span class="p">(</span><span class="nb">display </span><span class="s">"("</span><span class="p">)</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">x-point</span> <span class="nv">p</span><span class="p">))</span>
<span class="lineno">11 </span>  <span class="p">(</span><span class="nb">display </span><span class="s">","</span><span class="p">)</span>
<span class="lineno">12 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">y-point</span> <span class="nv">p</span><span class="p">))</span>
<span class="lineno">13 </span>  <span class="p">(</span><span class="nb">display </span><span class="s">")"</span><span class="p">))</span>
<span class="lineno">14 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">average-points</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">15 </span>   <span class="p">(</span><span class="nf">make-point</span> <span class="p">(</span><span class="nf">average</span> <span class="p">(</span><span class="nf">x-point</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">x-point</span> <span class="nv">b</span><span class="p">))</span>
<span class="lineno">16 </span>               <span class="p">(</span><span class="nf">average</span> <span class="p">(</span><span class="nf">y-point</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">y-point</span> <span class="nv">b</span><span class="p">))))</span>
<span class="lineno">17 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">distance-points</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">18 </span>  <span class="p">(</span><span class="nb">sqrt </span><span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">x-point</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">x-point</span> <span class="nv">b</span><span class="p">)))</span>
<span class="lineno">19 </span>           <span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">y-point</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">y-point</span> <span class="nv">b</span><span class="p">))))))</span>
<span class="lineno">20 </span><span class="p">(</span><span class="nf">print-point</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-segment</span> <span class="nv">start</span> <span class="nv">end</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">start</span> <span class="nv">end</span><span class="p">))</span>
<span class="lineno">23 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">start-segment</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">s</span><span class="p">))</span>
<span class="lineno">24 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">end-segment</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">s</span><span class="p">))</span>
<span class="lineno">25 </span>
<span class="lineno">26 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">midpoint-segment</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nf">average-points</span> <span class="p">(</span><span class="nf">start-segment</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nf">end-segment</span> <span class="nv">s</span><span class="p">)))</span>
<span class="lineno">27 </span><span class="p">(</span><span class="nf">print-point</span> <span class="p">(</span><span class="nf">midpoint-segment</span> <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">6</span> <span class="mi">0</span><span class="p">))))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.3
  </h2>
  <div>
   <div>
    <p>
     Определите представление прямоугольника на плоскости. В терминаха вашего конструктора и селекторов создайте процедуру которая вывчисляет периметр и площадь. Теперь реализуйте другое представление для прямоугольников. Можете ли вы спроектировать вашу сисетму с подходящими барьерами абстракций, что бы одни и теже процедуры для перемитра и площади работали с разными представлениями.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">segment-lenght</span> <span class="nv">s</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nf">distance-points</span> <span class="p">(</span><span class="nf">start-segment</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nf">end-segment</span> <span class="nv">s</span><span class="p">)))</span>
<span class="lineno"> 3 </span><span class="c1">;; (segment-lenght (make-segment (make-point 0 0) (make-point 6 0)))</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-rect</span> <span class="nv">seg1</span> <span class="nv">seg2</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">seg1</span> <span class="nv">seg2</span><span class="p">))</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rect-base</span> <span class="nv">r</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">r</span><span class="p">))</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rect-side</span> <span class="nv">r</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">r</span><span class="p">))</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rect-perimeter</span> <span class="nv">r</span><span class="p">)</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="nb">* </span><span class="mf">2.0</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">segment-lenght</span> <span class="p">(</span><span class="nf">rect-base</span> <span class="nv">r</span><span class="p">))</span> <span class="p">(</span><span class="nf">segment-lenght</span> <span class="p">(</span><span class="nf">rect-side</span> <span class="nv">r</span><span class="p">)))))</span>
<span class="lineno">11 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">react-area</span> <span class="nv">r</span><span class="p">)</span>
<span class="lineno">12 </span>  <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">segment-lenght</span> <span class="p">(</span><span class="nf">rect-base</span> <span class="nv">r</span><span class="p">))</span> <span class="p">(</span><span class="nf">segment-lenght</span> <span class="p">(</span><span class="nf">rect-side</span> <span class="nv">r</span><span class="p">))))</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span><span class="p">(</span><span class="nf">rect-perimeter</span> <span class="p">(</span><span class="nf">make-rect</span>
<span class="lineno">15 </span>                 <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">6</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno">16 </span>                 <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">))</span>
<span class="lineno">17 </span>                 <span class="p">))</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span><span class="p">(</span><span class="nf">react-area</span> <span class="p">(</span><span class="nf">make-rect</span>
<span class="lineno">20 </span>                 <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">6</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno">21 </span>                 <span class="p">(</span><span class="nf">make-segment</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">))</span>
<span class="lineno">22 </span>                 <span class="p">))</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span>
<span class="lineno">25 </span><span class="c1">;; другое представление прямоугольника например тремя точками</span>
<span class="lineno">26 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-rect</span> <span class="nv">point1</span> <span class="nv">point2</span> <span class="nv">point3</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">cons </span><span class="nv">point1</span> <span class="nv">point2</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">point2</span> <span class="nv">point3</span><span class="p">)))</span>
<span class="lineno">27 </span><span class="p">(</span><span class="nf">rect-perimeter</span> <span class="p">(</span><span class="nf">make-rect</span>
<span class="lineno">28 </span>                 <span class="p">(</span><span class="nf">make-point</span> <span class="mi">6</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">)</span>
<span class="lineno">29 </span>                 <span class="p">))</span>
<span class="lineno">30 </span>
<span class="lineno">31 </span><span class="p">(</span><span class="nf">react-area</span> <span class="p">(</span><span class="nf">make-rect</span>
<span class="lineno">32 </span>             <span class="p">(</span><span class="nf">make-point</span> <span class="mi">6</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">make-point</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">)</span>
<span class="lineno">33 </span>             <span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.4
  </h2>
  <div>
   <div>
    <p>
     Дано альтернативное процедурное представление пары. Проверить Что с его помощью можно получить первое значение из пары, допишите реализацию получения второго значения из пары?
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">m</span><span class="p">)</span> <span class="p">(</span><span class="nf">m</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)))</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="nb">cons </span><span class="mi">1</span> <span class="mi">2</span><span class="p">)</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">car </span><span class="nv">z</span><span class="p">)</span>
<span class="lineno"> 7 </span>  <span class="p">(</span><span class="nf">z</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p</span> <span class="nv">q</span><span class="p">)</span> <span class="nv">p</span><span class="p">)))</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span><span class="c1">;; (cons 1 3)</span>
<span class="lineno">10 </span><span class="c1">;; (car (cons 1 3))</span>
<span class="lineno">11 </span><span class="c1">;; (car (lambda (m) (m x y)))</span>
<span class="lineno">12 </span><span class="c1">;; ((lambda (m) (m x y)) (lambda (p q) p))</span>
<span class="lineno">13 </span><span class="c1">;; (m x y) это как раз вызвать процедуру которая в параметрах с параметрами x y</span>
<span class="lineno">14 </span><span class="c1">;; но следующая проуедура как раз возвращает первый параметр p, то есть все выражение</span>
<span class="lineno">15 </span><span class="c1">;; вернет x</span>
<span class="lineno">16 </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cons </span><span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">z</span><span class="p">)</span>
<span class="lineno">19 </span>  <span class="p">(</span><span class="nf">z</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p</span> <span class="nv">q</span><span class="p">)</span> <span class="nv">q</span><span class="p">)))</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cons </span><span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.5
  </h2>
  <div>
   <div>
    <p>
     Покажите что мы можем представить пары неотрицательных целых чисел, используя только числа и арифметические операции, если представим пару a и b как целое произведение <span class="inline-formula"><img class="img-inline-formula img-formula" width="45" height="15" src="formulae/.zOENo0lip4SHHhRpT3lhv8ITPk7RRL56PDS_A.png" alt="2^a\cdot 3^b" title="2^a\cdot 3^b"></span>. Приведите соответствующие процедуры cons, car, cdr.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="nv">logB</span>
<span class="lineno"> 2 </span>    <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">B</span><span class="p">)</span>
<span class="lineno"> 3 </span>      <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">log </span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">log </span><span class="nv">B</span><span class="p">))))</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">cons </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 6 </span>  <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">fast-expt</span> <span class="mi">2</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">fast-expt</span> <span class="mi">3</span> <span class="nv">b</span><span class="p">)))</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">r</span><span class="p">)</span>
<span class="lineno"> 9 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="p">(</span><span class="nb">remainder </span><span class="nv">r</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">10 </span>      <span class="p">(</span><span class="nf">logB</span> <span class="nv">r</span> <span class="mi">3</span><span class="p">)</span>
<span class="lineno">11 </span>      <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">/ </span><span class="nv">r</span> <span class="mi">2</span><span class="p">))))</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">car </span><span class="nv">r</span><span class="p">)</span>
<span class="lineno">14 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="p">(</span><span class="nb">remainder </span><span class="nv">r</span> <span class="mi">3</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">15 </span>      <span class="p">(</span><span class="nf">logB</span> <span class="nv">r</span> <span class="mi">2</span><span class="p">)</span>
<span class="lineno">16 </span>      <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">/ </span><span class="nv">r</span> <span class="mi">3</span><span class="p">))))</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span><span class="p">(</span><span class="nb">cons </span><span class="mi">1</span> <span class="mi">4</span><span class="p">)</span> <span class="c1">; 162</span>
<span class="lineno">19 </span><span class="p">(</span><span class="nb">car </span><span class="mi">162</span><span class="p">)</span> <span class="c1">; 1</span>
<span class="lineno">20 </span><span class="p">(</span><span class="nb">cdr </span><span class="mi">162</span><span class="p">)</span> <span class="c1">; 4</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.6
  </h2>
  <div>
   <div>
    <p>
     Если случай представления пар в виде процедур был не достаточно ошеломляющим, учтите что в языке который может манипулировать процедурами, мы можем обойтись без чисел , по крайне мерее если говорить о неотрицательных целых числах, реализовав 0 и операцию добавления 1 как:
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="nv">zero</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="nv">x</span><span class="p">)))</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-1</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">4 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="p">((</span><span class="nf">n</span> <span class="nv">f</span><span class="p">)</span> <span class="nv">x</span><span class="p">)))))</span>
</pre>
</div>   <div>
    <p>
     Это представление изветсно как цифры Черча в честь изобретателя Алонсо Черча, логика который изобрел исчисления. Дайте определении one и two (напрямую без использования zero add-1) (Используйте подстановку выполненния (add-1 zero)). Дайте прямое определение процедуры + (не в терминах повторения add-1)
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="nv">zero</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="nv">x</span><span class="p">)))</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-1</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">4 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="p">((</span><span class="nf">n</span> <span class="nv">f</span><span class="p">)</span> <span class="nv">x</span><span class="p">)))))</span>
</pre>
</div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; (add-1 zero)</span>
<span class="lineno"> 2 </span><span class="c1">;; (add-1 (lambda (f) (lambda (x) x)))</span>
<span class="lineno"> 3 </span><span class="c1">;; ((n f) x) будет просто x, так как n это zero</span>
<span class="lineno"> 4 </span><span class="c1">;;</span>
<span class="lineno"> 5 </span><span class="c1">;; (lambda (x) (f x))</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">one</span> <span class="nv">f</span><span class="p">)</span>
<span class="lineno"> 7 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span><span class="p">)))</span>
<span class="lineno"> 8 </span><span class="c1">;; (add-1 one)</span>
<span class="lineno"> 9 </span><span class="c1">;;</span>
<span class="lineno">10 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">two</span> <span class="nv">f</span><span class="p">)</span>
<span class="lineno">11 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span><span class="p">))))</span>
<span class="lineno">12 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add</span> <span class="nv">m</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">13 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">((</span><span class="nf">m</span> <span class="nv">f</span><span class="p">)</span> <span class="p">((</span><span class="nf">n</span> <span class="nv">f</span><span class="p">)</span> <span class="nv">x</span><span class="p">)))))</span>
<span class="lineno">14 </span><span class="c1">;; пусть m=one, n=one</span>
<span class="lineno">15 </span><span class="c1">;; ((n f) x) = (f x)</span>
<span class="lineno">16 </span><span class="c1">;; ((m f) (f x))</span>
<span class="lineno">17 </span><span class="c1">;; (f (f x))</span>
<span class="lineno">18 </span><span class="c1">;; (lambda (x) (f (f x))) а это не что иное как два</span>
<span class="lineno">19 </span><span class="p">(</span><span class="nf">add</span> <span class="nv">one</span> <span class="nv">one</span><span class="p">)</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">print-church</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">22 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">((</span><span class="nf">n</span> <span class="nv">inc</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">newline</span><span class="p">))</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span><span class="p">(</span><span class="nf">print-church</span> <span class="nv">zero</span><span class="p">)</span>
<span class="lineno">25 </span><span class="p">(</span><span class="nf">print-church</span> <span class="nv">one</span><span class="p">)</span>
<span class="lineno">26 </span><span class="p">(</span><span class="nf">print-church</span> <span class="nv">two</span><span class="p">)</span>
<span class="lineno">27 </span><span class="p">(</span><span class="nf">print-church</span> <span class="p">(</span><span class="nf">add</span> <span class="nv">two</span> <span class="nv">two</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.7
  </h2>
  <div>
   <div>
    <p>
     Определите селекторы upper-bound и lower-bound.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-interval</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">a</span> <span class="nv">b</span><span class="p">))</span>
<span class="lineno">2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">max </span><span class="p">(</span><span class="nb">car </span><span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">i</span><span class="p">)))</span>
<span class="lineno">3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">min </span><span class="p">(</span><span class="nb">car </span><span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">i</span><span class="p">)))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.8
  </h2>
  <div>
   <div>
    <p>
     Используя рассуждения Алисы напишите процедуру для вычисления разности интервалов.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub-interval</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nf">make-interval</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno">3 </span>                 <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.9
  </h2>
  <div>
   <div>
    <p>
     Ширина интервала - половина разницы между верхней и нижней оценкой. Ширина является мерой неопределенности значения указанного для интервала. Для некоторых операций над интервалами результирующая ширина является функцией от ширин интервалов, которые были аргументами, а для некотрых операций нет. Покажите что ширина суммы (или разницы) является такой функцией. А для умножения и деления правило не выполняется.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; определяем функцию ширины интервала</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">width-interval</span> <span class="nv">i</span><span class="p">)</span>
<span class="lineno"> 3 </span>  <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">i</span><span class="p">))</span> <span class="mf">2.0</span><span class="p">))</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="nf">width-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mf">4.0</span> <span class="mf">6.0</span><span class="p">))</span> <span class="c1">;; 1</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="nf">width-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">10</span> <span class="mi">14</span><span class="p">))</span> <span class="c1">;; 2</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="nf">width-interval</span> <span class="p">(</span><span class="nf">add-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">4</span> <span class="mi">6</span><span class="p">)</span>
<span class="lineno"> 8 </span>                              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">10</span> <span class="mi">14</span><span class="p">)))</span><span class="c1">;; 3</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="p">(</span><span class="nf">width-interval</span> <span class="p">(</span><span class="nf">sub-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">4</span> <span class="mi">6</span><span class="p">)</span>
<span class="lineno">11 </span>                              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">10</span> <span class="mi">14</span><span class="p">)))</span><span class="c1">;; 3</span>
<span class="lineno">12 </span><span class="p">(</span><span class="nf">width-interval</span> <span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">10</span> <span class="mi">14</span><span class="p">)</span>
<span class="lineno">13 </span>                              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">4</span> <span class="mi">6</span><span class="p">)))</span><span class="c1">;; 22</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span><span class="p">(</span><span class="nf">width-interval</span> <span class="p">(</span><span class="nf">div-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mf">10.0</span> <span class="mf">14.0</span><span class="p">)</span>
<span class="lineno">16 </span>                              <span class="p">(</span><span class="nf">make-interval</span> <span class="mf">4.0</span> <span class="mf">6.0</span><span class="p">)))</span><span class="c1">;; 0.916</span>
</pre>
</div>   <div>
    <p>
     Видим что для сложения и вычитания результирующая ширина равна сумме исходных. Для yмножения и деления это все не выполняется.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.10
  </h2>
  <div>
   <div>
    <p>
     Бен Битдиддл подсказал что неясно как делить если интервал с нулевой границей. Добавить в код обработку ошибки.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">div-interval</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">error</span> <span class="s">"Error upper-bound = 0"</span><span class="p">))</span>
<span class="lineno">3 </span>        <span class="p">((</span><span class="nb">= </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">error</span> <span class="s">"Error lower-bound = 0"</span><span class="p">))</span>
<span class="lineno">4 </span>        <span class="p">(</span><span class="nf">else</span>
<span class="lineno">5 </span>         <span class="p">(</span><span class="nf">mul-interval</span> <span class="nv">x</span>
<span class="lineno">6 </span>                       <span class="p">(</span><span class="nf">make-interval</span> <span class="p">(</span><span class="nb">/ </span><span class="mf">1.0</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno">7 </span>                                      <span class="p">(</span><span class="nb">/ </span><span class="mf">1.0</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)))))))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.11
  </h2>
  <div>
   <div>
    <p>
     Испытывая знаки конечных точек интервалов можно разбить multi-interval на девять случаев, только один из которых требует более двух перемножений. Перепишите процедуру используя этот совет.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="c1">;; Если все положительно</span>
<span class="lineno"> 3 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno"> 4 </span>                                                              <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno"> 5 </span>                                                              <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno"> 6 </span>        <span class="c1">;; Если все отрицательное</span>
<span class="lineno"> 7 </span>        <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&lt;= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt;= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno"> 8 </span>                                                              <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno"> 9 </span>                                                              <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">10 </span>        <span class="c1">;; x положительный, а y содержит 0</span>
<span class="lineno">11 </span>        <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno">12 </span>                                                                                    <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno">13 </span>                                                                                    <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">14 </span>        <span class="c1">;; x положительный, а y весь отрицательный</span>
<span class="lineno">15 </span>        <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno">16 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno">17 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">18 </span>        <span class="c1">;; y положительный, а x содержит 0</span>
<span class="lineno">19 </span>        <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno">20 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">))</span>
<span class="lineno">21 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">22 </span>        <span class="c1">;; y положительный, а x весь отрицательный</span>
<span class="lineno">23 </span>        <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno">24 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">))</span>
<span class="lineno">25 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">26 </span>        <span class="c1">;; x отрицательный y пересекает 0</span>
<span class="lineno">27 </span>        <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno">28 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))</span>
<span class="lineno">29 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">30 </span>        <span class="c1">;; y отрицательный x пересекает 0</span>
<span class="lineno">31 </span>        <span class="p">((</span><span class="k">and </span><span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="p">(</span><span class="nf">make-interval</span>
<span class="lineno">32 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">))</span>
<span class="lineno">33 </span>                                                             <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">34 </span>        <span class="c1">;; иначе у нас и x и y пересекают 0, в этом случае и нужно перемножать значения</span>
<span class="lineno">35 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">p1</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)))</span>
<span class="lineno">36 </span>                    <span class="p">(</span><span class="nf">p2</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">)))</span>
<span class="lineno">37 </span>                    <span class="p">(</span><span class="nf">p3</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">lower-bound</span> <span class="nv">y</span><span class="p">)))</span>
<span class="lineno">38 </span>                    <span class="p">(</span><span class="nf">p4</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">y</span><span class="p">))))</span>
<span class="lineno">39 </span>                <span class="p">(</span><span class="nf">make-interval</span> <span class="p">(</span><span class="nb">min </span><span class="nv">p1</span> <span class="nv">p2</span> <span class="nv">p3</span> <span class="nv">p4</span><span class="p">)</span>
<span class="lineno">40 </span>                               <span class="p">(</span><span class="nb">max </span><span class="nv">p1</span> <span class="nv">p2</span> <span class="nv">p3</span> <span class="nv">p4</span><span class="p">))))))</span>
<span class="lineno">41 </span>
<span class="lineno">42 </span><span class="c1">;; Тесты</span>
<span class="lineno">43 </span><span class="c1">;; 1) x, y &gt;</span>
<span class="lineno">44 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">10</span> <span class="mi">14</span><span class="p">)</span>
<span class="lineno">45 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">))</span>
<span class="lineno">46 </span><span class="c1">;; 2) x, y &lt;</span>
<span class="lineno">47 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-14</span> <span class="mi">-10</span><span class="p">)</span>
<span class="lineno">48 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-6</span> <span class="mi">-4</span><span class="p">))</span>
<span class="lineno">49 </span><span class="c1">;; 3) x&gt; y&lt;</span>
<span class="lineno">50 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">14</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno">51 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-6</span> <span class="mi">-4</span><span class="p">))</span>
<span class="lineno">52 </span><span class="c1">;; 4) x&gt; y 0</span>
<span class="lineno">53 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">14</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno">54 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-2</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno">55 </span><span class="c1">;; 5) y&gt; x 0</span>
<span class="lineno">56 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-2</span> <span class="mi">2</span><span class="p">)</span>
<span class="lineno">57 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">14</span> <span class="mi">10</span><span class="p">))</span>
<span class="lineno">58 </span><span class="c1">;; 6) y&gt; x&lt;</span>
<span class="lineno">59 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-4</span> <span class="mi">-2</span><span class="p">)</span>
<span class="lineno">60 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">14</span> <span class="mi">10</span><span class="p">))</span>
<span class="lineno">61 </span><span class="c1">;; 7) x&lt; y 0</span>
<span class="lineno">62 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-4</span> <span class="mi">-2</span><span class="p">)</span>
<span class="lineno">63 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-2</span> <span class="mi">6</span><span class="p">))</span>
<span class="lineno">64 </span><span class="c1">;; 8) y&lt; x 0</span>
<span class="lineno">65 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-2</span> <span class="mi">6</span><span class="p">)</span>
<span class="lineno">66 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-4</span> <span class="mi">-2</span><span class="p">))</span>
<span class="lineno">67 </span><span class="c1">;; 9) x, y 0</span>
<span class="lineno">68 </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-6</span> <span class="mi">-3</span><span class="p">)</span>
<span class="lineno">69 </span>              <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">-4</span> <span class="mi">-2</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.12
  </h2>
  <div>
   <div>
    <p>
     Определите конструктор make-center-percent который получает центр и процент погрешности что бы создать интервал. Вам также нужно определить селектор percent, который вычисляет погрешность для интервала.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-center-percent</span> <span class="nv">c</span> <span class="nv">p</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nf">make-interval</span> <span class="p">(</span><span class="nb">- </span><span class="nv">c</span>  <span class="p">(</span><span class="nb">* </span><span class="nv">c</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">p</span> <span class="mf">100.0</span><span class="p">)))</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">c</span> <span class="p">(</span><span class="nb">* </span><span class="nv">c</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">p</span> <span class="mf">100.0</span><span class="p">)))))</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">percent</span> <span class="nv">i</span><span class="p">)</span>
<span class="lineno">5 </span>  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">c</span> <span class="p">(</span><span class="nf">center</span> <span class="nv">i</span><span class="p">)))</span>
<span class="lineno">6 </span>    <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">upper-bound</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">c</span><span class="p">)</span> <span class="mi">100</span><span class="p">)</span> <span class="nv">c</span><span class="p">)))</span>
<span class="lineno">7 </span><span class="p">(</span><span class="nf">make-center-percent</span> <span class="mi">5</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno">8 </span><span class="p">(</span><span class="nf">percent</span> <span class="p">(</span><span class="nf">make-center-percent</span> <span class="mi">5</span> <span class="mi">10</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.13
  </h2>
  <div>
   <p>
    Покажите что при малых процентных допусках, есть простая формула для вычисления приблизительного значения допуска для произведения двух интервалов в терминах допусков факторов. Вы можете упростить задачу предположив что все интервалы положительные.
   </p>
   <p>
    Пусть Сx Cy центры двух интервалов, их погрешности Tx, Ty соответственно, пусть Сx, Cy &gt; 0. Тогда перемножая их получим:
   </p>
   <p>
    <span class="inline-formula"><img class="img-inline-formula img-formula" width="494" height="17" src="formulae/yzLwIL7U8o0TGIgYxnq1jKv8cn5D8X8nw.DdkQ.png" alt="min = (Cx-Tx)(Cy-Ty) = CxCy - (TxCy + TyCx) + TxTy" title="min = (Cx-Tx)(Cy-Ty) = CxCy - (TxCy + TyCx) + TxTy"></span> <span class="inline-formula"><img class="img-inline-formula img-formula" width="497" height="17" src="formulae/cbJuiyvW49gp_pAPXhvfaE1cmIYp.NqcCuql3Q.png" alt="max = (Cx+Tx)(Cy+Ty) = CxCy + (TxCy + TyCx) + TxTy" title="max = (Cx+Tx)(Cy+Ty) = CxCy + (TxCy + TyCx) + TxTy"></span>
   </p>
   <p>
    <span class="inline-formula"><img class="img-inline-formula img-formula" width="263" height="24" src="formulae/sWwyVefJ_.k1_WRDQReg36g_d43CjaZgB5m5IQ.png" alt="Tmul = \frac{CyTx + CxTy}{CxCy + TxTy}=\frac{CyTx + CxTy}{CxCy}" title="Tmul = \frac{CyTx + CxTy}{CxCy + TxTy}=\frac{CyTx + CxTy}{CxCy}"></span>. значением TxTy в знаменателе можно пренебречь.
   </p>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.14, 2.15, 2.16
  </h2>
  <div>
   <div>
    <p>
     Продемонстрируйте что утверждения Лема из книги правильно. Исследуйте поведение системы на различных арифметических выражениях. Создайте интервалы A и B и используйте их для вычисления A/A и B/B. Вы получите наибольшее понимание, используя интервалы, чья ширина составляет небольшой процент от значения центра. Изучите результаты вычислений в форме центр-процент.
    </p>
    <p>
     получается что при повторном делении умножении мы увеличиваем
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">A</span> <span class="p">(</span><span class="nf">make-center-percent</span> <span class="mi">100</span> <span class="mi">3</span><span class="p">))</span> <span class="p">(</span><span class="nf">B</span> <span class="p">(</span><span class="nf">make-center-percent</span> <span class="mi">80</span> <span class="mi">4</span><span class="p">)))</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">par1</span> <span class="nv">r1</span> <span class="nv">r2</span><span class="p">)</span>
<span class="lineno"> 3 </span>    <span class="p">(</span><span class="nf">div-interval</span> <span class="p">(</span><span class="nf">mul-interval</span> <span class="nv">r1</span> <span class="nv">r2</span><span class="p">)</span>
<span class="lineno"> 4 </span>                  <span class="p">(</span><span class="nf">add-interval</span> <span class="nv">r1</span> <span class="nv">r2</span><span class="p">)))</span>
<span class="lineno"> 5 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">par2</span> <span class="nv">r1</span> <span class="nv">r2</span><span class="p">)</span>
<span class="lineno"> 6 </span>    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">one</span> <span class="p">(</span><span class="nf">make-interval</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)))</span>
<span class="lineno"> 7 </span>      <span class="p">(</span><span class="nf">div-interval</span> <span class="nv">one</span>
<span class="lineno"> 8 </span>                    <span class="p">(</span><span class="nf">add-interval</span> <span class="p">(</span><span class="nf">div-interval</span> <span class="nv">one</span> <span class="nv">r1</span><span class="p">)</span>
<span class="lineno"> 9 </span>                                  <span class="p">(</span><span class="nf">div-interval</span> <span class="nv">one</span> <span class="nv">r2</span><span class="p">)))))</span>
<span class="lineno">10 </span>  <span class="c1">;; Подтверждение утверждения Лема</span>
<span class="lineno">11 </span>  <span class="c1">;; (display (width A))</span>
<span class="lineno">12 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">13 </span>  <span class="c1">;; (display (width B))</span>
<span class="lineno">14 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">15 </span>  <span class="c1">;; (display (par1 A B))</span>
<span class="lineno">16 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">17 </span>  <span class="c1">;; (display (center (par1 A B)))</span>
<span class="lineno">18 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">19 </span>  <span class="c1">;; (display (percent (par1 A B)))</span>
<span class="lineno">20 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">21 </span>  <span class="c1">;; (display (par2 A B))</span>
<span class="lineno">22 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">23 </span>  <span class="c1">;; (display (center (par2 A B)))</span>
<span class="lineno">24 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">25 </span>  <span class="c1">;; (display (percent (par2 A B)))</span>
<span class="lineno">26 </span>  <span class="c1">;; (newline)</span>
<span class="lineno">27 </span>
<span class="lineno">28 </span>  <span class="p">(</span><span class="nb">display </span><span class="s">"****B****"</span><span class="p">)</span>
<span class="lineno">29 </span>  <span class="p">(</span><span class="nb">display </span><span class="nv">B</span><span class="p">)</span>
<span class="lineno">30 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">31 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">center</span> <span class="nv">B</span><span class="p">))</span>
<span class="lineno">32 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">33 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">percent</span> <span class="nv">B</span><span class="p">))</span>
<span class="lineno">34 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">35 </span>  <span class="p">(</span><span class="nb">display </span><span class="s">"****B*(B/B)****"</span><span class="p">)</span>
<span class="lineno">36 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">mul-interval</span> <span class="nv">B</span> <span class="p">(</span><span class="nf">div-interval</span> <span class="nv">B</span> <span class="nv">B</span><span class="p">)))</span>
<span class="lineno">37 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">38 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">center</span> <span class="p">(</span><span class="nf">mul-interval</span> <span class="nv">B</span> <span class="p">(</span><span class="nf">div-interval</span> <span class="nv">B</span> <span class="nv">B</span><span class="p">))))</span>
<span class="lineno">39 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">40 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">percent</span> <span class="p">(</span><span class="nf">mul-interval</span> <span class="nv">B</span> <span class="p">(</span><span class="nf">div-interval</span> <span class="nv">B</span> <span class="nv">B</span><span class="p">))))</span>
<span class="lineno">41 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">42 </span>  <span class="p">)</span>
</pre>
</div>   <div>
    <p>
     Другой пользователь так же заметил различные результаты подсчета интервалов при эквивалентных алгебраических выражениях. Она говорит, что формула для вычисления интервалов с использованием сисетмы Алисы даст более жесткие границы ошибок, если её можно записать в такой форме, что никакая переменная, представляющая неопределенное число, не повторяется. Поэтому par2 "лучше" par1. Права ли она? Почему?
    </p>
    <p>
     "лучше" потому что погрешность получается меньше. она получается меньше, потому что в случае par2 у интервала 1 нет погрешности, поэтому все действия с этим интервалом не приводят к росту погрешности в целом, напротив в первом случае мы вводим дополнительную погрешность при каждом действии с интервалом. А нам нужно вводить погрешность столько раз сколько элемент задействован в цепи. То есть по разу для R1 и R2, поэтому вторая формула лучше.
    </p>
    <p>
     Объясните, в общем, почему эквивалентные алгебраические выражения могут привести к разным ответам. Можете ли вы разработать интервально-арифметический пакет, который не имеет этого недостатка, или эта задача невозможна? (Предупреждение: эта проблема очень сложная.)
    </p>
    <p>
     Алгебраические выражения не учитывают физического смысла встречающихся элементов. Если разрабатывать такой пакет, то нам при каждом расчете нужно знать сколько раз встречается тот или иной элемент и в каким способом он задействован, что бы дать расчет неопределенности конкретно для этого случая. Наверно можно разработать пакет которые будет находить минимально возможную неопределенность. Если проанализировать все действия которые нам надо выполнять и выявить повторы, можно перестроить уравнение таким образом что бы уменьшить количество действий с неопределенными интервалами.
    </p>
   </div>
  </div>
 </div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-134-protsedury-kak-vozvrashchaemye-znacheniia-uprazhneniia-140-146/" class="u-url">SICP 1.34 Процедуры как возвращаемые значения, упражнения 1.40-1.46</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-134-protsedury-kak-vozvrashchaemye-znacheniia-uprazhneniia-140-146/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-15T19:17:40+03:00" itemprop="datePublished" title="2020-01-15 19:17">2020-01-15 19:17</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.40
  </h2>
  <div>
   <div>
    <p>
     Определите процедуру cubic, которая может быть использована вместе с newtons-method для нахождения корней <span class="inline-formula"><img class="img-inline-formula img-formula" width="158" height="16" src="formulae/sXwqMiZD7UL6oHbZ.i0kVUnRMNW4SotUtae6OQ.png" alt="x^3+a\cdot x^2+b\cdot x+c" title="x^3+a\cdot x^2+b\cdot x+c"></span>
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cubic</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">* </span><span class="nv">x</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">a</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">b</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">c</span><span class="p">)))</span>
<span class="lineno">4 </span>
<span class="lineno">5 </span><span class="p">(</span><span class="nf">newtons-method</span> <span class="p">(</span><span class="nf">cubic</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.41
  </h2>
  <div>
   <div>
    <p>
     Определите процедуру double которая принимает процедуру как аргумент и возвращает процедуру, которая применяет переданную процедуру дважды. К примеру (double inc) должена вернуть процедуру которая два раза делает inc. Какое значение вернет (((double (double double)) inc) 5)?
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">double</span> <span class="nv">f</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span><span class="p">))))</span>
<span class="lineno">4 </span><span class="p">(((</span><span class="nf">double</span> <span class="p">(</span><span class="nf">double</span> <span class="nv">double</span><span class="p">))</span> <span class="nv">inc</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">; 16</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.42
  </h2>
  <div>
   <div>
    <p>
     Пусть f и g две функции одного аргумента. Композицией f после g называется <span class="inline-formula"><img class="img-inline-formula img-formula" width="93" height="17" src="formulae/gZRHSPvfgublk.GfaBQZG_htxW7etTPzHVF0_g.png" alt="x\mapsto f(g(x))" title="x\mapsto f(g(x))"></span>. Определите процедуру compose, которая составляет композицию двух функций.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">compose</span> <span class="nv">f</span> <span class="nv">g</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="nf">g</span> <span class="nv">x</span><span class="p">))))</span>
<span class="lineno">3 </span><span class="p">((</span><span class="nf">compose</span> <span class="nv">square</span> <span class="nv">inc</span><span class="p">)</span> <span class="mi">6</span><span class="p">)</span> <span class="c1">; 49</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.43
  </h2>
  <div>
   <div>
    <p>
     Если f числовая функция и n положительное целое, тогда мы можем n раз применить функцию к результату выполнения исходной функции, то есть <span class="inline-formula"><img class="img-inline-formula img-formula" width="124" height="17" src="formulae/HU6llSc5.Zpyr.Hr5NnGjQGw2XI4.RQN15cVAQ.png" alt="f(f(...(f(x))...))" title="f(f(...(f(x))...))"></span>. К примеру, если f(x) = x + 1, тогда если мы применим функцию n раз, то получим функцию f(x)=x+n. Если f - возведение в квадрат,тогда результирующая функция будет x в степени 2n. Напишите процедуру, что бы её можно было использовать вот таким образом ((repeated square 2) 5), используйте compose из упражнения 1.42.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">repeated</span> <span class="nv">f</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">3 </span>      <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span><span class="p">))</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="nf">compose</span> <span class="nv">f</span> <span class="p">(</span><span class="nf">repeated</span> <span class="nv">f</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)))))</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span><span class="p">((</span><span class="nf">repeated</span> <span class="nv">square</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">;; 625</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.44
  </h2>
  <div>
   <div>
    <p>
     Идея сглаживающей функции важна при обработке сигналов. Если f - функция и dx - некоторое малое приращение, тогда сглаженная версия функции f, эта функция значение которой в точке x среднее между f(x-dx) и f(x+dx). Напишете процедуру smooth которая принимает на вход функцию и возвращает сглаженную функцию f. Иногда полезно применить сглаживание несколько раз (то есть сгладить сглаженную функцию) что-бы получить n-раз сглаженную функцию. Покажите как генерировать n раз сглаженную функцию при помощи процедуры repeat из 1.43.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="nv">dx</span> <span class="mf">0.00001</span><span class="p">)</span>
<span class="lineno">2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">smooth</span> <span class="nv">f</span><span class="p">)</span>
<span class="lineno">3 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">average</span> <span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="nb">- </span><span class="nv">x</span> <span class="nv">dx</span><span class="p">))</span> <span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">dx</span><span class="p">)))))</span>
<span class="lineno">4 </span>
<span class="lineno">5 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">smooth-n</span> <span class="nv">f</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">6 </span>  <span class="p">((</span><span class="nf">repeated</span> <span class="nv">smooth</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">f</span><span class="p">))</span>
<span class="lineno">7 </span><span class="p">((</span><span class="nf">smooth</span> <span class="nv">square</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
<span class="lineno">8 </span><span class="p">((</span><span class="nf">smooth-n</span> <span class="nv">square</span> <span class="mi">5</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.45
  </h2>
  <div>
   <div>
    <p>
     В разделе 1.3.3 мы видели, что вычилсить квадратные корни путем лобового нахождения фиксированной точки от <span class="inline-formula"><img class="img-inline-formula img-formula" width="64" height="17" src="formulae/zdJWgnFS7PUYZhExeEvrX_tFSENKt1VSCK.Y5Q.png" alt="y\mapsto x/y" title="y\mapsto x/y"></span> не получается, это удалось починить методом усреднения. Тот же метод работает для нахождения кубического корня. К сожалению процесс не срабатывает для корня четвертой степени. Одного усреднения не достаточно что бы выполнить поиск фиксированной точки для схождения <span class="inline-formula"><img class="img-inline-formula img-formula" width="71" height="18" src="formulae/lgB8nsh8BmlyJvAIU7tAqvbF8Rl8.f5Qr5TrSA.png" alt="y\mapsto x/y^3" title="y\mapsto x/y^3"></span>. C другой стороны если применить усреднение два раза , поиск фиксированной точки начинает сходиться. Поэксперементируйте с количеством усреднений для вычисления корня n-ой степени, то есть на отображении <span class="inline-formula"><img class="img-inline-formula img-formula" width="91" height="18" src="formulae/3G5wsHuLMEIvQKNcMebKrdcrXyGTIDeetUDp8Q.png" alt="y\mapsto x/y^{n-1}" title="y\mapsto x/y^{n-1}"></span>. Используя это запишите процедуру для вычисления корня n-ой степени, через fixed-point, average-damp и repeated.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; 1 ; 1 0</span>
<span class="lineno"> 2 </span><span class="c1">;; 2 ; 2 1</span>
<span class="lineno"> 3 </span>     <span class="c1">; 3 1</span>
<span class="lineno"> 4 </span><span class="c1">;; 4 ; 4 2</span>
<span class="lineno"> 5 </span>     <span class="c1">; 5 2</span>
<span class="lineno"> 6 </span>     <span class="c1">; 6 2</span>
<span class="lineno"> 7 </span>     <span class="c1">; 7 2</span>
<span class="lineno"> 8 </span><span class="c1">;; 8 ; 8 3</span>
<span class="lineno"> 9 </span>     <span class="c1">; 15 3</span>
<span class="lineno">10 </span>     <span class="c1">; 16 4</span>
<span class="lineno">11 </span>     <span class="c1">; 32 4</span>
<span class="lineno">12 </span>     <span class="c1">; 33 5</span>
<span class="lineno">13 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">nth-root</span> <span class="nv">x</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">14 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">get-ad-count</span> <span class="nv">n</span> <span class="nv">i</span><span class="p">)</span>
<span class="lineno">15 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">n</span> <span class="p">(</span><span class="nf">fast-expt</span> <span class="mi">2</span> <span class="nv">i</span><span class="p">))</span>
<span class="lineno">16 </span>        <span class="p">(</span><span class="nb">- </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">17 </span>        <span class="p">(</span><span class="nf">get-ad-count</span> <span class="nv">n</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">i</span> <span class="mi">1</span><span class="p">))))</span>
<span class="lineno">18 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">get-ad-count</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">))</span>
<span class="lineno">19 </span>  <span class="p">(</span><span class="nf">fixed-point</span> <span class="p">((</span><span class="nf">repeated</span> <span class="nv">average-damp</span> <span class="p">(</span><span class="nf">get-ad-count</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">))</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">x</span> <span class="p">(</span><span class="nf">fast-expt</span> <span class="nv">y</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)))))</span>
<span class="lineno">20 </span>               <span class="mf">1.0</span><span class="p">))</span>
<span class="lineno">21 </span><span class="p">(</span><span class="nf">nth-root</span> <span class="mi">27</span> <span class="mi">64</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.46
  </h2>
  <div>
   <div>
    <p>
     Некоторые из численных методов, описанных в этой главе являются примерами примерами чрезвычайно общей вычислитетельной стратегии известной как итеративное улучшение. Итеративное вычисление говорит о том, что для вычисления чего либо, мы начнем с первоначальной догадки для ответа, проверим, является ли догадка достаточно хорошей, иначе улчучшим догадку и продолжим процесс используя улучшенную догадку в качестве новой догадки. Напишите процедуру iterative-improve которая принимает две процедуры в качестве аргументов: метод определяющий достаточно ли хороша догадка и метод улучшения догадки. Iterative-improve должна возвращать процедуру которая принимает в качестве аргумента догадку и улучшает её пока она не проходит проверку на предел. Перепишете процедуру квадратного корня и процедуру fixed-point в терминах iterative-improve.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="nv">tolerance</span> <span class="mf">0.00001</span><span class="p">)</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">close-enough?</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
<span class="lineno"> 3 </span>  <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">abs </span><span class="p">(</span><span class="nb">- </span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">))</span> <span class="nv">tolerance</span><span class="p">))</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iterative-improve</span> <span class="nv">good-enough?</span> <span class="nv">improve</span><span class="p">)</span>
<span class="lineno"> 6 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">try</span> <span class="nv">guess</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno"> 7 </span>    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">next</span> <span class="p">(</span><span class="nf">improve</span> <span class="nv">guess</span><span class="p">)))</span>
<span class="lineno"> 8 </span>      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">close-enough?</span> <span class="nv">guess</span> <span class="nv">next</span><span class="p">)</span>
<span class="lineno"> 9 </span>          <span class="nv">next</span>
<span class="lineno">10 </span>          <span class="p">(</span><span class="nf">try</span> <span class="nv">next</span> <span class="nv">x</span><span class="p">))))</span>
<span class="lineno">11 </span>  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">guess</span><span class="p">)</span> <span class="p">(</span><span class="nf">try</span> <span class="nv">guess</span> <span class="nv">x</span><span class="p">)))</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">sqrt </span><span class="nv">x</span><span class="p">)</span>
<span class="lineno">14 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">improve</span> <span class="nv">guess</span><span class="p">)</span>
<span class="lineno">15 </span>    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">average</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno">16 </span>      <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno">17 </span>    <span class="p">(</span><span class="nf">average</span> <span class="nv">guess</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">x</span> <span class="nv">guess</span><span class="p">)))</span>
<span class="lineno">18 </span>  <span class="p">((</span><span class="nf">iterative-improve</span> <span class="nv">close-enough?</span> <span class="nv">improve</span><span class="p">)</span> <span class="nv">x</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="lineno">19 </span>
<span class="lineno">20 </span><span class="p">(</span><span class="nb">sqrt </span><span class="mi">2</span><span class="p">)</span> <span class="c1">;Value: 1.4142156862745097</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span>
<span class="lineno">23 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fixed-point</span> <span class="nv">f</span><span class="p">)</span>
<span class="lineno">24 </span>  <span class="p">((</span><span class="nf">iterative-improve</span> <span class="nv">close-enough?</span> <span class="nv">f</span><span class="p">)</span> <span class="mf">1.0</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="lineno">25 </span><span class="p">(</span><span class="nf">fixed-point</span> <span class="nv">cos</span><span class="p">)</span> <span class="c1">;Value: .7390822985224024</span>
</pre>
</div>  </div>
 </div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-133-protsedury-kak-obobshchaiushchie-metody-uprazhneniia-135-139/" class="u-url">SICP 1.33 Процедуры как обобщающие методы, упражнения 1.35-1.39</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-133-protsedury-kak-obobshchaiushchie-metody-uprazhneniia-135-139/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-15T01:36:40+03:00" itemprop="datePublished" title="2020-01-15 01:36">2020-01-15 01:36</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.35
  </h2>
  <div>
   <div>
    <p>
     Показать что золотое сечение <span class="inline-formula"><img class="img-inline-formula img-formula" width="10" height="15" src="formulae/nnhzdqchKKCzaVcrUWETL.T75aNctBowFpJaFA.png" alt="\phi" title="\phi"></span> это фиксированная точка трансформации <span class="inline-formula"><img class="img-inline-formula img-formula" width="94" height="17" src="formulae/1nMkSU9aUmKU94eNCFHsW76zCOstgHrGuaN.JA.png" alt="x\mapsto1+1/x" title="x\mapsto1+1/x"></span> и используя этот факт, вычислить <span class="inline-formula"><img class="img-inline-formula img-formula" width="10" height="15" src="formulae/nnhzdqchKKCzaVcrUWETL.T75aNctBowFpJaFA.png" alt="\phi" title="\phi"></span> через fixed-point.
    </p>
    <p>
     По определению фиксированной точки <span class="inline-formula"><img class="img-inline-formula img-formula" width="91" height="17" src="formulae/WYQmJitF3lTCsDqateA03gibfHVchhI21clQqA.png" alt="\phi=1+1/\phi" title="\phi=1+1/\phi"></span>, где <span class="inline-formula"><img class="img-inline-formula img-formula" width="117" height="20" src="formulae/UjJadbN6A6Af7gemc_E398qzlsLx0k7YuMSyaw.png" alt="\phi=(1+\sqrt{5})/2" title="\phi=(1+\sqrt{5})/2"></span> в общем очевидно что <span class="inline-formula"><img class="img-inline-formula img-formula" width="10" height="15" src="formulae/nnhzdqchKKCzaVcrUWETL.T75aNctBowFpJaFA.png" alt="\phi" title="\phi"></span> фиксированная точка на таком отображении.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">phi</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nf">fixed-point</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="p">(</span><span class="nb">/ </span><span class="mi">1</span> <span class="nv">y</span><span class="p">)))</span>
<span class="lineno">3 </span>  <span class="mf">1.0</span><span class="p">))</span>
<span class="lineno">4 </span>
<span class="lineno">5 </span><span class="p">(</span><span class="nf">phi</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">;Value: 1.6180327868852458</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.36
  </h2>
  <div>
   <div>
    <p>
     Измените процедуру fixed-point чтобы она печатала последовательность генерируемых приближений используя newline и display из упражнения 1.22. Затем найдите решение для <span class="inline-formula"><img class="img-inline-formula img-formula" width="76" height="11" src="formulae/HM9Qm.s3HgJ57VPQ4wJ9rQUqMNF5eAQN2wpsuQ.png" alt="x^x=1000" title="x^x=1000"></span> найдя фиксированную точку для <span class="inline-formula"><img class="img-inline-formula img-formula" width="164" height="17" src="formulae/XbkaMPB9jJlE1P3QZghbOy1J0EdWxwV8s53z7g.png" alt="x\mapsto\log(1000)/\log(x)" title="x\mapsto\log(1000)/\log(x)"></span>. Сравните количество шагов с использованием усреднения и без него.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fixed-point</span> <span class="nv">f</span> <span class="nv">first-guess</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">close-enough?</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
<span class="lineno"> 3 </span>    <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">abs </span><span class="p">(</span><span class="nb">- </span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">))</span> <span class="nv">tolerance</span><span class="p">))</span>
<span class="lineno"> 4 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">try</span> <span class="nv">guess</span><span class="p">)</span>
<span class="lineno"> 5 </span>    <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno"> 6 </span>    <span class="p">(</span><span class="nb">display </span><span class="nv">guess</span><span class="p">)</span>
<span class="lineno"> 7 </span>    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">next</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">guess</span><span class="p">)))</span>
<span class="lineno"> 8 </span>      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">close-enough?</span> <span class="nv">guess</span> <span class="nv">next</span><span class="p">)</span>
<span class="lineno"> 9 </span>          <span class="nv">next</span>
<span class="lineno">10 </span>          <span class="p">(</span><span class="nf">try</span> <span class="nv">next</span><span class="p">))))</span>
<span class="lineno">11 </span>  <span class="p">(</span><span class="nf">try</span> <span class="nv">first-guess</span><span class="p">))</span>
</pre>
</div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">xx1000</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nf">fixed-point</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">log </span><span class="mi">1000</span><span class="p">)</span> <span class="p">(</span><span class="nb">log </span><span class="nv">y</span><span class="p">)))</span>
<span class="lineno">3 </span>               <span class="mf">2.0</span><span class="p">))</span>
<span class="lineno">4 </span><span class="p">(</span><span class="nf">xx1000</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     2. 9.965784284662087 3.004472209841214 6.279195757507157 3.759850702401539 5.215843784925895 4.182207192401397 4.8277650983445906 4.387593384662677 4.671250085763899 4.481403616895052 4.6053657460929 4.5230849678718865 4.577114682047341 4.541382480151454 4.564903245230833 4.549372679303342 4.559606491913287 4.552853875788271 4.557305529748263 4.554369064436181 4.556305311532999 4.555028263573554 4.555870396702851 4.555315001192079 4.5556812635433275 4.555439715736846 4.555599009998291 4.555493957531389 4.555563237292884 4.555517548417651 4.555547679306398 4.555527808516254 4.555540912917957 ;Value: 4.555532270803653
    </p>
    <p>
     35 раз.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">xx1000</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nf">fixed-point</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">average</span> <span class="nv">y</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">log </span><span class="mi">1000</span><span class="p">)</span> <span class="p">(</span><span class="nb">log </span><span class="nv">y</span><span class="p">))))</span>
<span class="lineno">3 </span>               <span class="mf">2.0</span><span class="p">))</span>
<span class="lineno">4 </span><span class="p">(</span><span class="nf">xx1000</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     2. 5.9828921423310435 4.922168721308343 4.628224318195455 4.568346513136242 4.5577305909237005 4.555909809045131 4.555599411610624 4.5555465521473675 ;Value: 4.555537551999825
    </p>
    <p>
     10 раз.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.37
  </h2>
  <div>
   <div>
    <p>
     a. Бесконечная непрерывная дробь, выражение вида <span class="inline-formula"><img class="img-inline-formula img-formula" width="137" height="42" src="formulae/sjdXVLc6Vxzo8R25UmTxO.UuXfYfmoa9vN_8.Q.png" alt="f=\frac{N_1}{D_1+\frac{N_2}{D_2+\frac{N_3}{D_3+...}}}" title="f=\frac{N_1}{D_1+\frac{N_2}{D_2+\frac{N_3}{D_3+...}}}"></span>. В качестве примера можно показать что если для всех i <span class="inline-formula"><img class="img-inline-formula img-formula" width="51" height="14" src="formulae/a5St5HY2vJG2jaktUsvEtzVWFraPzgmbnMYF1g.png" alt="N_i=1" title="N_i=1"></span> <span class="inline-formula"><img class="img-inline-formula img-formula" width="52" height="14" src="formulae/bDp8GpJmdsEE0J6UTQXqXGylrL1NSnQeOKvqew.png" alt="D_i=1" title="D_i=1"></span>, то дробь будут равна <span class="inline-formula"><img class="img-inline-formula img-formula" width="28" height="17" src="formulae/jqoyPqGFD.741uy0dJ7pDnObupyLxw9ZqHDK_w.png" alt="1/\phi" title="1/\phi"></span>, где <span class="inline-formula"><img class="img-inline-formula img-formula" width="10" height="15" src="formulae/nnhzdqchKKCzaVcrUWETL.T75aNctBowFpJaFA.png" alt="\phi" title="\phi"></span> золотое сечение рассмотренное в упражнении 1.22. Один из способов приближенного вычисления такой дроби это отсечь дальнейшее деление при каком-то i=k. Такое усечение называется k-выраженная конечная непрерывная дробь. <span class="inline-formula"><img class="img-inline-formula img-formula" width="79" height="43" src="formulae/5YQQAqK.eBLHAcmk.ZOTVEMFDhO2rwHnTcpQRA.png" alt="\frac{N_1}{D_1+\frac{N_2}{...+\frac{N_k}{D_k}}}" title="\frac{N_1}{D_1+\frac{N_2}{...+\frac{N_k}{D_k}}}"></span>. Предположим что n и d процедуры одного аргумента (в терминах индекса i), которые возвращают <span class="inline-formula"><img class="img-inline-formula img-formula" width="20" height="14" src="formulae/sZiS..WGvCGhxZnDSGl5MdBWBV0bOes6DufUgQ.png" alt="N_i" title="N_i"></span> и <span class="inline-formula"><img class="img-inline-formula img-formula" width="20" height="14" src="formulae/E9O3WRQowdTN.EcibQkKJgNdUqBImg.3BViLZQ.png" alt="D_i" title="D_i"></span> в терминологии непрерывной дроби. Определите процедуру cont-frac так что выполнение (cont-frac n d k) вычисляет значение дроби усеченной по k. Проверьте вашу процедуру на приближенное вычисление <span class="inline-formula"><img class="img-inline-formula img-formula" width="28" height="17" src="formulae/jqoyPqGFD.741uy0dJ7pDnObupyLxw9ZqHDK_w.png" alt="1/\phi" title="1/\phi"></span> используя код
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="nf">cont-frac</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno">2 </span>           <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno">3 </span>           <span class="nv">k</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     b. Напишите рекурсивную и итеративную реализацию процедуры cont-frac.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cont-frac</span> <span class="nv">n</span> <span class="nv">d</span> <span class="nv">k</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">revert-index</span> <span class="nv">n</span> <span class="nv">d</span> <span class="nv">i</span><span class="p">)</span>
<span class="lineno"> 3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">i</span> <span class="nv">k</span><span class="p">)</span>
<span class="lineno"> 4 </span>        <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">n</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">d</span> <span class="nv">i</span><span class="p">)</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="lineno"> 5 </span>        <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">n</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">d</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nf">revert-index</span> <span class="nv">n</span> <span class="nv">d</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">i</span> <span class="mi">1</span><span class="p">))))))</span>
<span class="lineno"> 6 </span>  <span class="p">(</span><span class="nf">revert-index</span> <span class="nv">n</span> <span class="nv">d</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="p">(</span><span class="nf">cont-frac</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno"> 9 </span>           <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno">10 </span>           <span class="mi">100</span><span class="p">)</span> <span class="c1">;Value: .6180339887498948</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>
<span class="lineno">13 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cont-frac</span> <span class="nv">n</span> <span class="nv">d</span> <span class="nv">k</span><span class="p">)</span>
<span class="lineno">14 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">i</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno">15 </span>    <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">16 </span>    <span class="p">(</span><span class="nb">display </span><span class="nv">result</span><span class="p">)</span>
<span class="lineno">17 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">i</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">18 </span>        <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">n</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">d</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">result</span><span class="p">))</span>
<span class="lineno">19 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">n</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">d</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">result</span><span class="p">)))))</span>
<span class="lineno">20 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">k</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span><span class="p">(</span><span class="nf">cont-frac</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno">23 </span>           <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno">24 </span>           <span class="mi">100</span><span class="p">)</span> <span class="c1">;Value: .6180339887498948</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.38
  </h2>
  <div>
   <div>
    <p>
     В 1737 швейцарский математик Леонард Эйлер опубликовал мемуары De Fractionibus Continuis, которые содержали запись непрерывной дроби для e-2, где e - основание натурального логарифма. В этой дроби все Ni = 1, а Di соответственно 1, 2, 1, 1, 4, 1, 1, 6, 1, 1, 8, ... Напишите процедуру для приближенного вычисления e.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">e-approximation</span> <span class="nv">k</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nb">+ </span><span class="mi">2</span> <span class="p">(</span><span class="nf">cont-frac</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno"> 3 </span>                  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">i</span> <span class="mi">0</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno"> 4 </span>                               <span class="p">((</span><span class="nb">= </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span> <span class="mf">2.0</span><span class="p">)</span>
<span class="lineno"> 5 </span>                               <span class="p">((</span><span class="nb">&lt;= </span><span class="nv">i</span> <span class="mi">3</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="lineno"> 6 </span>                               <span class="p">((</span><span class="nb">= </span><span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nb">- </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">3</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="mi">2</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">- </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">3</span><span class="p">)))</span>
<span class="lineno"> 7 </span>                               <span class="p">(</span><span class="k">else </span><span class="mf">1.0</span><span class="p">)))</span>
<span class="lineno"> 8 </span>                  <span class="nv">k</span><span class="p">)))</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="p">(</span><span class="nf">e-approximation</span> <span class="mi">100</span><span class="p">)</span> <span class="c1">;Value: 2.7208245385621153</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.39
  </h2>
  <div>
   <div>
    <p>
     Бесконечная дробь для тангенса была опубликована в 1970 немецким математиком Ламбертом. <span class="inline-formula"><img class="img-inline-formula img-formula" width="133" height="37" src="formulae/Kh3Tu0aZ5ik5TrqUeTNCTUfOTq2DBN23c_X9Qw.png" alt="\tan{x}=\frac{x}{1-\frac{x^2}{3-\frac{x^2}{5-...}}}" title="\tan{x}=\frac{x}{1-\frac{x^2}{3-\frac{x^2}{5-...}}}"></span>. Напишите процедуру для приближенного вычисления тангенса.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cont-frac-params</span> <span class="nv">n</span> <span class="nv">d</span> <span class="nv">k</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">i</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno"> 3 </span>    <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno"> 4 </span>    <span class="p">(</span><span class="nb">display </span><span class="nv">result</span><span class="p">)</span>
<span class="lineno"> 5 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">i</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno"> 6 </span>        <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">n</span> <span class="nv">i</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">d</span> <span class="nv">i</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">result</span><span class="p">))</span>
<span class="lineno"> 7 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">n</span> <span class="nv">i</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">d</span> <span class="nv">i</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">result</span><span class="p">)))))</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">k</span> <span class="mf">0.0</span><span class="p">))</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>
<span class="lineno">11 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tan-cf</span> <span class="nv">x</span> <span class="nv">k</span><span class="p">)</span>
<span class="lineno">12 </span>  <span class="p">(</span><span class="nf">cont-frac-params</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span> <span class="nv">j</span><span class="p">)</span> <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">i</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">j</span><span class="p">)</span>
<span class="lineno">13 </span>                          <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">square</span> <span class="nv">j</span><span class="p">))))</span>
<span class="lineno">14 </span>           <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="p">(</span><span class="nb">* </span><span class="mi">2</span> <span class="nv">i</span><span class="p">)))</span>
<span class="lineno">15 </span>           <span class="mi">100</span> <span class="nv">x</span><span class="p">))</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span><span class="p">(</span><span class="nf">tan-cf</span> <span class="mi">2</span> <span class="mi">100</span><span class="p">)</span><span class="c1">;Value: -2.185039863261519</span>
</pre>
</div>  </div>
 </div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-protsedury-vysshego-poriadka-uprazhneniia-129-133/" class="u-url">SICP Процедуры высшего порядка, упражнения 1.29-1.34</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-protsedury-vysshego-poriadka-uprazhneniia-129-133/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-14T12:43:07+03:00" itemprop="datePublished" title="2020-01-14 12:43">2020-01-14 12:43</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.29
  </h2>
  <div>
   <div>
    <p>
     Правило Симпсона более точный метод вычисления интеграла чем метод приведенный ранее в книге. По правилу Симпсона, интеграл функции f от а до b приблизительно равен <span class="inline-formula"><img class="img-inline-formula img-formula" width="344" height="21" src="formulae/ZEjhbtp2azXoWkeqy4AJ.bLxz0MqUj5y_JoL5g.png" alt="\frac{h}{3}[y_0+4y_1+2y_2+...+2y_{n-2}+4y_{n-1}+2y_n]" title="\frac{h}{3}[y_0+4y_1+2y_2+...+2y_{n-2}+4y_{n-1}+2y_n]"></span>, где h=(b-a)/n, <span class="inline-formula"><img class="img-inline-formula img-formula" width="114" height="17" src="formulae/fkSsmMh38xP3c4ajHM7Irs1jWJ1ViSftHhg2Ng.png" alt="y_k=f(a+kh)" title="y_k=f(a+kh)"></span>. Напишите процедуру вычисляющую интеграл по этому методу. Сравните результаты с предыдущим методом при n=100, n=1000.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sum-simpson</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span> <span class="nv">controln</span> <span class="nv">k</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 3 </span>      <span class="mi">0</span>
<span class="lineno"> 4 </span>      <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">controln</span> <span class="nv">k</span><span class="p">)(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">))</span>
<span class="lineno"> 5 </span>         <span class="p">(</span><span class="nf">sum-simpson</span> <span class="nv">term</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">next</span> <span class="nv">b</span> <span class="nv">controln</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">k</span> <span class="mi">1</span><span class="p">)))))</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">integral-simpson</span> <span class="nv">f</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">getdx</span> <span class="nv">start</span> <span class="nv">end</span> <span class="nv">steps</span><span class="p">)</span>
<span class="lineno"> 9 </span>    <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">- </span><span class="nv">end</span> <span class="nv">start</span><span class="p">)</span> <span class="nv">steps</span><span class="p">))</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">dx</span> <span class="p">(</span><span class="nf">getdx</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">n</span><span class="p">)))</span>
<span class="lineno">11 </span>    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">controln</span> <span class="nv">step-number</span><span class="p">)</span>
<span class="lineno">12 </span>      <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">step-number</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">13 </span>            <span class="p">((</span><span class="nb">even? </span><span class="nv">step-number</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
<span class="lineno">14 </span>            <span class="p">(</span><span class="k">else </span><span class="mi">4</span><span class="p">)))</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">next-a</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">17 </span>      <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">dx</span><span class="p">))</span>
<span class="lineno">18 </span>  <span class="c1">;; ;; (define (add-dx x) (+ x (getdx dx)))</span>
<span class="lineno">19 </span>    <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">sum-simpson</span> <span class="nv">f</span> <span class="nv">a</span> <span class="nv">next-a</span> <span class="nv">b</span> <span class="nv">controln</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">20 </span>       <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">getdx</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">n</span><span class="p">)</span> <span class="mi">3</span><span class="p">))</span>
<span class="lineno">21 </span>    <span class="p">))</span>
<span class="lineno">22 </span>
<span class="lineno">23 </span><span class="p">(</span><span class="nf">integral-simpson</span> <span class="nv">cube</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">100</span><span class="p">)</span><span class="c1">;;19/75 0.25333333333333335</span>
<span class="lineno">24 </span><span class="p">(</span><span class="nf">integral-simpson</span> <span class="nv">cube</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">1000</span><span class="p">)</span><span class="c1">;; 751/3000 0.25033333333333335</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.30
  </h2>
  <div>
   <div>
    <p>
     Процедура sum приведенная в книге генерирует линейную рекурсию. Процедуру можно переписать что бы сумма вычислялась итерациями. Покажите как это сделать.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sum</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="k">if </span><span class="nv">&lt;??&gt;</span>
<span class="lineno">4 </span>        <span class="nv">&lt;??&gt;</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="nv">&lt;??&gt;</span> <span class="nv">&lt;??&gt;</span><span class="p">)))</span>
<span class="lineno">6 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">&lt;??&gt;</span> <span class="nv">&lt;??&gt;</span><span class="p">))</span>
</pre>
</div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sum</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">4 </span>        <span class="nv">result</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">result</span> <span class="p">(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">)))))</span>
<span class="lineno">6 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno">7 </span><span class="p">(</span><span class="nf">sum</span> <span class="nv">identity</span> <span class="mi">1</span> <span class="nv">inc</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">; 15</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.31
  </h2>
  <div>
   <div>
    <p>
     a. Процедура sum является лишь простым примером из огромного числа подобных абстракций, которые могут быть сформулированы через процедуры высшего порядка. Напишите аналогичную процедуру product которая возвращает произведение значений функции в точках заданного интервала. Покажите как определить факториал через данную процедуру. Также используйте product для вычисления приближения <span class="inline-formula"><img class="img-inline-formula img-formula" width="10" height="7" src="formulae/pNnv.0JDiPStcnC_sVMLZXeu2Nqgm_VX3SQ9xw.png" alt="\pi" title="\pi"></span> используя формулу <span class="inline-formula"><img class="img-inline-formula img-formula" width="114" height="21" src="formulae/2U4YX2IBoqTMhJ80nyMI7JdFJpeeiyvd2Yp69g.png" alt="\frac{\pi}{4}=\frac{2\cdot4\cdot4\cdot6\cdot6\cdot8...}{3\cdot3\cdot5\cdot5\cdot7\cdot7...}" title="\frac{\pi}{4}=\frac{2\cdot4\cdot4\cdot6\cdot6\cdot8...}{3\cdot3\cdot5\cdot5\cdot7\cdot7...}"></span>.
    </p>
    <p>
     b. Если ваша процедура генерирует рекурсивный процесс, перепишите её на итерационный процесс.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">product</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 3 </span>      <span class="mi">1</span>
<span class="lineno"> 4 </span>      <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">)</span>
<span class="lineno"> 5 </span>         <span class="p">(</span><span class="nf">product</span> <span class="nv">term</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">))))</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">producti</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno"> 9 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">10 </span>        <span class="nv">result</span>
<span class="lineno">11 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">result</span> <span class="p">(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">)))))</span>
<span class="lineno">12 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="mi">1</span><span class="p">))</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">product-factorial</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">15 </span>  <span class="p">(</span><span class="nf">product</span> <span class="nv">identity</span> <span class="mi">1</span> <span class="nv">inc</span> <span class="mi">5</span><span class="p">))</span>
<span class="lineno">16 </span><span class="p">(</span><span class="nf">product-factorial</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">;; 120</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">multiplicate-pi</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">19 </span>  <span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">+ </span><span class="mi">4</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">5</span> <span class="nv">x</span><span class="p">))))</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">product-pi</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">22 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub-pi</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">23 </span>    <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nb">/ </span><span class="nv">x</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="mi">1</span><span class="p">))))</span>
<span class="lineno">24 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">next-x</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">25 </span>    <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno">26 </span>  <span class="p">(</span><span class="nb">* </span><span class="mi">4</span> <span class="p">(</span><span class="nf">product</span> <span class="nv">sub-pi</span> <span class="mi">2</span> <span class="nv">next-x</span> <span class="nv">n</span><span class="p">)))</span>
<span class="lineno">27 </span><span class="p">(</span><span class="nf">product-pi</span> <span class="mi">1000</span><span class="p">)</span> <span class="c1">; 3.1431607055322663</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.32
  </h2>
  <div>
   <div>
    <p>
     a. Покажите что процедуры sum и product оба являются частными случаями более общей нотации accumulate, которая объединяет набор терминов в более общую функцию.
    </p>
    <p>
     b. сделайте рекурсивный и итерационный вариант.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; рекурсивный</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">accumulate</span> <span class="nv">combiner</span> <span class="nv">null-value</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 3 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 4 </span>      <span class="nv">null-value</span>
<span class="lineno"> 5 </span>      <span class="p">(</span><span class="nf">combiner</span> <span class="p">(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">)</span>
<span class="lineno"> 6 </span>                <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">combiner</span> <span class="nv">null-value</span> <span class="nv">term</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">))))</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="c1">;; итерационный</span>
<span class="lineno"> 9 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">accumulate</span> <span class="nv">combiner</span> <span class="nv">null-value</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno">11 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">12 </span>      <span class="nv">result</span>
<span class="lineno">13 </span>      <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">combiner</span> <span class="nv">result</span> <span class="p">(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">)))))</span>
<span class="lineno">14 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="nv">null-value</span><span class="p">))</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">product</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">17 </span>  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">*</span> <span class="mi">1</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">))</span>
<span class="lineno">18 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sum</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">19 </span>  <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">+</span> <span class="mi">0</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span><span class="p">))</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">accumulate-factorial</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">22 </span>  <span class="p">(</span><span class="nf">product</span> <span class="nv">identity</span> <span class="mi">1</span> <span class="nv">inc</span> <span class="mi">5</span><span class="p">))</span>
<span class="lineno">23 </span><span class="p">(</span><span class="nf">accumulate-factorial</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">; 120</span>
<span class="lineno">24 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">accumulate-sum</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">25 </span>  <span class="p">(</span><span class="nf">sum</span> <span class="nv">identity</span> <span class="nv">a</span> <span class="nv">inc</span> <span class="nv">b</span><span class="p">))</span>
<span class="lineno">26 </span><span class="p">(</span><span class="nf">accumulate-sum</span> <span class="mi">1</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">; 15</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.33
  </h2>
  <div>
   <div>
    <p>
     Вы можете получить еще более общую версию accumulate, введя понятие фильтра по слагаемым. То есть складывать (или перемножать) только те значения которые удовлетворяют заданному условию. Результирующая абстракция filtered-accumulate все те же параметры как и accumulate, плюс дополнительным предикатом одного аргумента, описывающим фильтр. Напишите процедуру filtered-accumulate. Покажите как выразить следующие понятия используя её.
    </p>
    <p>
     a. Сумма квадратов простых чисел в интервале от a до b. b. Перемножение всех положительных целых меньших чем n, которые взаимно простых с n (GCD (i,n) = 1)
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; рекурсивный</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">filtered-accumulate</span> <span class="nv">combiner</span> <span class="nv">null-value</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span> <span class="nv">filter</span><span class="p">)</span>
<span class="lineno"> 3 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 4 </span>      <span class="nv">null-value</span>
<span class="lineno"> 5 </span>      <span class="p">(</span><span class="nf">combiner</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">filter</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">null-value</span><span class="p">)</span>
<span class="lineno"> 6 </span>                <span class="p">(</span><span class="nf">filtered-accumulate</span> <span class="nv">combiner</span> <span class="nv">null-value</span> <span class="nv">term</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">next</span> <span class="nv">b</span> <span class="nv">filter</span><span class="p">))))</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="c1">;; итерационный</span>
<span class="lineno"> 9 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">filtered-accumulate</span> <span class="nv">combiner</span> <span class="nv">null-value</span> <span class="nv">term</span> <span class="nv">a</span> <span class="nv">next</span> <span class="nv">b</span> <span class="nv">filter</span><span class="p">)</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno">11 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">12 </span>      <span class="nv">result</span>
<span class="lineno">13 </span>      <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">filter</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">14 </span>                         <span class="p">(</span><span class="nf">combiner</span> <span class="nv">result</span> <span class="p">(</span><span class="nf">term</span> <span class="nv">a</span><span class="p">))</span>
<span class="lineno">15 </span>                         <span class="nv">result</span><span class="p">)</span>
<span class="lineno">16 </span>            <span class="p">)))</span>
<span class="lineno">17 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">a</span> <span class="nv">null-value</span><span class="p">))</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span>
<span class="lineno">20 </span><span class="c1">;; cумма квадратов целых в диапазоне</span>
<span class="lineno">21 </span><span class="c1">;; передаем в фильтр два параметра a b что бы работало абстракция со следующим примером</span>
<span class="lineno">22 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">filter-prime?</span> <span class="nv">x</span> <span class="nv">end</span><span class="p">)</span>
<span class="lineno">23 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">prime?</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">24 </span>      <span class="mi">1</span>
<span class="lineno">25 </span>      <span class="nv">false</span><span class="p">))</span>
<span class="lineno">26 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sum-square-primes</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">27 </span>  <span class="p">(</span><span class="nf">filtered-accumulate</span> <span class="nv">+</span> <span class="mi">0</span> <span class="nv">square</span> <span class="nv">a</span> <span class="nv">inc</span> <span class="nv">b</span> <span class="nv">filter-prime?</span><span class="p">))</span>
<span class="lineno">28 </span><span class="p">(</span><span class="nf">sum-square-primes</span> <span class="mi">1</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">; 14</span>
<span class="lineno">29 </span>
<span class="lineno">30 </span><span class="c1">;; перемножение всех взаимно простых с n в диапазоне [m n]</span>
<span class="lineno">31 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">filter-relative-prime?</span> <span class="nv">x</span> <span class="nv">end</span><span class="p">)</span>
<span class="lineno">32 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">gcd </span><span class="nv">x</span> <span class="nv">end</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">33 </span>      <span class="mi">1</span>
<span class="lineno">34 </span>      <span class="nv">false</span><span class="p">))</span>
<span class="lineno">35 </span>
<span class="lineno">36 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">product-relative-primes</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">37 </span>  <span class="p">(</span><span class="nf">filtered-accumulate</span> <span class="nv">*</span> <span class="mi">1</span> <span class="nv">identity</span> <span class="nv">a</span> <span class="nv">inc</span> <span class="nv">b</span> <span class="nv">filter-relative-prime?</span><span class="p">))</span>
<span class="lineno">38 </span><span class="p">(</span><span class="nf">product-relative-primes</span> <span class="mi">1</span> <span class="mi">6</span><span class="p">)</span><span class="c1">; 5</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.34
  </h2>
  <div>
   <div>
    <p>
     Предположим мы определили процедуру
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">f</span> <span class="nv">g</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nf">g</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno">3 </span><span class="p">(</span><span class="nf">f</span> <span class="nv">square</span><span class="p">)</span> <span class="c1">; 4</span>
<span class="lineno">4 </span><span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">z</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">z</span> <span class="mi">1</span><span class="p">))))</span> <span class="c1">; 6</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span><span class="p">(</span><span class="mi">2</span> <span class="mi">2</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     Что произойдет если вызвать (f f)?
    </p>
    <p>
     Происходит ошибка ;The object 2 is not applicable. Функция f ожидает в качестве параметра получить функцию которую можно вызвать, она его и получает и вызывает функцию f с параметром 2 (рекурсивно второй раз), и пытается выполнить функцию (2 2), на что и ругается интерпретатор, потому что 2 не процедура.
    </p>
   </div>
  </div>
 </div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-uprazhneniia-125-126-127-128/" class="u-url">SICP Упражнения 1.25, 1.26, 1.27, 1.28</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-uprazhneniia-125-126-127-128/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-13T14:34:28+03:00" itemprop="datePublished" title="2020-01-13 14:34">2020-01-13 14:34</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.25
  </h2>
  <div>
   <div>
    <p>
     Алиса посетовала что мы проделали много лишней работы при написании expmod. В конце концов, сказала она, мы уже знаем как посчитать экспоненту, мы могли бы просто написать:
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">expmod</span> <span class="nv">base</span> <span class="nv">exp</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nf">fast-expt</span> <span class="nv">base</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">m</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     Правильно ли это? Будет ли эта процедура работать так же быстро как fast-prime тест?
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; метод который используем в fast-prime?</span>
<span class="lineno"> 2 </span><span class="c1">;; Два числа называются сопоставимыми по модулю n если оба имеют одинаковый остаток при делении на n.</span>
<span class="lineno"> 3 </span><span class="c1">;; вызывая каждый раз reminder, числа с которыми мы работаем остаются малыми</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="c1">;; 2 7 7</span>
<span class="lineno"> 6 </span><span class="c1">;; 2 &lt;- 2 * (2 6 7)</span>
<span class="lineno"> 7 </span><span class="c1">;; 1 &lt;- square (2 3 7)</span>
<span class="lineno"> 8 </span><span class="c1">;; 1 &lt;- 2 * (2 2 7)</span>
<span class="lineno"> 9 </span><span class="c1">;; 4 &lt;- sqaure (2 1 7)</span>
<span class="lineno">10 </span><span class="c1">;; 2 &lt;- 2 * (2 0 7)</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">expmod</span> <span class="nv">base</span> <span class="nv">exp</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno">13 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">exp</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">14 </span>        <span class="p">((</span><span class="nb">even? </span><span class="nv">exp</span><span class="p">)</span>
<span class="lineno">15 </span>         <span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nf">expmod</span> <span class="nv">base</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">exp</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">m</span><span class="p">))</span>
<span class="lineno">16 </span>                    <span class="nv">m</span><span class="p">))</span>
<span class="lineno">17 </span>        <span class="p">(</span><span class="nf">else</span>
<span class="lineno">18 </span>         <span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nb">* </span><span class="nv">base</span> <span class="p">(</span><span class="nf">expmod</span> <span class="nv">base</span> <span class="p">(</span><span class="nb">- </span><span class="nv">exp</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">m</span><span class="p">))</span>
<span class="lineno">19 </span>                    <span class="nv">m</span><span class="p">))))</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span><span class="nv">expmod</span> <span class="p">(</span><span class="mi">100</span> <span class="mi">1000000007</span> <span class="mi">1000000007</span><span class="p">)</span>
<span class="lineno">22 </span><span class="nv">reminder</span> <span class="p">(</span><span class="mi">100</span> <span class="nv">*</span> <span class="p">[</span><span class="nv">expmod</span><span class="p">(</span><span class="mi">100</span> <span class="mi">1000000006</span> <span class="mi">1000000007</span><span class="p">)])</span> <span class="mi">1000000007</span>
<span class="lineno">23 </span><span class="c1">;; тут мы будем умножать на остаток []</span>
<span class="lineno">24 </span><span class="p">[]</span> <span class="nv">=</span> <span class="nv">reminder</span> <span class="p">(</span><span class="nf">square</span> <span class="p">([</span><span class="nv">expmod</span> <span class="mi">100</span> <span class="mi">500000003</span> <span class="mi">1000000007</span><span class="p">]))</span> <span class="mi">1000000007</span><span class="p">)</span>
<span class="lineno">25 </span><span class="c1">;; возводить в квадрат и перемножать мы будем остаток от деления</span>
<span class="lineno">26 </span><span class="c1">;; мы сделаем это лагорифмическое число раз</span>
<span class="lineno">27 </span><span class="nv">reminder</span> <span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="mi">100</span> <span class="nv">*</span> <span class="nv">expmod</span><span class="p">(</span><span class="mi">100</span> <span class="mi">1000000006</span><span class="nv">/2</span> <span class="mi">1000000007</span><span class="p">))</span>
<span class="lineno">28 </span>
<span class="lineno">29 </span><span class="c1">;; метод Алисы</span>
<span class="lineno">30 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fast-expt</span> <span class="nv">b</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">31 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">32 </span>        <span class="p">((</span><span class="nb">even? </span><span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nf">fast-expt</span> <span class="nv">b</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">n</span> <span class="mi">2</span><span class="p">))))</span>
<span class="lineno">33 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">* </span><span class="nv">b</span> <span class="p">(</span><span class="nf">fast-expt</span> <span class="nv">b</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))))))</span>
<span class="lineno">34 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">expmod</span> <span class="nv">base</span> <span class="nv">exp</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno">35 </span>  <span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nf">fast-expt</span> <span class="nv">base</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">m</span><span class="p">))</span>
<span class="lineno">36 </span><span class="c1">;; тут мы сначала вычисляем экспоненту, с числами навроде 100**1000000007</span>
<span class="lineno">37 </span><span class="c1">;; умножение и возведение в квадрат на таких больших числах приводит к росту времени, алгоритм у нас по прежнему имеет лагорифмическую оценку по подсчету экспоненты, но порядок цифр таков, что обычное умножение требует больгих ресурсов компьютера.</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.26
  </h2>
  <div>
   <div>
    <p>
     Луи изменил процедуру expmod как приведено ниже.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">expmod</span> <span class="nv">base</span> <span class="nv">exp</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">exp</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">3 </span>        <span class="p">((</span><span class="nb">even? </span><span class="nv">exp</span><span class="p">)</span>
<span class="lineno">4 </span>         <span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">expmod</span> <span class="nv">base</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">exp</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno">5 </span>                       <span class="p">(</span><span class="nf">expmod</span> <span class="nv">base</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">exp</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">m</span><span class="p">))</span>
<span class="lineno">6 </span>                    <span class="nv">m</span><span class="p">))</span>
<span class="lineno">7 </span>        <span class="p">(</span><span class="nf">else</span>
<span class="lineno">8 </span>         <span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nb">* </span><span class="nv">base</span> <span class="p">(</span><span class="nf">expmod</span> <span class="nv">base</span> <span class="p">(</span><span class="nb">- </span><span class="nv">exp</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">m</span><span class="p">))</span>
<span class="lineno">9 </span>                    <span class="nv">m</span><span class="p">))))</span>
</pre>
</div>   <div>
    <p>
     Его тест с fast-prime? стал работать медленнее теста prime? Записав процедуру таким образом мы изменили порядок роста <span class="inline-formula"><img class="img-inline-formula img-formula" width="69" height="17" src="formulae/1x5T1vUP00ZqvVjCivgudKxH94n8CzR8J2yhGg.png" alt="\theta(log(n))" title="\theta(log(n))"></span> на <span class="inline-formula"><img class="img-inline-formula img-formula" width="32" height="17" src="formulae/cCSlLH6spWmUZ.yEu3RFI4JpEISlQpO3e_iouA.png" alt="\theta(n)" title="\theta(n)"></span>. Поясните.
    </p>
    <p>
     На каждой итерации (вернее через одну) мы сокращаем показатель экспоненты в два раза, но при этом мы увеличиваем количество операций в два раза. И таких шагов будет порядка n. То есть порядок роста данной процедуры будет <span class="inline-formula"><img class="img-inline-formula img-formula" width="125" height="17" src="formulae/l0_g5HESpbwL51Bg3kOuV1NK6d.gEU49UQiD0w.png" alt="\theta(log(2^n) = \theta(n)" title="\theta(log(2^n) = \theta(n)"></span>.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.27
  </h2>
  <div>
   <div>
    <p>
     Продемонстрируйте что числа Кармайкла действительно проходят тест Фрема. Напишите процедуру которая принимает целое и тестуриует все числе &lt; n.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fermat-test-all</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter-test</span> <span class="nv">a</span><span class="p">)</span>
<span class="lineno"> 3 </span>    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">&gt;= </span><span class="nv">a</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">display </span><span class="s">"passed full fermat"</span><span class="p">))</span>
<span class="lineno"> 4 </span>          <span class="p">((</span><span class="nb">= </span><span class="p">(</span><span class="nf">expmod</span> <span class="nv">a</span> <span class="nv">n</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">iter-test</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">a</span> <span class="mi">1</span><span class="p">)))</span>
<span class="lineno"> 5 </span>          <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">display </span><span class="s">"Ferma test failed"</span><span class="p">))))</span>
<span class="lineno"> 6 </span>  <span class="p">(</span><span class="nf">iter-test</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="p">(</span><span class="nf">fermat-test-all</span> <span class="mi">561</span><span class="p">)</span>  <span class="c1">; passed full fermat</span>
<span class="lineno"> 9 </span><span class="p">(</span><span class="nf">fermat-test-all</span> <span class="mi">1105</span><span class="p">)</span> <span class="c1">; passed full fermat</span>
<span class="lineno">10 </span><span class="p">(</span><span class="nf">fermat-test-all</span> <span class="mi">1729</span><span class="p">)</span> <span class="c1">; passed full fermat</span>
<span class="lineno">11 </span><span class="p">(</span><span class="nf">fermat-test-all</span> <span class="mi">2465</span><span class="p">)</span> <span class="c1">; passed full fermat</span>
<span class="lineno">12 </span><span class="p">(</span><span class="nf">fermat-test-all</span> <span class="mi">2821</span><span class="p">)</span> <span class="c1">; passed full fermat</span>
<span class="lineno">13 </span><span class="p">(</span><span class="nf">fermat-test-all</span> <span class="mi">6601</span><span class="p">)</span> <span class="c1">; passed full fermat</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.28
  </h2>
  <div>
   <div>
    <p>
     Один из вариантов теста Ферма, который не может быть одурачен числами Кармайкла, называется тест Миллера-Рабина (Миллер 1976; Рабин 1980). Он отталкивается от альтернативной формы Малой Теоремы Ферма, которая говорит что, если n - простое число и есть положительное целое a меньшее n, тогда <span class="inline-formula"><img class="img-inline-formula img-formula" width="124" height="18" src="formulae/h1NxGLnmrm3jF.Dr5t2Dx3FVFJTQnTF5iXXiSQ.png" alt="a^{n-1} \equiv 1 mod(n)" title="a^{n-1} \equiv 1 mod(n)"></span>.
    </p>
    <p>
     Для тестирования простоты числа n, мы выбираем произвольный a &lt; n и возводим его в степень (n-1), берем модуль используя процедуру expmod.
    </p>
    <p>
     Каждый раз когда мы выполняем возведение в квадрат, мы делаем дополнительную проверку на "не тривиальность квадратного корня к 1 по модулю n", то есть число не равное 1 или n-1, квадрат которого равен 1 по модулю n. Возможно доказать что если есть нетривиальный квадратный корень сопоставимый с 1 mod n, тогда n не простое. Также возможно доказать что если n нечетное число, которое не является простым, то по крайне мере для половины чисел a&lt;n, вычисление <span class="inline-formula"><img class="img-inline-formula img-formula" width="36" height="14" src="formulae/DiMGXUF1qBWcScK6PAT_f9sf89ACJHw5efZfAg.png" alt="a^{n-1}" title="a^{n-1}"></span> таким образом выявит нетривиальный квадратный корень от 1 по модулю n. (Именно из-за этого уточнения числа Кармайкла отсеиваются). Измените процедуру expmod что бы в случае обнаружения нетривиального квадратного корня она сигнализировала об ошибке.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">expmod-miller-rabin</span> <span class="nv">base</span> <span class="nv">exp</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">exp</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno"> 3 </span>        <span class="p">((</span><span class="nb">even? </span><span class="nv">exp</span><span class="p">)</span>
<span class="lineno"> 4 </span>         <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">x</span> <span class="p">(</span><span class="nf">expmod-miller-rabin</span> <span class="nv">base</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">exp</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">m</span><span class="p">)))</span>
<span class="lineno"> 5 </span>           <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">= </span><span class="nv">x</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">x</span> <span class="p">(</span><span class="nb">- </span><span class="nv">m</span> <span class="mi">1</span><span class="p">)))</span> <span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nf">square</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">m</span><span class="p">))</span>
<span class="lineno"> 6 </span>                 <span class="p">((</span><span class="nb">= </span><span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nf">square</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">m</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno"> 7 </span>                 <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nf">square</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">m</span><span class="p">)))))</span>
<span class="lineno"> 8 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nb">* </span><span class="nv">base</span> <span class="p">(</span><span class="nf">expmod-miller-rabin</span> <span class="nv">base</span> <span class="p">(</span><span class="nb">- </span><span class="nv">exp</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">m</span><span class="p">))</span>
<span class="lineno"> 9 </span>                         <span class="nv">m</span><span class="p">))))</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">miller-rabin-test-all</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">12 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter-test</span> <span class="nv">a</span><span class="p">)</span>
<span class="lineno">13 </span>    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">&gt;= </span><span class="nv">a</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">display </span><span class="s">"passed full miller-rabin test"</span><span class="p">))</span>
<span class="lineno">14 </span>          <span class="p">((</span><span class="nb">= </span><span class="p">(</span><span class="nf">expmod-miller-rabin</span> <span class="nv">a</span> <span class="nv">n</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">iter-test</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">a</span> <span class="mi">1</span><span class="p">)))</span>
<span class="lineno">15 </span>          <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">display </span><span class="s">"miller-rabin test failed"</span><span class="p">))))</span>
<span class="lineno">16 </span>  <span class="p">(</span><span class="nf">iter-test</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span><span class="p">(</span><span class="nf">miller-rabin-test-all</span> <span class="mi">1999</span><span class="p">)</span> <span class="c1">;;  passed full miller-rabin test</span>
<span class="lineno">19 </span><span class="p">(</span><span class="nf">miller-rabin-test-all</span> <span class="mi">561</span><span class="p">)</span> <span class="c1">;;  miller-rabin test failed</span>
</pre>
</div>  </div>
 </div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-uprazhneniia-120-124/" class="u-url">SICP Упражнения 1.20, 1.21, 1.22, 1.23, 1.24</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-uprazhneniia-120-124/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-12T12:32:43+03:00" itemprop="datePublished" title="2020-01-12 12:32">2020-01-12 12:32</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.20
  </h2>
  <div>
   <div>
    <p>
     Процесс который генерируется процедурой естественно зависит от правил интерпритатора. Как пример возьмем итеративную процецудуру нахождения наибольшего общего делителя приведенного выше. Предположим мы интерпритируем это процедуру используя "нормамальный порядок выполнения". Используя метод подстановки проиллюстрируйте процесс вычисления (gcd 206 40) и указать "reminder" операции которые реально выполняются. Сколько таких операций выполнится при "нормальном порядке" и сколько при "апликативном".
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; нормальный порядок</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="nb">gcd </span><span class="mi">206</span> <span class="mi">40</span><span class="p">)</span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="mi">40</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="nb">gcd </span><span class="mi">40</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">))</span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span> <span class="c1">; 6 + 1 раз</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="mi">6</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="nb">gcd </span><span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">)</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">40</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">)))</span>
<span class="lineno"> 8 </span><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">remainder </span><span class="mi">40</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">))</span> <span class="mi">0</span><span class="p">))</span> <span class="c1">; 4 + 2 раза</span>
<span class="lineno"> 9 </span><span class="p">(</span><span class="nb">gcd </span><span class="p">(</span><span class="nb">remainder </span><span class="mi">40</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">))</span> <span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">)</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">40</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">))))</span>
<span class="lineno">10 </span><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">)</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">40</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">)))</span> <span class="mi">0</span><span class="p">))</span> <span class="c1">; 2 + 4 раза</span>
<span class="lineno">11 </span><span class="p">(</span><span class="nb">gcd </span><span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">)</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">40</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">)))</span> <span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nb">remainder </span><span class="mi">40</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">))</span> <span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">)</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">40</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">)))))</span>
<span class="lineno">12 </span><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nf">reminder</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">40</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">))</span> <span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">)</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">40</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">))))</span> <span class="mi">0</span><span class="p">))</span><span class="c1">; 0; + 7 раз</span>
<span class="lineno">13 </span><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="mi">0</span> <span class="mi">0</span><span class="p">)</span> <span class="o">...</span><span class="p">)</span>
<span class="lineno">14 </span><span class="p">(</span><span class="nb">remainder </span><span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">)</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">40</span> <span class="p">(</span><span class="nb">remainder </span><span class="mi">206</span> <span class="mi">40</span><span class="p">)))</span> <span class="c1">;; 4 раза</span>
<span class="lineno">15 </span><span class="c1">;; 18 вычислений reminder</span>
<span class="lineno">16 </span><span class="c1">;; при апликативной форме этих вычислений всего 4</span>
</pre>
</div>   <div>
    <p>
     Вывод: при normal-order-evaluation 18 вызовов reminder, при applicative-order-evaluation 4.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.21
  </h2>
  <div>
   <div>
    <p>
     Используя процедуру "smallest-divisor" Найдите наиментший делитель для 199б 1999, 19999
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">smallest-divisor</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nf">find-divisor</span> <span class="nv">n</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">find-divisor</span> <span class="nv">n</span> <span class="nv">test-divisor</span><span class="p">)</span>
<span class="lineno"> 4 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">&gt; </span><span class="p">(</span><span class="nf">square</span> <span class="nv">test-divisor</span><span class="p">)</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 5 </span>        <span class="p">((</span><span class="nf">divides?</span> <span class="nv">test-divisor</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">test-divisor</span><span class="p">)</span>
<span class="lineno"> 6 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">find-divisor</span> <span class="nv">n</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">test-divisor</span> <span class="mi">1</span><span class="p">)))))</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">divides?</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">remainder </span><span class="nv">b</span> <span class="nv">a</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="p">(</span><span class="nf">smallest-divisor</span> <span class="mi">199</span><span class="p">)</span> <span class="c1">; 199</span>
<span class="lineno">11 </span><span class="p">(</span><span class="nf">smallest-divisor</span> <span class="mi">1999</span><span class="p">)</span> <span class="c1">; 1999</span>
<span class="lineno">12 </span><span class="p">(</span><span class="nf">smallest-divisor</span> <span class="mi">19999</span><span class="p">)</span> <span class="c1">; 7</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.22
  </h2>
  <div>
   <div>
    <p>
     Большинство реализаций lisp включаются примитиву runtime, которая возвращает время работы системы. Ниже написана процедура которое замеряет время теста на простоту. Используя ей, напишите процедуру search-for-primes, которая проверяет простоту последовательных нечетных целых в заданном диапазоне. Используйте её чтобы найти 3 простых &gt; 1000; &gt; 10 000; &gt; 100 000; &gt; 1 000 000. Замерьте время для проверки каждого простого числа. Так как тестирующий алгоритм имеет порядок роста <span class="inline-formula"><img class="img-inline-formula img-formula" width="47" height="18" src="formulae/Fm5mrdojcg8nfk0moVZWNPpDRW6kuON6Rr83Gg.png" alt="\theta(\sqrt{n})" title="\theta(\sqrt{n})"></span>, вы должны ожидать получить для время для 10 000 в <span class="inline-formula"><img class="img-inline-formula img-formula" width="32" height="18" src="formulae/stpajtmjWkASRa_Px.gSazh7yZYs.WaF43zFUg.png" alt="\sqrt{10}" title="\sqrt{10}"></span> больше времени чем для 1 000. Посмотрите как работает это соотношение для разных диапазонов n.
    </p>
    <p>
     Запись кривовата, потому что нет конструкции (let или progn как в emacs lisp, просто их еще не было в курсе). Тенденция <span class="inline-formula"><img class="img-inline-formula img-formula" width="33" height="18" src="formulae/R5RobS5u6di.UD.78_HWXVOLw_0Y2cnEpyVVEQ.png" alt="\theta{\sqrt{n}}" title="\theta{\sqrt{n}}"></span> начинает походить на оценку только с 10 000 000. До этого все данные совпадают и нет прироста.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">report-prime</span> <span class="nv">start-time</span> <span class="nv">end-time</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno"> 3 </span>  <span class="p">(</span><span class="nb">display </span><span class="s">" *** "</span><span class="p">)</span>
<span class="lineno"> 4 </span>  <span class="p">(</span><span class="nb">display </span><span class="nv">start-time</span><span class="p">)</span>
<span class="lineno"> 5 </span>  <span class="p">(</span><span class="nb">display </span><span class="s">"; "</span><span class="p">)</span>
<span class="lineno"> 6 </span>  <span class="p">(</span><span class="nb">display </span><span class="nv">end-time</span><span class="p">)</span>
<span class="lineno"> 7 </span>  <span class="p">(</span><span class="nb">display </span><span class="s">"; "</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nb">- </span><span class="nv">end-time</span> <span class="nv">start-time</span><span class="p">)))</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">prime?</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">11 </span>  <span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="p">(</span><span class="nf">smallest-divisor</span> <span class="nv">n</span><span class="p">)))</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">search-iter</span> <span class="nv">from</span> <span class="nv">number</span> <span class="nv">start-time</span><span class="p">)</span>
<span class="lineno">14 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">= </span><span class="nv">number</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno">15 </span>      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">prime?</span> <span class="nv">from</span><span class="p">)</span>
<span class="lineno">16 </span>          <span class="p">(</span><span class="nf">report-and-continue</span> <span class="nv">from</span> <span class="nv">number</span> <span class="nv">start-time</span> <span class="p">(</span><span class="nf">runtime</span><span class="p">))</span>
<span class="lineno">17 </span>          <span class="p">(</span><span class="nf">search-iter</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">from</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">number</span> <span class="nv">start-time</span><span class="p">))))</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">report-and-continue</span> <span class="nv">from</span> <span class="nv">number</span> <span class="nv">start-time</span> <span class="nv">end-time</span><span class="p">)</span>
<span class="lineno">20 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">21 </span>  <span class="p">(</span><span class="nb">display </span><span class="nv">from</span><span class="p">)</span>
<span class="lineno">22 </span>  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
<span class="lineno">23 </span>  <span class="p">(</span><span class="nf">report-prime</span> <span class="nv">start-time</span> <span class="nv">end-time</span><span class="p">)</span>
<span class="lineno">24 </span>  <span class="p">(</span><span class="nf">search-iter</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">from</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">- </span><span class="nv">number</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">start-time</span><span class="p">))</span>
<span class="lineno">25 </span>
<span class="lineno">26 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">search-for-primes</span> <span class="nv">from</span> <span class="nv">number</span><span class="p">)</span>
<span class="lineno">27 </span>  <span class="p">(</span><span class="nf">search-iter</span> <span class="nv">from</span> <span class="nv">number</span> <span class="p">(</span><span class="nf">runtime</span><span class="p">)))</span>
<span class="lineno">28 </span>
<span class="lineno">29 </span><span class="p">(</span><span class="nf">search-for-primes</span> <span class="mi">1000</span> <span class="mi">3</span><span class="p">)</span>
<span class="lineno">30 </span><span class="p">(</span><span class="nf">search-for-primes</span> <span class="mi">10000</span> <span class="mi">3</span><span class="p">)</span>
<span class="lineno">31 </span><span class="p">(</span><span class="nf">search-for-primes</span> <span class="mi">100000</span> <span class="mi">3</span><span class="p">)</span>
<span class="lineno">32 </span><span class="p">(</span><span class="nf">search-for-primes</span> <span class="mi">1000000</span> <span class="mi">3</span><span class="p">)</span>
<span class="lineno">33 </span><span class="p">(</span><span class="nf">search-for-primes</span> <span class="mi">10000000</span> <span class="mi">3</span><span class="p">)</span>
<span class="lineno">34 </span><span class="p">(</span><span class="nf">search-for-primes</span> <span class="mi">100000000</span> <span class="mi">3</span><span class="p">)</span>
</pre>
</div>   <div class="center-block">
    <p>
     </p>
<div class="tabular-wrapper"><table>
<tr>
<td class="cell-lt" style="text-align: left;">1009 </td>
<td class="cell-lrt" style="text-align: center;"> 0. </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">1013 </td>
<td class="cell-lrt" style="text-align: center;"> 1.0000000000001563e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">1019 </td>
<td class="cell-lrt" style="text-align: center;"> 1.0000000000001563e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">10007 </td>
<td class="cell-lrt" style="text-align: center;"> 0. </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">10009 </td>
<td class="cell-lrt" style="text-align: center;"> .00999999999999801 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">10037 </td>
<td class="cell-lrt" style="text-align: center;"> 1.9999999999999574e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">100003 </td>
<td class="cell-lrt" style="text-align: center;"> 0. </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">100019 </td>
<td class="cell-lrt" style="text-align: center;"> 1.0000000000001563e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">100043 </td>
<td class="cell-lrt" style="text-align: center;"> 1.9999999999999574e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">1000003 </td>
<td class="cell-lrt" style="text-align: center;"> 0. </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">1000033 </td>
<td class="cell-lrt" style="text-align: center;"> 1.0000000000001563e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">1000037 </td>
<td class="cell-lrt" style="text-align: center;"> 1.9999999999999574e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">10000019 </td>
<td class="cell-lrt" style="text-align: center;"> .00999999999999801 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">10000079 </td>
<td class="cell-lrt" style="text-align: center;"> .03999999999999915 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">10000103 </td>
<td class="cell-lrt" style="text-align: center;"> .05999999999999872 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">100000007 </td>
<td class="cell-lrt" style="text-align: center;"> .03999999999999915 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">10000079 </td>
<td class="cell-lrt" style="text-align: center;"> .08999999999999986 </td>
</tr>
<tr>
<td class="cell-ltb" style="text-align: left;">10000103 </td>
<td class="cell-lrtb" style="text-align: center;"> .129999999999999 </td>
</tr>
</table></div>
    
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.23
  </h2>
  <div>
   <div>
    <p>
     Процедура smallest-divisor приведенная в начале главы выполняет много ненужных проверок. После проверки деления на 2, нет смысла делить на любые другие четные. То есть значениями для проверки должны быть не 2, 3, 4, 5, 6, ..., а 2, 3, 5, 7, 9, ....
    </p>
    <p>
     Сделайте это изменение реализовав процедуру next, которая вернет 3 если на вход получили 2, в ином случае вернет входное значение плюс два. Измените smallest-divisor используя (next test-divisor) (+ test-divisor 1).
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">smallest-divisor</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nf">find-divisor</span> <span class="nv">n</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">next</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 4 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">2</span><span class="p">)</span>
<span class="lineno"> 5 </span>      <span class="mi">3</span>
<span class="lineno"> 6 </span>      <span class="p">(</span><span class="nb">+ </span><span class="nv">n</span> <span class="mi">2</span><span class="p">)))</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">find-divisor</span> <span class="nv">n</span> <span class="nv">test-divisor</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">&gt; </span><span class="p">(</span><span class="nf">square</span> <span class="nv">test-divisor</span><span class="p">)</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 9 </span>        <span class="p">((</span><span class="nf">divides?</span> <span class="nv">test-divisor</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">test-divisor</span><span class="p">)</span>
<span class="lineno">10 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">find-divisor</span> <span class="nv">n</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">test-divisor</span><span class="p">)))))</span>
<span class="lineno">11 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">divides?</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">12 </span>  <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">remainder </span><span class="nv">b</span> <span class="nv">a</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     Повторите тест из 1.22
    </p>
    <div class="center-block">
     <p>
      </p>
<div class="tabular-wrapper"><table>
<tr>
<td class="cell-lt" style="text-align: left;">1009 </td>
<td class="cell-lrt" style="text-align: center;"> 0. </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">1013 </td>
<td class="cell-lrt" style="text-align: center;"> 0. </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">1019 </td>
<td class="cell-lrt" style="text-align: center;"> 1.0000000000001563e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">10007 </td>
<td class="cell-lrt" style="text-align: center;"> 0. </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">10009 </td>
<td class="cell-lrt" style="text-align: center;"> 0. </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">10037 </td>
<td class="cell-lrt" style="text-align: center;"> 1.0000000000001563e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">100003 </td>
<td class="cell-lrt" style="text-align: center;"> 0. </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">100019 </td>
<td class="cell-lrt" style="text-align: center;"> 1.0000000000001563e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">100043 </td>
<td class="cell-lrt" style="text-align: center;"> 1.9999999999999574e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">1000003 </td>
<td class="cell-lrt" style="text-align: center;"> 0. </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">1000033 </td>
<td class="cell-lrt" style="text-align: center;"> 1.0000000000001563e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">1000037 </td>
<td class="cell-lrt" style="text-align: center;"> 2.0000000000003126e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">10000019 </td>
<td class="cell-lrt" style="text-align: center;"> .0 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">10000079 </td>
<td class="cell-lrt" style="text-align: center;"> 1.9999999999999574e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">10000103 </td>
<td class="cell-lrt" style="text-align: center;"> 3.0000000000001137e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">100000007 </td>
<td class="cell-lrt" style="text-align: center;"> 1.9999999999999574e-2 </td>
</tr>
<tr>
<td class="cell-lt" style="text-align: left;">100000037 </td>
<td class="cell-lrt" style="text-align: center;"> .05000000000000071 </td>
</tr>
<tr>
<td class="cell-ltb" style="text-align: left;">100000039 </td>
<td class="cell-lrtb" style="text-align: center;"> .07000000000000028 </td>
</tr>
</table></div>
     
    </div>
    <p>
     Во многих случаях уменьшилось в два раза.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.24
  </h2>
  <div>
   <div>
    <p>
     Измените процедуру timed-prime-test из 1.22 что бы она использовала fast-prime? (метод Ферма), протестируйте 12 чисел которые были найдены в упражнении 1.22. Сравните время проверки. Так как тест Ферма имеет порядок роста (log n), каково ожидание по времени для чисел около 1,000,000 в сравнении с числами около 1000? Подтвержают ли это ваши данные? Можете объяснить несоответствия, которые найдете?
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">smallest-divisor</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nf">find-divisor</span> <span class="nv">n</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">next</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 4 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">2</span><span class="p">)</span>
<span class="lineno"> 5 </span>      <span class="mi">3</span>
<span class="lineno"> 6 </span>      <span class="p">(</span><span class="nb">+ </span><span class="nv">n</span> <span class="mi">2</span><span class="p">)))</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">find-divisor</span> <span class="nv">n</span> <span class="nv">test-divisor</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">&gt; </span><span class="p">(</span><span class="nf">square</span> <span class="nv">test-divisor</span><span class="p">)</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 9 </span>        <span class="p">((</span><span class="nf">divides?</span> <span class="nv">test-divisor</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">test-divisor</span><span class="p">)</span>
<span class="lineno">10 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">find-divisor</span> <span class="nv">n</span> <span class="p">(</span><span class="nf">next</span> <span class="nv">test-divisor</span><span class="p">)))))</span>
<span class="lineno">11 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">divides?</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">12 </span>  <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">remainder </span><span class="nv">b</span> <span class="nv">a</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     для диапазанов &lt; 10,000,000 время проверки по исходному тесту было .0, поэтому я добавил еще один диапазон и протестировал сначала старую функцию timed-prime-test
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">10000019</span><span class="p">)</span><span class="c1">; 1.0000000000001563e-2</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">10000079</span><span class="p">)</span><span class="c1">; 1.0000000000001563e-2</span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">10000103</span><span class="p">)</span><span class="c1">; 1.0000000000001563e-2</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">100000007</span><span class="p">)</span><span class="c1">; 1.9999999999999574e-2</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">100000037</span><span class="p">)</span><span class="c1">; 2.0000000000003126e-2</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">100000039</span><span class="p">)</span><span class="c1">; 2.0000000000003126e-2</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">1000000007</span><span class="p">)</span><span class="c1">; .05000000000000071</span>
<span class="lineno">10 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">1000000009</span><span class="p">)</span><span class="c1">; .05999999999999872</span>
<span class="lineno">11 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">1000000021</span><span class="p">)</span><span class="c1">; .07000000000000028</span>
</pre>
</div>   <div>
    <p>
     результаты выполнения теста между 1 и 2 диапазоном &lt; <span class="inline-formula"><img class="img-inline-formula img-formula" width="32" height="18" src="formulae/stpajtmjWkASRa_Px.gSazh7yZYs.WaF43zFUg.png" alt="\sqrt{10}" title="\sqrt{10}"></span> между 2 и 3 приближенно равны ему.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">10000019</span><span class="p">)</span><span class="c1">; 1.0000000000001563e-2</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">10000079</span><span class="p">)</span><span class="c1">; 1.0000000000001563e-2</span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">10000103</span><span class="p">)</span><span class="c1">; 1.0000000000001563e-2</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">100000007</span><span class="p">)</span><span class="c1">; 1.9999999999999574e-2</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">100000037</span><span class="p">)</span><span class="c1">; 2.0000000000003126e-2</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">100000039</span><span class="p">)</span><span class="c1">; 2.0000000000003126e-2</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">1000000007</span><span class="p">)</span><span class="c1">; .05000000000000071</span>
<span class="lineno">10 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">1000000009</span><span class="p">)</span><span class="c1">; .05999999999999872</span>
<span class="lineno">11 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">1000000021</span><span class="p">)</span><span class="c1">; .07000000000000028</span>
</pre>
</div>   <div>
    <p>
     после этого переписал через fast-prime, время теста зависит от количества проверок
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">; c 10 проверками</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">10000019</span><span class="p">)</span><span class="c1">; 0.</span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">10000079</span><span class="p">)</span><span class="c1">; 0.</span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">10000103</span><span class="p">)</span><span class="c1">; .00999999999999801</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">100000007</span><span class="p">)</span><span class="c1">; 0.</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">100000037</span><span class="p">)</span><span class="c1">; .00999999999999801</span>
<span class="lineno"> 8 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">100000039</span><span class="p">)</span><span class="c1">; .00999999999999801</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">1000000007</span><span class="p">)</span><span class="c1">; 1.0000000000001563e-2</span>
<span class="lineno">11 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">1000000009</span><span class="p">)</span><span class="c1">; 1.0000000000001563e-2</span>
<span class="lineno">12 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">1000000021</span><span class="p">)</span><span class="c1">; 1.0000000000001563e-2</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span><span class="c1">; с 1000 проверками</span>
<span class="lineno">15 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">10000019</span><span class="p">)</span><span class="c1">; .1999999999999993</span>
<span class="lineno">16 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">10000079</span><span class="p">)</span><span class="c1">; .20000000000000284</span>
<span class="lineno">17 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">10000103</span><span class="p">)</span><span class="c1">; .21999999999999886</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">100000007</span><span class="p">)</span><span class="c1">; .23000000000000043</span>
<span class="lineno">20 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">100000037</span><span class="p">)</span><span class="c1">; .23999999999999844</span>
<span class="lineno">21 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">100000039</span><span class="p">)</span><span class="c1">; .240000000000002</span>
<span class="lineno">22 </span>
<span class="lineno">23 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">1000000007</span><span class="p">)</span><span class="c1">; .2699999999999996</span>
<span class="lineno">24 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">1000000009</span><span class="p">)</span><span class="c1">; .26000000000000156</span>
<span class="lineno">25 </span><span class="p">(</span><span class="nf">timed-prime-test</span> <span class="mi">1000000021</span><span class="p">)</span><span class="c1">; .259999999999998</span>
</pre>
</div>   <div>
    <p>
     оба тесты похожи на линейный прирост времени.
    </p>
   </div>
  </div>
 </div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sicp-uprazhnenie-114/" class="u-url">SICP Упражнения 1.14, 1.15, 1.16, 1.17.</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="posts/sicp-uprazhnenie-114/" rel="bookmark">
            <time class="published dt-published" datetime="2020-01-11T14:54:25+03:00" itemprop="datePublished" title="2020-01-11 14:54">2020-01-11 14:54</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.14
  </h2>
  <div>
   <div class="section-block">
    <h3>
     Изобразите дерево иллюстрирующее процесс процедуры count-charge из секции 1.22 для 11 центов.
    </h3>
    <div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; Example: Counting change</span>
<span class="lineno"> 2 </span><span class="c1">;; Сколькими способами мы можем внесни изменение в сумму</span>
<span class="lineno"> 3 </span><span class="c1">;; если у нас есть монеты 50 25 10 5 и 1 центов.</span>
<span class="lineno"> 4 </span><span class="c1">;; Есть простое решение через рекурсивную процедуру</span>
<span class="lineno"> 5 </span><span class="c1">;; если a = 0 1 способ внести изменение</span>
<span class="lineno"> 6 </span><span class="c1">;; если a &lt; 0 0 способов</span>
<span class="lineno"> 7 </span><span class="c1">;; если n = 0, 0 способов внести изменение</span>
<span class="lineno"> 8 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">count-change</span> <span class="nv">amount</span><span class="p">)</span>
<span class="lineno"> 9 </span>  <span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="mi">5</span><span class="p">))</span>
<span class="lineno">10 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">kinds-of-coins</span><span class="p">)</span>
<span class="lineno">11 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">12 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">5</span><span class="p">)</span>
<span class="lineno">13 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">3</span><span class="p">)</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno">14 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">4</span><span class="p">)</span> <span class="mi">25</span><span class="p">)</span>
<span class="lineno">15 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">5</span><span class="p">)</span> <span class="mi">50</span><span class="p">)))</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="nv">kinds-of-coins</span><span class="p">)</span>
<span class="lineno">18 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">19 </span>        <span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">0</span><span class="p">))</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">20 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span>
<span class="lineno">21 </span>                     <span class="p">(</span><span class="nb">- </span><span class="nv">kinds-of-coins</span> <span class="mi">1</span><span class="p">))</span> <span class="c1">;; изменение берем разные монетки</span>
<span class="lineno">22 </span>                 <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nb">- </span><span class="nv">amount</span>
<span class="lineno">23 </span>                        <span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">kinds-of-coins</span><span class="p">))</span> <span class="c1">;; изменяем сумму на значение монетки</span>
<span class="lineno">24 </span>                     <span class="nv">kinds-of-coins</span><span class="p">)))))</span>
</pre>
</div>     <div>
      <p>
       Иттерируя можно себе представить что получится что-то вроде.
      </p>
     </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span>                            <span class="p">(</span><span class="nf">cc</span> <span class="mi">11</span> <span class="mi">5</span><span class="p">)</span>
<span class="lineno"> 2 </span>                     <span class="p">(</span><span class="nf">cc</span> <span class="mi">11</span> <span class="mi">4</span><span class="p">)</span>     <span class="p">(</span><span class="nf">cc</span> <span class="mi">-39</span> <span class="mi">5</span><span class="p">)</span>
<span class="lineno"> 3 </span>                <span class="p">(</span><span class="nf">cc</span> <span class="mi">11</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">-14</span> <span class="mi">4</span><span class="p">)</span>      <span class="mi">0</span>
<span class="lineno"> 4 </span>           <span class="p">(</span><span class="nf">cc</span> <span class="mi">11</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">1</span> <span class="mi">3</span><span class="p">)</span> <span class="nv">|</span> <span class="mi">0</span>
<span class="lineno"> 5 </span>      <span class="p">(</span><span class="nf">cc</span> <span class="mi">11</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">6</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">|</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">-9</span> <span class="mi">3</span><span class="p">)</span>
<span class="lineno"> 6 </span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">11</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">10</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">|</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">6</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">|</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">-4</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">|</span> <span class="mi">0</span>
<span class="lineno"> 7 </span>    <span class="mi">0</span> <span class="nv">|</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">10</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">9</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">|</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">6</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">5</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">|</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">|</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">|</span> <span class="mi">0</span>
<span class="lineno"> 8 </span>          <span class="mi">0</span> <span class="nv">|</span> <span class="mi">0</span> <span class="nv">|</span> <span class="mi">0</span> <span class="nv">|</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">5</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">4</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">|</span> <span class="mi">0</span> <span class="nv">|</span> <span class="mi">0</span> <span class="nv">|</span> <span class="mi">0</span> <span class="nv">|</span> <span class="mi">0</span>
<span class="lineno"> 9 </span>          <span class="mi">0</span> <span class="nv">|</span> <span class="mi">0</span> <span class="nv">|</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">4</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">3</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">10 </span>          <span class="mi">0</span> <span class="nv">|</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">3</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">2</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">11 </span>          <span class="mi">0</span> <span class="nv">|</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">2</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">12 </span>          <span class="mi">0</span> <span class="nv">|</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">cc</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">13 </span>          <span class="mi">0</span> <span class="nv">|</span> <span class="mi">0</span>
</pre>
</div>    </div>
   </div>
   <div class="section-block">
    <h3>
     Каков порядок роста (<span class="inline-formula"><img class="img-inline-formula img-formula" width="32" height="17" src="formulae/cCSlLH6spWmUZ.yEu3RFI4JpEISlQpO3e_iouA.png" alt="\theta(n)" title="\theta(n)"></span>) по памяти и по количеству шагов. Где n - сумма.
    </h3>
    <div>
     <div>
      <p>
       По количеству шагов, давайте представим что у нас есть всего одна монетка для изменений. Тогда.
      </p>
     </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span>        <span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span>  <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nf">amount</span> <span class="nv">-</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">3 </span><span class="mi">0</span>                <span class="mi">0</span>     <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nf">amount</span> <span class="nv">-</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
</pre>
</div>     <div>
      <p>
       Видим что у нас левая часть всегда вырождается в 0. А порядок роста в право это просто <span class="inline-formula"><img class="img-inline-formula img-formula" width="32" height="17" src="formulae/cCSlLH6spWmUZ.yEu3RFI4JpEISlQpO3e_iouA.png" alt="\theta(n)" title="\theta(n)"></span>
      </p>
      <p>
       Теперь посмотрим что будет происходить с двумя монетками для изменения.
      </p>
     </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span>        <span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="mi">2</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="mi">1</span><span class="p">)</span>  <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nf">amount</span> <span class="nv">-</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
</pre>
</div>     <div>
      <p>
       Видим что в левой части у нас в точности то что при одной монетке. А в провой части у нас каждый раз будет создаваться новая левая для одной монетки и еще одна правая. Порядок роста у нас получится <span class="inline-formula"><img class="img-inline-formula img-formula" width="40" height="18" src="formulae/TDMg7xotZXKkYHRB35dASqEHcCEqzcosTs4gqA.png" alt="\theta(n^2)" title="\theta(n^2)"></span>.
      </p>
      <p>
       И так при каждом добавлении еще одного номинала разменной монетки, порядок роста будет увеличиваться на n.
      </p>
      <p>
       У нас в задаче 5 разменных монет, поэтому для нашей задачи порядок роста <span class="inline-formula"><img class="img-inline-formula img-formula" width="40" height="18" src="formulae/fOU3P7Sr57KOt1u0RoA3w7g8.o4nZ4F8ewg70g.png" alt="\theta(n^5)" title="\theta(n^5)"></span>.
      </p>
      <p>
       По памяти <span class="inline-formula"><img class="img-inline-formula img-formula" width="32" height="17" src="formulae/cCSlLH6spWmUZ.yEu3RFI4JpEISlQpO3e_iouA.png" alt="\theta(n)" title="\theta(n)"></span> (порядок максимального разветвления дерева).
      </p>
     </div>
    </div>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.15
  </h2>
  <div>
   <div>
    <p>
     Синус угла (указанный в радианах) может быть вычислен используя приближение что <span class="inline-formula"><img class="img-inline-formula img-formula" width="74" height="17" src="formulae/VwTzGshSwoUNeeeAXWnwBL9X4VMacim1a14XTQ.png" alt="\sin(r) = r" title="\sin(r) = r"></span> если <span class="inline-formula"><img class="img-inline-formula img-formula" width="8" height="7" src="formulae/9PDR_uZ5xxt4l_bI_FVKMXrwFl94B6.ue5eEfg.png" alt="r" title="r"></span> малое значение. Для итеративного уменьшения угла будем использовать тригонометрическое тождество <span class="inline-formula"><img class="img-inline-formula img-formula" width="204" height="18" src="formulae/B.h1aEvWmQVlz4e7yBgWDTMA515GD0w6mJyTvg.png" alt="\sin{r} = 3\sin{r/3} - 4sin^3{r/3}" title="\sin{r} = 3\sin{r/3} - 4sin^3{r/3}"></span>.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cube</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">x</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>
<span class="lineno">2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">p</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">* </span><span class="mi">3</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="mi">4</span> <span class="p">(</span><span class="nf">cube</span> <span class="nv">x</span><span class="p">))))</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sine</span> <span class="nv">angle</span><span class="p">)</span>
<span class="lineno">5 </span>   <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">&gt; </span><span class="p">(</span><span class="nb">abs </span><span class="nv">angle</span><span class="p">)</span> <span class="mf">0.1</span><span class="p">))</span>
<span class="lineno">6 </span>       <span class="nv">angle</span>
<span class="lineno">7 </span>       <span class="p">(</span><span class="nf">p</span> <span class="p">(</span><span class="nf">sine</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">angle</span> <span class="mf">3.0</span><span class="p">)))))</span>
</pre>
</div>   <div>
    <div class="section-block">
     <h3>
      Сколько раз выполнится процедура p применительно к sin 12.15?
     </h3>
     <div>
      <p>
       Будем делить угол на 3 пока, он не станет меньше чем 0.1. 12.15/3/3/3/3/3 = 0.049, значит 5 раз.
      </p>
      <p>
       А если записать в общем виде это будет <span class="inline-formula"><img class="img-inline-formula img-formula" width="73" height="16" src="formulae/WyZGa87XcDVFaBuL3zhCCfou.bf8HHwAK4huJg.png" alt="\log_3{x} + a" title="\log_3{x} + a"></span>, где а константа.
      </p>
     </div>
    </div>
    <div class="section-block">
     <h3>
      Каков порядок роста этой функции.
     </h3>
     <div>
      <p>
       Порядок роста по количеству итераций равен <span class="inline-formula"><img class="img-inline-formula img-formula" width="55" height="17" src="formulae/p7Pg644Ou_yBspI.6P9dd_cyiYJtXOrDgKl4aQ.png" alt="\theta(log{n})" title="\theta(log{n})"></span>. По месту так же.
      </p>
     </div>
    </div>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.16
  </h2>
  <div>
   <div>
    <p>
     Написать итеративный вариант быстрой экспоненты с порядком роста <span class="inline-formula"><img class="img-inline-formula img-formula" width="55" height="17" src="formulae/p7Pg644Ou_yBspI.6P9dd_cyiYJtXOrDgKl4aQ.png" alt="\theta(log{n})" title="\theta(log{n})"></span>
    </p>
    <p>
     Рекурсивный вариант:
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">even? </span><span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">remainder </span><span class="nv">n</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="nb">even? </span><span class="mi">2</span><span class="p">)</span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="nb">even? </span><span class="mi">7</span><span class="p">)</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fast-expt</span> <span class="nv">b</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 7 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno"> 8 </span>        <span class="p">((</span><span class="nb">even? </span><span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nf">fast-expt</span> <span class="nv">b</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">n</span> <span class="mi">2</span><span class="p">))))</span>
<span class="lineno"> 9 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">* </span><span class="nv">b</span> <span class="p">(</span><span class="nf">fast-expt</span> <span class="nv">b</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))))))</span>
<span class="lineno">10 </span><span class="p">(</span><span class="nf">fast-expt</span> <span class="mi">5</span> <span class="mi">10</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     Итеративный вариант:
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">even? </span><span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">remainder </span><span class="nv">n</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">expt </span><span class="nv">b</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 5 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">expt-iter</span> <span class="nv">a</span> <span class="nv">count</span><span class="p">)</span>
<span class="lineno"> 6 </span>    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">count</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">a</span><span class="p">)</span>
<span class="lineno"> 7 </span>          <span class="p">((</span><span class="nb">= </span><span class="nv">count</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">a</span><span class="p">)</span>
<span class="lineno"> 8 </span>          <span class="p">((</span><span class="nb">&gt;= </span><span class="nv">count</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))</span> <span class="p">(</span><span class="nf">expt-iter</span> <span class="p">(</span><span class="nf">square</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">count</span> <span class="mi">2</span><span class="p">)))</span>
<span class="lineno"> 9 </span>          <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">expt-iter</span> <span class="p">(</span><span class="nf">square</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">count</span> <span class="mi">2</span><span class="p">)))))</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">even? </span><span class="nv">n</span><span class="p">)</span>
<span class="lineno">11 </span>      <span class="p">(</span><span class="nf">expt-iter</span> <span class="mi">1</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno">12 </span>      <span class="p">(</span><span class="nb">* </span><span class="nv">b</span> <span class="p">(</span><span class="nf">expt-iter</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)))))</span>
<span class="lineno">13 </span><span class="p">(</span><span class="nb">expt </span><span class="mi">3</span> <span class="mi">150</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.17
  </h2>
  <div>
   <div>
    <p>
     Допустим у нас нет процедуры умножения, написать процедуру использую только сложение и предопределенные процедуры halve и double, с порядком роста <span class="inline-formula"><img class="img-inline-formula img-formula" width="55" height="17" src="formulae/p7Pg644Ou_yBspI.6P9dd_cyiYJtXOrDgKl4aQ.png" alt="\theta(log{n})" title="\theta(log{n})"></span>
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">double</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nb">* </span><span class="nv">x</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="nf">double</span> <span class="mi">2</span><span class="p">)</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">halve</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno"> 6 </span>  <span class="p">(</span><span class="nb">/ </span><span class="nv">x</span> <span class="mi">2</span><span class="p">))</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="nf">halve</span> <span class="mi">4</span><span class="p">)</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">even? </span><span class="nv">n</span><span class="p">)</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">remainder </span><span class="nv">n</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span>
<span class="lineno">11 </span><span class="p">(</span><span class="nb">even? </span><span class="mi">6</span><span class="p">)</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fast?</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">14 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">= </span><span class="nv">b</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">a</span> <span class="mi">0</span><span class="p">))</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">15 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">b</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">a</span><span class="p">)</span>
<span class="lineno">16 </span>        <span class="p">((</span><span class="nb">even? </span><span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">double</span> <span class="p">(</span><span class="nf">fast?</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">halve</span> <span class="nv">b</span><span class="p">))))</span>
<span class="lineno">17 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">+ </span><span class="nv">a</span> <span class="p">(</span><span class="nf">double</span> <span class="p">(</span><span class="nf">fast?</span> <span class="nv">a</span> <span class="p">(</span><span class="nf">halve</span> <span class="p">(</span><span class="nb">- </span><span class="nv">b</span> <span class="mi">1</span><span class="p">))))))))</span>
<span class="lineno">18 </span><span class="p">(</span><span class="nf">fast?</span> <span class="mi">10</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">19 </span><span class="p">(</span><span class="nf">fast?</span> <span class="mi">0</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno">20 </span><span class="p">(</span><span class="nf">fast?</span> <span class="mi">10</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno">21 </span><span class="p">(</span><span class="nf">fast?</span> <span class="mi">10</span> <span class="mi">11</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.18
  </h2>
  <div>
   <div>
    <p>
     Используя результаты 1.16, 1.17 разработайте итеративную процедуру умножения двух чисел в терминах “удвоить, взять половину, добавить”, процедура должна выполняться с порядком роста <span class="inline-formula"><img class="img-inline-formula img-formula" width="55" height="17" src="formulae/p7Pg644Ou_yBspI.6P9dd_cyiYJtXOrDgKl4aQ.png" alt="\theta(log{n})" title="\theta(log{n})"></span>.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fast?</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fast-iter</span> <span class="nv">asum</span> <span class="nv">bsum</span> <span class="nv">count</span><span class="p">)</span>
<span class="lineno"> 3 </span>    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">bsum</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">asum</span><span class="p">)</span>
<span class="lineno"> 4 </span>          <span class="p">((</span><span class="nb">= </span><span class="nv">bsum</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">asum</span><span class="p">)</span>
<span class="lineno"> 5 </span>          <span class="p">((</span><span class="nb">even? </span><span class="nv">bsum</span><span class="p">)</span> <span class="p">(</span><span class="nf">fast-iter</span> <span class="p">(</span><span class="nf">double</span> <span class="nv">asum</span><span class="p">)</span> <span class="p">(</span><span class="nf">halve</span> <span class="nv">bsum</span><span class="p">)))</span>
<span class="lineno"> 6 </span>          <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">fast-iter</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">asum</span> <span class="nv">asum</span><span class="p">)</span> <span class="p">(</span><span class="nb">- </span><span class="nv">bsum</span> <span class="mi">1</span><span class="p">)))))</span>
<span class="lineno"> 7 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nb">= </span><span class="nv">b</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">a</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno"> 8 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">b</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">a</span><span class="p">)</span>
<span class="lineno"> 9 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">fast-iter</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))))</span>
<span class="lineno">10 </span><span class="p">(</span><span class="nf">fast?</span> <span class="mi">16</span> <span class="mi">18</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 1.19
  </h2>
  <div>
   <div>
    <p>
     Доработать вычисление функции Фибоначи, процедура должна выполняться с порядком роста <span class="inline-formula"><img class="img-inline-formula img-formula" width="55" height="17" src="formulae/p7Pg644Ou_yBspI.6P9dd_cyiYJtXOrDgKl4aQ.png" alt="\theta(log{n})" title="\theta(log{n})"></span>.
    </p>
    <p>
     В последнем итеративном подсчете Фибоначи мы перезаписывали a &lt;- a + b и b &lt;- a, назовем это трансформацией T. Заметим что применение T n раз даст пару Fib(n + 1) и Fib(n), иными словами числа генерируются применением T^n. Теперь рассмотрим частный случай T p = 0 q = 1 в преобразовании Tpq, где Tpq преобразует пару (a, b) в a &lt;- bq + aq + ap и b &lt;- bp + aq. Покажите что если применить такую трансформацию Tpq дважды, результат будет тем же как и от единственной трансформации Tp'q' такой же формы, для которой p' и q' выраженны через p и q. Это даст нам возможность ускорить процедуру, как мы делали в fast-exp. Собрав все это вместе закончите процедуру приведенную ниже.
    </p>
    <p>
     Выражаем p' и q' через p и q.
    </p>
    <div class="theorem-environment theorem-proposition-environment">
     <div class="theorem-header theorem-proposition-header">
      Утверждение.
     </div>
     <div class="theorem-content theorem-proposition-content">
      <p>
       a1 b1 a2 = b1q + a1q + a1p b2 = b1p + a1q
      </p>
      <p>
       a3 = b2q + a2q + a2p b3 = b2p + a2q
      </p>
      <p>
       a3 = (b1p + a1q)q + (b1q + a1q + a1p)q + (b1q + a1q + a1p)p b3 = (b1p + a1q)p + (b1q + a1q + a1p)q
      </p>
      <p>
       a3 = b1q' + a1q' + a1p' (1) b3 = b1p' + a1q' (2)
      </p>
      <p>
       a3 = b1pq + a1qq + b1qq + a1qq + a1pq + b1pq + a1pq + a1pp b3 = b1pp + a1pq + b1qq + a1qq + a1pq
      </p>
      <p>
       a3 = b1(2pq + qq) + a1(2qq + 2pq + pp) (3) b3 = b1(pp + qq) + a1(2pq + qq) (4)
      </p>
      <p>
       a3 = b1(2pq + qq) + a1(2pq + qq) + a1(qq + pp)
      </p>
      <p>
       q' = 2pq + qq
      </p>
      <p>
       p' = pp + qq
      </p>
     </div>
    </div>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fib</span> <span class="nv">n</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nf">fib-iter</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="nv">n</span><span class="p">))</span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fib-iter</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">p</span> <span class="nv">q</span> <span class="nv">count</span><span class="p">)</span>
<span class="lineno"> 4 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">count</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno"> 5 </span>        <span class="p">((</span><span class="nb">even? </span><span class="nv">count</span><span class="p">)</span>
<span class="lineno"> 6 </span>         <span class="p">(</span><span class="nf">fib-iter</span> <span class="nv">a</span>
<span class="lineno"> 7 </span>                   <span class="nv">b</span>
<span class="lineno"> 8 </span>                   <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">square</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nf">square</span> <span class="nv">q</span><span class="p">))</span>      <span class="c1">; compute p'</span>
<span class="lineno"> 9 </span>                   <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">* </span><span class="mi">2</span> <span class="nv">p</span> <span class="nv">q</span><span class="p">)</span> <span class="p">(</span><span class="nf">square</span> <span class="nv">q</span><span class="p">))</span>      <span class="c1">; compute q'</span>
<span class="lineno">10 </span>                   <span class="p">(</span><span class="nb">/ </span><span class="nv">count</span> <span class="mi">2</span><span class="p">)))</span>
<span class="lineno">11 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">fib-iter</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">* </span><span class="nv">b</span> <span class="nv">q</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">a</span> <span class="nv">q</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">a</span> <span class="nv">p</span><span class="p">))</span>
<span class="lineno">12 </span>                        <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">* </span><span class="nv">b</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">a</span> <span class="nv">q</span><span class="p">))</span>
<span class="lineno">13 </span>                        <span class="nv">p</span>
<span class="lineno">14 </span>                        <span class="nv">q</span>
<span class="lineno">15 </span>                        <span class="p">(</span><span class="nb">- </span><span class="nv">count</span> <span class="mi">1</span><span class="p">)))))</span>
</pre>
</div>  </div>
 </div>
</div>
    </div>
    </article>
</div>
        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-1.html" rel="next">Старые записи</a>
            </li>
        </ul></nav></main><footer id="footer"><p>Contents © 2020         <a href="mailto:anton.s.pilipenko@gmail.com">Velikii Nehochuha</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
                <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
