<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>SICP 2.2 Иерархические данные и свойство замыкания (the closure property). | VelikiiNehochuha Blog</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="ru" href="../../rss.xml">
<link rel="canonical" href="http://velikiinehochuha.github.io/posts/sicp-22-ierarkhicheskie-dannye-i-svoistvo-zamykaniia-the-closure-property/">
<!--[if lt IE 9]><script src="../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Velikii Nehochuha">
<link rel="prev" href="../sicp-vvedenie-v-abstragirovanie-dannykh/" title="SICP Введение в абстрагирование данных" type="text/html">
<link rel="next" href="../sicp-223-posledovatelnosti-kak-obobshchaiushchie-interfeisy/" title="SICP 2.2.3 Последовательности как обобщающие интерфейсы." type="text/html">
<meta property="og:site_name" content="VelikiiNehochuha Blog">
<meta property="og:title" content="SICP 2.2 Иерархические данные и свойство замыкания (the closure proper">
<meta property="og:url" content="http://velikiinehochuha.github.io/posts/sicp-22-ierarkhicheskie-dannye-i-svoistvo-zamykaniia-the-closure-property/">
<meta property="og:description" content="Упражнение 2.17
  
  
   
    
     Определите процедуру last-pair, которая возвращает список который содержит только последний элемент данного (непустого списка).
    
   
1 (define (last-pair list1)">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-01-18T15:18:01+03:00">
<meta property="article:tag" content="hierarchical_data">
<meta property="article:tag" content="scheme">
<meta property="article:tag" content="sicp">
<meta property="article:tag" content="the_closure_property">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Перейти к главному содержимому</a>
    <div id="container">
             <header id="header"><h1 id="brand"><a href="http://velikiinehochuha.github.io/" title="VelikiiNehochuha Blog" rel="home">

        <span id="blog-title">VelikiiNehochuha Blog</span>
    </a></h1>

        
            <nav id="menu"><ul>
<li><a href="../../archive.html">Архив</a></li>
                <li><a href="../../categories/">Тэги</a></li>
                <li><a href="../../rss.xml">RSS лента</a></li>

    
    
    
    </ul></nav></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">SICP 2.2 Иерархические данные и свойство замыкания (the closure property).</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Velikii Nehochuha
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2020-01-18T15:18:01+03:00" itemprop="datePublished" title="2020-01-18 15:18">2020-01-18 15:18</time></a>
            </p>
                    <p class="sourceline"><a href="index.tex" class="sourcelink">Источник</a></p>

        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.17
  </h2>
  <div>
   <div>
    <p>
     Определите процедуру last-pair, которая возвращает список который содержит только последний элемент данного (непустого списка).
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">last-pair</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">))</span>
<span class="lineno">3 </span>      <span class="nv">list1</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="nf">last-pair</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">))))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.18
  </h2>
  <div>
   <div>
    <p>
     Определите процедуру reverse, которая возвращает список элементы которого записаны в обратном порядке.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">reverse </span><span class="nv">list1</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">l</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">l</span><span class="p">)</span>
<span class="lineno">4 </span>        <span class="nv">result</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">l</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">l</span><span class="p">)</span> <span class="nv">result</span><span class="p">))))</span>
<span class="lineno">6 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">list1</span> <span class="nv">nil</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.19
  </h2>
  <div>
   <div>
    <p>
     Рассмотрим программу подсчета количества изменений из раздела 1.2.2. Было бы хорошо легко изменить валюту. Когда программа написана валюта учитывается в методах first-denomination и count-change.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="c1">;; исходная программа</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">count-change</span> <span class="nv">amount</span><span class="p">)</span>
<span class="lineno"> 3 </span>  <span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="mi">5</span><span class="p">))</span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="nv">kinds-of-coins</span><span class="p">)</span>
<span class="lineno"> 5 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno"> 6 </span>        <span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">0</span><span class="p">))</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno"> 7 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span>
<span class="lineno"> 8 </span>                     <span class="p">(</span><span class="nb">- </span><span class="nv">kinds-of-coins</span> <span class="mi">1</span><span class="p">))</span>
<span class="lineno"> 9 </span>                 <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nb">- </span><span class="nv">amount</span>
<span class="lineno">10 </span>                        <span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">kinds-of-coins</span><span class="p">))</span>
<span class="lineno">11 </span>                     <span class="nv">kinds-of-coins</span><span class="p">)))))</span>
<span class="lineno">12 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">kinds-of-coins</span><span class="p">)</span>
<span class="lineno">13 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">14 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">5</span><span class="p">)</span>
<span class="lineno">15 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">3</span><span class="p">)</span> <span class="mi">10</span><span class="p">)</span>
<span class="lineno">16 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">4</span><span class="p">)</span> <span class="mi">25</span><span class="p">)</span>
<span class="lineno">17 </span>        <span class="p">((</span><span class="nb">= </span><span class="nv">kinds-of-coins</span> <span class="mi">5</span><span class="p">)</span> <span class="mi">50</span><span class="p">)))</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span><span class="p">(</span><span class="nf">cc</span> <span class="mi">100</span> <span class="mi">5</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     Было бы лучше иметь список монет которые могут быть использованы для размена.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="nv">us-coins</span> <span class="p">(</span><span class="nb">list </span><span class="mi">50</span> <span class="mi">25</span> <span class="mi">10</span> <span class="mi">5</span> <span class="mi">1</span><span class="p">))</span>
<span class="lineno">2 </span><span class="p">(</span><span class="k">define </span><span class="nv">uk-coins</span> <span class="p">(</span><span class="nb">list </span><span class="mi">100</span> <span class="mi">50</span> <span class="mi">20</span> <span class="mi">10</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mf">0.5</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     Мы хотим переписать программу cc что бы её второй аргумент представлял собой список значений монет, вместо целого числа. Тогда у нас будут списки для каждого вида валют.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="nf">cc</span> <span class="mi">100</span> <span class="nv">us-coins</span><span class="p">)</span>
<span class="lineno">2 </span><span class="mi">292</span>
</pre>
</div>   <div>
    <p>
     Для этого потребуется несколько изменить программу cc. Доступ ко второму элементу будет осуществляться по другому.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="nv">coin-values</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">3 </span>        <span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">no-more?</span> <span class="nv">coin-values</span><span class="p">))</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">4 </span>        <span class="p">(</span><span class="nf">else</span>
<span class="lineno">5 </span>         <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span>
<span class="lineno">6 </span>                <span class="p">(</span><span class="nf">except-first-denomination</span> <span class="nv">coin-values</span><span class="p">))</span>
<span class="lineno">7 </span>            <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nb">- </span><span class="nv">amount</span>
<span class="lineno">8 </span>                   <span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">coin-values</span><span class="p">))</span>
<span class="lineno">9 </span>                <span class="nv">coin-values</span><span class="p">)))))</span>
</pre>
</div>   <div>
    <p>
     Определите процедуры first-denomination, except-first-denomination, no-more. Влияет ли порядок в списке на итоговое число?
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="nv">us-coins</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">25</span> <span class="mi">10</span> <span class="mi">5</span> <span class="mi">50</span><span class="p">))</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="nv">uk-coins</span> <span class="p">(</span><span class="nb">list </span><span class="mi">100</span> <span class="mi">50</span> <span class="mi">20</span> <span class="mi">10</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">except-first-denomination</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 4 </span>  <span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">))</span>
<span class="lineno"> 5 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 6 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">list1</span><span class="p">))</span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">no-more?</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 9 </span>      <span class="nv">list1</span>
<span class="lineno">10 </span>      <span class="nv">false</span><span class="p">))</span>
<span class="lineno">11 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="nv">coin-values</span><span class="p">)</span>
<span class="lineno">12 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
<span class="lineno">13 </span>        <span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">no-more?</span> <span class="nv">coin-values</span><span class="p">))</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">14 </span>        <span class="p">(</span><span class="nf">else</span>
<span class="lineno">15 </span>         <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span>
<span class="lineno">16 </span>                <span class="p">(</span><span class="nf">except-first-denomination</span> <span class="nv">coin-values</span><span class="p">))</span>
<span class="lineno">17 </span>            <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nb">- </span><span class="nv">amount</span>
<span class="lineno">18 </span>                   <span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">coin-values</span><span class="p">))</span>
<span class="lineno">19 </span>                <span class="nv">coin-values</span><span class="p">)))))</span>
<span class="lineno">20 </span><span class="p">(</span><span class="nf">cc</span> <span class="mi">100</span> <span class="nv">us-coins</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     Порядок не влияет, так как рекурсивно обходятся все варианты изменения.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.20
  </h2>
  <div>
   <div>
    <p>
     Используя нотацию dotted-tail, напишите процедуру same-parity которая принимает одно или более целых чисел и возвращает список всех аргументов которые имеют такое-же четное-нечетное соотношение как первый аргумент.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">same-parity</span> <span class="nv">x</span> <span class="o">.</span> <span class="nv">l</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">filter</span> <span class="nv">list1</span> <span class="nv">same?</span><span class="p">)</span>
<span class="lineno"> 3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 4 </span>        <span class="nv">list1</span>
<span class="lineno"> 5 </span>        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same?</span> <span class="p">(</span><span class="nb">car </span><span class="nv">list1</span><span class="p">))</span>
<span class="lineno"> 6 </span>            <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">list1</span><span class="p">)</span> <span class="p">(</span><span class="nf">filter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">)</span> <span class="nv">same?</span><span class="p">))</span>
<span class="lineno"> 7 </span>            <span class="p">(</span><span class="nf">filter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">)</span> <span class="nv">same?</span><span class="p">)</span>
<span class="lineno"> 8 </span>            <span class="p">)))</span>
<span class="lineno"> 9 </span>  <span class="p">(</span><span class="k">define </span><span class="nv">same-even-odd</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">even? </span><span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">even? </span><span class="nv">i</span><span class="p">)))</span> <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">even? </span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">even? </span><span class="nv">i</span><span class="p">)))</span> <span class="mi">1</span> <span class="nv">false</span><span class="p">)))</span>
<span class="lineno">10 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="p">(</span><span class="nf">filter</span> <span class="nv">l</span> <span class="nv">same-even-odd</span><span class="p">)))</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span><span class="p">(</span><span class="nf">same-parity</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.21
  </h2>
  <div>
   <div>
    <p>
     Процедура square-list принимает список аргументов и возвращает список квадратов.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="nf">square-list</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
<span class="lineno">2 </span><span class="p">(</span><span class="mi">1</span> <span class="mi">4</span> <span class="mi">9</span> <span class="mi">16</span><span class="p">)</span>
</pre>
</div>   <div>
    <p>
     Приведены два реализации square-list. Дополните их.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-list</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">)</span>
<span class="lineno">3 </span>      <span class="nv">nil</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">))</span> <span class="p">(</span><span class="nf">square-list</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)))))</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span>
<span class="lineno">7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-list</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">8 </span>  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">square</span> <span class="nv">x</span><span class="p">))</span> <span class="nv">items</span><span class="p">))</span>
<span class="lineno">9 </span><span class="p">(</span><span class="nf">square-list</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.22
  </h2>
  <div>
   <div>
    <p>
     Луис пытается переписать первую реализацию square-list (2.21) что бы она генерировала итеративный процесс.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-list</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">things</span> <span class="nv">answer</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">things</span><span class="p">)</span>
<span class="lineno">4 </span>        <span class="nv">answer</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">things</span><span class="p">)</span> 
<span class="lineno">6 </span>              <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">car </span><span class="nv">things</span><span class="p">))</span>
<span class="lineno">7 </span>                    <span class="nv">answer</span><span class="p">))))</span>
<span class="lineno">8 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">items</span> <span class="nv">nil</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     К сожалению список получается в обратном порядке, почему?
    </p>
    <p>
     (list 1 2 3) nil iter (list 2 3) (cons 1 nil) iter (list 3) (cons 4 (cons 1 nil)) iter () (cons 9 (cons 4 (cons 1 nil))) return (cons 9 (cons 4 (cons 1 nil)))
    </p>
    <p>
     Луис пытается починить баг переставляя аргументы в cons
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-list</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">things</span> <span class="nv">answer</span><span class="p">)</span>
<span class="lineno">3 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">things</span><span class="p">)</span>
<span class="lineno">4 </span>        <span class="nv">answer</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">things</span><span class="p">)</span>
<span class="lineno">6 </span>              <span class="p">(</span><span class="nb">cons </span><span class="nv">answer</span>
<span class="lineno">7 </span>                    <span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">car </span><span class="nv">things</span><span class="p">))))))</span>
<span class="lineno">8 </span>  <span class="p">(</span><span class="nf">iter</span> <span class="nv">items</span> <span class="nv">nil</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     Это не работает получается (cons (cons (cons nil 1) 4) 9)
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.23
  </h2>
  <div>
   <div>
    <p>
     Процедура for-each похожа на map, только вместо того чтобы возвращать измененный список она просто применяет переданную функцию к каждому элементу. Используется что бы выполнить действия над списком, например печать.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="nb">for-each </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">newline</span><span class="p">)</span> <span class="p">(</span><span class="nb">display </span><span class="nv">x</span><span class="p">))</span>
<span class="lineno">2 </span>          <span class="p">(</span><span class="nb">list </span><span class="mi">57</span> <span class="mi">321</span> <span class="mi">88</span><span class="p">))</span>
<span class="lineno">3 </span><span class="mi">57</span>
<span class="lineno">4 </span><span class="mi">321</span>
<span class="lineno">5 </span><span class="mi">88</span>
</pre>
</div>   <div>
    <p>
     Возвращаемое значение может быть любым например true. Дайте определение процедуры for-each.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">for-each </span><span class="nv">proc</span> <span class="nv">items</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">))</span>
<span class="lineno">3 </span>      <span class="p">(</span><span class="nf">proc</span> <span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">)))</span>
<span class="lineno">4 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">))</span>
<span class="lineno">5 </span>      <span class="p">(</span><span class="nb">for-each </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)))</span>
<span class="lineno">6 </span>  <span class="nv">true</span><span class="p">)</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.24
  </h2>
  <div>
   <div>
    <p>
     Предположим мы оцениваем выражение (list 1 (list 2 (list 3 4))). Что даст вывод интерпретатора. Изобразите box-and-pointer и древовидную структуры.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="mi">1</span> <span class="p">(</span><span class="mi">2</span> <span class="p">(</span><span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="p">(</span><span class="nb">list </span><span class="mi">2</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
<span class="lineno"> 4 </span>     <span class="nv">/</span>      <span class="err">\</span>
<span class="lineno"> 5 </span>    <span class="nv">/</span>        <span class="err">\</span>
<span class="lineno"> 6 </span>   <span class="mi">1</span>   <span class="p">(</span><span class="nb">list </span><span class="mi">2</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
<span class="lineno"> 7 </span>            <span class="nv">/</span>        <span class="err">\</span>
<span class="lineno"> 8 </span>           <span class="nv">/</span>          <span class="err">\</span>
<span class="lineno"> 9 </span>          <span class="mi">2</span>         <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="lineno">10 </span>                     <span class="nv">/</span>      <span class="err">\</span>
<span class="lineno">11 </span>                    <span class="nv">/</span>        <span class="err">\</span>
<span class="lineno">12 </span>                   <span class="mi">3</span>          <span class="mi">4</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span><span class="p">(</span><span class="nb">cons </span><span class="mi">1</span>  <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">list </span><span class="mi">2</span> <span class="p">(</span><span class="o">...</span><span class="p">))</span> <span class="nv">nil</span><span class="p">)</span>
<span class="lineno">15 </span>     <span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="o">.</span><span class="p">]</span><span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">-</span> <span class="nv">&gt;</span><span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="nv">/</span><span class="p">]</span>
<span class="lineno">16 </span>      <span class="nv">|</span>                    <span class="nv">|</span>
<span class="lineno">17 </span>      <span class="nv">|</span>                    <span class="nv">|</span>
<span class="lineno">18 </span>      <span class="nv">v</span>                    <span class="nv">v</span>
<span class="lineno">19 </span>      <span class="mi">1</span>                   <span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="o">.</span><span class="p">]</span><span class="nv">-</span> <span class="nv">-&gt;</span><span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="nv">/</span><span class="p">]</span>
<span class="lineno">20 </span>                           <span class="nv">|</span>         <span class="nv">|</span>
<span class="lineno">21 </span>                           <span class="nv">|</span>         <span class="nv">|</span>
<span class="lineno">22 </span>                           <span class="nv">v</span>         <span class="nv">v</span>
<span class="lineno">23 </span>                           <span class="mi">2</span>     <span class="p">(</span><span class="nb">cons </span><span class="mi">3</span> <span class="p">(</span><span class="nb">cons </span><span class="mi">4</span> <span class="nv">nil</span><span class="p">)</span>
<span class="lineno">24 </span>                                    <span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="o">.</span><span class="p">]</span><span class="nv">-</span> <span class="nv">-&gt;</span><span class="p">[</span><span class="o">.</span><span class="p">][</span><span class="nv">/</span><span class="p">]</span>
<span class="lineno">25 </span>                                     <span class="nv">|</span>         <span class="nv">|</span>
<span class="lineno">26 </span>                                     <span class="nv">|</span>         <span class="nv">|</span>
<span class="lineno">27 </span>                                     <span class="nv">v</span>         <span class="nv">v</span>
<span class="lineno">28 </span>                                     <span class="mi">3</span>         <span class="mi">4</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.25
  </h2>
  <div>
   <div>
    <p>
     Приведите комюинации cars и cdrs которые выбирую 7 из каждого списка.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="c1">;; (1 3 (5 7) 9)</span>
<span class="lineno">2 </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">3</span> <span class="p">(</span><span class="nb">list </span><span class="mi">5</span> <span class="mi">7</span><span class="p">)</span> <span class="mi">9</span><span class="p">))))))</span>
<span class="lineno">3 </span><span class="c1">;; ((7))</span>
<span class="lineno">4 </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="mi">7</span><span class="p">))))</span>
<span class="lineno">5 </span><span class="c1">;; (1 (2 (3 (4 (5 (6 7))))))</span>
<span class="lineno">6 </span><span class="p">(</span><span class="k">define </span><span class="nv">list3</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="p">(</span><span class="nb">list </span><span class="mi">2</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="p">(</span><span class="nb">list </span><span class="mi">4</span> <span class="p">(</span><span class="nb">list </span><span class="mi">5</span> <span class="p">(</span><span class="nb">list </span><span class="mi">6</span> <span class="mi">7</span><span class="p">)))))))</span>
<span class="lineno">7 </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">list3</span><span class="p">))))))))))))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.26
  </h2>
  <div>
   <div>
    <p>
     Допустим определили два списка. Какой будет результат выражений.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
<span class="lineno"> 2 </span><span class="p">(</span><span class="k">define </span><span class="nv">y</span> <span class="p">(</span><span class="nb">list </span><span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="nb">append </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno"> 5 </span><span class="c1">;; (1 2 3 4 5 6)</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno"> 7 </span><span class="c1">;; ((1 2 3) 4 5 6)</span>
<span class="lineno"> 8 </span><span class="p">(</span><span class="nb">list </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
<span class="lineno"> 9 </span><span class="c1">;; (cons x (cons y nil)</span>
<span class="lineno">10 </span><span class="c1">;; ((1 2 4) (4 5 6))</span>
</pre>
</div>   <div>
    <p>
     то есть list создаст список списков, в то время как cons запишет в car первый список, а в cdr указатель на y, что приведет к разному результату с list x y. cons просто добавляет элемент в начало списка y.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.27
  </h2>
  <div>
   <div>
    <p>
     Измените процедуру reverse что бы она умела разворачивать вложенные списки.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">deep-reverse</span> <span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 4 </span>  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">l</span> <span class="nv">result</span><span class="p">)</span>
<span class="lineno"> 5 </span>    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">l</span><span class="p">)</span>
<span class="lineno"> 6 </span>        <span class="nv">result</span>
<span class="lineno"> 7 </span>        <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">l</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">deep-reverse</span> <span class="p">(</span><span class="nb">car </span><span class="nv">l</span><span class="p">))</span> <span class="nv">result</span><span class="p">))))</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">list1</span><span class="p">)</span>
<span class="lineno"> 9 </span>      <span class="p">(</span><span class="nf">iter</span> <span class="nv">list1</span> <span class="nv">nil</span><span class="p">)</span>
<span class="lineno">10 </span>      <span class="nv">list1</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     тут просто рекурсивно вызываем deep-reverse и если list1 это не список просто возвращаем значение.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.28
  </h2>
  <div>
   <div>
    <p>
     Напишите процедуру fringe, которая принимает дерево в виде списка и возвращает список всех листьев в порядке слева на право.
    </p>
    <p>
     Например:
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="p">(</span><span class="nf">fringe</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">4 </span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span><span class="p">(</span><span class="nf">fringe</span> <span class="p">(</span><span class="nb">list </span><span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>
<span class="lineno">7 </span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
</pre>
</div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="k">define </span><span class="p">(</span><span class="nf">fringe</span> <span class="nv">x</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">x</span><span class="p">)</span>
<span class="lineno">3 </span>      <span class="nv">x</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">))</span>
<span class="lineno">5 </span>          <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nf">fringe</span> <span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="nf">fringe</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">x</span><span class="p">)))</span>
<span class="lineno">6 </span>          <span class="nv">x</span><span class="p">)))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.29
  </h2>
  <div>
   <div>
    <p>
     Бинарный ползунок состоит из двух веток, левой и правой. Мы можем представить бинарный ползунок используя объединение из двух веток (к примеру используя list).
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nb">list </span><span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     Каждая ветка это стержень определенной длинны + вес либо еще один бинарный ползунок.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-branch</span> <span class="nv">length</span> <span class="nv">structure</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nb">list </span><span class="nv">length</span> <span class="nv">structure</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     a. Напишите селекторы left-branch и right-branch, которые возвращабт ветки + branch-length и branch-structure, которые возвращают компоненты ветки. b. Используя селекторы напишите процедуру total-weight, которая возвращает суммарный вес. с. Ползунок сбалансирован, когда крутящий момент верхней левой ветки равен верхней правой ветке (то есть длинна стержня умножить на вес свисающий с этого стержня). Напишите процедуру которая тестирует сбалансировал ли ползунок. d. Предположим мы поменяли представление так что конструктор стал таким
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>
<span class="lineno">3 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-branch</span> <span class="nv">length</span> <span class="nv">structure</span><span class="p">)</span>
<span class="lineno">4 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">length</span> <span class="nv">structure</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     Как много изменений нужно внести в программу после этого?
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="nb">list </span><span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-branch</span> <span class="nv">length</span> <span class="nv">structure</span><span class="p">)</span>
<span class="lineno"> 5 </span>  <span class="p">(</span><span class="nb">list </span><span class="nv">length</span> <span class="nv">structure</span><span class="p">))</span>
<span class="lineno"> 6 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno"> 7 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">m</span><span class="p">))</span>
<span class="lineno"> 8 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno"> 9 </span>  <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">m</span><span class="p">)))</span>
<span class="lineno">10 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-length</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">11 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">b</span><span class="p">))</span>
<span class="lineno">12 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-structure</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">13 </span>  <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">b</span><span class="p">)))</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>
<span class="lineno">16 </span><span class="p">(</span><span class="k">define </span><span class="nv">l0</span> <span class="p">(</span><span class="nf">make-branch</span> <span class="mi">3</span> <span class="mi">10</span><span class="p">))</span>
<span class="lineno">17 </span><span class="p">(</span><span class="k">define </span><span class="nv">r0</span> <span class="p">(</span><span class="nf">make-branch</span> <span class="mi">3</span> <span class="mi">10</span><span class="p">))</span>
<span class="lineno">18 </span><span class="p">(</span><span class="k">define </span><span class="nv">m0</span> <span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">l0</span> <span class="nv">r0</span><span class="p">))</span>
<span class="lineno">19 </span>
<span class="lineno">20 </span><span class="p">(</span><span class="k">define </span><span class="nv">l1</span> <span class="p">(</span><span class="nf">make-branch</span> <span class="mi">10</span> <span class="mi">10</span><span class="p">))</span>
<span class="lineno">21 </span><span class="p">(</span><span class="k">define </span><span class="nv">r1</span> <span class="p">(</span><span class="nf">make-branch</span> <span class="mi">5</span> <span class="nv">m0</span><span class="p">))</span>
<span class="lineno">22 </span><span class="p">(</span><span class="k">define </span><span class="nv">m1</span> <span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">l1</span> <span class="nv">r1</span><span class="p">))</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span><span class="c1">;; общий вес</span>
<span class="lineno">25 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">structure-weight</span> <span class="nv">s</span><span class="p">)</span>
<span class="lineno">26 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">s</span><span class="p">)</span>
<span class="lineno">27 </span>      <span class="p">(</span><span class="nf">total-weight</span> <span class="nv">s</span><span class="p">)</span>
<span class="lineno">28 </span>      <span class="nv">s</span><span class="p">))</span>
<span class="lineno">29 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-weight</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">30 </span>  <span class="p">(</span><span class="nf">structure-weight</span> <span class="p">(</span><span class="nf">branch-structure</span> <span class="nv">b</span><span class="p">)))</span>
<span class="lineno">31 </span>
<span class="lineno">32 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">total-weight</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno">33 </span>  <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">branch-weight</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">))</span> <span class="p">(</span><span class="nf">branch-weight</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">))))</span>
<span class="lineno">34 </span>
<span class="lineno">35 </span><span class="p">(</span><span class="nf">total-weight</span> <span class="nv">m1</span><span class="p">)</span>
<span class="lineno">36 </span>
<span class="lineno">37 </span><span class="c1">;; балансировка</span>
<span class="lineno">38 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">balanced?</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno">39 </span>  <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">branch-weight</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">))</span> <span class="p">(</span><span class="nf">branch-length</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">)))</span>
<span class="lineno">40 </span>     <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">branch-weight</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">))</span> <span class="p">(</span><span class="nf">branch-length</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">)))))</span>
<span class="lineno">41 </span>
<span class="lineno">42 </span><span class="p">(</span><span class="nf">balanced?</span> <span class="nv">m1</span><span class="p">)</span>
<span class="lineno">43 </span><span class="p">(</span><span class="nf">balanced?</span> <span class="nv">m0</span><span class="p">)</span>
<span class="lineno">44 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
<span class="lineno">45 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>
<span class="lineno">46 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-branch</span> <span class="nv">length</span> <span class="nv">structure</span><span class="p">)</span>
<span class="lineno">47 </span>  <span class="p">(</span><span class="nb">cons </span><span class="nv">length</span> <span class="nv">structure</span><span class="p">))</span>
<span class="lineno">48 </span>
<span class="lineno">49 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m</span><span class="p">)</span>
<span class="lineno">50 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">m</span><span class="p">))</span>
<span class="lineno">51 </span><span class="p">(</span><span class="nf">left-branch</span> <span class="nv">m0</span><span class="p">)</span>
<span class="lineno">52 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m</span><span class="p">)</span> <span class="c1">;; поменял метод</span>
<span class="lineno">53 </span>  <span class="p">(</span><span class="nb">cdr </span><span class="nv">m</span><span class="p">))</span>
<span class="lineno">54 </span><span class="p">(</span><span class="nf">right-branch</span> <span class="nv">m0</span><span class="p">)</span>
<span class="lineno">55 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-length</span> <span class="nv">b</span><span class="p">)</span>
<span class="lineno">56 </span>  <span class="p">(</span><span class="nb">car </span><span class="nv">b</span><span class="p">))</span>
<span class="lineno">57 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-structure</span> <span class="nv">b</span><span class="p">)</span> <span class="c1">;; поменял метод</span>
<span class="lineno">58 </span>  <span class="p">(</span><span class="nb">cdr </span><span class="nv">b</span><span class="p">))</span>
</pre>
</div>   <div>
    <p>
     поменяли два селектора.
    </p>
   </div>
  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.30
  </h2>
  <div>
   <div>
    <p>
     Напишите процедуру square-tree без и с использованием map.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno"> 1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-tree</span> <span class="nv">tree</span><span class="p">)</span>
<span class="lineno"> 2 </span>  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">tree</span><span class="p">)</span> <span class="nv">nil</span><span class="p">)</span>
<span class="lineno"> 3 </span>        <span class="p">((</span><span class="nb">not </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">tree</span><span class="p">))</span> <span class="p">(</span><span class="nf">square</span> <span class="nv">tree</span><span class="p">))</span>
<span class="lineno"> 4 </span>        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">square-tree</span> <span class="p">(</span><span class="nb">car </span><span class="nv">tree</span><span class="p">))</span>
<span class="lineno"> 5 </span>                    <span class="p">(</span><span class="nf">square-tree</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">tree</span><span class="p">))))))</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-tree</span> <span class="nv">tree</span><span class="p">)</span>
<span class="lineno"> 8 </span>  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">sub-tree</span><span class="p">)</span>
<span class="lineno"> 9 </span>         <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">sub-tree</span><span class="p">)</span>
<span class="lineno">10 </span>             <span class="p">(</span><span class="nf">square-tree</span> <span class="nv">sub-tree</span><span class="p">)</span>
<span class="lineno">11 </span>             <span class="p">(</span><span class="nf">square</span> <span class="nv">sub-tree</span><span class="p">)))</span>
<span class="lineno">12 </span>       <span class="nv">tree</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.31
  </h2>
  <div>
   <div>
    <p>
     Абстрагируйте ваш ответ к 2.30 что бы можно было записывать процедуру square-tree через tree-map.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-tree</span> <span class="nv">tree</span><span class="p">)</span> <span class="p">(</span><span class="nf">tree-map</span> <span class="nv">square</span> <span class="nv">tree</span><span class="p">))</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span>
<span class="lineno">4 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tree-map</span> <span class="nv">proc</span> <span class="nv">tree</span><span class="p">)</span>
<span class="lineno">5 </span>  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">sub-tree</span><span class="p">)</span>
<span class="lineno">6 </span>         <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">sub-tree</span><span class="p">)</span>
<span class="lineno">7 </span>             <span class="p">(</span><span class="nf">tree-map</span> <span class="nv">proc</span> <span class="nv">sub-tree</span><span class="p">)</span>
<span class="lineno">8 </span>             <span class="p">(</span><span class="nf">proc</span> <span class="nv">sub-tree</span><span class="p">)))</span>
<span class="lineno">9 </span>       <span class="nv">tree</span><span class="p">))</span>
</pre>
</div>  </div>
 </div>
 <div class="chapter-block">
  <h2>
   Упражнение 2.32
  </h2>
  <div>
   <div>
    <p>
     Мы можем представить set как список уникальных элементов, а так же set всех подмножеств как список списков. К примеру set (1 2 3), тогда сет всех подмножеств будет (() (3) (2) (2 3) (1) (1 3) (1 2) (1 2 3)). Допишите функцию генерирующую список всех подмножеств сета и дайте пояснение как она работает.
    </p>
   </div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">subsets</span> <span class="nv">s</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">s</span><span class="p">)</span>
<span class="lineno">3 </span>      <span class="p">(</span><span class="nb">list </span><span class="nv">nil</span><span class="p">)</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">rest</span> <span class="p">(</span><span class="nf">subsets</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">s</span><span class="p">))))</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nb">append </span><span class="nv">rest</span> <span class="p">(</span><span class="nb">map </span><span class="nv">&lt;??&gt;</span> <span class="nv">rest</span><span class="p">)))))</span>
</pre>
</div>
<div class="code-scheme">
<pre class="code literal-block"><span></span><span class="lineno">1 </span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">subsets</span> <span class="nv">s</span><span class="p">)</span>
<span class="lineno">2 </span>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">s</span><span class="p">)</span>
<span class="lineno">3 </span>      <span class="p">(</span><span class="nb">list </span><span class="nv">nil</span><span class="p">)</span>
<span class="lineno">4 </span>      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">rest</span> <span class="p">(</span><span class="nf">subsets</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">s</span><span class="p">))))</span>
<span class="lineno">5 </span>        <span class="p">(</span><span class="nb">append </span><span class="nv">rest</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">set</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">s</span><span class="p">)</span> <span class="nv">set</span><span class="p">))</span> <span class="nv">rest</span><span class="p">)))))</span>
<span class="lineno">6 </span>
<span class="lineno">7 </span><span class="p">(</span><span class="nf">subsets</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
<span class="lineno">8 </span><span class="c1">;Value: (() (3) (2) (2 3) (1) (1 3) (1 2) (1 2 3))</span>
</pre>
</div>   <div>
    <p>
     выбираем список без первого элемента, генерируем для него все подмножества. добавляем к полученным подмножествам такое же подмножество но везде первым элементом идет первый элемент. на последней итерации у нас получается пустое список, он возвращает () - нулевое подмножество. в итоге мы перебрали все возможные варианты.
    </p>
   </div>
  </div>
 </div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/hierarchical_data/" rel="tag">hierarchical_data</a></li>
            <li><a class="tag p-category" href="../../categories/scheme/" rel="tag">scheme</a></li>
            <li><a class="tag p-category" href="../../categories/sicp/" rel="tag">sicp</a></li>
            <li><a class="tag p-category" href="../../categories/the_closure_property/" rel="tag">the_closure_property</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../sicp-vvedenie-v-abstragirovanie-dannykh/" rel="prev" title="SICP Введение в абстрагирование данных">Предыдущая запись</a>
            </li>
            <li class="next">
                <a href="../sicp-223-posledovatelnosti-kak-obobshchaiushchie-interfeisy/" rel="next" title="SICP 2.2.3 Последовательности как обобщающие интерфейсы.">Следующая запись</a>
            </li>
        </ul></nav></aside></article></main><footer id="footer"><p>Contents © 2020         <a href="mailto:anton.s.pilipenko@gmail.com">Velikii Nehochuha</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
                <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
